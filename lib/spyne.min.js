!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs"),require("ramda"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("spyne",["rxjs","ramda","rxjs/operators"],t):"object"==typeof exports?exports.spyne=t(require("rxjs"),require("ramda"),require("rxjs/operators")):e.spyne=t(e.rxjs,e.R,e.rxjs.operators)}(self,(function(e,t,r){return(()=>{"use strict";var s={205:e=>{e.exports=t},443:e=>{e.exports=r},318:t=>{t.exports=e}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={exports:{}};return s[e](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{o.r(i),o.d(i,{Channel:()=>ce,ChannelFetch:()=>fe,ChannelFetchUtil:()=>Ce,ChannelPayload:()=>D,ChannelPayloadFilter:()=>X,ChannelsMap:()=>Ae,DomElement:()=>H,DomElementTemplate:()=>V,SpyneApp:()=>ye,SpyneAppProperties:()=>u,SpynePlugin:()=>ve,SpyneTrait:()=>Se,ViewStream:()=>oe,ViewStreamBroadcaster:()=>j,ViewStreamElement:()=>U,ViewStreamPayload:()=>k,ViewStreamSelector:()=>se,deepMerge:()=>l});var e=o(318),t=o(205);class r{constructor(){this.checkIfObjIsNotEmptyOrNil=r.checkIfObjIsNotEmptyOrNil.bind(this)}static checkIfObjIsNotEmptyOrNil(e){const r=(0,t.compose)((0,t.complement)(t.isEmpty),t.head,t.values),s=(0,t.compose)((0,t.complement)(t.isNil),t.head,t.values);return(0,t.allPass)([r,s])(e)}static checkIfParamValueMatchesRegex(e,r){const s=(0,t.reject)((0,t.equals)("routeName")),n=(0,t.compose)(s,t.keys),o=(0,t.compose)((0,t.find)((r=>(0,t.test)(new RegExp(r),e))),n)(r);return(0,t.is)(String,o)&&(r=(0,t.assoc)(e,(0,t.prop)(o,r),r)),r}static formatStrAsWindowLocation(e){return{hash:e,search:e,pathname:e}}static getLocationStrByType(e,r=!1,s=window.location){const n={slash:"pathname",query:"search",hash:"hash"}[!0===r?"hash":e];return(0,t.prop)(n,s).replace(/^(\/)?(#)?(\/)?(.*)$/,"$4")}static createRouteArrayFromParams(e,r,s="slash",n){let o=[],i=r=>{let s={},a=r.routeName,c=void 0!==e[a]?e[a]:(0,t.prop)(a,n);const l=typeof r[c];"string"===l?c=r[c]:"undefined"===l&&(r=this.checkIfParamValueMatchesRegex(c,r)),s[a]=c,this.checkIfObjIsNotEmptyOrNil(s)&&o.push(s);const d=(0,t.is)(Object,r),h=(0,t.has)(c,r),p=(0,t.has)("routePath",r);if(!0===(h&&d)){let e=r[c];(0,t.has)("routePath",e)&&i(e.routePath)}else!0===p&&void 0!==c&&i(r.routePath)};return i(r),o}static createSlashString(e){const r=(0,t.reject)(t.isNil),s=(0,t.when)((0,t.complement)(t.isNil,t.__),(0,t.join)("/")),n=(0,t.replace)(/^(\^*)(.*|^\$)(\$)$/,"$2");return(0,t.compose)(n,s,r,t.flatten,(0,t.map)(t.values))(e)}static createQueryString(e){const r=(0,t.reject)(t.isNil),s=this.checkIfObjIsNotEmptyOrNil,n=(0,t.compose)((0,t.join)("="),t.flatten,t.toPairs),o=(0,t.ifElse)(s,n,(0,t.always)(void 0)),i=(0,t.map)(o),a=(0,t.when)((0,t.complement)(t.isEmpty),(0,t.concat)("?"));return(0,t.compose)(a,(0,t.join)("&"),r,i)(e)}static checkPayloadForRegexOverrides(e,r,s="Value"){const n=(0,t.compose)((e=>(0,t.prop)(`${e}${s}`,r)),t.head,t.keys);return(0,t.map)((e=>{let r=n(e);return void 0!==r?(0,t.assoc)((0,t.compose)(t.head,t.keys)(e),r,e):e}),e)}static convertParamsToRoute(e,t=u.config.channels.ROUTE,s,n){const o=void 0!==s?s:t.type,i=t.isHash;let a=t.routes.routePath,c=void 0!==n?n:this.getLocationStrByType(o,i),l=this.convertRouteToParams(c,t,o).routeData,d=this.createRouteArrayFromParams(e,a,o,l);return d=r.checkPayloadForRegexOverrides(d,e),"query"===o?this.createQueryString(d):this.createSlashString(d)}static findIndexOfMatchedStringOrRegex(e,r){const s=(0,t.replace)(/^$/,"^$"),n=(0,t.either)((0,t.propEq)("str",e),(0,t.compose)((0,t.test)(t.__,e),(0,t.prop)("re")));return(0,t.compose)((0,t.findLastIndex)((0,t.equals)(!0)),(0,t.map)(n),(0,t.map)((e=>{return{str:e,re:(t=e,new RegExp(t))};var t})),(0,t.map)(s))(r)}static checkIfValueShouldMapToParam(e,s,n){let o=(0,t.compose)((0,t.map)(t.last),(0,t.map)((0,t.filter)((0,t.is)(String))),t.toPairs)(e),i=r.findIndexOfMatchedStringOrRegex(s,o),a=s;if(i>=0){let r=o[i],s=(0,t.invert)(e),n=(0,t.compose)(t.head,(0,t.defaultTo)([]),(0,t.prop)(r))(s);!0===/^([-\$\w]*)$/.test(n)&&!0===(0,t.is)(String,n)&&(a=n)}return a}static createArrFromSlashStr(e){return e.replace(/^([/])?(.*)$/,"$2").split("/")}static convertSlashRouteStrToParamsObj(e,r,s){const n=r;let o=this.createArrFromSlashStr(r),i=[],a=[],c=e;(0,t.reduce)(((e,r)=>{let n=this.checkIfValueShouldMapToParam(c,r,s);c=this.checkIfParamValueMatchesRegex(r,c);const o=(0,t.either)(t.isEmpty,t.isNil);void 0!==c&&(e=>e!==(0,t.last)(i))(c.routeName)&&!1===o(n)&&(i.push(c.routeName),a.push(n));let l=[r,"routePath"],d=(0,t.path)(l,c),h=(0,t.path)(["routePath"],c);void 0!==d?c=d:void 0!==h&&(c=h)}),0,o);let l=(0,t.zipObj)(i,a);const d=this.getLastArrVal(i);return{paths:i,pathInnermost:d,routeData:l,routeValue:n}}static getLastArrVal(e){return r=e,void 0!==(0,t.last)(r)?(0,t.last)(r):"";var r}static createDefaultParamFromEmptyStr(e,t){let r={};return r[e.routeName]=this.checkIfValueShouldMapToParam(e,t),r}static convertQueryStrToParams(e,r,s){const n=r;let o=r.replace(/^([?])?(.*)$/,"$2"),i=(0,t.compose)((0,t.map)((0,t.split)("=")),(0,t.split)("&"))(o),a=(0,t.fromPairs)(i),c=(0,t.map)(t.head,i);return!0===(0,t.isEmpty)(r)&&(a=this.createDefaultParamFromEmptyStr(e,r,s),c=(0,t.keys)(a)),{paths:c,pathInnermost:this.getLastArrVal(c),routeData:a,routeValue:n}}static convertRouteToParams(e,r,s){if(void 0===r)return{};const n=void 0!==s?s:r.type,o=(0,t.defaultTo)({},(0,t.prop)("regexTokens",r));let i=r.routes.routePath;return"query"===n?this.convertQueryStrToParams(i,e):(e=e.replace(/\/$|$/,"/"),this.convertSlashRouteStrToParamsObj(i,e,o))}}class s{constructor(){this.createPopStateStream=s.createPopStateStream.bind(this)}static createPopStateStream(t){(0,e.fromEventPattern)((function(e){window.onpopstate=e}),(function(){window.onpopstate=function(){}})).subscribe(t)}static getLastArrVal(e){return r=e,void 0!==(0,t.last)(r)?(0,t.last)(r):"";var r}static compareRouteKeywords(e={},r){const s=(e,r)=>void 0!==r?(0,t.pick)(r,e):e;let n=s(e,r);return{pickValues:s,compare:(e={},r)=>{let o=s(e,r);const i=e=>(0,t.compose)(t.keys,(0,t.filter)((0,t.propEq)(e,!0))),a=(0,t.compose)((0,t.map)((e=>{let r=(0,t.prop)(e,n),s=(0,t.prop)(e,o),i=(0,t.equals)(r,s),a=void 0!==r,c=void 0!==s,l=!i,d=!1===a&&!0===c,h=!0===a&&!1===c,p={};return p[e]={same:i,changed:l,added:d,removed:h,previousExists:a,nextExists:c},p})),t.uniq,(0,t.chain)(t.keys))([n,o]);let c=(0,t.chain)(i("changed"),a),l=(0,t.chain)(i("added"),a),d=(0,t.chain)(i("removed"),a);return n=o,{pathsAdded:l,pathsRemoved:d,pathsChanged:c}},getComparer:()=>n}}static getRouteArrData(e,r){let n=(0,t.filter)((0,t.includes)(t.__,e),r);return{paths:n,pathInnermost:s.getLastArrVal(n)}}static flattenConfigObject(e){const r=e=>(0,t.chain)((([e,s])=>"[object Object]"===Object.prototype.toString.call(s)?(0,t.map)((([t,r])=>[`${e}.${t}`,r]),r(s)):[[e,s]]),(0,t.toPairs)(e));return(0,t.values)((0,t.fromPairs)(r(e)))}static addRouteDatasets(e){const{type:s,isHash:n}=e,o=t=>("query"===s?"":!0===n?"#":"/")+r.convertParamsToRoute(t,e).replace(/^(.*\/)([\w\-]*\/?)(.*)$/gm,"$1$2"),i=/^([A-Za-z0-9_\-])+$/m,a=(e=[],r,s={})=>{let{routeName:n}=r;return(0,t.toPairs)(r).reduce(((r,c)=>{const[l,d]=c,h=(0,t.is)(Object,d),p=e=>(0,t.test)(i,e)?String(e).toUpperCase():l;if("routeName"===l||"404"===l)return r;n=n||(0,t.prop)("routeName",d);let u=(0,t.clone)(s);if(u[n]=String(l).replace(/([^A-Za-z0-9-_])/g,""),!0===h){if(1===(0,t.keys)(u).length){const e=(0,t.path)(["routePath","routeName"],d);if(e){const n=(0,t.clone)(u);n[e]="",n.navLevel=(0,t.keys)(s).length,n.title=p(l),n.href=o(n),r.push(n)}}u=a(e,d,u)}else u.title=p(l),u.href=o(u);return u.navLevel=(0,t.keys)(s).length,r.push(u),r}),[])};let c=a([],e.routes);const l=(0,t.flatten)(c);return{routeDatasetsArr:l,routeNamesArr:(e=>{const r=(0,t.reject)((0,t.includes)(t.__,["title","href","navLevel"]));return(0,t.compose)(t.uniq,r,t.flatten,(0,t.map)(t.keys))(e)})(l)}}static conformRouteObject(e={},r=!1){const n=(0,t.path)(["channels","ROUTE"],e);let{add404s:o}=void 0!==n?n:e;o=o||r;const i=e=>{let r=e[1];const s=(0,t.is)(Array,r);return""===r?e[1]="^$":s&&(e[1]=r.join("|")),e},a=(0,t.compose)(t.fromPairs,(0,t.map)((e=>{let[r,s]=e;const n=o?{404:".+"}:{},c=(0,t.is)(Object,s),l=(0,t.is)(Array,s),d="routePath"===r;return!0===c&&!1===l&&(e[1]=a(e[1]),d&&(e[1]=(0,t.compose)((0,t.mergeDeepRight)(n),t.fromPairs,(0,t.map)(i),t.toPairs)(e[1]))),e})),t.toPairs);if(void 0!==n){e.channels.ROUTE=a(e.channels.ROUTE);const r=s.addRouteDatasets(e.channels.ROUTE);return e.channels.ROUTE=(0,t.mergeRight)(e.channels.ROUTE,r),e}return a(e)}static getLocationData(){return(0,t.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}}function n(e){return e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function a(e,t){return t&&!0===t.clone&&n(e)?l((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function c(e,t,r){let s=e.slice();return t.forEach((function(t,o){void 0===s[o]?s[o]=a(t,r):n(t)?s[o]=l(e[o],t,r):-1===e.indexOf(t)&&s.push(a(t,r))})),s}function l(e,t,r){let s=Array.isArray(t),o=(r||{arrayMerge:c}).arrayMerge||c;return s?Array.isArray(e)?o(e,t,r):a(t,r):function(e,t,r){let s={};return n(e)&&Object.keys(e).forEach((function(t){s[t]=a(e[t],r)})),Object.keys(t).forEach((function(o){n(t[o])&&e[o]?s[o]=l(e[o],t[o],r):s[o]=a(t[o],r)})),s}(e,t,r)}let d,h,p;l.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce((function(e,r){return l(e,r,t)}))};let u=new class{constructor(){this._initialized=!1}initialize(e={},t={},r){h=r;const n=s.conformRouteObject(t);return d=l(e,n),console.log("CONFIG IN PROPS IS ",{_config:d}),this.getChannelActions=h.getChannelActions.bind(h),this.listRegisteredChannels=h.listRegisteredChannels.bind(h),this._initialized=!0,this.setChannelsMap(),d}conformRouteConfig(e=!1){d=s.conformRouteObject(d,e)}setChannelsMap(){const e=h.getStream.bind(h),t=h.testStream.bind(h),r=h.getProxySubject.bind(h);p={getStream:e,testStream:t,getProxySubject:r}}get channelsMap(){return p}get initialized(){return this._initialized}setConfigProperty(){}setChannelConfig(e,t){return d.channels[e]=t,d.channels[e]}get config(){return d}static listChannels(){return Array.from(h.map.keys())}registerChannel(){}addPluginConfig(e,t={}){void 0===d.plugins&&(d.plugins={}),d.plugins[e]=t}getPluginConfigByPluginName(e){return d.plugins[e]}tempGetChannelsInstance(){}tempGetConfig(){}get debug(){return!0===d.debug}};const E=o(318),m=o(318);let N=()=>({includes:()=>!0===u.initialized?u.listRegisteredChannels():["CHANNEL_ROUTE","CHANNEL_UI","CHANNEL_WINDOW","DISPATCHER"]}),g=["LOAD","RENDER","MOUNT","UNMOUNT","DISPOSE","GARBAGE_COLLECT","UPDATE"],_=["parent","self","child","children","view"],T=["Observable","BehaviorSubject","Subject","Observer","Subscriber","FromEventObservable"],A=["subscribe","combineLatest"],S=[],C=[],f=[],b=null,y=null,v=null,O=null,I=null,L=null;if(void 0!==t.compose&&void 0!==E){S=[{error:`need to match a valid name within ${T}`,predicate:e=>N().includes(e.name)},{error:"param 'observable' must contain a valid Observable",predicate:e=>void 0!==e.observable.subscribe},{error:"param action must be a registered action",predicate:e=>A.includes(e.action)}],C=[{error:"needs vsid number in srcElement",predicate:(0,t.compose)((0,t.is)(String),(0,t.path)(["data","srcElement","vsid"]))},{error:"needs a id in srcElement",predicate:(0,t.compose)((0,t.is)(String),(0,t.path)(["data","srcElement","id"]))}],f=function(){return[].concat(S).concat(C)};let e=[{error:`need to match a valid name within ${T}`,predicate:e=>N().includes(e.name)},{error:`needs one of the following step strings: ${g}`,predicate:e=>g.includes(e.STEP)},{error:`type needs to one of the following: ${_}`,predicate:e=>_.includes(e.type)},{error:"viewId needs to be added ",predicate:e=>void 0!==e.viewId}];y=function(){return[].concat(e)},v=function(){return[{error:"DISPOSE STEP requires a disposeItem param in the data object",predicate:e=>"DISPOSE"===e.STEP&&void 0!==e.data.disposeItems}].concat(e)},O=function(){return[{error:"UPDATE STEP requires a data object ",predicate:e=>"UPDATE"===e.STEP&&void 0!==e.data}].concat(e)},b=function(){return e.concat(S).concat(C)},I=function(){return[].concat(S).concat(C)},L=function(){let e=[{error:"param 'name' must be of a registered type",predicate:e=>N().includes(e.name)},{error:"param 'observable' must contain a valid Observable",predicate:e=>T.includes((0,e.observable)().constructor.name)},{error:"param action must be a registered action",predicate:e=>A.includes(e.action)}];return{streams:[{init:{name:"DISPATCHER",observable:()=>new m,action:"subscribe"},structure:{type:String,observable:E||m,action:String},validations:e},{init:{name:"UBU",observable:()=>new m,action:"subscribe"},structure:{type:String,observable:E||m,action:String},validations:e}]}}}class D{constructor(e,r,s,n,o,i){let a=e;i&&console.time(i);let c={channelName:e,action:r,srcElement:n,event:o};if(c.payload=D.deepFreeze(s),!0===u.debug){if(s.hasOwnProperty("payload")){let e=JSON.stringify(s);console.warn(`Spyne Warning: the following payload contains a nested payload property which may create conflicts: Action: ${r}, ${e}`)}const e=u.getChannelActions(a);D.validateAction(r,a,e)}return c.props=()=>(0,t.clone)((0,t.mergeAll)([{payload:D.deepClone(c.payload)},c.payload,{channel:a},{event:o},c.srcElement,{action:c.action}])),"CHANNEL_ROUTE"===a&&(c.location=D.getLocationData()),c._dir=void 0,Object.defineProperties(c,{$dir:{get:()=>c._dir,set:e=>c._dir=e}}),i&&console.timeEnd(i),c}static validateAction(e,r,s){let n=(0,t.includes)(e,s);return!1===n&&!0===u.initialized&&console.warn(`warning: Action: '${e}' is not registered within the ${r} channel!`),n}static getLocationData(){return(0,t.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getStreamItem(){}static deepClone(e){const r=(0,t.is)(Array),s=(0,t.is)(Object);var n;return!1===r(n=e)&&!0===s(n)?(0,t.compose)(t.fromPairs,t.toPairs,t.clone)(e):(0,t.clone)(e)}static deepFreeze(e){const r=(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"));try{Object.freeze(e),Object.getOwnPropertyNames(e).forEach((function(t){!e.hasOwnProperty(t)||!1!==r(e[t])||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||D.deepFreeze(e[t])}))}catch(t){return e}return e}static getMouseEventKeys(){return["altKey","bubbles","cancelBubble","cancelable","clientX","clientY","composed","ctrlKey","currentTarget","defaultPrevented","detail","eventPhase","fromElement","isTrusted","layerX","layerY","metaKey","movementX","movementY","offsetX","offsetY","pageX","pageY","path","relatedTarget","returnValue","screenX","screenY","shiftKey","sourceCapabilities","srcElement","target","timeStamp","toElement","type","view","which","x","y"]}}function R(){return{createpropsMap:function(){let e=new WeakMap,t={vsid:this.props.vsid};return e.set(t,this.props),{key:t,weakMap:e}},gc:function(){for(let e in this)delete this[e]},createId:function(){return Math.random().toString(36).replace(/\d/gm,"").substring(1,8)},setTraceFunc:function(e){return!0===e?console.log:()=>{}}}}const w=e=>{if(void 0!==e.constructor.name)return e.constructor.name;let r=e.toString();return(0,t.defaultTo)(String(r).substr(0,12),(0,t.match)(/^(function\s)(\w+)(\(.*)$/,r)[2])},P=(e,r=[])=>{r=(0,t.concat)(["length","name","prototype","constructor"],r);let s=(0,t.compose)((0,t.without)(r),t.uniq),n=s(Object.getOwnPropertyNames(e.constructor.prototype)),o=s((i=e.constructor,Object.getOwnPropertyNames(i)));var i;return{methods:n,staticMethods:o,allMethods:(0,t.concat)(n,o)}};class V{constructor(e,r){this.template=this.formatTemplate(e),(()=>{!0===(0,t.is)(Array,r)&&(r={spyneData:r},this.template=this.template.replace("{{/}}","{{/spyneData}}"),this.template=this.template.replace("{{#}}","{{#spyneData}}"))})(),this.templateData=r;let s=V.getStringArray(this.template),n=this.template.match(V.findTmplLoopsRE());n=null===n?[]:n;const o=V.parseTmplLoopsRE(),i=this.parseTheTmplLoop.bind(this),a=(0,t.includes)(t.__,n),c=(0,t.ifElse)(a,((e,t)=>e.replace(o,i)),this.addParams.bind(this));this.finalArr=s.map(c)}static getStringArray(e){let r=e.split(V.findTmplLoopsRE());const s=/^([\\n\s\W]+)$/;return(0,t.reject)((e=>e.match(s)),r)}static findTmplLoopsRE(){return/({{#\w+}}[\w\n\s\W]+?{{\/\w+}})/gm}static parseTmplLoopsRE(){return/({{#(\w+)}})([\w\n\s\W]+?)({{\/\2}})/gm}static swapParamsForTagsRE(){return/({{)(.*?)(}})/gm}removeThis(){this.finalArr=void 0,this.templateData=void 0,this.template=void 0}renderDocFrag(){const e=this.finalArr.join(""),t=/^([^>]*?)(<){1}(\b)(thead|col|colgroup|tbody|td|tfoot|tr|th)(\b)([^\0]*)$/.test(e)?e:document.createRange().createContextualFragment(e);return window.setTimeout(this.removeThis(),2),t}renderToString(){const e=this.finalArr.join("");return window.setTimeout(this.removeThis(),2),e}getTemplateString(){return this.finalArr.join("")}formatTemplate(e){return"SCRIPT"===(0,t.prop)("nodeName",e)?e.innerHTML:e}getDataValFromPathStr(e,r){const s=String(e).split(".");return(0,t.path)(s,r)||""}addParams(e){const t=/(\.)/gm;return e.replace(V.swapParamsForTagsRE(),((e,r,s,n)=>!1===t.test(s)&&void 0!==this.templateData[s]?this.templateData[s]:this.getDataValFromPathStr(s,this.templateData)))}parseTheTmplLoop(e,r,s,n){const o=/(\.)/gm,i=n;let a=this.templateData[s];const c=(e,t)=>t.replace(V.swapParamsForTagsRE(),((t,r,s)=>!1===o.test(s)&&void 0!==e[s]?e[s]:this.getDataValFromPathStr(s,e)));return!0===(0,t.isNil)(a)||(0,t.isEmpty)(a)?"":(void 0===a.length&&(a=[a]),a.map((e=>"string"==typeof e?((e,t)=>t.replace(V.swapParamsForTagsRE(),e))(e,i):c(e,i))).join(""))}}class H{constructor(e={}){var r;e.tagName=("div",r=e.tagName,(0,t.defaultTo)("div")(r)),e.attributes=void 0!==e.attributes?e.attributes:this.getDomAttributes(e),e.attrs=this.updateAttrs(e.attributes),e.fragment=document.createDocumentFragment(),this.props=e,this.addMixins()}setProp(e,t){this.props[e]=t}getProp(e){return this.props[e]}get el(){return this.props.el}setElAttrs(e,r){return this.getProp("attrs").forEach(((r,s)=>{"dataset"===s?(0,t.forEachObjIndexed)(((t,r)=>{e.dataset[r]=t}),r):e.setAttribute(s,r)})),e}updateAttrs(e,r){let s=void 0!==r?r:new Map;return(0,t.mapObjIndexed)(((e,t)=>s.set(t,e)),e),s}addTemplate(e){let r=this.getProp("template");return void 0!==r?(r=>{let s=this.getProp("data");s=(0,t.is)(Object,s)?s:{};let n=new V(r,s).renderDocFrag();return(0,t.is)(String,n)?e.innerHTML=n:e.appendChild(n),e})(r):e}createElement(e="div"){return document.createElement(e)}addContent(e){let r=this.getProp("data");if(!0===(0,t.is)(String,r)){let t=document.createTextNode(r);e.appendChild(t)}return e}execute(){let e=(0,t.pipe)(this.createElement.bind(this),this.setElAttrs.bind(this),this.addTemplate.bind(this),this.addContent.bind(this))(this.getProp("tagName"));this.props.el=e}render(){return this.execute(),this.props.template=void 0,this.props.data=void 0,this.props.attributes=void 0,this.getProp("el")}renderToHTMLString(){return this.execute(),this.props.template=void 0,this.props.data=void 0,this.props.attributes=void 0,this.getProp("el").outerHTML}returnIfDefined(e,t){if(void 0!==t){let r=void 0===t;e[t]=!1===r?t:l(e[t],t)}}updateprops(e){return this.returnIfDefined(this.props,e),this}updatepropsAndRun(e){return this.updateprops(e),this.execute(),this.getProp("fragment")}unmount(){void 0!==this.props&&(this.getProp("el").remove(),this.props=void 0,this.gc())}updateTag(e="div"){this.updateprops(e)}updateAttributes(e={}){this.updateprops(e)}updateTemplate(e){this.updateprops(e)}updateData(e={}){this.updateprops(e)}addTagAndRender(e="div"){this.updatepropsAndRun(e)}addAttrsibutesAndRender(e={}){this.updatepropsAndRun(e)}addTemplateAndRender(e){this.updatepropsAndRun(e)}addDataAndRender(e={}){this.updatepropsAndRun(e)}addMixins(){let e=R();this.gc=e.gc.bind(this)}getDomAttributes(e){return(0,t.pick)(this.attributesArray,e)}get attributesArray(){return["accept","accept-charset","accesskey","action","align","allow","alt","async","autocapitalize","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","dataset","datetime","decoding","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","importance","integrity","ismap","itemprop","keytype","kind","label","lang","language","lazyload","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","referrerpolicy","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","value","width","wrap"]}}let M=(e=!1,t=1,r="ease",s=!1)=>`${!0===s?"opacity:0;":""}transition: opacity ${t}s ${r}; opacity: ${!0===e?1:0};`;var W=o(443);class ${constructor(e){this.props.observableStreams=$.createDirectionalObservables()}static createDirectionalFiltersObject(){const e="internal",t="parent",r="child";return{P:[t],C:[r],PCI:[t,e,r],CI:[r,e],PI:[t,e],PC:[t,r]}}static addDefaultDir(e){return(0,t.flip)(t.mergeRight)({$dir:["internal"]},(0,t.clone)(e))}static addDownInternalDir(e,r=["internal","down"]){return(0,t.flip)(t.mergeRight)((0,t.clone)(e),{$dir:r})}static addChildAndInternalDir(e,r=["child","down"]){return(0,t.flip)(t.mergeRight)((0,t.clone)(e),{$dir:r})}static mapToDefaultDir(e){return this.addDefaultDir(e)}static createDirectionalObservables(r=new e.Subject,s,n){void 0!==s&&void 0!==n&&(r.viewName=s,r.vsid=n);const o=e=>(0,t.propSatisfies)((t=>t.includes(e)),"$dir"),i=o("parent"),a=o("child"),c=o("internal"),l=e=>(0,t.mergeRight)({from$:e}),d=l("child"),h=l("internal"),p=l("parent"),u=r.pipe((0,W.filter)((e=>void 0!==e&&void 0!==e.action))),E=r.pipe((0,W.filter)(c),(0,W.map)(h)),m=r.pipe((0,W.filter)(i),(0,W.map)(d)),N=r.pipe((0,W.filter)(a),(0,W.map)(p)),g={parent:m,internal:E,child:N};return{raw$:u,toInternal$:E,toParent$:m,toChild$:N,completeAll:()=>{(0,t.forEach)((e=>{e.complete(),e.isStopped=!0}),[u,E,m,N])},completeStream:(e=[])=>{void 0!==e&&e.length>=1&&e.forEach((e=>{var t;void 0!==g[e]&&((t=g[e]).complete(),t.isStopped=!0)}))}}}}class U{constructor(t,r={},s="",n="theName"){this.addMixins(),this._state="INIT",this.vsid=s,this.vsName=n,this.defaults={debug:!1,extendedHashMethods:{}},this.options=l(this.defaults,r),this.addActionListeners().forEach((e=>{let[t,r]=e;this.options.extendedHashMethods[t]=e=>this[r](e)})),this.options.hashMethods=this.setHashMethods(this.options.extendedHashMethods),this.sink$=t,this.sink$.subscribe(this.onObsSinkSubscribe.bind(this)),this.$dirs=$.createDirectionalFiltersObject(),this.addDefaultDir=$.addDefaultDir,this.sourceStreams=$.createDirectionalObservables(new e.Subject,this.vsName,this.vsid),this._source$=this.sourceStreams.toInternal$}addActionListeners(){return[]}setHashMethods(e={}){return l({VS_DETRITUS_COLLECT:e=>this.onGarbageCollect(e),READY_FOR_VS_DETRITUS_COLLECT:e=>this.onReadyForGC(e),EXTIRPATE:e=>this.onDispose(e),VS_SPAWN:e=>this.onRender(e),VS_SPAWN_AND_ATTACH_TO_PARENT:e=>this.onRenderAndAttachToParent(e),VS_SPAWN_AND_ATTACH_TO_DOM:e=>this.onRenderAndAttachToDom(e),ATTACH_CHILD_TO_SELF:e=>this.onAttachChildToSelf(e)},e)}createDomItem(){this.props=void 0!==this.props?this.props:{};let e=(0,t.filter)((e=>void 0!==e),(0,t.pick)(["id","className"],this.props)),{tagName:r,data:s,template:n}=this.props;return new H(r,e,s,n)}onDisposeCompleted(e){}animateInTween(e,t){!function(e,t){let r=1*window.getComputedStyle(e).opacity,s=M(!0,t,"ease",1===r);e.style.cssText+=s}(e,t)}animateOutTween(e,t,r){!function(e,t,r){let s=M(!1,t,"ease");e.style.cssText+=s,e.addEventListener("transitionend",r,!1)}(e,t,r)}setAnimateIn(e){if(!0===e.animateIn){let t=void 0!==e.el?e.el:this.domItem.el;this.animateInTween(t,e.animateInTime)}}disposeMethod(t){let r=void 0!==t.el.el?t.el.el:t.el;const s={action:"READY_FOR_VS_DETRITUS_COLLECT",$dir:this.$dirs.PI,el:r};let n=(0,e.bindCallback)(((e,t)=>{this.animateOutTween(r,e.animateOutTime,t)})),o=e=>{this._source$.next(s)};return(!0===t.animateOut?e=>(n(e).subscribe(o),{action:"EXTIRPATING",$dir:this.$dirs.CI}):()=>({action:"EXTIRPATE_AND_READY_FOR_VS_DETRITUS_COLLECT",$dir:this.$dirs.CI}))(t)}onDispose(e){return this.disposeMethod(e)}removeStream(){void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["internal","child"])}onReadyForGC(e){this.removeStream()}onGarbageCollect(e){void 0!==this.domItem&&this.domItem.unmount(),void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["parent"])}getSourceStream(){return this._source$}combineDomItems(e){let r=(0,t.isNil)(e.query)?e.node:e.query;("appendChild"===e.attachType?(e,t)=>e.appendChild(t):(e,t)=>e.insertBefore(t,e.firstChild))(r,this.domItem.render()),this.setAnimateIn(e)}onAttachChildToSelf(e){let t=e.childRenderData;return this.combineDomItems(t),{action:"CHILD_ATTACHED",$dir:this.$dirs.PI}}onRenderAndAttachToParent(e){return this.onRender(e),this.combineDomItems(e),{action:"VS_SPAWNED_AND_ATTACHED_TO_PARENT",el:this.domItem.el,$dir:this.$dirs.PI}}renderDomItem(e){let t,r,s,n;return[t,r,s,n]=e,this.domItem=new H({tagName:t,attributes:r,data:s,template:n}),this.domItem}onRender(e){return{action:"VS_SPAWNED",el:(e=>this.renderDomItem(e))((0,t.props)(["tagName","domAttributes","data","template"],e)),$dir:this.$dirs.I}}extendedMethods(e){}onRenderAndAttachToDom(e){return e.attachData.el=(e=>this.renderDomItem(e))((0,t.props)(["tagName","domAttributes","data","template"],e)),this.combineDomItems(e.attachData),{action:"VS_SPAWNED_AND_ATTACHED_TO_DOM",el:e.attachData.el.el,$dir:this.$dirs.CI}}onObsSinkSubscribe(e){let r=e.action,s=(0,t.defaultTo)((e=>this.extendedMethods(e)))(this.options.hashMethods[r])(e);void 0!==s&&(e=>{this._source$.next(e)})(Object.freeze(s))}addMixins(){}}class F{constructor(e,t){this.context=e,this.enhancersMap=new Map,this.enhancersArr=t,this.initMap(),this.addAllEnhancerMethods()}initMap(){this.enhancersMap.set("ALL",[]);let e=P(this.context).allMethods;this.updateMap("LOCAL",e)}getEnhancersMap(){return this.enhancersMap}updateMap(e,r){let s=(0,t.concat)(this.enhancersMap.get("ALL"),r);this.enhancersMap.set(e,r),this.enhancersMap.set("ALL",s)}getMethodsArr(e){return this.enhancersMap.get(e)}createEnhancerMethodsObj(e){const r=e=>console.error(`Spyne Error: The following enhancer method, "${e}", already exists and cannot be added to the ${s.name} Enhancer!`);let s=new e(this.context),n=s.getEnhancerMethods(),o=(e=>{let s=(0,t.includes)(t.__,this.getMethodsArr("ALL")),n=(0,t.filter)(s,e);return n.forEach(r),n})(n.allMethods),i=(0,t.dropWhile)((0,t.includes)(t.__,o));return n=(0,t.map)(i,n),this.updateMap(s.name,n.allMethods),n.enhancer=s,n.name=s.name,n}addAllEnhancerMethods(){(0,t.forEach)((e=>{let t=this.createEnhancerMethodsObj(e);t.enhancer.bindParentViewStream(t,this.context)}),this.enhancersArr)}}function x(){setTimeout((()=>{(0,t.forEach)((e=>{}),this)}),1)}class k{constructor(e,t,r,s="subscribe",n=!1){this.addMixins(),this.options={name:e,observable:t,data:r,action:s},this.sendToDirectorStream(this.options)}getValidationChecks(e){return!0===window.Spyne.channels.map.has(e)?(e=>this.onRunValidations(e))(f):("payload Needs a Valid Stream Name!",console.warn("payload Needs a Valid Stream Name!"))}onRunValidations(e){}onPayloadValidated(e){this.sendToDirectorStream(e)}sendToDirectorStream(e){window.Spyne.channels.getStream("DISPATCHER").next(e),this.gc()}onError(e){console.warn("payload failed due to:\n"+e.map((e=>"* "+e)).join("\n")),this.gc()}onSuccess(e){this.onPayloadValidated(e)}addMixins(){this.gc=x}}class j{constructor(e,t){this.addMixins(),this.props=e,this.broadcastFn=t,this.broadcaster(this.broadcastFn)}addDblClickEvt(r){return(0,e.fromEvent)(r,"dblclick").pipe((0,W.map)((e=>{let r=(0,t.clone)(e);return r.typeOverRide="dblclick",r})))}broadcast(r){let s,n={UI:this.sendUIPayload,ROUTE:this.sendRoutePayload},[o,i,a]=r,c=this.props.el.querySelectorAll(o);if(c.length<=0){let e=this.props.el;const t=t=>{t===e&&(c=[t])};(()=>{let r=(null!==e.parentElement?e.parentElement:document).querySelectorAll(o);r.forEach=Array.prototype.forEach,r.forEach(t)})()}let l=void 0!==a,d=!0===(0,t.path)(["Spyne","config","debug"],window);!0==(void 0===c||c.length<=0)&&!0===d?console.warn(`Spyne Warning: The item ${o}, does not appear to exist!`):(c.forEach=Array.prototype.forEach,c.forEach((r=>{let o="dblClick"!==i?(0,e.fromEvent)(r,i,{preventDefault:()=>!0}):this.addDblClickEvt(r);s=r.dataset.channel;let a={};a.payload=(e=>{let t={};for(let r in e)t[r]=e[r];return t})(r.dataset),a.payload=(0,t.omit)(["channel"],a.payload),a.channel=s,a.srcElement={},a.srcElement.id=this.props.id,a.srcElement.vsid=this.props.vsid,a.srcElement.isLocalEvent=l,a.srcElement.srcEvent=i,a.srcElement.el=r,(void 0!==s?n[s]:n.UI)(o,a)})))}broadcaster(e){e().forEach((e=>this.broadcast(e)))}addMixins(){let e=function(e,t){return new k("CHANNEL_ROUTE",e,t,"subscribe")},t=function(e,t){return new k("CHANNEL_UI",e,t,"subscribe")};this.sendUIPayload=t,this.sendRoutePayload=e}}const G=o(205).map,q=(0,t.compose)(t.not,(0,t.is)(Array)),Y=(0,t.compose)(t.not,t.isEmpty),B=(0,t.allPass)([(0,t.is)(String),Y]),z=(0,t.allPass)([(0,t.is)(Array),Y]),K=(0,t.compose)((0,t.allPass)([q,(0,t.is)(Object)])),Q=(0,t.compose)((0,t.allPass)([Y,q,(0,t.is)(Object)]));class X{constructor(e,r={},s,n){K(e)&&(r=e,e=(0,t.prop)("selector",r),n=n||(0,t.prop)("testMode",r));const o=[s,(0,t.prop)("debugLabel",r)];s=(0,t.compose)((0,t.find)((0,t.is)(String)))(o);let i=(0,t.omit)(["debugLabel","label","selector","props","testMode","propFilters"],r);void 0!==r.props?i=(0,t.mergeAll)([r.props,i]):void 0!==r.propFilters&&(i=(0,t.mergeAll)([r.propFilters,i])),r.propFilters=i;let{propFilters:a}=r;const c=B(e)?X.filterSelector([e],s):void 0,l=z(e)?X.filterSelector(e,s):void 0,d=Q(a)?X.filterData(a,s):void 0;let h=(0,t.reject)(t.isNil,[c,l,d]);const p=(0,t.isEmpty)(h);return p&&(h=[(0,t.always)(!1)],!0===u.debug&&!0!==n&&console.warn(`Spyne Warning: The Channel Filter, with selector: ${e}, and propFilters:${a} appears to be empty!`)),!0===n?{selector:e,propFilters:a,debugLabel:s,filters:r,testMode:n,filtersAreEmpty:p}:(0,t.allPass)(h)}static filterData(e,r){const s=r;return(()=>{if((0,t.isEmpty)(e))return(0,t.always)(!1);e=G(((e,r,s)=>{return!0===(0,t.is)(String,e)?(n=e,e=>e===n):e;var n}),e);let r=(0,t.where)(e);return(0,t.compose)(r,(r=>{if(void 0===s)return r;const n={};return(0,t.forEachObjIndexed)(((e,s)=>n[s]=e((0,t.prop)(s,r))),e),console.log(`%c CHANNEL PAYLOAD FILTER DEBUGGER ["${s}"] - values:    `,"color:orange;",{propsBooleans:n,comparedObj:r}),r}),(0,t.defaultTo)({}),(e=>{const{payload:t,srcElement:r,event:s}=e||{};return Object.assign({},e,s,r,t)}))})()}static checkPayloadSelector(e,r,s){const{payload:n,srcElement:o,event:i}=s||{},a=[o,n,(0,t.prop)("srcElement",i),s].reduce(((e,r)=>{const s=(0,t.prop)("el",r);return X.elIsDomElement(s)&&void 0===e&&(e=s),e}),void 0),c=e=>e.isEqualNode(a),l=e=>{let r=(0,t.flatten)(document.querySelectorAll(e));return G(c,r)};if(void 0!==r){let s=(0,t.compose)(t.flatten,G(l))(e);const n=e;console.log(`%c CHANNEL PAYLOAD FILTER DEBUGGER ["${r}"] - selectors: `,"color:orange;",{el:a,selectorsArr:n,nodeArrResultsDebugger:s})}if("object"!=typeof a)return!1;let d=(0,t.compose)(t.flatten,G(l))(e);return!0!==(0,t.isEmpty)(d)&&(0,t.any)((0,t.equals)(!0),d)}static elIsDomElement(e){return(0,t.is)(String,e)&&(e=document.querySelector(e)),(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"))(e)}static filterSelector(e,r){let s=(0,t.reject)(t.isEmpty,e);return(0,t.curry)(X.checkPayloadSelector)(s,r)}}function J(){return!0===(0,t.path)(["Spyne","config","debug"],window)}function Z(e,r,s=!1){let n=te(e,r,s);return 1===n.length?(0,t.head)(n):n}function ee(e,r,s){let n=document.querySelector(e);!1!==(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"))(n)?void 0!==r&&null===n.querySelector(r)&&!0===J()&&!0===s&&console.warn(`Spyne Warning: the selector, ${r} does not exist in this el, ${e}`):console.warn(`Spyne Warning: the el object is not a valid single element, ${n}`)}function te(e,t,r=!1){let s=void 0!==t?`${e} ${t}`:e;return!0===r&&ee(e,t,r),(e=>{try{document.querySelectorAll(e)}catch(e){return[]}return document.querySelectorAll(e)})(s)}function re(e,t,r){return te(t,r).forEach((t=>{t.style.cssText=e})),this}function se(e,r){function s(t){return se(e,t)}return ee(e="string"==typeof e?e:function(e){let t=`${Math.random().toString(36).replace(/\d/gm,"").substring(1,8)}`;return void 0===e.dataset.vsid?e.dataset.vsid=t:t=e.dataset.vsid,`[data-vsid='${t}']`}(e),r,!1),s.map=t=>Array.from(te(e,r)).map(t),s.forEach=t=>Array.from(te(e,r)).map(t),s.getNodeListArray=()=>te(e,r),s.addClass=t=>(te(e,r).forEach((e=>e.classList.add(t))),this),s.removeClass=t=>(te(e,r).forEach((e=>{e.classList.remove(t)})),this),s.setClass=s=>(te(e,r).forEach((e=>{let r=(0,t.compose)((0,t.reject)(t.isEmpty),(0,t.split)(" "))(e.className),n=s.split(" ");r.forEach((t=>e.classList.remove(t))),n.forEach((t=>e.classList.add(t)))})),this),s.unmount=()=>{},s.toggleClass=(t,s)=>(te(e,r).forEach((e=>{(s=void 0!==s?s:!e.classList.contains(t))?e.classList.add(t):e.classList.remove(t)})),this),s.toggle=(e,t)=>(s.toggleClass(e,t),this),s.appendChild=e=>(0!==s.el.length?s.el.appendChild(e):console.warn(`Spyne Warning: The selector, ${r} does not appear to be valid!`),s.el),s.addAnimClass=t=>{window.setTimeout((()=>{te(e,r).forEach((e=>e.classList.add(t)))}),1)},s.setActiveItem=(s,n)=>{let o=te(e,r),i="string"==typeof n?Z(e,n):n;var a;return!0===(a=i,(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"))(a))?o.forEach((e=>e.isEqualNode(i)?e.classList.add(s):e.classList.remove(s))):!0===J()&&console.warn(`Spyne Warning: The selector, ${n}, does not appear to be a valid item in setActiveItem: ${s}`),this},Object.defineProperty(s,"el",{get:()=>Z(e,r,!0)}),Object.defineProperty(s,"els",{get:()=>te(e,r)}),Object.defineProperty(s,"len",{get:()=>te(e,r,!1).length}),Object.defineProperty(s,"exists",{get:()=>te(e,r,!1).length>=1}),Object.defineProperty(s,"exist",{get:()=>te(e,r,!1).length>=1}),Object.defineProperty(s,"nodeList",{get:()=>te(e,r)}),Object.defineProperty(s,"arr",{get:()=>{let t=Z(e,r,!0);return void 0===t?[]:void 0===t.length?[t]:Array.from(t)}}),Object.defineProperty(s,"inline",{set:t=>re(t,e,r)}),Object.defineProperty(s,"inlineCss",{set:t=>re(t,e,r)}),s}const ne=o(205).map;class oe{constructor(r={}){this.vsnum=Math.random(),this.addMixins(),this.defaults=()=>{const e=this.createId(),t=r.id?r.id:e;return{vsid:e,id:t,tagName:"div",el:void 0,data:void 0,animateIn:!1,animateInTime:.5,animateOut:!1,animateOutTime:.5,sendLifecyleEvents:!1,hashId:`#${t}`,id$:`#${t}`,viewClass:U,extendedSourcesHashMethods:{},debug:!1,template:void 0,node:document.createDocumentFragment(),name:w(this)}},this._state={},this.$dirs=$.createDirectionalFiltersObject(),this.addDefaultDirection=$.addDefaultDir,this.addDownInternalDir=$.addDownInternalDir,this.props=l(this.defaults(),r),this.sendLifecycleMethod=!0===this.props.sendLifecyleEvents?this.sendLifecycleMethodActive.bind(this):this.sendLifecycleMethodInactive.bind(this);let s=this.attributesArray;this.props.domAttributes=(0,t.pick)(s,this.props),void 0!==this.props.traits&&this.addTraits(this.props.traits),this.loadEnhancers(),this.loadAllMethods(),this.props.action="LOADED",this.sink$=new e.Subject;const n=this.props.viewClass;this.view=new n(this.sink$,{},this.props.vsid,this.props.id),this.sourceStreams=this.view.sourceStreams,this._rawSource$=this.view.getSourceStream(),this._rawSource$.viewName=this.props.name,this.sendEventsDownStream=this.sendEventsDownStreamFn,this.initViewStream(),this.isDevMode=oe.isDevMode(),this.props.addedChannels=[],this.checkIfElementAlreadyExists()}updatePropsToMatchEl(){const e=(0,t.compose)(t.toLower,(0,t.either)((0,t.prop)("tagName"),(0,t.always)("")));this.props.tagName=e(this.props.el)}checkIfElementAlreadyExists(){const e=(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"));(0,t.propSatisfies)((0,t.allPass)([e=>document.body.contains(e),e]),"el")(this.props)&&(this.updatePropsToMatchEl(),this.postRender())}loadEnhancers(e=[]){let t=new F(this,e);this.props.enhancersMap=t.getEnhancersMap(),t=void 0}loadAllMethods(){const e=(0,t.curry)(this.onChannelMethodCall.bind(this));this.addActionListeners().forEach((r=>{let[s,n,o]=r;(0,t.is)(String,o)&&(o=new X({selector:o})),this.props.extendedSourcesHashMethods[s]=e(n,o)})),this.props.hashSourceMethods=this.setSourceHashMethods(this.props.extendedSourcesHashMethods)}addActionListeners(){return[]}onChannelMethodCall(e,r,s){if(void 0!==s.$dir&&s.$dir.includes("child")&&!0!==this.deleted){let e=l({},s);e.$dir=this.$dirs.C,this.sourceStreams.raw$.next(e)}let n=(0,t.defaultTo)((0,t.always)(!0),r);Math.floor(999999*Math.random()),!0===n(s)&&(t=>{void 0===this[e]?console.warn(`Spyne Warning: The method, ${e} does not appear to exist in ${this.constructor.name}!`):this[e](t)})(s=(0,t.omit)(["$dir"],s))}setSourceHashMethods(e={}){let t={EXTIRPATING:e=>this.checkParentDispose(e),EXTIRPATE:e=>this.disposeViewStream(e),VS_SPAWNED:e=>this.onVSRendered(e),VS_SPAWNED_AND_ATTACHED_TO_DOM:e=>this.onVSRendered(e),VS_SPAWNED_AND_ATTACHED_TO_PARENT:e=>this.onVSRendered(e),READY_FOR_VS_DETRITUS_COLLECT:e=>this.onReadyToGC(e),VS_NULLITY:()=>({})};return l.all([{},t,e])}initViewStream(){this._source$=this._rawSource$.pipe((0,W.map)((e=>this.onMapViewSource(e))),(0,W.takeWhile)(this.notGCSTATE)),this.initAutoMergeSourceStreams(),this.updateSourceSubscription(this._source$,!0)}notGCSTATE(e){return!e.action.includes("READY_FOR_VS_DETRITUS_COLLECT")}eqGCSTATE(e){return!e.action.includes("READY_FOR_VS_DETRITUS_COLLECT")}notCOMPLETED(e){return!e.action.includes("COMPLETED")}notGCCOMPLETE(e){return!e.action.includes("GC_COMPLETE")}testVal(e){console.log("TESTING VALL IS ",e)}addParentStream(e,t){this.parent$=e.pipe((0,W.filter)((e=>void 0!==e&&void 0!==e.action)),(0,W.map)((e=>{let t=l({},e);return"EXTIRPATE_AND_READY_FOR_VS_DETRITUS_COLLECT"===t.action&&(this.disposeViewStream(t),t.action="READY_FOR_VS_DETRITUS_COLLECT"),t}))),this.updateSourceSubscription(this.parent$,!1,"PARENT"),this.renderAndAttachToParent(t)}addChildStream(e){let t=e.pipe((0,W.filter)((e=>void 0!==e&&void 0!==e.action)),(0,W.tap)((e=>this.tracer("addChildStraem do ",e))),(0,W.map)((e=>e)),(0,W.finalize)((e=>this.onChildCompleted(t.source))));this.updateSourceSubscription(t,!0,"CHILD")}onChildDisposed(e){}onChildCompleted(e){let r=(e=>{let r=e=>{for(;void 0!==e.destination;)e=r(e.destination);return e};return(0,t.pick)(["id","vsid"],r(e))})(e);return this.tracer("onChildCompleted ",this.vsnum,e),this.onChildDisposed(r,e),r}initAutoMergeSourceStreams(){let t={next:this.onSubscribeToSourcesNext.bind(this),error:this.onSubscribeToSourcesError.bind(this),complete:this.onSubscribeToSourcesComplete.bind(this)},r=()=>{this.props.el$=void 0,this.uberSource$.complete(),this.autoSubscriber$.complete(),this.sink$.complete(),this.props=void 0,this.deleted=!0,this.tracer("completeAll",this.deleted,this.props)},s=()=>{n-=1,0===n&&r()},n=0;this.uberSource$=new e.Subject,this.autoMergeSubject$=this.uberSource$.pipe((0,W.mergeMap)((e=>{let t=e.observable.pipe((0,W.filter)((e=>void 0!==e&&void 0!==e.action)),(0,W.map)((e=>{let t=l({},e);return t.action=e.action,this.tracer("autoMergeSubject$",t),t})));return!1===e.autoClosesBool?t:(n+=1,t.pipe((0,W.finalize)(s)))}))),this.autoSubscriber$=this.autoMergeSubject$.pipe((0,W.filter)((e=>void 0!==e&&void 0!==e.action))).subscribe(t)}updateSourceSubscription(e,t=!1,r){let s={observable:e,autoClosesBool:t,rel:r};this.tracer("updateSourceSubscription ",this.vsnum,s),this.uberSource$.next(s)}onSubscribeToSourcesNext(e={}){let r=(0,t.defaultTo)((e=>this.sendExtendedStreams(e)));const s=void 0!==(n=this.props.hashSourceMethods)[o=e.action]?o:(0,t.compose)(t.head,(0,t.filter)((0,t.compose)((0,t.test)(t.__,o),(e=>new RegExp(e)))))((0,t.keys)(n));var n,o;r(this.props.hashSourceMethods[s])(e),this.tracer("onSubscribeToSourcesNext",{payload:e})}onSubscribeToSourcesError(e=""){console.log("ALL ERROR  ",this.constructor.name,e)}onSubscribeToSourcesComplete(){this.tracer("onSubscribeToSourcesComplete","VS_DETRITUS_COLLECT"),this.openSpigot("VS_DETRITUS_COLLECT")}get source$(){return this._source$}sendExtendedStreams(e){this.tracer("sendExtendedStreams",e),this.openSpigot(e.action,e)}renderAndAttachToParent(e){this.openSpigot("VS_SPAWN_AND_ATTACH_TO_PARENT",e)}renderView(){this.openSpigot("VS_SPAWN")}renderViewAndAttachToDom(e,t,r){let s={node:e,type:t,attachType:r};this.openSpigot("VS_SPAWN_AND_ATTACH_TO_DOM",{attachData:s})}checkParentDispose(e){"parent"===e.from$&&this.disposeViewStream(e)}onBeforeDispose(){}setTimeout(e,r=0,s=!1){window.setTimeout(((...r)=>{if(void 0!==this&&void 0!==this.props){const n=!0===s?e.bind(this):e;(0,t.apply)(n,r)}}),r)}disposeViewStream(e){this.onBeforeDispose(),this.openSpigot("EXTIRPATE")}onChildDispose(e){}onParentDisposing(e){this.openSpigot("EXTIRPATE")}onReadyToGC(e){const t=void 0!==e.from$&&"internal"===e.from$;this.tracer("onReadyToGC",t,e)}openSpigot(e,r={}){if(void 0!==this.props){this.props.action=e;let s=(0,t.mergeRight)(this.props,r);this.sink$.next(Object.freeze(s))}}static isDevMode(){return u.debug}setAttachData(e,r){return{node:this.props.el,type:"ViewStreamObservable",attachType:e,query:(()=>{let e=this.props.el.querySelector(r);return!0===oe.isDevMode()&&(0,t.is)(String,r)&&(0,t.isNil)(e)&&console.warn(`Spyne Warning: The appendView query in ${this.props.name}, '${r}', appears to not exist!`),e})()}}getParentEls(e,t){let r=e=>e.parentElement,s=0,n=e;for(;s<t;)n=r(n),s++;return n}setAttachParentData(e,t,r){return t=""!==t?t:void 0,{node:this.getParentEls(this.props.el,r),type:"ViewStreamObservable",attachType:e,query:this.props.el.parentElement.querySelector(t)}}onMapViewSource(e={}){return this.props=(0,t.mergeRight)(this.props,e),e}exchangeViewsWithChild(e,t){this.addChildStream(e.sourceStreams.toParent$),e.addParentStream(this.sourceStreams.toChild$,t)}appendToDom(e){void 0!==this.props.el&&console.warn(`Spyne Warning: The ViewStream, ${this.props.name}, has an element, ${this.props.el}, that is already rendered and does not need to be appendedToDom. This may create unsusual side effects!`),this.renderViewAndAttachToDom(e,"dom","appendChild")}prependToDom(e){void 0!==this.props.el&&console.warn(`Spyne Warning: The ViewStream, ${this.props.name}, has an element, ${this.props.el}, that is already rendered and does not need to be prependedToDom. This may create unsusual side effects!`),this.renderViewAndAttachToDom(e,"dom","prependChild")}appendView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("appendChild",t))}appendViewToParentEl(e,t,r=1){this.exchangeViewsWithChild(e,this.setAttachParentData("appendChild",t,r))}prependViewToParentEl(e,t,r=1){this.exchangeViewsWithChild(e,this.setAttachParentData("prependChild",t,r))}prependView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("prependChild",t))}appendToNull(){let e=document.getElementById("spyne-null-views");this.renderViewAndAttachToDom(e,"dom","appendChild")}onVSRendered(e){"internal"===e.from$&&this.postRender()}postRender(){if(this.beforeAfterRender(),this.afterRender(),this.onRendered(),!0===this.isDevMode){const e=this.broadcastEvents();!1===oe.isValidNestedArr(e)&&console.warn(`Spyne Warning: The array returned from broadcastEvents in ${this.props.name}, '${JSON.stringify(e)}', does not appear to be properly formatted!`)}this.viewsStreamBroadcaster=new j(this.props,this.broadcastEvents.bind(this)),this.afterBroadcastEvents()}addTraits(e){"Array"!==e.constructor.name&&(e=[e]),e.forEach((e=>{new e(this)})),!0===this.isDevMode&&this.addActionListeners()}afterBroadcastEvents(){if(!0===this.isDevMode){const e=e=>e[0],r=this.addActionListeners();let s=r.map(e);if(!1===oe.isValidNestedArr(r))console.warn(`Spyne Warning: The array returned from addActionsListeners in ${this.props.name}, '${JSON.stringify(r)}', does not appear to be properly formatted!`);else{const e=e=>{const r=(0,t.defaultTo)("",e[1]);!1===(0,t.is)(Function,this[r])&&console.warn(`Spyne Warning: The method in addActionListeners nested Array, '${JSON.stringify(e)}', in ${this.props.name}, does not appear to exist!`)};(0,t.compose)((0,t.forEach)(e),(0,t.defaultTo)([]))(r)}const n=()=>{void 0!==(0,t.path)(["props","addedChannels"],this)&&oe.checkIfActionsAreRegistered.bind(this)(this.props.addedChannels,s)};this.setTimeout(n,500)}}static checkIfActionsAreRegistered(e=[],r){if(r.length>0){const s=r=>{let s=new RegExp(r);if((0,t.findIndex)((0,t.test)(s),n)<0){let t=1===e.length?"from added channel":"from added dchannels";console.warn(`Spyne Warning: The action, ${r}, in ${this.props.name}, does not match any of the registered actions ${t}, ${e.join(", ")}`)}};let n=(e=>{let r=e.map((e=>window.Spyne.channels.getChannelActions(e)));return(0,t.flatten)(r)})(e);r.forEach(s)}}setDataVSID(){this.props.el.dataset.vsid=this.props.vsid}beforeAfterRender(){this.setDataVSID(),this.props.el$=se(this.props.el)}downStream(){}onRendered(){}afterRender(){}static isValidNestedArr(e){const r=(0,t.equals)(!0),s=(0,t.all)(r),n=(0,t.is)(String),o=(0,t.compose)(s,ne(n),(0,t.slice)(0,2),(0,t.defaultTo)([]));return(0,t.compose)(s,ne(o),(0,t.defaultTo)([]))(e)}broadcastEvents(){return[]}getChannel(e){return(0,t.ifElse)((e=>N().includes(e)),(e=>window.Spyne.channels.getStream(e).observer.pipe((0,W.takeWhile)((e=>!0!==this.deleted)))),(e=>console.warn(`channel name ${e} is not within ${N}`)))(e)}addChannel(e,r=!1,s=!1,n=!1){const o=!0===s?this.$dirs.CI:this.$dirs.I,i=(0,t.path)(["srcElement","isLocalEvent"]),a=(0,t.path)(["srcElement","vsid"]),c=[(0,W.map)((e=>{let t=e;return t.$dir=o,t})),(0,W.filter)((e=>{let t=a(e);return!0!==i(e)||t===this.props.vsid}))];!0===r&&c.unshift((0,W.skip)(1));let l=this.getChannel(e).pipe(...c);this.updateSourceSubscription(l,!1),this.props.addedChannels.push(e)}checkIfChannelExists(e){let t=void 0!==window.Spyne.channels.map.get(e);return!0!==t&&console.warn(`SPYNE WARNING: The ChannelPayload from ${this.props.name}, has been sent to a channel, ${e}, that has not been registered!`),t}sendInfoToChannel(r,s={},n="VIEWSTREAM_EVENT"){let o={payload:s,action:n};if(o.srcElement=(0,t.compose)((0,t.pick)(["id","vsid","class","tagName"]),(0,t.prop)("props"))(this),!0===this.checkIfChannelExists(r)){!1===/CHANNEL_LIFECYCLE/.test(n)&&Object.defineProperties(o,{payload:{get:()=>(0,t.clone)(s)}});let i=(0,e.of)(o);return new k(r,i,o)}}tracer(...e){this.sendLifecycleMethod(...e)}sendLifecycleMethodInactive(){}sendLifecycleMethodActive(e,r){let s="VS_DETRITUS_COLLECT"===r;!0===(0,t.where)({from$:(0,t.equals)("internal"),action:(0,t.equals)("VS_SPAWNED_AND_ATTACHED_TO_PARENT")},r)?this.sendInfoToChannel("CHANNEL_LIFECYCLE",{action:"CHANNEL_LIFECYCLE_RENDERED_EVENT"},"CHANNEL_LIFECYCLE_RENDERED_EVENT"):!0===s&&this.sendInfoToChannel("CHANNEL_LIFECYCLE",{action:"CHANNEL_LIFECYCLE_DISPOSED_EVENT"},"CHANNEL_LIFECYCLE_DISPOSED_EVENT")}createActionFilter(e,t){return new X(e,t)}isLocalEvent(e){return void 0!==(0,t.path)(["srcElement","el"],e)&&this.props.el.contains(e.srcElement.el)}get attributesArray(){return["accept","accept-charset","accesskey","action","align","allow","alt","aria-autocomplete","aria-checked","aria-disabled","aria-expanded","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-level","aria-multiline","aria-multiselectable","aria-orientation","aria-pressed","aria-readonly","aria-required","aria-selected","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","aria-atomic","aria-busy","aria-live","aria-relevant","aria-dropeffect","aria-grabbed","aria-activedescendant","aria-controls","aria-describedby","aria-flowto","aria-labelledby","aria-owns","aria-posinset","aria-setsize","async","autocapitalize","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","dataset","datetime","decoding","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","importance","integrity","ismap","itemprop","keytype","kind","label","lang","language","lazyload","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","referrerpolicy","rel","required","reversed","role","rows","rowspan","sandbox","scope","scoped","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","value","width","wrap"]}addMixins(){let e=R();this.createId=e.createId}}class ie{constructor(e){let r=String(e.props.name),s=`${r}_ROUTE_UPDATER`;return(0,t.curry)(ie.createTemporaryViewStreamObj)({id:s,name:r})}static createTemporaryViewStreamObj(e,t){let{name:r,id:s}=e,n=t,o=new oe({id:s,name:r,data:t});o.onRendered=()=>{o.sendInfoToChannel("CHANNEL_ROUTE",n)},o.afterBroadcastEvents=()=>{o.disposeViewStream()},o.appendToNull()}}const ae=o(205).map;class ce{constructor(e,t={}){this.addRegisteredActions.bind(this),this.createChannelActionsObj(e,t.extendedActionsArr),t.name=e,this.props=t,this.props.isRegistered=!1,this.props.isProxy=void 0!==this.props.isProxy&&this.props.isProxy,this.props.sendCachedPayload=void 0!==this.props.sendCachedPayload&&this.props.sendCachedPayload,this.sendPayloadToRouteChannel=new ie(this),this.createChannelActionMethods(),this.streamsController=u.channelsMap;let r=this.getMainObserver();this.observer$=this.props.observer=r,this.streamsController.getStream("DISPATCHER").subscribe((e=>this.onReceivedObservable(e)))}getMainObserver(){return!0===this.streamsController.testStream(this.props.name)?this.streamsController.getProxySubject(this.props.name,this.props.sendCachedPayload):!0===this.props.sendCachedPayload?new e.ReplaySubject(1):new e.Subject}onChannelInitialized(){}onRegistered(){}get isProxy(){return this.props.isProxy}get channelName(){return this.props.name}get observer(){return this.observer$}checkForTraits(){void 0!==this.props.traits&&(e=>{"Array"!==e.constructor.name&&(e=[e]),e.forEach((e=>{new e(this)}))})(this.props.traits)}initializeStream(){this.checkForTraits(),this.onChannelInitialized(),this.onRegistered(),this.props.isRegistered=!0}setTrace(e){}createChannelActionsObj(e,r=[]){const s=(0,t.ifElse)((0,t.is)(String),t.identity,t.head);let n=r.concat(this.addRegisteredActions(e)),o=ae(s,n),i=(0,t.mergeAll)((0,t.chain)((e=>(0,t.objOf)(e,e)),o));this.channelActions=i}createChannelActionMethods(){const e=(0,t.ifElse)((0,t.is)(String),t.identity,t.head),r=(0,t.ifElse)((0,t.is)(String),(0,t.always)("onViewStreamInfo"),(e=>{const r=(0,t.view)((0,t.lensIndex)(1),e);return!0==("function"==typeof this[r])?this[r].bind(this):console.warn(`"${this.props.name}", REQUIRES THE FOLLOWING METHOD ${r} FOR ACTION, ${e[0]}`),r}));this.channelActionMethods=(0,t.fromPairs)(ae((t=>[e(t),r(t)]),this.addRegisteredActions()))}addRegisteredActions(){return[]}onReceivedObservable(e){this.onIncomingObservable(e)}getActionMethodForObservable(e){e.unpacked=!0;const r=this.onViewStreamInfo.bind(this);let s=(0,t.path)(["data","action"],e);const n=(0,t.prop)(s,this.channelActionMethods);let o=r;return void 0!==n&&"onViewStreamInfo"!==n&&!0==("function"==typeof this[n])&&(o=this[n].bind(this)),o}onIncomingObservable(e){let r=(0,t.equals)(e.name,this.props.name),{action:s,payload:n,srcElement:o}=e.data,i=r=>({props:()=>{return r=e.data,(0,t.mergeAll)([r,{action:(0,t.prop)("action",r)},(0,t.prop)("payload",r),(0,t.prop)("srcElement",r)]);var r},action:s,payload:n,srcElement:o,event:r});return!0===r?(e=>e.observable.pipe((0,W.map)(i)).subscribe(this.getActionMethodForObservable(e)))(e):void 0}onViewStreamInfo(e){}sendChannelPayload(e,t,r={},s={},n=this.observer$){let o=new D(this.props.name,e,t,r,s);n.next(o)}getChannel(e,r){return(0,t.ifElse)((e=>N().includes(e)),(e=>{let t=this.streamsController.getStream(e).observer;return void 0!==r?t.pipe((0,W.filter)(r)):t}),(e=>console.warn(`channel name ${e} is not within ${N}`)))(e)}}const le=o(205).filter,de=o(205).mergeRight;class he extends ce{constructor(t="CHANNEL_ROUTE",r={}){r.sendCachedPayload=!0,super("CHANNEL_ROUTE",r),this.createChannelActionsObj(),this.routeConfigJson=this.getRouteConfig(),this.bindStaticMethods(),this.navToStream$=new e.ReplaySubject(1),this.observer$=this.navToStream$.pipe((0,W.map)((e=>this.onMapNext(e)))),this.compareRouteKeywords=s.compareRouteKeywords()}checkConfigForHash(){!0==("hash"===u.config.channels.ROUTE.type)&&(u.config.channels.ROUTE.type="slash",u.config.channels.ROUTE.isHash=!0)}onRegistered(){this.checkConfigForHash(),this.initStream()}createChannelActionsObj(){let e=this.addRegisteredActions(),r=(0,t.mergeAll)((0,t.chain)((e=>(0,t.objOf)(e,e)),e));this.channelActions=r}addRegisteredActions(){return["CHANNEL_ROUTE_DEEPLINK_EVENT","CHANNEL_ROUTE_CHANGE_EVENT","CHANNEL_ROUTE_CONFIG_UPDATED_EVENT",["CHANNEL_ROUTE_UPDATE_CONFIG_EVENT","updateRouteConfig"]]}updateRouteConfig(e){const r=(0,t.pick)(["isHash","isHidden","routes","type"],e.payload);u.config.channels.ROUTE=(0,t.mergeRight)(u.config.channels.ROUTE,r),u.conformRouteConfig();const s=this.getRouteConfig();this.routeConfigJson=s,this.bindStaticMethodsWithConfigData(),this.sendChannelPayload("CHANNEL_ROUTE_CONFIG_UPDATED_EVENT",s,{},{},this.navToStream$)}getRouteConfig(){const e=u.config;let r=(0,t.path)(["channels","ROUTE"],e);"query"===r.type&&(r.isHash=!1);let n=s.flattenConfigObject(r.routes);return r.paramsArr=n,r}initStream(){this.firstLoadStream$=new e.ReplaySubject(1),this.onIncomingDomEvent(void 0,this.routeConfigJson,"CHANNEL_ROUTE_DEEPLINK_EVENT"),s.createPopStateStream(this.onIncomingDomEvent.bind(this)),this.observer$=(0,e.merge)(this.firstLoadStream$,this.navToStream$)}onMapNext(e,t=!1){return e.action="CHANNEL_ROUTE_CHANGE_EVENT",e}static removeSSID(e){const r=(0,t.lensProp)(["routeData"]);return(0,t.over)(r,(0,t.omit)(["vsid"]))(e)}static onIncomingDomEvent(e,r=this.routeConfigJson,s){let n=void 0!==s?s:this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT,o=(0,t.path)(["state","routeCount"],e),i=!0===(0,t.is)(Number,o),a=this.getDataFromString(r,i);!0===i&&(a.routeCount=o);let c=this.compareRouteKeywords.compare(a.routeData,a.paths);a=de(a,c),this.sendChannelPayload(n,a,void 0,void 0,this.navToStream$)}static checkForRouteParamsOverrides(e){return e}static checkForEventMethods(e){const r=(0,t.compose)(le((0,t.test)(/^(event)([A-Z].*)([A-Z].*)$/gm)),t.keys,(0,t.prop)("payload"))(e);if(r.length>=1){const s=(0,t.prop)("event",e);if(void 0!==s){const e=(e,t,r,s,n)=>String(r).toLowerCase()+s+n,n=(0,t.replace)(/^(event)([A-Z])(.*)([A-Z].*)$/gm,e),o=e=>{const t=n(e);void 0!==s[t]&&s[t]()};r.forEach(o)}}return e}static checkForEndRoute(e,r=this.routeConfigJson,s){if(!0!==(0,t.compose)((0,t.equals)("true"),(0,t.path)(["payload","endRoute"]))(e))return e;const n=window||{},o=void 0!==s?s:(0,t.compose)((0,t.equals)(!0),(0,t.path)(["Spyne","config","debug"]))(n),{payload:i}=e;let a=0;const c=(e=[],r)=>{const[s,n]=r,{routePath:l}=n,d=(0,t.prop)("routeName",l),h=(e=>{const r=(0,t.prop)("routeName",e);if(r){const s=(0,t.compose)(t.keys,(0,t.omit)(["routeName"]))(e);let n=i[r];const o=e=>new RegExp(`^${e}$`).test(n);return(0,t.find)(o,s)}})(l),p=(0,t.is)(Object,n),u=(0,t.is)(Array,n);if(a+=1,!0===p&&!1===u){const r=l[h];r?(0,t.compose)(t.reverse,(0,t.reduce)(c,e),t.toPairs)({nextRoutePath:r}):1===a?o&&console.warn(`Spyne Warning: use of end route method should add start route value of "${d}".`):e.push(d)}return e},{routes:l}=r,d=(0,t.compose)(t.reverse,(0,t.reduce)(c,[]),t.toPairs)({routes:l});if(1===d.length){const t=d[0];e.payload[t]=""}return e}onViewStreamInfo(e){let r=this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT;he.checkForEventMethods(e),e=this.checkForEndRoute(e);let s=this.getDataFromParams(e);const{routeConfigJson:n}=this;let o=(0,t.prop)("srcElement",e),i=(0,t.prop)("event",e),a=!s.isHidden,c=this.compareRouteKeywords.compare(s.routeData,s.paths);s=de(s,c),this.sendRouteStream(s,a),s=he.removeSSID(s),this.sendChannelPayload(r,s,o,i,this.navToStream$)}static checkAndConvertStrWithRegexTokens(e,r){return(0,t.keys)(r)}sendRouteStream(e,t=!0){!0===t&&this.setWindowLocation(e)}static getRouteState(){return"CHANNEL_ROUTE_CHANGE_EVENT"}static getIsDeepLinkBool(e){return!1===e&&0===this._routeCount}static getRouteCount(e=!1){return void 0===this._routeCount?(this._routeCount=0,this._routeCount):(!1===e&&(this._routeCount+=1),this._routeCount)}static getExtraPayloadParams(e=this.routeConfigJson,t=!1){return{routeCount:this.getRouteCount(t),isDeepLink:this.getIsDeepLinkBool(t),isHash:e.isHash,isHidden:e.isHidden,routeType:e.type}}static getDataFromParams(e,s=this.routeConfigJson){let n=(0,t.prop)("payload",e),o=this.getRouteStrFromParams(n,s);const i=(e,r)=>(0,t.defaultTo)(r,(0,t.prop)(e,s));let a=i("type","slash"),c=i("isHash",!1),l=r.formatStrAsWindowLocation(o),d=this.getDataFromLocationStr(a,c,l),{pathInnermost:h,paths:p}=d;n=de(d.routeData,n);let{routeCount:u,isDeepLink:E,isHash:m,isHidden:N,routeType:g}=this.getExtraPayloadParams(s);return{isDeepLink:E,routeCount:u,pathInnermost:h,paths:p,routeData:n,routeValue:o,isHash:m,isHidden:N,routeType:g}}static getDataFromString(e=this.routeConfigJson,t=!1){const s=e.type,n=!0===e.isHash,o=r.getLocationStrByType(s,n);let{paths:i,pathInnermost:a,routeData:c,routeValue:l}=he.getParamsFromRouteStr(o,e,s),{routeCount:d,isDeepLink:h,isHash:p,routeType:u,isHidden:E}=this.getExtraPayloadParams(e,t);return{isDeepLink:h,routeCount:d,pathInnermost:a,paths:i,routeData:c,routeValue:l,isHash:p,isHidden:E,routeType:u}}static getDataFromLocationStr(e="slash",t=this.routeConfigJson.isHash,s=window.location){const n=void 0!==this.routeConfigJson?this.routeConfigJson.type:e,o=r.getLocationStrByType(n,t,s);let{paths:i,pathInnermost:a,routeData:c,routeValue:l}=this.getParamsFromRouteStr(o,this.routeConfigJson,n);return{paths:i,pathInnermost:a,routeData:c,routeValue:l,action:this.getRouteState()}}static getLocationData(){return(0,t.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getRouteStrFromParams(e,t,s){const n=void 0!==s?s:t.type;return r.convertParamsToRoute(e,t,n)}static getParamsFromRouteStr(e,t,s){const n=void 0!==s?s:t.type;return r.convertRouteToParams(e,t,n)}checkEmptyRouteStr(e,r=!1){const s=(0,t.isEmpty)(e);return!0==(!0===s&&!1===r)||!0==(!0===s&&!0===r)?"/":!0==(!1===s&&!0===r)?(0,t.concat)("#",e):e}static removeLastSlash(e){return e.replace(/^(.*)(\/)$/,"$1")}setWindowLocation(e){let{isHash:r,routeValue:s}=e;s=this.checkEmptyRouteStr(s,r);let{routeCount:n}=e;if(!0===r)s=he.removeLastSlash(window.location.pathname)+s,window.history.pushState({routeCount:n},"",s);else{const e=(0,t.when)((0,t.compose)((0,t.complement)((0,t.equals)("/")),t.head),(0,t.concat)("/",t.__));window.history.pushState({routeCount:n},"",e(s))}}getWindowLocation(){return window.location.pathname}bindStaticMethods(){this.checkForEndRoute=he.checkForEndRoute.bind(this),this.getIsDeepLinkBool=he.getIsDeepLinkBool.bind(this),this.getDataFromLocationStr=he.getDataFromLocationStr.bind(this),this.onIncomingDomEvent=he.onIncomingDomEvent.bind(this),this.getDataFromString=he.getDataFromString.bind(this),this.getParamsFromRouteStr=he.getParamsFromRouteStr.bind(this),this.getLocationData=he.getLocationData.bind(this),this.getRouteState=he.getRouteState.bind(this),this.getDataFromParams=he.getDataFromParams.bind(this),this.getRouteCount=he.getRouteCount.bind(this),this.getExtraPayloadParams=he.getExtraPayloadParams.bind(this),this.bindStaticMethodsWithConfigData()}bindStaticMethodsWithConfigData(){const e=(0,t.curryN)(3,he.getRouteStrFromParams);this.getRouteStrFromParams=e(t.__,this.routeConfigJson,this.routeConfigJson.type)}}class pe extends ce{constructor(e="CHANNEL_UI",t={}){t.sendCachedPayload=!1,super(e,t),this.keyEventsLoaded=!1,this.keyCodeArr=[]}addRegisteredActions(){return["CHANNEL_UI_ANIMATIONEND_EVENT","CHANNEL_UI_ANIMATIONITERATION_EVENT","CHANNEL_UI_ANIMATIONSTART_EVENT","CHANNEL_UI_AUDIOEND_EVENT","CHANNEL_UI_AUDIOPROCESS_EVENT","CHANNEL_UI_AUDIOSTART_EVENT","CHANNEL_UI_BLUR_EVENT","CHANNEL_UI_CACHED_EVENT","CHANNEL_UI_CANPLAYTHROUGH_EVENT","CHANNEL_UI_CANPLAY_EVENT","CHANNEL_UI_CHANGE_EVENT","CHANNEL_UI_CHECKBOXSTATECHANGE_EVENT","CHANNEL_UI_CLICK_EVENT","CHANNEL_UI_COMPLETE_EVENT","CHANNEL_UI_COPY_EVENT","CHANNEL_UI_CUT_EVENT","CHANNEL_UI_DBLCLICK_EVENT","CHANNEL_UI_DURATIONCHANGE_EVENT","CHANNEL_UI_EMPTIED_EVENT","CHANNEL_UI_ENDED_EVENT","CHANNEL_UI_EVENT","CHANNEL_UI_FOCUSIN_EVENT","CHANNEL_UI_FOCUSOUT_EVENT","CHANNEL_UI_FOCUS_EVENT","CHANNEL_UI_HASHCHANGE_EVENT","CHANNEL_UI_INPUT_EVENT","CHANNEL_UI_KEYDOWN_EVENT","CHANNEL_UI_KEYPRESS_EVENT","CHANNEL_UI_KEYUP_EVENT","CHANNEL_UI_LOADEDDATA_EVENT","CHANNEL_UI_LOADEDMETADATA_EVENT","CHANNEL_UI_MOUSEDOWN_EVENT","CHANNEL_UI_MOUSEENTER_EVENT","CHANNEL_UI_MOUSELEAVE_EVENT","CHANNEL_UI_MOUSEMOVE_EVENT","CHANNEL_UI_MOUSEOUT_EVENT","CHANNEL_UI_MOUSEOVER_EVENT","CHANNEL_UI_MOUSEUP_EVENT","CHANNEL_UI_MOUSEWHEEL_EVENT","CHANNEL_UI_PAUSE_EVENT","CHANNEL_UI_PLAYING_EVENT","CHANNEL_UI_PLAY_EVENT","CHANNEL_UI_RADIOSTATECHANGE_EVENT","CHANNEL_UI_RATECHANGE_EVENT","CHANNEL_UI_READYSTATECHANGE_EVENT","CHANNEL_UI_SEEKED_EVENT","CHANNEL_UI_SEEKING_EVENT","CHANNEL_UI_SELECT_EVENT","CHANNEL_UI_STALLED_EVENT","CHANNEL_UI_SUBMIT_EVENT","CHANNEL_UI_SUSPEND_EVENT","CHANNEL_UI_SVGABORT_EVENT","CHANNEL_UI_SVGERROR_EVENT","CHANNEL_UI_SVGLOAD_EVENT","CHANNEL_UI_SVGRESIZE_EVENT","CHANNEL_UI_SVGSCROLL_EVENT","CHANNEL_UI_SVGUNLOAD_EVENT","CHANNEL_UI_SVGZOOM_EVENT","CHANNEL_UI_TIMEUPDATE_EVENT","CHANNEL_UI_TOUCHCANCEL_EVENT","CHANNEL_UI_TOUCHEND_EVENT","CHANNEL_UI_TOUCHMOVE_EVENT","CHANNEL_UI_TOUCHSTART_EVENT","CHANNEL_UI_TRANSITIONEND_EVENT","CHANNEL_UI_VALUECHANGE_EVENT","CHANNEL_UI_VOLUMECHANGE_EVENT","CHANNEL_UI_WAITING_EVENT","CHANNEL_UI_WHEEL_EVENT"]}loadKeyStream(){let t=e.Observable.fromEvent(document,"keyup");this.keyPresses$=t.groupBy((e=>e.keyCode)).mergeAll().filter((e=>this.keyCodeArr.indexOf(e.keyCode)>=0)).repeat().subscribe(this.onKeyPressed.bind(this))}addKeyEvent(e){!1===this.keyEventsLoaded&&this.loadKeyStream(),this.keyEventsLoaded=!0,this.registerKey(e)}registerKey(e){this.keyCodeArr.push(e)}onKeyPressed(e){console.log("key is ",e)}static removeSSID(e){const r=(0,t.lensProp)(["payload"]);return(0,t.over)(r,(0,t.omit)(["vsid"]))(e)}onIncomingObservable(e){let r=(0,t.equals)(e.name,this.props.name);e.data=pe.removeSSID(e.data);let{payload:s,srcElement:n}=e.data,o=e=>({payload:s,srcElement:n,event:e});return!0===r?(e=>e.observable.pipe((0,W.map)(o)).subscribe(this.onUIEvent.bind(this)))(e):void 0}getActionState(e){let r=(0,t.path)(["event","type"]),s=(0,t.path)(["event","typeOverRide"]),n=(0,t.compose)(t.toUpper,(0,t.either)(s,r))(e);return void 0!==n?`CHANNEL_UI_${n}_EVENT`:"CHANNEL_UI"}static checkForEventMethods(e){const r=(0,t.compose)((0,t.filter)((0,t.test)(/^(event)([A-Z].*)([A-Z].*)$/gm)),t.keys,(0,t.prop)("payload"))(e);if(r.length>=1){const s=(0,t.prop)("event",e);if(void 0!==s){const e=(e,t,r,s,n)=>String(r).toLowerCase()+s+n,n=(0,t.replace)(/^(event)([A-Z])(.*)([A-Z].*)$/gm,e),o=e=>{const t=n(e);void 0!==s[t]&&"function"==typeof s[t]&&s[t]()};r.forEach(o)}}return e}onUIEvent(e){pe.checkForEventMethods(e),e.action=this.getActionState(e);const t=e.action,{payload:r,srcElement:s}=e,n=e.event;this.sendChannelPayload(t,r,s,n)}}class ue{constructor(){this.createDomObservableFromEvent=ue.createDomObservableFromEvent.bind(this)}static createDomObservableFromEvent(t,r,s=!0,n=window){return r=void 0===r?e=>e:r,(0,e.fromEventPattern)((e=>n.addEventListener(t,e,{passive:s})),(()=>{n[t]=e=>e})).pipe((0,W.map)(r))}static createMediaQuery(e){const t=window.matchMedia(e);return this.checkIfValidMediaQuery(t,e),!1!==t&&t}static checkIfValidMediaQuery(e,t){const r=e=>e.replace(/\s+/gm,""),s=void 0!==e.matches&&r(e.media).indexOf(r(t))>=0;return!1===s&&(t=>{console.warn(`Spyne Info: the following query string, "${t}", has been optimized to "${e.media}" by the browser and may not be a valid Media Query item!`)})(t),s}static createMediaQueryHandler(t,r){let s=(e=>t=>(t.mediaQueryName=e,t))(r),n=(o=t,{addHandler:e=>{o.addListener(e)},removeHandler:e=>{o.onchange=()=>{}}});var o;return new e.fromEventPattern(n.addHandler,n.removeHandler).pipe((0,W.map)(s))}static createMergedObsFromObj(e){let r=e.mediqQueries,s=[];return(0,t.mapObjIndexed)(((e,t,r)=>{let n=ue.createMediaQuery(e);return!1!==n&&s.push(ue.createMediaQueryHandler(n,t)),s}),r),s}}const Ee=o(205).map;class me extends ce{constructor(e="CHANNEL_WINDOW"){super(e),this.bindStaticMethods(),this.currentScrollY=0}initializeStream(){this.domChannelConfig=u.config.channels.WINDOW;let t=this.getActiveObservables(),r=(0,e.merge)(...t);this.dom$=r,r.subscribe((e=>{let{action:t,payload:r,srcElement:s,event:n}=e;this.sendChannelPayload(t,r,s,n)}))}static getMouseWheelMapFn(e){let t=this.channelActions.CHANNEL_WINDOW_MOUSEWHEEL_EVENT,r=e.deltaY<=0?"up":"down",{deltaX:s,deltaY:n,deltaZ:o}=e;return{action:t,payload:{scrollDir:r,deltaX:s,deltaY:n,deltaZ:o},srcElement:e.srcElement,event:e}}static createCurriedGenericEvent(e){let r=`CHANNEL_WINDOW_${e.toUpperCase()}_EVENT`;return(0,t.curry)(me.mapGenericEvent)(r)}static mapGenericEvent(e,t){return{action:e,payload:t,srcElement:t.srcElement,event:t}}static getResizeMapFn(e){return{action:this.channelActions.CHANNEL_WINDOW_RESIZE_EVENT,payload:(0,t.pick)(["innerWidth","innerHeight","outerWidth","outerHeight"],window),srcElement:e.srcElement,event:e}}static getOrientationMapFn(e){let r=this.channelActions.CHANNEL_WINDOW_ORIENTATION_EVENT,s=window.matchMedia("(orientation: portrait)").matches,n=(0,t.pick)(["innerWidth","innerHeight","outerWidth","outerHeight"],window);return n.orientation=!0===s?"portrait":"landscape",{action:r,payload:n,srcElement:e.srcElement,event:e}}getMediaQueryMapFn(e){return{action:this.channelActions.CHANNEL_WINDOW_MEDIA_QUERY_EVENT,payload:(0,t.pick)(["matches","media","mediaQueryName"],e),srcElement:e.srcElement,event:e}}createMouseWheelObservable(e){const t=e.debounceMSTimeForScroll;return ue.createDomObservableFromEvent("mousewheel",me.getMouseWheelMapFn.bind(this)).pipe((0,W.debounceTime)(t))}static getScrollData(){let e=0;return t=>{let r=e-t;return e=t,{scrollY:t,scrollDistance:r,scrollDir:r>=0?"up":"down"}}}static getScrollY(e){return void 0!==e.pageYOffset?e.pageYOffset:e.scrollTop}static getScrollMapFn(e,t,r,s,n){let o=s(me.getScrollY(n)),{scrollDistance:i}=o;return{action:r,payload:o,srcElement:e.srcElement,scrollDistance:i,event:e}}createScrollObservable(e,r=window){const s=e.debounceMSTimeForScroll,n=r===window,o=void 0!==e.scrollElForVals?e.scrollElForVals:r,i=n?"CHANNEL_WINDOW_SCROLL_EVENT":"CHANNEL_WINDOW_ELEMENT_SCROLL_EVENT",a=me.getScrollData(),c=(0,t.partialRight)(me.getScrollMapFn,[i,a,o]).bind(this);return ue.createDomObservableFromEvent("scroll",c).pipe((0,W.debounceTime)(s),(0,W.skipWhile)((e=>0===e.scrollDistance)),(0,W.map)((e=>{const t=me.getScrollY(window);return e.payload.scrollDistanceAbs=Math.abs(this.currentScrollY-t),this.currentScrollY=t,e})))}createOrientationObservable(e){return ue.createDomObservableFromEvent("orientationchange",me.getOrientationMapFn.bind(this))}createResizeObservable(e){const t=e.debounceMSTimeForResize;return ue.createDomObservableFromEvent("resize",me.getResizeMapFn.bind(this)).pipe((0,W.debounceTime)(t))}getEventsFromConfig(e=this.domChannelConfig){let t=e.events;return Ee((e=>{let t=me.createCurriedGenericEvent(e);return ue.createDomObservableFromEvent(e,t)}),t)}getActiveObservables(e=this.domChannelConfig){let r=[];e.listenForMediaQueries=(e=>{const r=(0,t.compose)((0,t.complement)(t.isEmpty),t.head,t.values),s=(0,t.compose)((0,t.complement)(t.isNil),t.head,t.values);return(0,t.allPass)([r,s])(e)})(e.mediqQueries);let s={listenForResize:this.createResizeObservable.bind(this),listenForOrientation:this.createOrientationObservable.bind(this),listenForScroll:this.createScrollObservable.bind(this),listenForMouseWheel:this.createMouseWheelObservable.bind(this)};(0,t.mapObjIndexed)(((t,s,n)=>{e[s]&&r.push(t(e))}),s),this.checkForMediaQueries(e.listenForMediaQueries);let n=this.getEventsFromConfig(e);return r=r.concat(n),r}checkForMediaQueries(e){!0===e&&this.getMediaQueryObservable(this.domChannelConfig).subscribe((e=>{let{action:t,payload:r,srcElement:s,event:n}=e;this.sendChannelPayload(t,r,s,n,this.observer$)}))}getMediaQueryObservable(r){let s=this.createMergedObsFromObj(r);return(0,t.apply)(e.merge,s).pipe((0,W.map)(this.getMediaQueryMapFn.bind(this)))}addRegisteredActions(){return["CHANNEL_WINDOW_ABORT_EVENT","CHANNEL_WINDOW_AFTERPRINT_EVENT","CHANNEL_WINDOW_ANIMATIONEND_EVENT","CHANNEL_WINDOW_ANIMATIONITERATION_EVENT","CHANNEL_WINDOW_ANIMATIONSTART_EVENT","CHANNEL_WINDOW_APPINSTALLED_EVENT","CHANNEL_WINDOW_BEFOREPRINT_EVENT","CHANNEL_WINDOW_BEFOREUNLOAD_EVENT","CHANNEL_WINDOW_BEGINEVENT_EVENT","CHANNEL_WINDOW_BLUR_EVENT","CHANNEL_WINDOW_CACHED_EVENT","CHANNEL_WINDOW_CHANGE_EVENT","CHANNEL_WINDOW_CLICK_EVENT","CHANNEL_WINDOW_CLOSE_EVENT","CHANNEL_WINDOW_COMPOSITIONEND_EVENT","CHANNEL_WINDOW_COMPOSITIONSTART_EVENT","CHANNEL_WINDOW_COMPOSITIONUPDATE_EVENT","CHANNEL_WINDOW_COPY_EVENT","CHANNEL_WINDOW_CUT_EVENT","CHANNEL_WINDOW_DEVICECHANGE_EVENT","CHANNEL_WINDOW_DEVICELIGHT_EVENT","CHANNEL_WINDOW_DEVICEMOTION_EVENT","CHANNEL_WINDOW_DEVICEORIENTATION_EVENT","CHANNEL_WINDOW_DEVICEPROXIMITY_EVENT","CHANNEL_WINDOW_DOMATTRIBUTENAMECHANGED_EVENT","CHANNEL_WINDOW_DOMATTRMODIFIED_EVENT","CHANNEL_WINDOW_DOMCHARACTERDATAMODIFIED_EVENT","CHANNEL_WINDOW_DOMCONTENTLOADED_EVENT","CHANNEL_WINDOW_DOMELEMENTNAMECHANGED_EVENT","CHANNEL_WINDOW_ERROR_EVENT","CHANNEL_WINDOW_FOCUSIN_EVENT","CHANNEL_WINDOW_FOCUS_EVENT","CHANNEL_WINDOW_FULLSCREENCHANGE_EVENT","CHANNEL_WINDOW_FULLSCREENERROR_EVENT","CHANNEL_WINDOW_LOAD_EVENT","CHANNEL_WINDOW_MEDIA_QUERY_EVENT","CHANNEL_WINDOW_MESSAGE_EVENT","CHANNEL_WINDOW_MOUSEWHEEL_EVENT","CHANNEL_WINDOW_OFFLINE_EVENT","CHANNEL_WINDOW_ONLINE_EVENT","CHANNEL_WINDOW_OPEN_EVENT","CHANNEL_WINDOW_ORIENTATION_EVENT","CHANNEL_WINDOW_PAGEHIDE_EVENT","CHANNEL_WINDOW_PAGESHOW_EVENT","CHANNEL_WINDOW_POPSTATE_EVENT","CHANNEL_WINDOW_RESET_EVENT","CHANNEL_WINDOW_RESIZE_EVENT","CHANNEL_WINDOW_ELEMENT_SCROLL_EVENT",["CHANNEL_WINDOW_SET_ELEMENT_TO_SCROLL_EVENT","onSetElementToScroll"],"CHANNEL_WINDOW_SCROLL_EVENT","CHANNEL_WINDOW_SCROLL_LOCK_EVENT",["CHANNEL_WINDOW_SCROLL_LOCK_EVENT","onScrollLockEvent"],"CHANNEL_WINDOW_SUBMIT_EVENT","CHANNEL_WINDOW_TRANSITIONCANCEL_EVENT","CHANNEL_WINDOW_TRANSITIONEND_EVENT","CHANNEL_WINDOW_TRANSITIONRUN_EVENT","CHANNEL_WINDOW_TRANSITIONSTART_EVENT","CHANNEL_WINDOW_UNLOAD_EVENT","CHANNEL_WINDOW_WHEEL_EVENT"]}onScrollLockEvent(e){let{action:t,scrollLock:r}=e.payload;u.config.scrollLock=r,!0===r&&(u.config.scrollLockX=window.scrollX,u.config.scrollLockY=window.scrollY),this.sendChannelPayload(t,{scrollLock:r})}onSetElementToScroll(e){let{config:t,scrollElement:r}=e.payload;t=l(this.domChannelConfig,t),this.createScrollObservable(t,r).subscribe((e=>{let{action:t,payload:r,srcElement:s,event:n}=e;this.sendChannelPayload(t,r,s,n)}))}bindStaticMethods(){this.createMediaQueryHandler=ue.createMediaQueryHandler.bind(this),this.createMergedObsFromObj=ue.createMergedObsFromObj.bind(this)}}class Ne extends ce{constructor(e={}){super("CHANNEL_LIFECYCLE",e)}addRegisteredActions(){return["CHANNEL_LIFECYCLE_RENDERED_EVENT","CHANNEL_LIFECYCLE_DISPOSED_EVENT"]}onViewStreamInfo(e){let{data:t,action:r,srcElement:s}=e,n=s;n.action=r,this.onSendEvent(r,n)}onSendEvent(e,t={}){const r=this.channelActions[e],s={};window.setTimeout((()=>this.sendChannelPayload(r,t,s,void 0)),0)}}class ge extends ce{constructor(t,r={}){r.isProxy=!0,super(t,r),this.props=r,this.subject$=new e.Subject,this.replaySub$=new e.ReplaySubject(1),this.observer$=(0,e.merge)(this.subject$,this.replaySub$),!0===u.debug&&this.checkIfChannelIsStillProxy(t)}getMergedSubject(e=!1){return!0===e?this.replaySub$:this.subject$}checkIfChannelIsStillProxy(e){let r=e;(async(e,t)=>{window.setTimeout((async()=>{await new Promise((e=>setTimeout(e,1))),window.requestAnimationFrame(e)}),t)})((()=>{!0!==(0,t.includes)(r,u.listRegisteredChannels())&&console.warn(`Spyne Warning: The channel, ${r} does not appear to be registered!`)}),1e3)}get replaySubject(){return this.replaySub$}get subject(){return this.subject$}}const _e=o(205).map,Te=new Map;class Ae{constructor(){this.addMixins(),Te.set("DISPATCHER",new e.Subject),this.listRegisteredChannels=Ae.listRegisteredChannels.bind(this),this.getChannelsList=Ae.getChannelsList.bind(this)}get map(){return Te}static getChannelsList(){return Array.from(Te,((e,t)=>({key:e[0],val:e[1].constructor.name})))}static listRegisteredChannels(e=!1){let r=this.getChannelsList(),s=(0,t.reject)((0,t.propEq)("val","ChannelProxy")),n=(0,t.filter)((0,t.propEq)("val","ChannelProxy")),o=(!0===e?n:s)(r);return(0,t.pluck)(["key"],o)}listProxyChannels(){return this.listRegisteredChannels(!0)}checkForMissingChannels(){let e=this.getChannelsList(),r=(0,t.filter)((0,t.propEq)("val","ChannelProxy"))(e);if(r.length>=1){let e=`Spyne Warning: The following ${1===r.length?"Channel has":"Channels have"} not been initialized: ${(0,t.compose)((0,t.join)(", "),_e((0,t.prop)("key")))(r)}`;console.warn(e)}}init(){this.createMainStreams()}createMainStreams(){this.routeStream=new he,Te.set("CHANNEL_ROUTE",this.routeStream),this.uiStream=new pe,Te.set("CHANNEL_UI",this.uiStream),this.domStream=new me,Te.set("CHANNEL_WINDOW",this.domStream),this.viewStreamLifecycle=new Ne,Te.set("CHANNEL_LIFECYCLE",this.viewStreamLifecycle),this.routeStream.initializeStream(),this.domStream.initializeStream()}addKeyEvent(e){Te.get("UI").addKeyEvent(e)}registerStream(e){let r=e.channelName;Te.has(r)&&(0,t.compose)((0,t.pathEq)(["props","isRegistered"],!0))(Te.get(r))?console.warn(`Spyne Warning: The Channel, ${r}, has already been registered!`):(Te.set(r,e),e.initializeStream())}getChannelActions(e){return Te.get(e).addRegisteredActions()}getProxySubject(e,t=!1){let r=!0===t?"replaySubject":"subject";return Te.get(e)[r]}testStream(e){return void 0!==Te.get(e)}getStream(e){return!1===this.testStream(e)&&Te.set(e,new ge(e)),Te.get(e)}addMixins(){}}class Se{constructor(e,t="",r=!0){return this.parentContext=e,this.omittedMethods=["autoBinder","initAutoBinder","getEnhancerMethods","checkForMalformedMethods","caller","arguments","bindParentViewStream"],this.prefix=t,!0===r&&this.autoBinder(),this.allMethodsList}initAutoBinder(){this.autoBinder()}getEnhancerMethods(){return P(this,this.omittedMethods)}checkForMalformedMethods(e){if(""===this.prefix)return void console.warn(`SPYNE WARNING: The following SpyneTrait ${this.constructor.name} needs a prefix`);let r=(0,t.reject)((e=>0===e.indexOf(this.prefix)),e);if(r.length>=1){let e=`Spyne Warning: The following method(s) in ${this.constructor.name} require the prefix, "${this.prefix}": [${r.join(", ")}];`;console.warn(e)}}bindParentViewStream(e,r){this.checkForMalformedMethods(e.allMethods);let s={};const n=(e,t=!1)=>{let n=!0===t?this.constructor:this;var o;"function"==typeof n[e]&&(s[e]=r[o=e]=n[o].bind(r))},o=(0,t.curryN)(2,n)(t.__,!0);return(0,t.map)(o,e.staticMethods),(0,t.map)(n,e.methods),s}autoBinder(){let e=this.getEnhancerMethods();return this.allMethodsList=this.bindParentViewStream(e,this.parentContext),this.allMethodsList}}class Ce{constructor(e,t,r){this._mapFn=Ce.setMapFn(e),this._url=Ce.setUrl(e),this._responseType=Ce.setResponseType(e),this._serverOptions=Ce.setServerOptions(e),this._subscriber=void 0!==t?t:e=>console.log("FETCH RETURNED ",e),this.debug=void 0!==e.debug&&e.debug;let s={mapFn:this.mapFn,url:this.url,serverOptions:this.serverOptions,responseType:this.responseType,debug:this.debug};!0!==r&&Ce.startWindowFetch(s,this._subscriber)}static startWindowFetch(t,r){let{mapFn:s,url:n,serverOptions:o,responseType:i,debug:a}=t;const c=!0===a?e=>console.log("DEBUG FETCH :",e):()=>{};let l=(0,e.from)(window.fetch(n,o)).pipe((0,W.tap)(c),(0,W.flatMap)((t=>(0,e.from)(t[i]()))),(0,W.map)(s),(0,W.publish)());l.connect(),l.subscribe(r)}static setMapFn(e){return(0,t.compose)((0,t.defaultTo)((e=>e)),(0,t.prop)("mapFn"))(e)}static setUrl(e){let r=(0,t.prop)("url",e);return void 0===r&&console.warn("SPYNE WARNING: URL is undefined for data channel"),r}static setResponseType(e){return(0,t.defaultTo)("json",(0,t.prop)("responseType",e))}get mapFn(){return this._mapFn}get url(){return this._url}get serverOptions(){return this._serverOptions}get responseType(){return this._responseType}static stringifyBodyIfItExists(e){return(0,t.when)((0,t.propIs)(Object,"body"),(0,t.compose)((0,t.over)((0,t.lensProp)("body"),JSON.stringify)))(e)}static updateMethodWhenBodyExists(e){const r=(0,t.has)("body"),s=(0,t.propEq)("method","GET"),n=(0,t.allPass)([r,s]);return(0,t.when)(n,(0,t.assoc)("method","POST"))(e)}static setServerOptions(e){let r=(0,t.pick)(["header","body","mode","method"],e),s=(0,t.mergeDeepRight)(Ce.baseOptions(),r);return s=Ce.updateMethodWhenBodyExists(s),s=Ce.stringifyBodyIfItExists(s),s}static baseOptions(){return{method:"GET",headers:{Accept:"application/json, text/plain, */*"}}}}class fe extends ce{constructor(e,t={}){void 0!==t.map&&(t.mapFn=t.map),t.extendedActionsArr=[`${e}_DATA_EVENT`,[`${e}_UPDATE_DATA_EVENT`,"onFetchUpdate"]],t.sendCachedPayload=!0,super(e,t)}onRegistered(){this.startFetch()}addRegisteredActions(e){let r=(0,t.compose)((0,t.defaultTo)([]),(0,t.path)(["props","extendedActionsArr"]));return["CHANNEL_DATA_EVENT",["CHANNEL_UPDATE_DATA_EVENT","onFetchUpdate"]].concat(r(this))}startFetch(e={},t=this.onFetchReturned.bind(this)){let r=this.consolidateAllFetchProps(e);return new Ce(r,t)}onFetchUpdate(e){let t=this.getPropsForFetch(e);this.startFetch(t)}onFetchReturned(e){this.createChannelPayloadItem(e)}createChannelPayloadItem(e,t=`${this.props.name}_DATA_EVENT`){this.sendChannelPayload(t,e)}getPropsForFetch(e){let r=(0,t.path)(["viewStreamInfo","payload"],e);return(0,t.pick)(["mapFn","url","header","body","mode","method","responseType","debug"],r)}consolidateAllFetchProps(e,r=this.props){let s=(0,t.pick)(["mapFn","url","header","body","mode","method","responseType","debug"],r);const n=(0,t.reject)(t.isNil);return(0,t.compose)(n,((e,r)=>(0,t.mergeDeepRight)(e,r)))(s,e)}get observer(){return this.observer$}}const be=new Ae;let ye=new class{constructor(){this.VERSION="0.17.0a",window.Spyne=this,console.log("spyne app created")}get channels(){return be}init(e={}){void 0!==e&&(e=u.initialize({scrollLock:!1,scrollLockX:31,scrollLockY:0,debug:!1,plugins:{},channels:{WINDOW:{mediqQueries:{},events:[],listenForResize:!0,listenForOrientation:!0,listenForScroll:!1,listenForMouseWheel:!1,debounceMSTimeForResize:200,debounceMSTimeForScroll:150},ROUTE:{type:"slash",isHash:!1,isHidden:!1,add404s:!1,routes:{routePath:{routeName:"change"}}}}},e,be),window.Spyne.config=e),this.getChannelActions=e=>be.getChannelActions(e),this.registerChannel=e=>be.registerStream(e),this.registerDataChannel=e=>be.registerStream(e),this.listChannels=()=>Array.from(be.map.keys());let t=new oe({id:"spyne-null-views"});t.appendToDom(document.body),t.props.el.style.cssText="display:none; opacity:0; pointer-events:none;",be.init(),console.log("spyne app initialized")}static listChannels(){return Array.from(be.map.keys())}static getChannelActions(e){return be.getChannelActions(e)}static registerChannel(e){if(void 0!==window.Spyne)return be.registerStream(e);console.warn("Spyne has not been initialized")}};class ve{constructor(e={}){let{name:r,config:s,parentEl:n}=e;this.props=e,void 0===s&&(s=(0,t.clone)(e)),this.name=r||"empty",this.props.name=r,s=ve.mergeDefaultConfig(s,this.defaultConfig()),this.props.parentEl=n||ve.createParentEl(),ve.getSpyneApp(r,s),this.onBeforeRegistered(),this.onRegistered(),this.onRender()}onBeforeRegistered(){this.props.pluginName=this.props.name,this.props.config=u.getPluginConfigByPluginName(this.props.pluginName)}static mergeDefaultConfig(e={},t=this.defaultConfig()){return Object.assign(t,e)}defaultConfig(){return{}}static getSpyneApp(e,t){!1===u.initialized&&ye.init(),u.addPluginConfig(e,t)}static updateSpyneConfig(e,r,s){return!0===(0,t.pathSatisfies)((0,t.is)(Object),["config","plugins",r])(e)?(!0===e.config.debug&&console.warn(`Spyne Warning: The plugin, ${r}, already exists`),!1):(e.config.plugins[r]=s,e.config.plugins[r])}static createParentEl(e){return e||document.getElementById("spyne-plugins")||(()=>{const e=new H({id:"spyne-plugins"});document.body.appendChild(e.render());const t=document.getElementById("spyne-plugins");return t.style.cssText="position:absolute; top:0;left:0;width:100%;height:100%;min-height:100vh;z-index:1000000; pointer-events:none",t})()}onRegistered(){}onRender(){}}})(),i})()}));