/*! For license information please see spyne.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs"),require("ramda"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("spyne",["rxjs","ramda","rxjs/operators"],t):"object"==typeof exports?exports.spyne=t(require("rxjs"),require("ramda"),require("rxjs/operators")):e.spyne=t(e.rxjs,e.R,e.rxjs.operators)}(self,(function(e,t,r){return(()=>{var s={360:(e,t,r)=>{e.exports=r(989)},989:e=>{e.exports=o;var t=Object.create,r=function(){throw new Error("Not implemented.")},s=function(){return this};function o(){}function n(e){this.value=e}function i(e){this.value=e}n.prototype=t(o.prototype),i.prototype=t(o.prototype),o.Failure=function(e){return new n(e)},o.prototype.Failure=o.Failure,o.Success=function(e){return new i(e)},o.prototype.Success=o.Success,o.fromNullable=function(e){return null!=e?new i(e):new n(e)},o.prototype.fromNullable=o.fromNullable,o.fromEither=function(e){return e.fold(o.Failure,o.Success)},o.prototype.isFailure=!1,n.prototype.isFailure=!0,o.prototype.isSuccess=!1,i.prototype.isSuccess=!0,o.of=function(e){return new i(e)},o.prototype.of=o.of,o.prototype.ap=r,n.prototype.ap=function(e){return e.isFailure?this.Failure(this.value.concat(e.value)):this},i.prototype.ap=function(e){return e.isFailure?e:e.map(this.value)},o.prototype.map=r,n.prototype.map=s,i.prototype.map=function(e){return this.of(e(this.value))},o.prototype.toString=r,n.prototype.toString=function(){return"Validation.Failure("+this.value+")"},i.prototype.toString=function(){return"Validation.Success("+this.value+")"},o.prototype.isEqual=r,n.prototype.isEqual=function(e){return e.isFailure&&e.value===this.value},i.prototype.isEqual=function(e){return e.isSuccess&&e.value===this.value},o.prototype.get=r,n.prototype.get=function(){throw new TypeError("Can't extract the value of a Failure(a).")},i.prototype.get=function(){return this.value},o.prototype.getOrElse=r,n.prototype.getOrElse=function(e){return e},i.prototype.getOrElse=function(e){return this.value},o.prototype.orElse=r,i.prototype.orElse=s,n.prototype.orElse=function(e){return e(this.value)},o.prototype.merge=function(){return this.value},o.prototype.fold=r,n.prototype.fold=function(e,t){return e(this.value)},i.prototype.fold=function(e,t){return t(this.value)},o.prototype.cata=r,n.prototype.cata=function(e){return e.Failure(this.value)},i.prototype.cata=function(e){return e.Success(this.value)},o.prototype.swap=r,n.prototype.swap=function(){return this.Success(this.value)},i.prototype.swap=function(){return this.Failure(this.value)},o.prototype.bimap=r,n.prototype.bimap=function(e,t){return this.Failure(e(this.value))},i.prototype.bimap=function(e,t){return this.Success(t(this.value))},o.prototype.failureMap=r,i.prototype.failureMap=s,n.prototype.failureMap=function(e){return this.Failure(e(this.value))},o.prototype.leftMap=o.prototype.failureMap,i.prototype.leftMap=i.prototype.failureMap,n.prototype.leftMap=n.prototype.failureMap},205:e=>{"use strict";e.exports=t},443:e=>{"use strict";e.exports=r},318:t=>{"use strict";t.exports=e}},o={};function n(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return s[e](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";n.r(i),n.d(i,{Channel:()=>ce,ChannelFetch:()=>be,ChannelFetchUtil:()=>Ce,ChannelPayload:()=>T,ChannelPayloadFilter:()=>X,ChannelsDelegator:()=>Te,DomEl:()=>D,DomElement:()=>I,DomElementTemplate:()=>O,SpyneApp:()=>Oe,SpynePlugin:()=>ve,SpyneTrait:()=>fe,ViewStream:()=>ne,ViewStreamBroadcaster:()=>j,ViewStreamElement:()=>V,ViewStreamPayload:()=>x,ViewStreamSelector:()=>se,deepMerge:()=>v});var e=n(205);const t=t=>{if(void 0!==t.constructor.name)return t.constructor.name;let r=t.toString();return(0,e.defaultTo)(String(r).substr(0,12),(0,e.match)(/^(function\s)(\w+)(\(.*)$/,r)[2])},r=(t,r=[])=>{r=(0,e.concat)(["length","name","prototype","constructor"],r);let s=(0,e.compose)((0,e.without)(r),e.uniq),o=s(Object.getOwnPropertyNames(t.constructor.prototype)),n=s((i=t.constructor,Object.getOwnPropertyNames(i)));var i;return{methods:o,staticMethods:n,allMethods:(0,e.concat)(o,n)}},s=n(318),o=n(318);let a=()=>({includes:()=>void 0!==window.Spyne?(t=>{let r=[];return(0,e.forEach)(((e,t,s)=>r.push(t)),t),r})(window.Spyne.channels.map):["CHANNEL_ROUTE","CHANNEL_UI","CHANNEL_WINDOW","DISPATCHER"]}),c=["LOAD","RENDER","MOUNT","UNMOUNT","DISPOSE","GARBAGE_COLLECT","UPDATE"],l=["parent","self","child","children","view"],d=["Observable","BehaviorSubject","Subject","Observer","Subscriber","FromEventObservable"],p=["subscribe","combineLatest"],h=[],u=[],E=[],m=null,N=null,g=null,y=null,_=null,S=null;if(void 0!==e.compose&&void 0!==s){h=[{error:`need to match a valid name within ${d}`,predicate:e=>a().includes(e.name)},{error:"param 'observable' must contain a valid Observable",predicate:e=>void 0!==e.observable.subscribe},{error:"param action must be a registered action",predicate:e=>p.includes(e.action)}],u=[{error:"needs vsid number in srcElement",predicate:(0,e.compose)((0,e.is)(String),(0,e.path)(["data","srcElement","vsid"]))},{error:"needs a id in srcElement",predicate:(0,e.compose)((0,e.is)(String),(0,e.path)(["data","srcElement","id"]))}],E=function(){return[].concat(h).concat(u)};let t=[{error:`need to match a valid name within ${d}`,predicate:e=>a().includes(e.name)},{error:`needs one of the following step strings: ${c}`,predicate:e=>c.includes(e.STEP)},{error:`type needs to one of the following: ${l}`,predicate:e=>l.includes(e.type)},{error:"viewId needs to be added ",predicate:e=>void 0!==e.viewId}];N=function(){return[].concat(t)},g=function(){return[{error:"DISPOSE STEP requires a disposeItem param in the data object",predicate:e=>"DISPOSE"===e.STEP&&void 0!==e.data.disposeItems}].concat(t)},y=function(){return[{error:"UPDATE STEP requires a data object ",predicate:e=>"UPDATE"===e.STEP&&void 0!==e.data}].concat(t)},m=function(){return t.concat(h).concat(u)},_=function(){return[].concat(h).concat(u)},S=function(){let e=[{error:"param 'name' must be of a registered type",predicate:e=>a().includes(e.name)},{error:"param 'observable' must contain a valid Observable",predicate:e=>d.includes((0,e.observable)().constructor.name)},{error:"param action must be a registered action",predicate:e=>p.includes(e.action)}];return{streams:[{init:{name:"DISPATCHER",observable:()=>new o,action:"subscribe"},structure:{type:String,observable:s||o,action:String},validations:e},{init:{name:"UBU",observable:()=>new o,action:"subscribe"},structure:{type:String,observable:s||o,action:String},validations:e}]}}}class T{constructor(t,r,s,o,n,i){let a=t;i&&console.time(i);let c={channelName:t,action:r,srcElement:o,event:n};if(c.payload=T.deepFreeze(s),!0===(0,e.pathEq)(["Spyne","config","debug"],!0)(window)&&s.hasOwnProperty("payload")){let e=JSON.stringify(s);console.warn(`Spyne Warning: the following payload contains a nested payload property which may create conflicts: Action: ${r}, ${e}`)}c.props=()=>(0,e.clone)((0,e.mergeAll)([{payload:T.deepClone(c.payload)},c.payload,{channel:a},{event:n},c.srcElement,{action:c.action}]));const l=window.Spyne.getChannelActions(a);return T.validateAction(r,a,l),"CHANNEL_ROUTE"===a&&(c.location=T.getLocationData()),c._dir=void 0,Object.defineProperties(c,{$dir:{get:()=>c._dir,set:e=>c._dir=e}}),i&&console.timeEnd(i),c}static validateAction(t,r,s){let o=(0,e.includes)(t,s);return!1===o&&void 0!==window.Spyne&&console.warn(`warning: Action: '${t}' is not registered within the ${r} channel!`),o}static getLocationData(){return(0,e.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getStreamItem(){}static deepClone(t){const r=(0,e.is)(Array),s=(0,e.is)(Object);var o;return!1===r(o=t)&&!0===s(o)?(0,e.compose)(e.fromPairs,e.toPairs,e.clone)(t):(0,e.clone)(t)}static deepFreeze(t){const r=(0,e.compose)((0,e.lte)(0),(0,e.defaultTo)(-1),(0,e.prop)("nodeType"));try{Object.freeze(t),Object.getOwnPropertyNames(t).forEach((function(e){!t.hasOwnProperty(e)||!1!==r(t[e])||null===t[e]||"object"!=typeof t[e]&&"function"!=typeof t[e]||Object.isFrozen(t[e])||T.deepFreeze(t[e])}))}catch(e){return t}return t}static getMouseEventKeys(){return["altKey","bubbles","cancelBubble","cancelable","clientX","clientY","composed","ctrlKey","currentTarget","defaultPrevented","detail","eventPhase","fromElement","isTrusted","layerX","layerY","metaKey","movementX","movementY","offsetX","offsetY","pageX","pageY","path","relatedTarget","returnValue","screenX","screenY","shiftKey","sourceCapabilities","srcElement","target","timeStamp","toElement","type","view","which","x","y"]}}function A(){return{createpropsMap:function(){let e=new WeakMap,t={vsid:this.props.vsid};return e.set(t,this.props),{key:t,weakMap:e}},gc:function(){for(let e in this)delete this[e]},createId:function(){return Math.random().toString(36).replace(/\d/gm,"").substring(1,8)},setTraceFunc:function(e){return!0===e?console.log:()=>{}}}}function f(e){return e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function C(e,t){return t&&!0===t.clone&&f(e)?v((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function b(e,t,r){let s=e.slice();return t.forEach((function(t,o){void 0===s[o]?s[o]=C(t,r):f(t)?s[o]=v(e[o],t,r):-1===e.indexOf(t)&&s.push(C(t,r))})),s}function v(e,t,r){let s=Array.isArray(t),o=(r||{arrayMerge:b}).arrayMerge||b;return s?Array.isArray(e)?o(e,t,r):C(t,r):function(e,t,r){let s={};return f(e)&&Object.keys(e).forEach((function(t){s[t]=C(e[t],r)})),Object.keys(t).forEach((function(o){f(t[o])&&e[o]?s[o]=v(e[o],t[o],r):s[o]=C(t[o],r)})),s}(e,t,r)}v.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce((function(e,r){return v(e,r,t)}))};class O{constructor(t,r){this.template=this.formatTemplate(t),(()=>{!0===(0,e.is)(Array,r)&&(r={spyneData:r},this.template=this.template.replace("{{/}}","{{/spyneData}}"),this.template=this.template.replace("{{#}}","{{#spyneData}}"))})(),this.templateData=r;let s=O.getStringArray(this.template),o=this.template.match(O.findTmplLoopsRE());o=null===o?[]:o;const n=O.parseTmplLoopsRE(),i=this.parseTheTmplLoop.bind(this),a=(0,e.includes)(e.__,o),c=(0,e.ifElse)(a,((e,t)=>e.replace(n,i)),this.addParams.bind(this));this.finalArr=s.map(c)}static getStringArray(t){let r=t.split(O.findTmplLoopsRE());const s=/^([\\n\s\W]+)$/;return(0,e.reject)((e=>e.match(s)),r)}static findTmplLoopsRE(){return/({{#\w+}}[\w\n\s\W]+?{{\/\w+}})/gm}static parseTmplLoopsRE(){return/({{#(\w+)}})([\w\n\s\W]+?)({{\/\2}})/gm}static swapParamsForTagsRE(){return/({{)(.*?)(}})/gm}removeThis(){this.finalArr=void 0,this.templateData=void 0,this.template=void 0}renderDocFrag(){const e=this.finalArr.join(""),t=/^([^>]*?)(<){1}(\b)(thead|col|colgroup|tbody|td|tfoot|tr|th)(\b)([^\0]*)$/.test(e)?e:document.createRange().createContextualFragment(e);return window.setTimeout(this.removeThis(),2),t}renderToString(){const e=this.finalArr.join("");return window.setTimeout(this.removeThis(),2),e}getTemplateString(){return this.finalArr.join("")}formatTemplate(t){return"SCRIPT"===(0,e.prop)("nodeName",t)?t.innerHTML:t}getDataValFromPathStr(t,r){const s=String(t).split(".");return(0,e.path)(s,r)||""}addParams(e){const t=/(\.)/gm;return e.replace(O.swapParamsForTagsRE(),((e,r,s,o)=>!1===t.test(s)&&void 0!==this.templateData[s]?this.templateData[s]:this.getDataValFromPathStr(s,this.templateData)))}parseTheTmplLoop(t,r,s,o){const n=/(\.)/gm,i=o;let a=this.templateData[s];const c=(e,t)=>t.replace(O.swapParamsForTagsRE(),((t,r,s)=>!1===n.test(s)&&void 0!==e[s]?e[s]:this.getDataValFromPathStr(s,e)));return!0===(0,e.isNil)(a)||(0,e.isEmpty)(a)?"":(void 0===a.length&&(a=[a]),a.map((e=>"string"==typeof e?((e,t)=>t.replace(O.swapParamsForTagsRE(),e))(e,i):c(e,i))).join(""))}}class I{constructor(t={}){var r;t.tagName=("div",r=t.tagName,(0,e.defaultTo)("div")(r)),t.attributes=void 0!==t.attributes?t.attributes:this.getDomAttributes(t),t.attrs=this.updateAttrs(t.attributes),t.fragment=document.createDocumentFragment(),this.props=t,this.addMixins()}setProp(e,t){this.props[e]=t}getProp(e){return this.props[e]}get el(){return this.props.el}setElAttrs(t,r){return this.getProp("attrs").forEach(((r,s)=>{"dataset"===s?(0,e.forEachObjIndexed)(((e,r)=>{t.dataset[r]=e}),r):t.setAttribute(s,r)})),t}updateAttrs(t,r){let s=void 0!==r?r:new Map;return(0,e.mapObjIndexed)(((e,t)=>s.set(t,e)),t),s}addTemplate(t){let r=this.getProp("template");return void 0!==r?(r=>{let s=this.getProp("data");s=(0,e.is)(Object,s)?s:{};let o=new O(r,s).renderDocFrag();return(0,e.is)(String,o)?t.innerHTML=o:t.appendChild(o),t})(r):t}createElement(e="div"){return document.createElement(e)}addContent(t){let r=this.getProp("data");if(!0===(0,e.is)(String,r)){let e=document.createTextNode(r);t.appendChild(e)}return t}execute(){let t=(0,e.pipe)(this.createElement.bind(this),this.setElAttrs.bind(this),this.addTemplate.bind(this),this.addContent.bind(this))(this.getProp("tagName"));this.props.el=t}render(){return this.execute(),this.props.template=void 0,this.props.data=void 0,this.props.attributes=void 0,this.getProp("el")}renderToHTMLString(){return this.execute(),this.props.template=void 0,this.props.data=void 0,this.props.attributes=void 0,this.getProp("el").outerHTML}returnIfDefined(e,t){if(void 0!==t){let r=void 0===t;e[t]=!1===r?t:v(e[t],t)}}updateprops(e){return this.returnIfDefined(this.props,e),this}updatepropsAndRun(e){return this.updateprops(e),this.execute(),this.getProp("fragment")}unmount(){void 0!==this.props&&(this.getProp("el").remove(),this.props=void 0,this.gc())}updateTag(e="div"){this.updateprops(e)}updateAttributes(e={}){this.updateprops(e)}updateTemplate(e){this.updateprops(e)}updateData(e={}){this.updateprops(e)}addTagAndRender(e="div"){this.updatepropsAndRun(e)}addAttrsibutesAndRender(e={}){this.updatepropsAndRun(e)}addTemplateAndRender(e){this.updatepropsAndRun(e)}addDataAndRender(e={}){this.updatepropsAndRun(e)}addMixins(){let e=A();this.gc=e.gc.bind(this)}getDomAttributes(t){return(0,e.pick)(this.attributesArray,t)}get attributesArray(){return["accept","accept-charset","accesskey","action","align","allow","alt","async","autocapitalize","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","dataset","datetime","decoding","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","importance","integrity","ismap","itemprop","keytype","kind","label","lang","language","lazyload","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","referrerpolicy","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","value","width","wrap"]}}const D=I;let L=(e=!1,t=1,r="ease",s=!1)=>`${!0===s?"opacity:0;":""}transition: opacity ${t}s ${r}; opacity: ${!0===e?1:0};`;var w=n(318),R=n(443);class P{constructor(e){this.props.observableStreams=P.createDirectionalObservables()}static createDirectionalFiltersObject(){const e="internal",t="parent",r="child";return{P:[t],C:[r],PCI:[t,e,r],CI:[r,e],PI:[t,e],PC:[t,r]}}static addDefaultDir(t){return(0,e.flip)(e.mergeRight)({$dir:["internal"]},(0,e.clone)(t))}static addDownInternalDir(t,r=["internal","down"]){return(0,e.flip)(e.mergeRight)((0,e.clone)(t),{$dir:r})}static addChildAndInternalDir(t,r=["child","down"]){return(0,e.flip)(e.mergeRight)((0,e.clone)(t),{$dir:r})}static mapToDefaultDir(e){return this.addDefaultDir(e)}static createDirectionalObservables(t=new w.Subject,r,s){void 0!==r&&void 0!==s&&(t.viewName=r,t.vsid=s);const o=t=>(0,e.propSatisfies)((e=>e.includes(t)),"$dir"),n=o("parent"),i=o("child"),a=o("internal"),c=t=>(0,e.mergeRight)({from$:t}),l=c("child"),d=c("internal"),p=c("parent"),h=t.pipe((0,R.filter)((e=>void 0!==e&&void 0!==e.action))),u=t.pipe((0,R.filter)(a),(0,R.map)(d)),E=t.pipe((0,R.filter)(n),(0,R.map)(l)),m=t.pipe((0,R.filter)(i),(0,R.map)(p)),N={parent:E,internal:u,child:m};return{raw$:h,toInternal$:u,toParent$:E,toChild$:m,completeAll:()=>{(0,e.forEach)((e=>{e.complete(),e.isStopped=!0}),[h,u,E,m])},completeStream:(e=[])=>{void 0!==e&&e.length>=1&&e.forEach((e=>{var t;void 0!==N[e]&&((t=N[e]).complete(),t.isStopped=!0)}))}}}}class V{constructor(e,t={},r="",s="theName"){this.addMixins(),this._state="INIT",this.vsid=r,this.vsName=s,this.defaults={debug:!1,extendedHashMethods:{}},this.options=v(this.defaults,t),this.addActionListeners().forEach((e=>{let[t,r]=e;this.options.extendedHashMethods[t]=e=>this[r](e)})),this.options.hashMethods=this.setHashMethods(this.options.extendedHashMethods),this.sink$=e,this.sink$.subscribe(this.onObsSinkSubscribe.bind(this)),this.$dirs=P.createDirectionalFiltersObject(),this.addDefaultDir=P.addDefaultDir,this.sourceStreams=P.createDirectionalObservables(new w.Subject,this.vsName,this.vsid),this._source$=this.sourceStreams.toInternal$}addActionListeners(){return[]}setHashMethods(e={}){return v({VS_DETRITUS_COLLECT:e=>this.onGarbageCollect(e),READY_FOR_VS_DETRITUS_COLLECT:e=>this.onReadyForGC(e),EXTIRPATE:e=>this.onDispose(e),VS_SPAWN:e=>this.onRender(e),VS_SPAWN_AND_ATTACH_TO_PARENT:e=>this.onRenderAndAttachToParent(e),VS_SPAWN_AND_ATTACH_TO_DOM:e=>this.onRenderAndAttachToDom(e),ATTACH_CHILD_TO_SELF:e=>this.onAttachChildToSelf(e)},e)}createDomItem(){this.props=void 0!==this.props?this.props:{};let t=(0,e.filter)((e=>void 0!==e),(0,e.pick)(["id","className"],this.props)),{tagName:r,data:s,template:o}=this.props;return new I(r,t,s,o)}onDisposeCompleted(e){}animateInTween(e,t){!function(e,t){let r=1*window.getComputedStyle(e).opacity,s=L(!0,t,"ease",1===r);e.style.cssText+=s}(e,t)}animateOutTween(e,t,r){!function(e,t,r){let s=L(!1,t,"ease");e.style.cssText+=s,e.addEventListener("transitionend",r,!1)}(e,t,r)}setAnimateIn(e){if(!0===e.animateIn){let t=void 0!==e.el?e.el:this.domItem.el;this.animateInTween(t,e.animateInTime)}}disposeMethod(e){let t=void 0!==e.el.el?e.el.el:e.el;const r={action:"READY_FOR_VS_DETRITUS_COLLECT",$dir:this.$dirs.PI,el:t};let s=(0,w.bindCallback)(((e,r)=>{this.animateOutTween(t,e.animateOutTime,r)})),o=e=>{this._source$.next(r)};return(!0===e.animateOut?e=>(s(e).subscribe(o),{action:"EXTIRPATING",$dir:this.$dirs.CI}):()=>({action:"EXTIRPATE_AND_READY_FOR_VS_DETRITUS_COLLECT",$dir:this.$dirs.CI}))(e)}onDispose(e){return this.disposeMethod(e)}removeStream(){void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["internal","child"])}onReadyForGC(e){this.removeStream()}onGarbageCollect(e){void 0!==this.domItem&&this.domItem.unmount(),void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["parent"])}getSourceStream(){return this._source$}combineDomItems(t){let r=(0,e.isNil)(t.query)?t.node:t.query;("appendChild"===t.attachType?(e,t)=>e.appendChild(t):(e,t)=>e.insertBefore(t,e.firstChild))(r,this.domItem.render()),this.setAnimateIn(t)}onAttachChildToSelf(e){let t=e.childRenderData;return this.combineDomItems(t),{action:"CHILD_ATTACHED",$dir:this.$dirs.PI}}onRenderAndAttachToParent(e){return this.onRender(e),this.combineDomItems(e),{action:"VS_SPAWNED_AND_ATTACHED_TO_PARENT",el:this.domItem.el,$dir:this.$dirs.PI}}renderDomItem(e){let t,r,s,o;return[t,r,s,o]=e,this.domItem=new I({tagName:t,attributes:r,data:s,template:o}),this.domItem}onRender(t){return{action:"VS_SPAWNED",el:(e=>this.renderDomItem(e))((0,e.props)(["tagName","domAttributes","data","template"],t)),$dir:this.$dirs.I}}extendedMethods(e){}onRenderAndAttachToDom(t){return t.attachData.el=(e=>this.renderDomItem(e))((0,e.props)(["tagName","domAttributes","data","template"],t)),this.combineDomItems(t.attachData),{action:"VS_SPAWNED_AND_ATTACHED_TO_DOM",el:t.attachData.el.el,$dir:this.$dirs.CI}}onObsSinkSubscribe(t){let r=t.action,s=(0,e.defaultTo)((e=>this.extendedMethods(e)))(this.options.hashMethods[r])(t);void 0!==s&&(e=>{this._source$.next(e)})(Object.freeze(s))}addMixins(){}}class H{constructor(e,t){this.context=e,this.enhancersMap=new Map,this.enhancersArr=t,this.initMap(),this.addAllEnhancerMethods()}initMap(){this.enhancersMap.set("ALL",[]);let e=r(this.context).allMethods;this.updateMap("LOCAL",e)}getEnhancersMap(){return this.enhancersMap}updateMap(t,r){let s=(0,e.concat)(this.enhancersMap.get("ALL"),r);this.enhancersMap.set(t,r),this.enhancersMap.set("ALL",s)}getMethodsArr(e){return this.enhancersMap.get(e)}createEnhancerMethodsObj(t){const r=e=>console.error(`Spyne Error: The following enhancer method, "${e}", already exists and cannot be added to the ${s.name} Enhancer!`);let s=new t(this.context),o=s.getEnhancerMethods(),n=(t=>{let s=(0,e.includes)(e.__,this.getMethodsArr("ALL")),o=(0,e.filter)(s,t);return o.forEach(r),o})(o.allMethods),i=(0,e.dropWhile)((0,e.includes)(e.__,n));return o=(0,e.map)(i,o),this.updateMap(s.name,o.allMethods),o.enhancer=s,o.name=s.name,o}addAllEnhancerMethods(){(0,e.forEach)((e=>{let t=this.createEnhancerMethodsObj(e);t.enhancer.bindParentViewStream(t,this.context)}),this.enhancersArr)}}var M=n(360),F=n.n(M);const W=F().Success,$=F().Failure;let U=()=>{};function k(){setTimeout((()=>{(0,e.forEach)((e=>{}),this)}),1)}void 0!==e.curry&&(U=(0,e.curry)(((t,r)=>{const s=W((0,e.curryN)((0,e.length)(t),(0,e.always)(r)));return(0,e.reduce)(((e,t)=>e.ap(t.predicate(r)?W(r):$([t.error]))),s,t)})));class x{constructor(e,t,r,s="subscribe",o=!1){this.addMixins(),this.options={name:e,observable:t,data:r,action:s},this.getValidationChecks(e)}getValidationChecks(e){return!0===window.Spyne.channels.map.has(e)?(e=>this.onRunValidations(e))(E):("payload Needs a Valid Stream Name!",console.warn("payload Needs a Valid Stream Name!"))}onRunValidations(e){U(e(),this.options).fold(this.onError.bind(this),this.onSuccess.bind(this))}onPayloadValidated(e){this.sendToDirectorStream(e)}sendToDirectorStream(e){window.Spyne.channels.getStream("DISPATCHER").next(e),this.gc()}onError(e){console.warn("payload failed due to:\n"+e.map((e=>"* "+e)).join("\n")),this.gc()}onSuccess(e){this.onPayloadValidated(e)}addMixins(){this.gc=k}}class j{constructor(e,t){this.addMixins(),this.props=e,this.broadcastFn=t,this.broadcaster(this.broadcastFn)}addDblClickEvt(t){return(0,w.fromEvent)(t,"dblclick").pipe((0,R.map)((t=>{let r=(0,e.clone)(t);return r.typeOverRide="dblclick",r})))}broadcast(t){let r,s={UI:this.sendUIPayload,ROUTE:this.sendRoutePayload},[o,n,i]=t,a=this.props.el.querySelectorAll(o);if(a.length<=0){let e=this.props.el;const t=t=>{t===e&&(a=[t])};(()=>{let r=(null!==e.parentElement?e.parentElement:document).querySelectorAll(o);r.forEach=Array.prototype.forEach,r.forEach(t)})()}let c=void 0!==i,l=!0===(0,e.path)(["Spyne","config","debug"],window);!0==(void 0===a||a.length<=0)&&!0===l?console.warn(`Spyne Warning: The item ${o}, does not appear to exist!`):(a.forEach=Array.prototype.forEach,a.forEach((t=>{let o="dblClick"!==n?(0,w.fromEvent)(t,n,{preventDefault:()=>!0}):this.addDblClickEvt(t);r=t.dataset.channel;let i={};i.payload=(e=>{let t={};for(let r in e)t[r]=e[r];return t})(t.dataset),i.payload=(0,e.omit)(["channel"],i.payload),i.channel=r,i.srcElement={},i.srcElement.id=this.props.id,i.srcElement.vsid=this.props.vsid,i.srcElement.isLocalEvent=c,i.srcElement.srcEvent=n,i.srcElement.el=t,(void 0!==r?s[r]:s.UI)(o,i)})))}broadcaster(e){e().forEach((e=>this.broadcast(e)))}addMixins(){let e=function(e,t){return new x("CHANNEL_ROUTE",e,t,"subscribe")},t=function(e,t){return new x("CHANNEL_UI",e,t,"subscribe")};this.sendUIPayload=t,this.sendRoutePayload=e}}const G=n(205).map,q=(0,e.compose)(e.not,(0,e.is)(Array)),Y=(0,e.compose)(e.not,e.isEmpty),B=(0,e.allPass)([(0,e.is)(String),Y]),z=(0,e.allPass)([(0,e.is)(Array),Y]),K=(0,e.compose)((0,e.allPass)([q,(0,e.is)(Object)])),Q=(0,e.compose)((0,e.allPass)([Y,q,(0,e.is)(Object)]));class X{constructor(t,r={},s,o){K(t)&&(r=t,t=(0,e.prop)("selector",r),o=o||(0,e.prop)("testMode",r));const n=[s,(0,e.prop)("debugLabel",r)];s=(0,e.compose)((0,e.find)((0,e.is)(String)))(n);let i=(0,e.omit)(["debugLabel","label","selector","props","testMode","propFilters"],r);void 0!==r.props?i=(0,e.mergeAll)([r.props,i]):void 0!==r.propFilters&&(i=(0,e.mergeAll)([r.propFilters,i])),r.propFilters=i;let{propFilters:a}=r;const c=B(t)?X.filterSelector([t],s):void 0,l=z(t)?X.filterSelector(t,s):void 0,d=Q(a)?X.filterData(a,s):void 0;let p=(0,e.reject)(e.isNil,[c,l,d]);const h=(0,e.isEmpty)(p);return h&&(p=[(0,e.always)(!1)],!0===(0,e.path)(["Spyne","config","debug"],window)&&!0!==o&&console.warn(`Spyne Warning: The Channel Filter, with selector: ${t}, and propFilters:${a} appears to be empty!`)),!0===o?{selector:t,propFilters:a,debugLabel:s,filters:r,testMode:o,filtersAreEmpty:h}:(0,e.allPass)(p)}static filterData(t,r){const s=r;return(()=>{if((0,e.isEmpty)(t))return(0,e.always)(!1);t=G(((t,r,s)=>{return!0===(0,e.is)(String,t)?(o=t,e=>e===o):t;var o}),t);let r=(0,e.where)(t);return(0,e.compose)(r,(r=>{if(void 0===s)return r;const o={};return(0,e.forEachObjIndexed)(((t,s)=>o[s]=t((0,e.prop)(s,r))),t),console.log(`%c CHANNEL PAYLOAD FILTER DEBUGGER ["${s}"] - values:    `,"color:orange;",{propsBooleans:o,comparedObj:r}),r}),(0,e.defaultTo)({}),(e=>{const{payload:t,srcElement:r,event:s}=e||{};return Object.assign({},e,s,r,t)}))})()}static checkPayloadSelector(t,r,s){const{payload:o,srcElement:n,event:i}=s||{},a=[n,o,(0,e.prop)("srcElement",i),s].reduce(((t,r)=>{const s=(0,e.prop)("el",r);return X.elIsDomElement(s)&&void 0===t&&(t=s),t}),void 0),c=e=>e.isEqualNode(a),l=t=>{let r=(0,e.flatten)(document.querySelectorAll(t));return G(c,r)};if(void 0!==r){let s=(0,e.compose)(e.flatten,G(l))(t);const o=t;console.log(`%c CHANNEL PAYLOAD FILTER DEBUGGER ["${r}"] - selectors: `,"color:orange;",{el:a,selectorsArr:o,nodeArrResultsDebugger:s})}if("object"!=typeof a)return!1;let d=(0,e.compose)(e.flatten,G(l))(t);return!0!==(0,e.isEmpty)(d)&&(0,e.any)((0,e.equals)(!0),d)}static elIsDomElement(t){return(0,e.is)(String,t)&&(t=document.querySelector(t)),(0,e.compose)((0,e.lte)(0),(0,e.defaultTo)(-1),(0,e.prop)("nodeType"))(t)}static filterSelector(t,r){let s=(0,e.reject)(e.isEmpty,t);return(0,e.curry)(X.checkPayloadSelector)(s,r)}}function J(){return!0===(0,e.path)(["Spyne","config","debug"],window)}function Z(t,r,s=!1){let o=te(t,r,s);return 1===o.length?(0,e.head)(o):o}function ee(t,r,s){let o=document.querySelector(t);!1!==(0,e.compose)((0,e.lte)(0),(0,e.defaultTo)(-1),(0,e.prop)("nodeType"))(o)?void 0!==r&&null===o.querySelector(r)&&!0===J()&&!0===s&&console.warn(`Spyne Warning: the selector, ${r} does not exist in this el, ${t}`):console.warn(`Spyne Warning: the el object is not a valid single element, ${o}`)}function te(e,t,r=!1){let s=void 0!==t?`${e} ${t}`:e;return!0===r&&ee(e,t,r),(e=>{try{document.querySelectorAll(e)}catch(e){return[]}return document.querySelectorAll(e)})(s)}function re(e,t,r){return te(t,r).forEach((t=>{t.style.cssText=e})),this}function se(t,r){function s(e){return se(t,e)}return ee(t="string"==typeof t?t:function(e){let t=`${Math.random().toString(36).replace(/\d/gm,"").substring(1,8)}`;return void 0===e.dataset.vsid?e.dataset.vsid=t:t=e.dataset.vsid,`[data-vsid='${t}']`}(t),r,!1),s.map=e=>Array.from(te(t,r)).map(e),s.forEach=e=>Array.from(te(t,r)).map(e),s.getNodeListArray=()=>te(t,r),s.addClass=e=>(te(t,r).forEach((t=>t.classList.add(e))),this),s.removeClass=e=>(te(t,r).forEach((t=>{t.classList.remove(e)})),this),s.setClass=s=>(te(t,r).forEach((t=>{let r=(0,e.compose)((0,e.reject)(e.isEmpty),(0,e.split)(" "))(t.className),o=s.split(" ");r.forEach((e=>t.classList.remove(e))),o.forEach((e=>t.classList.add(e)))})),this),s.unmount=()=>{},s.toggleClass=(e,s)=>(te(t,r).forEach((t=>{(s=void 0!==s?s:!t.classList.contains(e))?t.classList.add(e):t.classList.remove(e)})),this),s.toggle=(e,t)=>(s.toggleClass(e,t),this),s.appendChild=e=>(0!==s.el.length?s.el.appendChild(e):console.warn(`Spyne Warning: The selector, ${r} does not appear to be valid!`),s.el),s.addAnimClass=e=>{window.setTimeout((()=>{te(t,r).forEach((t=>t.classList.add(e)))}),1)},s.setActiveItem=(s,o)=>{let n=te(t,r),i="string"==typeof o?Z(t,o):o;var a;return!0===(a=i,(0,e.compose)((0,e.lte)(0),(0,e.defaultTo)(-1),(0,e.prop)("nodeType"))(a))?n.forEach((e=>e.isEqualNode(i)?e.classList.add(s):e.classList.remove(s))):!0===J()&&console.warn(`Spyne Warning: The selector, ${o}, does not appear to be a valid item in setActiveItem: ${s}`),this},Object.defineProperty(s,"el",{get:()=>Z(t,r,!0)}),Object.defineProperty(s,"els",{get:()=>te(t,r)}),Object.defineProperty(s,"len",{get:()=>te(t,r,!1).length}),Object.defineProperty(s,"exists",{get:()=>te(t,r,!1).length>=1}),Object.defineProperty(s,"exist",{get:()=>te(t,r,!1).length>=1}),Object.defineProperty(s,"nodeList",{get:()=>te(t,r)}),Object.defineProperty(s,"arr",{get:()=>{let e=Z(t,r,!0);return void 0===e?[]:void 0===e.length?[e]:Array.from(e)}}),Object.defineProperty(s,"inline",{set:e=>re(e,t,r)}),Object.defineProperty(s,"inlineCss",{set:e=>re(e,t,r)}),s}const oe=n(205).map;class ne{constructor(r={}){this.vsnum=Math.random(),this.addMixins(),this.defaults=()=>{const e=this.createId(),s=r.id?r.id:e;return{vsid:e,id:s,tagName:"div",el:void 0,data:void 0,animateIn:!1,animateInTime:.5,animateOut:!1,animateOutTime:.5,sendLifecyleEvents:!1,hashId:`#${s}`,id$:`#${s}`,viewClass:V,extendedSourcesHashMethods:{},debug:!1,template:void 0,node:document.createDocumentFragment(),name:t(this)}},this._state={},this.$dirs=P.createDirectionalFiltersObject(),this.addDefaultDirection=P.addDefaultDir,this.addDownInternalDir=P.addDownInternalDir,this.props=v(this.defaults(),r),this.sendLifecycleMethod=!0===this.props.sendLifecyleEvents?this.sendLifecycleMethodActive.bind(this):this.sendLifecycleMethodInactive.bind(this);let s=this.attributesArray;this.props.domAttributes=(0,e.pick)(s,this.props),void 0!==this.props.traits&&this.addTraits(this.props.traits),this.loadEnhancers(),this.loadAllMethods(),this.props.action="LOADED",this.sink$=new w.Subject;const o=this.props.viewClass;this.view=new o(this.sink$,{},this.props.vsid,this.props.id),this.sourceStreams=this.view.sourceStreams,this._rawSource$=this.view.getSourceStream(),this._rawSource$.viewName=this.props.name,this.sendEventsDownStream=this.sendEventsDownStreamFn,this.initViewStream(),this.isDevMode=ne.isDevMode(),this.props.addedChannels=[],this.checkIfElementAlreadyExists()}updatePropsToMatchEl(){const t=(0,e.compose)(e.toLower,(0,e.either)((0,e.prop)("tagName"),(0,e.always)("")));this.props.tagName=t(this.props.el)}checkIfElementAlreadyExists(){const t=(0,e.compose)((0,e.lte)(0),(0,e.defaultTo)(-1),(0,e.prop)("nodeType"));(0,e.propSatisfies)((0,e.allPass)([e=>document.body.contains(e),t]),"el")(this.props)&&(this.updatePropsToMatchEl(),this.postRender())}loadEnhancers(e=[]){let t=new H(this,e);this.props.enhancersMap=t.getEnhancersMap(),t=void 0}loadAllMethods(){const t=(0,e.curry)(this.onChannelMethodCall.bind(this));this.addActionListeners().forEach((r=>{let[s,o,n]=r;(0,e.is)(String,n)&&(n=new X({selector:n})),this.props.extendedSourcesHashMethods[s]=t(o,n)})),this.props.hashSourceMethods=this.setSourceHashMethods(this.props.extendedSourcesHashMethods)}addActionListeners(){return[]}onChannelMethodCall(t,r,s){if(void 0!==s.$dir&&s.$dir.includes("child")&&!0!==this.deleted){let e=v({},s);e.$dir=this.$dirs.C,this.sourceStreams.raw$.next(e)}let o=(0,e.defaultTo)((0,e.always)(!0),r);Math.floor(999999*Math.random()),!0===o(s)&&(e=>{void 0===this[t]?console.warn(`Spyne Warning: The method, ${t} does not appear to exist in ${this.constructor.name}!`):this[t](e)})(s=(0,e.omit)(["$dir"],s))}setSourceHashMethods(e={}){let t={EXTIRPATING:e=>this.checkParentDispose(e),EXTIRPATE:e=>this.disposeViewStream(e),VS_SPAWNED:e=>this.onVSRendered(e),VS_SPAWNED_AND_ATTACHED_TO_DOM:e=>this.onVSRendered(e),VS_SPAWNED_AND_ATTACHED_TO_PARENT:e=>this.onVSRendered(e),READY_FOR_VS_DETRITUS_COLLECT:e=>this.onReadyToGC(e),VS_NULLITY:()=>({})};return v.all([{},t,e])}initViewStream(){this._source$=this._rawSource$.pipe((0,R.map)((e=>this.onMapViewSource(e))),(0,R.takeWhile)(this.notGCSTATE)),this.initAutoMergeSourceStreams(),this.updateSourceSubscription(this._source$,!0)}notGCSTATE(e){return!e.action.includes("READY_FOR_VS_DETRITUS_COLLECT")}eqGCSTATE(e){return!e.action.includes("READY_FOR_VS_DETRITUS_COLLECT")}notCOMPLETED(e){return!e.action.includes("COMPLETED")}notGCCOMPLETE(e){return!e.action.includes("GC_COMPLETE")}testVal(e){console.log("TESTING VALL IS ",e)}addParentStream(e,t){this.parent$=e.pipe((0,R.filter)((e=>void 0!==e&&void 0!==e.action)),(0,R.map)((e=>{let t=v({},e);return"EXTIRPATE_AND_READY_FOR_VS_DETRITUS_COLLECT"===t.action&&(this.disposeViewStream(t),t.action="READY_FOR_VS_DETRITUS_COLLECT"),t}))),this.updateSourceSubscription(this.parent$,!1,"PARENT"),this.renderAndAttachToParent(t)}addChildStream(e){let t=e.pipe((0,R.filter)((e=>void 0!==e&&void 0!==e.action)),(0,R.tap)((e=>this.tracer("addChildStraem do ",e))),(0,R.map)((e=>e)),(0,R.finalize)((e=>this.onChildCompleted(t.source))));this.updateSourceSubscription(t,!0,"CHILD")}onChildDisposed(e){}onChildCompleted(t){let r=(t=>{let r=e=>{for(;void 0!==e.destination;)e=r(e.destination);return e};return(0,e.pick)(["id","vsid"],r(t))})(t);return this.tracer("onChildCompleted ",this.vsnum,t),this.onChildDisposed(r,t),r}static removeDataFromTmpDir(t){void 0!==(0,e.path)(["Spyne","config","tmp"],window)[t]&&delete window.Spyne.config.tmp[t]}initAutoMergeSourceStreams(){let e={next:this.onSubscribeToSourcesNext.bind(this),error:this.onSubscribeToSourcesError.bind(this),complete:this.onSubscribeToSourcesComplete.bind(this)},t=()=>{this.props.el$=void 0,this.uberSource$.complete(),this.autoSubscriber$.complete(),this.sink$.complete(),this.props=void 0,this.deleted=!0,this.tracer("completeAll",this.deleted,this.props)},r=()=>{s-=1,0===s&&t()},s=0;this.uberSource$=new w.Subject,this.autoMergeSubject$=this.uberSource$.pipe((0,R.mergeMap)((e=>{let t=e.observable.pipe((0,R.filter)((e=>void 0!==e&&void 0!==e.action)),(0,R.map)((e=>{let t=v({},e);return t.action=e.action,this.tracer("autoMergeSubject$",t),t})));return!1===e.autoClosesBool?t:(s+=1,t.pipe((0,R.finalize)(r)))}))),this.autoSubscriber$=this.autoMergeSubject$.pipe((0,R.filter)((e=>void 0!==e&&void 0!==e.action))).subscribe(e)}updateSourceSubscription(e,t=!1,r){let s={observable:e,autoClosesBool:t,rel:r};this.tracer("updateSourceSubscription ",this.vsnum,s),this.uberSource$.next(s)}onSubscribeToSourcesNext(t={}){let r=(0,e.defaultTo)((e=>this.sendExtendedStreams(e)));const s=void 0!==(o=this.props.hashSourceMethods)[n=t.action]?n:(0,e.compose)(e.head,(0,e.filter)((0,e.compose)((0,e.test)(e.__,n),(e=>new RegExp(e)))))((0,e.keys)(o));var o,n;r(this.props.hashSourceMethods[s])(t),this.tracer("onSubscribeToSourcesNext",{payload:t})}onSubscribeToSourcesError(e=""){console.log("ALL ERROR  ",this.constructor.name,e)}onSubscribeToSourcesComplete(){this.tracer("onSubscribeToSourcesComplete","VS_DETRITUS_COLLECT"),this.openSpigot("VS_DETRITUS_COLLECT")}get source$(){return this._source$}sendExtendedStreams(e){this.tracer("sendExtendedStreams",e),this.openSpigot(e.action,e)}renderAndAttachToParent(e){this.openSpigot("VS_SPAWN_AND_ATTACH_TO_PARENT",e)}renderView(){this.openSpigot("VS_SPAWN")}renderViewAndAttachToDom(e,t,r){let s={node:e,type:t,attachType:r};this.openSpigot("VS_SPAWN_AND_ATTACH_TO_DOM",{attachData:s})}checkParentDispose(e){"parent"===e.from$&&this.disposeViewStream(e)}onBeforeDispose(){}setTimeout(t,r=0,s=!1){window.setTimeout(((...r)=>{if(void 0!==this&&void 0!==this.props){const o=!0===s?t.bind(this):t;(0,e.apply)(o,r)}}),r)}disposeViewStream(e){this.onBeforeDispose(),this.openSpigot("EXTIRPATE")}onChildDispose(e){}onParentDisposing(e){this.openSpigot("EXTIRPATE")}onReadyToGC(e){const t=void 0!==e.from$&&"internal"===e.from$;this.tracer("onReadyToGC",t,e)}openSpigot(t,r={}){if(void 0!==this.props){this.props.action=t;let s=(0,e.mergeRight)(this.props,r);this.sink$.next(Object.freeze(s))}}static isDevMode(){return!0===(0,e.path)(["Spyne","config","debug"],window)}setAttachData(t,r){return{node:this.props.el,type:"ViewStreamObservable",attachType:t,query:(()=>{let t=this.props.el.querySelector(r);return!0===ne.isDevMode()&&(0,e.is)(String,r)&&(0,e.isNil)(t)&&console.warn(`Spyne Warning: The appendView query in ${this.props.name}, '${r}', appears to not exist!`),t})()}}getParentEls(e,t){let r=e=>e.parentElement,s=0,o=e;for(;s<t;)o=r(o),s++;return o}setAttachParentData(e,t,r){return t=""!==t?t:void 0,{node:this.getParentEls(this.props.el,r),type:"ViewStreamObservable",attachType:e,query:this.props.el.parentElement.querySelector(t)}}onMapViewSource(t={}){return this.props=(0,e.mergeRight)(this.props,t),t}exchangeViewsWithChild(e,t){this.addChildStream(e.sourceStreams.toParent$),e.addParentStream(this.sourceStreams.toChild$,t)}appendToDom(e){void 0!==this.props.el&&console.warn(`Spyne Warning: The ViewStream, ${this.props.name}, has an element, ${this.props.el}, that is already rendered and does not need to be appendedToDom. This may create unsusual side effects!`),this.renderViewAndAttachToDom(e,"dom","appendChild")}prependToDom(e){void 0!==this.props.el&&console.warn(`Spyne Warning: The ViewStream, ${this.props.name}, has an element, ${this.props.el}, that is already rendered and does not need to be prependedToDom. This may create unsusual side effects!`),this.renderViewAndAttachToDom(e,"dom","prependChild")}appendView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("appendChild",t))}appendViewToParentEl(e,t,r=1){this.exchangeViewsWithChild(e,this.setAttachParentData("appendChild",t,r))}prependViewToParentEl(e,t,r=1){this.exchangeViewsWithChild(e,this.setAttachParentData("prependChild",t,r))}prependView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("prependChild",t))}appendToNull(){let e=document.getElementById("spyne-null-views");this.renderViewAndAttachToDom(e,"dom","appendChild")}onVSRendered(e){"internal"===e.from$&&this.postRender()}postRender(){if(this.beforeAfterRender(),this.afterRender(),this.onRendered(),!0===this.isDevMode){const e=this.broadcastEvents();!1===ne.isValidNestedArr(e)&&console.warn(`Spyne Warning: The array returned from broadcastEvents in ${this.props.name}, '${JSON.stringify(e)}', does not appear to be properly formatted!`)}this.viewsStreamBroadcaster=new j(this.props,this.broadcastEvents.bind(this)),this.afterBroadcastEvents()}addTraits(e){"Array"!==e.constructor.name&&(e=[e]),e.forEach((e=>{new e(this)})),!0===this.isDevMode&&this.addActionListeners()}afterBroadcastEvents(){if(!0===this.isDevMode){const t=e=>e[0],r=this.addActionListeners();let s=r.map(t);if(!1===ne.isValidNestedArr(r))console.warn(`Spyne Warning: The array returned from addActionsListeners in ${this.props.name}, '${JSON.stringify(r)}', does not appear to be properly formatted!`);else{const t=t=>{const r=(0,e.defaultTo)("",t[1]);!1===(0,e.is)(Function,this[r])&&console.warn(`Spyne Warning: The method in addActionListeners nested Array, '${JSON.stringify(t)}', in ${this.props.name}, does not appear to exist!`)};(0,e.compose)((0,e.forEach)(t),(0,e.defaultTo)([]))(r)}const o=()=>{void 0!==(0,e.path)(["props","addedChannels"],this)&&ne.checkIfActionsAreRegistered.bind(this)(this.props.addedChannels,s)};this.setTimeout(o,500)}}static checkIfActionsAreRegistered(t=[],r){if(r.length>0){const s=r=>{let s=new RegExp(r);if((0,e.findIndex)((0,e.test)(s),o)<0){let e=1===t.length?"from added channel":"from added dchannels";console.warn(`Spyne Warning: The action, ${r}, in ${this.props.name}, does not match any of the registered actions ${e}, ${t.join(", ")}`)}};let o=(t=>{let r=t.map((e=>window.Spyne.channels.getChannelActions(e)));return(0,e.flatten)(r)})(t);r.forEach(s)}}setDataVSID(){this.props.el.dataset.vsid=this.props.vsid}beforeAfterRender(){this.setDataVSID(),this.props.el$=se(this.props.el)}downStream(){}onRendered(){}afterRender(){}static isValidNestedArr(t){const r=(0,e.equals)(!0),s=(0,e.all)(r),o=(0,e.is)(String),n=(0,e.compose)(s,oe(o),(0,e.slice)(0,2),(0,e.defaultTo)([]));return(0,e.compose)(s,oe(n),(0,e.defaultTo)([]))(t)}broadcastEvents(){return[]}getChannel(t){return(0,e.ifElse)((e=>a().includes(e)),(e=>window.Spyne.channels.getStream(e).observer.pipe((0,R.takeWhile)((e=>!0!==this.deleted)))),(e=>console.warn(`channel name ${e} is not within ${a}`)))(t)}addChannel(t,r=!1,s=!1,o=!1){const n=!0===s?this.$dirs.CI:this.$dirs.I,i=(0,e.path)(["srcElement","isLocalEvent"]),a=(0,e.path)(["srcElement","vsid"]),c=[(0,R.map)((e=>{let t=e;return t.$dir=n,t})),(0,R.filter)((e=>{let t=a(e);return!0!==i(e)||t===this.props.vsid}))];!0===r&&c.unshift((0,R.skip)(1));let l=this.getChannel(t).pipe(...c);this.updateSourceSubscription(l,!1),this.props.addedChannels.push(t)}checkIfChannelExists(e){let t=void 0!==window.Spyne.channels.map.get(e);return!0!==t&&console.warn(`SPYNE WARNING: The ChannelPayload from ${this.props.name}, has been sent to a channel, ${e}, that has not been registered!`),t}sendInfoToChannel(t,r={},s="VIEWSTREAM_EVENT"){let o={payload:r,action:s};if(o.srcElement=(0,e.compose)((0,e.pick)(["id","vsid","class","tagName"]),(0,e.prop)("props"))(this),!0===this.checkIfChannelExists(t)){if(!1===/CHANNEL_LIFECYCLE/.test(s)){const t=["Spyne","config","tmp"],s=["Spyne","config","tmp",this.props.vsid];(0,e.path)(t,window)[this.props.vsid]=r;const n=this.props.vsid;Object.defineProperties(o,{payload:{get:()=>(0,e.compose)(e.clone,(0,e.path)(s))(window)}});const i=()=>ne.removeDataFromTmpDir(n);window.requestAnimationFrame(i)}let n=(0,w.of)(o);return new x(t,n,o)}}tracer(...e){this.sendLifecycleMethod(...e)}sendLifecycleMethodInactive(){}sendLifecycleMethodActive(t,r){let s="VS_DETRITUS_COLLECT"===r;!0===(0,e.where)({from$:(0,e.equals)("internal"),action:(0,e.equals)("VS_SPAWNED_AND_ATTACHED_TO_PARENT")},r)?this.sendInfoToChannel("CHANNEL_LIFECYCLE",{action:"CHANNEL_LIFECYCLE_RENDERED_EVENT"},"CHANNEL_LIFECYCLE_RENDERED_EVENT"):!0===s&&this.sendInfoToChannel("CHANNEL_LIFECYCLE",{action:"CHANNEL_LIFECYCLE_DISPOSED_EVENT"},"CHANNEL_LIFECYCLE_DISPOSED_EVENT")}createActionFilter(e,t){return new X(e,t)}isLocalEvent(t){return void 0!==(0,e.path)(["srcElement","el"],t)&&this.props.el.contains(t.srcElement.el)}get attributesArray(){return["accept","accept-charset","accesskey","action","align","allow","alt","aria-autocomplete","aria-checked","aria-disabled","aria-expanded","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-level","aria-multiline","aria-multiselectable","aria-orientation","aria-pressed","aria-readonly","aria-required","aria-selected","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","aria-atomic","aria-busy","aria-live","aria-relevant","aria-dropeffect","aria-grabbed","aria-activedescendant","aria-controls","aria-describedby","aria-flowto","aria-labelledby","aria-owns","aria-posinset","aria-setsize","async","autocapitalize","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","dataset","datetime","decoding","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","importance","integrity","ismap","itemprop","keytype","kind","label","lang","language","lazyload","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","referrerpolicy","rel","required","reversed","role","rows","rowspan","sandbox","scope","scoped","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","value","width","wrap"]}addMixins(){let e=A();this.createId=e.createId}}class ie{constructor(t){let r=String(t.props.name),s=`${r}_ROUTE_UPDATER`;return(0,e.curry)(ie.createTemporaryViewStreamObj)({id:s,name:r})}static createTemporaryViewStreamObj(e,t){let{name:r,id:s}=e,o=t,n=new ne({id:s,name:r,data:t});n.onRendered=()=>{n.sendInfoToChannel("CHANNEL_ROUTE",o)},n.afterBroadcastEvents=()=>{n.disposeViewStream()},n.appendToNull()}}const ae=n(205).map;class ce{constructor(e,t={}){this.addRegisteredActions.bind(this),this.createChannelActionsObj(e,t.extendedActionsArr),t.name=e,this.props=t,this.props.isRegistered=!1,this.props.isProxy=void 0!==this.props.isProxy&&this.props.isProxy,this.props.sendCachedPayload=void 0!==this.props.sendCachedPayload&&this.props.sendCachedPayload,this.sendPayloadToRouteChannel=new ie(this),this.createChannelActionMethods(),this.streamsController=window.Spyne.channels;let r=this.getMainObserver();this.observer$=this.props.observer=r,this.streamsController.getStream("DISPATCHER").subscribe((e=>this.onReceivedObservable(e)))}getMainObserver(){return!0===this.streamsController.testStream(this.props.name)?this.streamsController.getProxySubject(this.props.name,this.props.sendCachedPayload):!0===this.props.sendCachedPayload?new w.ReplaySubject(1):new w.Subject}onChannelInitialized(){}onRegistered(){}get isProxy(){return this.props.isProxy}get channelName(){return this.props.name}get observer(){return this.observer$}checkForTraits(){void 0!==this.props.traits&&(e=>{"Array"!==e.constructor.name&&(e=[e]),e.forEach((e=>{new e(this)}))})(this.props.traits)}initializeStream(){this.checkForTraits(),this.onChannelInitialized(),this.onRegistered(),this.props.isRegistered=!0}setTrace(e){}createChannelActionsObj(t,r=[]){const s=(0,e.ifElse)((0,e.is)(String),e.identity,e.head);let o=r.concat(this.addRegisteredActions(t)),n=ae(s,o),i=(0,e.mergeAll)((0,e.chain)((t=>(0,e.objOf)(t,t)),n));this.channelActions=i}createChannelActionMethods(){const t=(0,e.ifElse)((0,e.is)(String),e.identity,e.head),r=(0,e.ifElse)((0,e.is)(String),(0,e.always)("onViewStreamInfo"),(t=>{const r=(0,e.view)((0,e.lensIndex)(1),t);return!0==("function"==typeof this[r])?this[r].bind(this):console.warn(`"${this.props.name}", REQUIRES THE FOLLOWING METHOD ${r} FOR ACTION, ${t[0]}`),r}));this.channelActionMethods=(0,e.fromPairs)(ae((e=>[t(e),r(e)]),this.addRegisteredActions()))}addRegisteredActions(){return[]}onReceivedObservable(e){this.onIncomingObservable(e)}getActionMethodForObservable(t){t.unpacked=!0;const r=this.onViewStreamInfo.bind(this);let s=(0,e.path)(["data","action"],t);const o=(0,e.prop)(s,this.channelActionMethods);let n=r;return void 0!==o&&"onViewStreamInfo"!==o&&!0==("function"==typeof this[o])&&(n=this[o].bind(this)),n}onIncomingObservable(t){let r=(0,e.equals)(t.name,this.props.name),{action:s,payload:o,srcElement:n}=t.data,i=r=>({props:()=>{return r=t.data,(0,e.mergeAll)([r,{action:(0,e.prop)("action",r)},(0,e.prop)("payload",r),(0,e.prop)("srcElement",r)]);var r},action:s,payload:o,srcElement:n,event:r});return!0===r?(e=>e.observable.pipe((0,R.map)(i)).subscribe(this.getActionMethodForObservable(e)))(t):void 0}onViewStreamInfo(e){}sendChannelPayload(e,t,r={},s={},o=this.observer$){let n=new T(this.props.name,e,t,r,s);o.next(n)}getChannel(t,r){return(0,e.ifElse)((e=>a().includes(e)),(e=>{let t=this.streamsController.getStream(e).observer;return void 0!==r?t.pipe((0,R.filter)(r)):t}),(e=>console.warn(`channel name ${e} is not within ${a}`)))(t)}setTimeout(t,r=0,s=!1){window.setTimeout(((...r)=>{if(void 0!==this&&void 0!==this.props){const o=!0===s?t.bind(this):t;(0,e.apply)(o,r)}}),r)}}class le{constructor(){this.checkIfObjIsNotEmptyOrNil=le.checkIfObjIsNotEmptyOrNil.bind(this)}static checkIfObjIsNotEmptyOrNil(t){const r=(0,e.compose)((0,e.complement)(e.isEmpty),e.head,e.values),s=(0,e.compose)((0,e.complement)(e.isNil),e.head,e.values);return(0,e.allPass)([r,s])(t)}static checkIfParamValueMatchesRegex(t,r){const s=(0,e.reject)((0,e.equals)("routeName")),o=(0,e.compose)(s,e.keys),n=(0,e.compose)((0,e.find)((r=>(0,e.test)(new RegExp(r),t))),o)(r);return(0,e.is)(String,n)&&(r=(0,e.assoc)(t,(0,e.prop)(n,r),r)),r}static formatStrAsWindowLocation(e){return{hash:e,search:e,pathname:e}}static getLocationStrByType(t,r=!1,s=window.location){const o={slash:"pathname",query:"search",hash:"hash"}[!0===r?"hash":t];return(0,e.prop)(o,s).replace(/^(\/)?(#)?(\/)?(.*)$/,"$4")}static createRouteArrayFromParams(t,r,s="slash",o){let n=[],i=r=>{let s={},a=r.routeName,c=void 0!==t[a]?t[a]:(0,e.prop)(a,o);const l=typeof r[c];"string"===l?c=r[c]:"undefined"===l&&(r=this.checkIfParamValueMatchesRegex(c,r)),s[a]=c,this.checkIfObjIsNotEmptyOrNil(s)&&n.push(s);const d=(0,e.is)(Object,r),p=(0,e.has)(c,r),h=(0,e.has)("routePath",r);if(!0===(p&&d)){let t=r[c];(0,e.has)("routePath",t)&&i(t.routePath)}else!0===h&&void 0!==c&&i(r.routePath)};return i(r),n}static createSlashString(t){const r=(0,e.reject)(e.isNil),s=(0,e.when)((0,e.complement)(e.isNil,e.__),(0,e.join)("/")),o=(0,e.replace)(/^(\^*)(.*|^\$)(\$)$/,"$2");return(0,e.compose)(o,s,r,e.flatten,(0,e.map)(e.values))(t)}static createQueryString(t){const r=(0,e.reject)(e.isNil),s=this.checkIfObjIsNotEmptyOrNil,o=(0,e.compose)((0,e.join)("="),e.flatten,e.toPairs),n=(0,e.ifElse)(s,o,(0,e.always)(void 0)),i=(0,e.map)(n),a=(0,e.when)((0,e.complement)(e.isEmpty),(0,e.concat)("?"));return(0,e.compose)(a,(0,e.join)("&"),r,i)(t)}static checkPayloadForRegexOverrides(t,r,s="Value"){const o=(0,e.compose)((t=>(0,e.prop)(`${t}${s}`,r)),e.head,e.keys);return(0,e.map)((t=>{let r=o(t);return void 0!==r?(0,e.assoc)((0,e.compose)(e.head,e.keys)(t),r,t):t}),t)}static convertParamsToRoute(e,t=window.Spyne.config.channels.ROUTE,r,s){const o=void 0!==r?r:t.type,n=t.isHash;let i=t.routes.routePath,a=void 0!==s?s:this.getLocationStrByType(o,n),c=this.convertRouteToParams(a,t,o).routeData,l=this.createRouteArrayFromParams(e,i,o,c);return l=le.checkPayloadForRegexOverrides(l,e),"query"===o?this.createQueryString(l):this.createSlashString(l)}static findIndexOfMatchedStringOrRegex(t,r){const s=(0,e.replace)(/^$/,"^$"),o=(0,e.either)((0,e.propEq)("str",t),(0,e.compose)((0,e.test)(e.__,t),(0,e.prop)("re")));return(0,e.compose)((0,e.findLastIndex)((0,e.equals)(!0)),(0,e.map)(o),(0,e.map)((e=>{return{str:e,re:(t=e,new RegExp(t))};var t})),(0,e.map)(s))(r)}static checkIfValueShouldMapToParam(t,r,s){let o=(0,e.compose)((0,e.map)(e.last),(0,e.map)((0,e.filter)((0,e.is)(String))),e.toPairs)(t),n=le.findIndexOfMatchedStringOrRegex(r,o),i=r;if(n>=0){let r=o[n],s=(0,e.invert)(t),a=(0,e.compose)(e.head,(0,e.defaultTo)([]),(0,e.prop)(r))(s);!0===/^([-\$\w]*)$/.test(a)&&!0===(0,e.is)(String,a)&&(i=a)}return i}static createArrFromSlashStr(e){return e.replace(/^([/])?(.*)$/,"$2").split("/")}static convertSlashRouteStrToParamsObj(t,r,s){const o=r;let n=this.createArrFromSlashStr(r),i=[],a=[],c=t;(0,e.reduce)(((t,r)=>{let o=this.checkIfValueShouldMapToParam(c,r,s);c=this.checkIfParamValueMatchesRegex(r,c);const n=(0,e.either)(e.isEmpty,e.isNil);void 0!==c&&(t=>t!==(0,e.last)(i))(c.routeName)&&!1===n(o)&&(i.push(c.routeName),a.push(o));let l=[r,"routePath"],d=(0,e.path)(l,c),p=(0,e.path)(["routePath"],c);void 0!==d?c=d:void 0!==p&&(c=p)}),0,n);let l=(0,e.zipObj)(i,a);const d=this.getLastArrVal(i);return{paths:i,pathInnermost:d,routeData:l,routeValue:o}}static getLastArrVal(t){return r=t,void 0!==(0,e.last)(r)?(0,e.last)(r):"";var r}static createDefaultParamFromEmptyStr(e,t){let r={};return r[e.routeName]=this.checkIfValueShouldMapToParam(e,t),r}static convertQueryStrToParams(t,r,s){const o=r;let n=r.replace(/^([?])?(.*)$/,"$2"),i=(0,e.compose)((0,e.map)((0,e.split)("=")),(0,e.split)("&"))(n),a=(0,e.fromPairs)(i),c=(0,e.map)(e.head,i);return!0===(0,e.isEmpty)(r)&&(a=this.createDefaultParamFromEmptyStr(t,r,s),c=(0,e.keys)(a)),{paths:c,pathInnermost:this.getLastArrVal(c),routeData:a,routeValue:o}}static convertRouteToParams(t,r,s){if(void 0===r)return{};const o=void 0!==s?s:r.type,n=(0,e.defaultTo)({},(0,e.prop)("regexTokens",r));let i=r.routes.routePath;return"query"===o?this.convertQueryStrToParams(i,t):(t=t.replace(/\/$|$/,"/"),this.convertSlashRouteStrToParamsObj(i,t,n))}}class de{constructor(){this.createPopStateStream=de.createPopStateStream.bind(this)}static createPopStateStream(e){(0,w.fromEventPattern)((function(e){window.onpopstate=e}),(function(){window.onpopstate=function(){}})).subscribe(e)}static getLastArrVal(t){return r=t,void 0!==(0,e.last)(r)?(0,e.last)(r):"";var r}static compareRouteKeywords(t={},r){const s=(t,r)=>void 0!==r?(0,e.pick)(r,t):t;let o=s(t,r);return{pickValues:s,compare:(t={},r)=>{let n=s(t,r);const i=t=>(0,e.compose)(e.keys,(0,e.filter)((0,e.propEq)(t,!0))),a=(0,e.compose)((0,e.map)((t=>{let r=(0,e.prop)(t,o),s=(0,e.prop)(t,n),i=(0,e.equals)(r,s),a=void 0!==r,c=void 0!==s,l=!i,d=!1===a&&!0===c,p=!0===a&&!1===c,h={};return h[t]={same:i,changed:l,added:d,removed:p,previousExists:a,nextExists:c},h})),e.uniq,(0,e.chain)(e.keys))([o,n]);let c=(0,e.chain)(i("changed"),a),l=(0,e.chain)(i("added"),a),d=(0,e.chain)(i("removed"),a);return o=n,{pathsAdded:l,pathsRemoved:d,pathsChanged:c}},getComparer:()=>o}}static getRouteArrData(t,r){let s=(0,e.filter)((0,e.includes)(e.__,t),r);return{paths:s,pathInnermost:de.getLastArrVal(s)}}static flattenConfigObject(t){const r=t=>(0,e.chain)((([t,s])=>"[object Object]"===Object.prototype.toString.call(s)?(0,e.map)((([e,r])=>[`${t}.${e}`,r]),r(s)):[[t,s]]),(0,e.toPairs)(t));return(0,e.values)((0,e.fromPairs)(r(t)))}static addRouteDatasets(t){const{type:r,isHash:s}=t,o=e=>("query"===r?"":!0===s?"#":"/")+le.convertParamsToRoute(e,t).replace(/^(.*\/)([\w\-]*\/?)(.*)$/gm,"$1$2"),n=/^([A-Za-z0-9_\-])+$/m,i=(t=[],r,s={})=>{let{routeName:a}=r;return(0,e.toPairs)(r).reduce(((r,c)=>{const[l,d]=c,p=(0,e.is)(Object,d),h=t=>(0,e.test)(n,t)?String(t).toUpperCase():l;if("routeName"===l||"404"===l)return r;a=a||(0,e.prop)("routeName",d);let u=(0,e.clone)(s);if(u[a]=String(l).replace(/([^A-Za-z0-9-_])/g,""),!0===p){if(1===(0,e.keys)(u).length){const t=(0,e.path)(["routePath","routeName"],d);if(t){const n=(0,e.clone)(u);n[t]="",n.navLevel=(0,e.keys)(s).length,n.title=h(l),n.href=o(n),r.push(n)}}u=i(t,d,u)}else u.title=h(l),u.href=o(u);return u.navLevel=(0,e.keys)(s).length,r.push(u),r}),[])};let a=i([],t.routes);const c=(0,e.flatten)(a);return{routeDatasetsArr:c,routeNamesArr:(t=>{const r=(0,e.reject)((0,e.includes)(e.__,["title","href","navLevel"]));return(0,e.compose)(e.uniq,r,e.flatten,(0,e.map)(e.keys))(t)})(c)}}static conformRouteObject(t={},r=!1){const s=(0,e.path)(["channels","ROUTE"],t);let{add404s:o}=void 0!==s?s:t;o=o||r;const n=t=>{let r=t[1];const s=(0,e.is)(Array,r);return""===r?t[1]="^$":s&&(t[1]=r.join("|")),t},i=(0,e.compose)(e.fromPairs,(0,e.map)((t=>{let[r,s]=t;const a=o?{404:".+"}:{},c=(0,e.is)(Object,s),l=(0,e.is)(Array,s),d="routePath"===r;return!0===c&&!1===l&&(t[1]=i(t[1]),d&&(t[1]=(0,e.compose)((0,e.mergeDeepRight)(a),e.fromPairs,(0,e.map)(n),e.toPairs)(t[1]))),t})),e.toPairs);if(void 0!==s){t.channels.ROUTE=i(t.channels.ROUTE);const r=de.addRouteDatasets(t.channels.ROUTE);return t.channels.ROUTE=(0,e.mergeRight)(t.channels.ROUTE,r),t}return i(t)}static getLocationData(){return(0,e.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}}const pe=n(205).filter,he=n(205).mergeRight;class ue extends ce{constructor(e="CHANNEL_ROUTE",t={}){t.sendCachedPayload=!0,super("CHANNEL_ROUTE",t),this.createChannelActionsObj(),this.routeConfigJson=this.getRouteConfig(),this.bindStaticMethods(),this.navToStream$=new w.ReplaySubject(1),this.observer$=this.navToStream$.pipe((0,R.map)((e=>this.onMapNext(e)))),this.compareRouteKeywords=de.compareRouteKeywords()}checkConfigForHash(){!0==("hash"===window.Spyne.config.channels.ROUTE.type)&&(window.Spyne.config.channels.ROUTE.type="slash",window.Spyne.config.channels.ROUTE.isHash=!0)}onRegistered(){this.checkConfigForHash(),this.initStream()}createChannelActionsObj(){let t=this.addRegisteredActions(),r=(0,e.mergeAll)((0,e.chain)((t=>(0,e.objOf)(t,t)),t));this.channelActions=r}addRegisteredActions(){return["CHANNEL_ROUTE_DEEPLINK_EVENT","CHANNEL_ROUTE_CHANGE_EVENT","CHANNEL_ROUTE_CONFIG_UPDATED_EVENT",["CHANNEL_ROUTE_UPDATE_CONFIG_EVENT","updateRouteConfig"]]}updateRouteConfig(t){const r=(0,e.pick)(["isHash","isHidden","routes","type"],t.payload);window.Spyne.config.channels.ROUTE=(0,e.mergeRight)(window.Spyne.config.channels.ROUTE,r),(0,e.clone)(window.Spyne.config.channels.ROUTE),window.Spyne.config=de.conformRouteObject(window.Spyne.config);const s=this.getRouteConfig();this.routeConfigJson=s,this.bindStaticMethodsWithConfigData(),this.sendChannelPayload("CHANNEL_ROUTE_CONFIG_UPDATED_EVENT",s,{},{},this.navToStream$)}getRouteConfig(){const t=window.Spyne.config;let r=(0,e.path)(["channels","ROUTE"],t);"query"===r.type&&(r.isHash=!1);let s=de.flattenConfigObject(r.routes);return r.paramsArr=s,r}initStream(){this.firstLoadStream$=new w.ReplaySubject(1),this.onIncomingDomEvent(void 0,this.routeConfigJson,"CHANNEL_ROUTE_DEEPLINK_EVENT"),de.createPopStateStream(this.onIncomingDomEvent.bind(this)),this.observer$=(0,w.merge)(this.firstLoadStream$,this.navToStream$)}onMapNext(e,t=!1){return e.action="CHANNEL_ROUTE_CHANGE_EVENT",e}static removeSSID(t){const r=(0,e.lensProp)(["routeData"]);return(0,e.over)(r,(0,e.omit)(["vsid"]))(t)}static onIncomingDomEvent(t,r=this.routeConfigJson,s){let o=void 0!==s?s:this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT,n=(0,e.path)(["state","routeCount"],t),i=!0===(0,e.is)(Number,n),a=this.getDataFromString(r,i);!0===i&&(a.routeCount=n);let c=this.compareRouteKeywords.compare(a.routeData,a.paths);a=he(a,c),this.sendChannelPayload(o,a,void 0,void 0,this.navToStream$)}static checkForRouteParamsOverrides(e){return e}static checkForEventMethods(t){const r=(0,e.compose)(pe((0,e.test)(/^(event)([A-Z].*)([A-Z].*)$/gm)),e.keys,(0,e.prop)("payload"))(t);if(r.length>=1){const s=(0,e.prop)("event",t);if(void 0!==s){const t=(e,t,r,s,o)=>String(r).toLowerCase()+s+o,o=(0,e.replace)(/^(event)([A-Z])(.*)([A-Z].*)$/gm,t),n=e=>{const t=o(e);void 0!==s[t]&&s[t]()};r.forEach(n)}}return t}static checkForEndRoute(t,r=this.routeConfigJson,s){if(!0!==(0,e.compose)((0,e.equals)("true"),(0,e.path)(["payload","endRoute"]))(t))return t;const o=window||{},n=void 0!==s?s:(0,e.compose)((0,e.equals)(!0),(0,e.path)(["Spyne","config","debug"]))(o),{payload:i}=t;let a=0;const c=(t=[],r)=>{const[s,o]=r,{routePath:l}=o,d=(0,e.prop)("routeName",l),p=(t=>{const r=(0,e.prop)("routeName",t);if(r){const s=(0,e.compose)(e.keys,(0,e.omit)(["routeName"]))(t);let o=i[r];const n=e=>new RegExp(`^${e}$`).test(o);return(0,e.find)(n,s)}})(l),h=(0,e.is)(Object,o),u=(0,e.is)(Array,o);if(a+=1,!0===h&&!1===u){const r=l[p];r?(0,e.compose)(e.reverse,(0,e.reduce)(c,t),e.toPairs)({nextRoutePath:r}):1===a?n&&console.warn(`Spyne Warning: use of end route method should add start route value of "${d}".`):t.push(d)}return t},{routes:l}=r,d=(0,e.compose)(e.reverse,(0,e.reduce)(c,[]),e.toPairs)({routes:l});if(1===d.length){const e=d[0];t.payload[e]=""}return t}onViewStreamInfo(t){let r=this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT;ue.checkForEventMethods(t),t=this.checkForEndRoute(t);let s=this.getDataFromParams(t);const{routeConfigJson:o}=this;let n=(0,e.prop)("srcElement",t),i=(0,e.prop)("event",t),a=!s.isHidden,c=this.compareRouteKeywords.compare(s.routeData,s.paths);s=he(s,c),this.sendRouteStream(s,a),s=ue.removeSSID(s),this.sendChannelPayload(r,s,n,i,this.navToStream$)}static checkAndConvertStrWithRegexTokens(t,r){return(0,e.keys)(r)}sendRouteStream(e,t=!0){!0===t&&this.setWindowLocation(e)}static getRouteState(){return"CHANNEL_ROUTE_CHANGE_EVENT"}static getIsDeepLinkBool(e){return!1===e&&0===this._routeCount}static getRouteCount(e=!1){return void 0===this._routeCount?(this._routeCount=0,this._routeCount):(!1===e&&(this._routeCount+=1),this._routeCount)}static getExtraPayloadParams(e=this.routeConfigJson,t=!1){return{routeCount:this.getRouteCount(t),isDeepLink:this.getIsDeepLinkBool(t),isHash:e.isHash,isHidden:e.isHidden,routeType:e.type}}static getDataFromParams(t,r=this.routeConfigJson){let s=(0,e.prop)("payload",t),o=this.getRouteStrFromParams(s,r);const n=(t,s)=>(0,e.defaultTo)(s,(0,e.prop)(t,r));let i=n("type","slash"),a=n("isHash",!1),c=le.formatStrAsWindowLocation(o),l=this.getDataFromLocationStr(i,a,c),{pathInnermost:d,paths:p}=l;s=he(l.routeData,s);let{routeCount:h,isDeepLink:u,isHash:E,isHidden:m,routeType:N}=this.getExtraPayloadParams(r);return{isDeepLink:u,routeCount:h,pathInnermost:d,paths:p,routeData:s,routeValue:o,isHash:E,isHidden:m,routeType:N}}static getDataFromString(e=this.routeConfigJson,t=!1){const r=e.type,s=!0===e.isHash,o=le.getLocationStrByType(r,s);let{paths:n,pathInnermost:i,routeData:a,routeValue:c}=ue.getParamsFromRouteStr(o,e,r),{routeCount:l,isDeepLink:d,isHash:p,routeType:h,isHidden:u}=this.getExtraPayloadParams(e,t);return{isDeepLink:d,routeCount:l,pathInnermost:i,paths:n,routeData:a,routeValue:c,isHash:p,isHidden:u,routeType:h}}static getDataFromLocationStr(e="slash",t=this.routeConfigJson.isHash,r=window.location){const s=void 0!==this.routeConfigJson?this.routeConfigJson.type:e,o=le.getLocationStrByType(s,t,r);let{paths:n,pathInnermost:i,routeData:a,routeValue:c}=this.getParamsFromRouteStr(o,this.routeConfigJson,s);return{paths:n,pathInnermost:i,routeData:a,routeValue:c,action:this.getRouteState()}}static getLocationData(){return(0,e.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getRouteStrFromParams(e,t,r){const s=void 0!==r?r:t.type;return le.convertParamsToRoute(e,t,s)}static getParamsFromRouteStr(e,t,r){const s=void 0!==r?r:t.type;return le.convertRouteToParams(e,t,s)}checkEmptyRouteStr(t,r=!1){const s=(0,e.isEmpty)(t);return!0==(!0===s&&!1===r)||!0==(!0===s&&!0===r)?"/":!0==(!1===s&&!0===r)?(0,e.concat)("#",t):t}static removeLastSlash(e){return e.replace(/^(.*)(\/)$/,"$1")}setWindowLocation(t){let{isHash:r,routeValue:s}=t;s=this.checkEmptyRouteStr(s,r);let{routeCount:o}=t;if(!0===r)s=ue.removeLastSlash(window.location.pathname)+s,window.history.pushState({routeCount:o},"",s);else{const t=(0,e.when)((0,e.compose)((0,e.complement)((0,e.equals)("/")),e.head),(0,e.concat)("/",e.__));window.history.pushState({routeCount:o},"",t(s))}}getWindowLocation(){return window.location.pathname}bindStaticMethods(){this.checkForEndRoute=ue.checkForEndRoute.bind(this),this.getIsDeepLinkBool=ue.getIsDeepLinkBool.bind(this),this.getDataFromLocationStr=ue.getDataFromLocationStr.bind(this),this.onIncomingDomEvent=ue.onIncomingDomEvent.bind(this),this.getDataFromString=ue.getDataFromString.bind(this),this.getParamsFromRouteStr=ue.getParamsFromRouteStr.bind(this),this.getLocationData=ue.getLocationData.bind(this),this.getRouteState=ue.getRouteState.bind(this),this.getDataFromParams=ue.getDataFromParams.bind(this),this.getRouteCount=ue.getRouteCount.bind(this),this.getExtraPayloadParams=ue.getExtraPayloadParams.bind(this),this.bindStaticMethodsWithConfigData()}bindStaticMethodsWithConfigData(){const t=(0,e.curryN)(3,ue.getRouteStrFromParams);this.getRouteStrFromParams=t(e.__,this.routeConfigJson,this.routeConfigJson.type)}}class Ee extends ce{constructor(e="CHANNEL_UI",t={}){t.sendCachedPayload=!1,super(e,t),this.keyEventsLoaded=!1,this.keyCodeArr=[]}addRegisteredActions(){return["CHANNEL_UI_ANIMATIONEND_EVENT","CHANNEL_UI_ANIMATIONITERATION_EVENT","CHANNEL_UI_ANIMATIONSTART_EVENT","CHANNEL_UI_AUDIOEND_EVENT","CHANNEL_UI_AUDIOPROCESS_EVENT","CHANNEL_UI_AUDIOSTART_EVENT","CHANNEL_UI_BLUR_EVENT","CHANNEL_UI_CACHED_EVENT","CHANNEL_UI_CANPLAYTHROUGH_EVENT","CHANNEL_UI_CANPLAY_EVENT","CHANNEL_UI_CHANGE_EVENT","CHANNEL_UI_CHECKBOXSTATECHANGE_EVENT","CHANNEL_UI_CLICK_EVENT","CHANNEL_UI_COMPLETE_EVENT","CHANNEL_UI_COPY_EVENT","CHANNEL_UI_CUT_EVENT","CHANNEL_UI_DBLCLICK_EVENT","CHANNEL_UI_DURATIONCHANGE_EVENT","CHANNEL_UI_EMPTIED_EVENT","CHANNEL_UI_ENDED_EVENT","CHANNEL_UI_EVENT","CHANNEL_UI_FOCUSIN_EVENT","CHANNEL_UI_FOCUSOUT_EVENT","CHANNEL_UI_FOCUS_EVENT","CHANNEL_UI_HASHCHANGE_EVENT","CHANNEL_UI_INPUT_EVENT","CHANNEL_UI_KEYDOWN_EVENT","CHANNEL_UI_KEYPRESS_EVENT","CHANNEL_UI_KEYUP_EVENT","CHANNEL_UI_LOADEDDATA_EVENT","CHANNEL_UI_LOADEDMETADATA_EVENT","CHANNEL_UI_MOUSEDOWN_EVENT","CHANNEL_UI_MOUSEENTER_EVENT","CHANNEL_UI_MOUSELEAVE_EVENT","CHANNEL_UI_MOUSEMOVE_EVENT","CHANNEL_UI_MOUSEOUT_EVENT","CHANNEL_UI_MOUSEOVER_EVENT","CHANNEL_UI_MOUSEUP_EVENT","CHANNEL_UI_MOUSEWHEEL_EVENT","CHANNEL_UI_PAUSE_EVENT","CHANNEL_UI_PLAYING_EVENT","CHANNEL_UI_PLAY_EVENT","CHANNEL_UI_RADIOSTATECHANGE_EVENT","CHANNEL_UI_RATECHANGE_EVENT","CHANNEL_UI_READYSTATECHANGE_EVENT","CHANNEL_UI_SEEKED_EVENT","CHANNEL_UI_SEEKING_EVENT","CHANNEL_UI_SELECT_EVENT","CHANNEL_UI_STALLED_EVENT","CHANNEL_UI_SUBMIT_EVENT","CHANNEL_UI_SUSPEND_EVENT","CHANNEL_UI_SVGABORT_EVENT","CHANNEL_UI_SVGERROR_EVENT","CHANNEL_UI_SVGLOAD_EVENT","CHANNEL_UI_SVGRESIZE_EVENT","CHANNEL_UI_SVGSCROLL_EVENT","CHANNEL_UI_SVGUNLOAD_EVENT","CHANNEL_UI_SVGZOOM_EVENT","CHANNEL_UI_TIMEUPDATE_EVENT","CHANNEL_UI_TOUCHCANCEL_EVENT","CHANNEL_UI_TOUCHEND_EVENT","CHANNEL_UI_TOUCHMOVE_EVENT","CHANNEL_UI_TOUCHSTART_EVENT","CHANNEL_UI_TRANSITIONEND_EVENT","CHANNEL_UI_VALUECHANGE_EVENT","CHANNEL_UI_VOLUMECHANGE_EVENT","CHANNEL_UI_WAITING_EVENT","CHANNEL_UI_WHEEL_EVENT"]}loadKeyStream(){let e=w.Observable.fromEvent(document,"keyup");this.keyPresses$=e.groupBy((e=>e.keyCode)).mergeAll().filter((e=>this.keyCodeArr.indexOf(e.keyCode)>=0)).repeat().subscribe(this.onKeyPressed.bind(this))}addKeyEvent(e){!1===this.keyEventsLoaded&&this.loadKeyStream(),this.keyEventsLoaded=!0,this.registerKey(e)}registerKey(e){this.keyCodeArr.push(e)}onKeyPressed(e){console.log("key is ",e)}static removeSSID(t){const r=(0,e.lensProp)(["payload"]);return(0,e.over)(r,(0,e.omit)(["vsid"]))(t)}onIncomingObservable(t){let r=(0,e.equals)(t.name,this.props.name);t.data=Ee.removeSSID(t.data);let{payload:s,srcElement:o}=t.data,n=e=>({payload:s,srcElement:o,event:e});return!0===r?(e=>e.observable.pipe((0,R.map)(n)).subscribe(this.onUIEvent.bind(this)))(t):void 0}getActionState(t){let r=(0,e.path)(["event","type"]),s=(0,e.path)(["event","typeOverRide"]),o=(0,e.compose)(e.toUpper,(0,e.either)(s,r))(t);return void 0!==o?`CHANNEL_UI_${o}_EVENT`:"CHANNEL_UI"}static checkForEventMethods(t){const r=(0,e.compose)((0,e.filter)((0,e.test)(/^(event)([A-Z].*)([A-Z].*)$/gm)),e.keys,(0,e.prop)("payload"))(t);if(r.length>=1){const s=(0,e.prop)("event",t);if(void 0!==s){const t=(e,t,r,s,o)=>String(r).toLowerCase()+s+o,o=(0,e.replace)(/^(event)([A-Z])(.*)([A-Z].*)$/gm,t),n=e=>{const t=o(e);void 0!==s[t]&&"function"==typeof s[t]&&s[t]()};r.forEach(n)}}return t}onUIEvent(e){Ee.checkForEventMethods(e),e.action=this.getActionState(e);const t=e.action,{payload:r,srcElement:s}=e,o=e.event;this.sendChannelPayload(t,r,s,o)}}class me{constructor(){this.createDomObservableFromEvent=me.createDomObservableFromEvent.bind(this)}static createDomObservableFromEvent(e,t,r=!0,s=window){return t=void 0===t?e=>e:t,(0,w.fromEventPattern)((t=>s.addEventListener(e,t,{passive:r})),(()=>{s[e]=e=>e})).pipe((0,R.map)(t))}static createMediaQuery(e){const t=window.matchMedia(e);return this.checkIfValidMediaQuery(t,e),!1!==t&&t}static checkIfValidMediaQuery(e,t){const r=e=>e.replace(/\s+/gm,""),s=void 0!==e.matches&&r(e.media).indexOf(r(t))>=0;return!1===s&&(t=>{console.warn(`Spyne Info: the following query string, "${t}", has been optimized to "${e.media}" by the browser and may not be a valid Media Query item!`)})(t),s}static createMediaQueryHandler(e,t){let r=(e=>t=>(t.mediaQueryName=e,t))(t),s=(o=e,{addHandler:e=>{o.addListener(e)},removeHandler:e=>{o.onchange=()=>{}}});var o;return new w.fromEventPattern(s.addHandler,s.removeHandler).pipe((0,R.map)(r))}static createMergedObsFromObj(t){let r=t.mediqQueries,s=[];return(0,e.mapObjIndexed)(((e,t,r)=>{let o=me.createMediaQuery(e);return!1!==o&&s.push(me.createMediaQueryHandler(o,t)),s}),r),s}}const Ne=n(205).map;class ge extends ce{constructor(e="CHANNEL_WINDOW"){super(e),this.bindStaticMethods(),this.currentScrollY=0}initializeStream(){this.domChannelConfig=window.Spyne.config.channels.WINDOW;let e=this.getActiveObservables(),t=(0,w.merge)(...e);this.dom$=t,t.subscribe((e=>{let{action:t,payload:r,srcElement:s,event:o}=e;this.sendChannelPayload(t,r,s,o)}))}static getMouseWheelMapFn(e){let t=this.channelActions.CHANNEL_WINDOW_MOUSEWHEEL_EVENT,r=e.deltaY<=0?"up":"down",{deltaX:s,deltaY:o,deltaZ:n}=e;return{action:t,payload:{scrollDir:r,deltaX:s,deltaY:o,deltaZ:n},srcElement:e.srcElement,event:e}}static createCurriedGenericEvent(t){let r=`CHANNEL_WINDOW_${t.toUpperCase()}_EVENT`;return(0,e.curry)(ge.mapGenericEvent)(r)}static mapGenericEvent(e,t){return{action:e,payload:t,srcElement:t.srcElement,event:t}}static getResizeMapFn(t){return{action:this.channelActions.CHANNEL_WINDOW_RESIZE_EVENT,payload:(0,e.pick)(["innerWidth","innerHeight","outerWidth","outerHeight"],window),srcElement:t.srcElement,event:t}}static getOrientationMapFn(t){let r=this.channelActions.CHANNEL_WINDOW_ORIENTATION_EVENT,s=window.matchMedia("(orientation: portrait)").matches,o=(0,e.pick)(["innerWidth","innerHeight","outerWidth","outerHeight"],window);return o.orientation=!0===s?"portrait":"landscape",{action:r,payload:o,srcElement:t.srcElement,event:t}}getMediaQueryMapFn(t){return{action:this.channelActions.CHANNEL_WINDOW_MEDIA_QUERY_EVENT,payload:(0,e.pick)(["matches","media","mediaQueryName"],t),srcElement:t.srcElement,event:t}}createMouseWheelObservable(e){const t=e.debounceMSTimeForScroll;return me.createDomObservableFromEvent("mousewheel",ge.getMouseWheelMapFn.bind(this)).pipe((0,R.debounceTime)(t))}static getScrollData(){let e=0;return t=>{let r=e-t;return e=t,{scrollY:t,scrollDistance:r,scrollDir:r>=0?"up":"down"}}}static getScrollY(e){return void 0!==e.pageYOffset?e.pageYOffset:e.scrollTop}static getScrollMapFn(e,t,r,s,o){let n=s(ge.getScrollY(o)),{scrollDistance:i}=n;return{action:r,payload:n,srcElement:e.srcElement,scrollDistance:i,event:e}}createScrollObservable(t,r=window){const s=t.debounceMSTimeForScroll,o=r===window,n=void 0!==t.scrollElForVals?t.scrollElForVals:r,i=o?"CHANNEL_WINDOW_SCROLL_EVENT":"CHANNEL_WINDOW_ELEMENT_SCROLL_EVENT",a=ge.getScrollData(),c=(0,e.partialRight)(ge.getScrollMapFn,[i,a,n]).bind(this);return me.createDomObservableFromEvent("scroll",c).pipe((0,R.debounceTime)(s),(0,R.skipWhile)((e=>0===e.scrollDistance)),(0,R.map)((e=>{const t=ge.getScrollY(window);return e.payload.scrollDistanceAbs=Math.abs(this.currentScrollY-t),this.currentScrollY=t,e})))}createOrientationObservable(e){return me.createDomObservableFromEvent("orientationchange",ge.getOrientationMapFn.bind(this))}createResizeObservable(e){const t=e.debounceMSTimeForResize;return me.createDomObservableFromEvent("resize",ge.getResizeMapFn.bind(this)).pipe((0,R.debounceTime)(t))}getEventsFromConfig(e=this.domChannelConfig){let t=e.events;return Ne((e=>{let t=ge.createCurriedGenericEvent(e);return me.createDomObservableFromEvent(e,t)}),t)}getActiveObservables(t=this.domChannelConfig){let r=[];t.listenForMediaQueries=(t=>{const r=(0,e.compose)((0,e.complement)(e.isEmpty),e.head,e.values),s=(0,e.compose)((0,e.complement)(e.isNil),e.head,e.values);return(0,e.allPass)([r,s])(t)})(t.mediqQueries);let s={listenForResize:this.createResizeObservable.bind(this),listenForOrientation:this.createOrientationObservable.bind(this),listenForScroll:this.createScrollObservable.bind(this),listenForMouseWheel:this.createMouseWheelObservable.bind(this)};(0,e.mapObjIndexed)(((e,s,o)=>{t[s]&&r.push(e(t))}),s),this.checkForMediaQueries(t.listenForMediaQueries);let o=this.getEventsFromConfig(t);return r=r.concat(o),r}checkForMediaQueries(e){!0===e&&this.getMediaQueryObservable(this.domChannelConfig).subscribe((e=>{let{action:t,payload:r,srcElement:s,event:o}=e;this.sendChannelPayload(t,r,s,o,this.observer$)}))}getMediaQueryObservable(t){let r=this.createMergedObsFromObj(t);return(0,e.apply)(w.merge,r).pipe((0,R.map)(this.getMediaQueryMapFn.bind(this)))}addRegisteredActions(){return["CHANNEL_WINDOW_ABORT_EVENT","CHANNEL_WINDOW_AFTERPRINT_EVENT","CHANNEL_WINDOW_ANIMATIONEND_EVENT","CHANNEL_WINDOW_ANIMATIONITERATION_EVENT","CHANNEL_WINDOW_ANIMATIONSTART_EVENT","CHANNEL_WINDOW_APPINSTALLED_EVENT","CHANNEL_WINDOW_BEFOREPRINT_EVENT","CHANNEL_WINDOW_BEFOREUNLOAD_EVENT","CHANNEL_WINDOW_BEGINEVENT_EVENT","CHANNEL_WINDOW_BLUR_EVENT","CHANNEL_WINDOW_CACHED_EVENT","CHANNEL_WINDOW_CHANGE_EVENT","CHANNEL_WINDOW_CLICK_EVENT","CHANNEL_WINDOW_CLOSE_EVENT","CHANNEL_WINDOW_COMPOSITIONEND_EVENT","CHANNEL_WINDOW_COMPOSITIONSTART_EVENT","CHANNEL_WINDOW_COMPOSITIONUPDATE_EVENT","CHANNEL_WINDOW_COPY_EVENT","CHANNEL_WINDOW_CUT_EVENT","CHANNEL_WINDOW_DEVICECHANGE_EVENT","CHANNEL_WINDOW_DEVICELIGHT_EVENT","CHANNEL_WINDOW_DEVICEMOTION_EVENT","CHANNEL_WINDOW_DEVICEORIENTATION_EVENT","CHANNEL_WINDOW_DEVICEPROXIMITY_EVENT","CHANNEL_WINDOW_DOMATTRIBUTENAMECHANGED_EVENT","CHANNEL_WINDOW_DOMATTRMODIFIED_EVENT","CHANNEL_WINDOW_DOMCHARACTERDATAMODIFIED_EVENT","CHANNEL_WINDOW_DOMCONTENTLOADED_EVENT","CHANNEL_WINDOW_DOMELEMENTNAMECHANGED_EVENT","CHANNEL_WINDOW_ERROR_EVENT","CHANNEL_WINDOW_FOCUSIN_EVENT","CHANNEL_WINDOW_FOCUS_EVENT","CHANNEL_WINDOW_FULLSCREENCHANGE_EVENT","CHANNEL_WINDOW_FULLSCREENERROR_EVENT","CHANNEL_WINDOW_LOAD_EVENT","CHANNEL_WINDOW_MEDIA_QUERY_EVENT","CHANNEL_WINDOW_MESSAGE_EVENT","CHANNEL_WINDOW_MOUSEWHEEL_EVENT","CHANNEL_WINDOW_OFFLINE_EVENT","CHANNEL_WINDOW_ONLINE_EVENT","CHANNEL_WINDOW_OPEN_EVENT","CHANNEL_WINDOW_ORIENTATION_EVENT","CHANNEL_WINDOW_PAGEHIDE_EVENT","CHANNEL_WINDOW_PAGESHOW_EVENT","CHANNEL_WINDOW_POPSTATE_EVENT","CHANNEL_WINDOW_RESET_EVENT","CHANNEL_WINDOW_RESIZE_EVENT","CHANNEL_WINDOW_ELEMENT_SCROLL_EVENT",["CHANNEL_WINDOW_SET_ELEMENT_TO_SCROLL_EVENT","onSetElementToScroll"],"CHANNEL_WINDOW_SCROLL_EVENT","CHANNEL_WINDOW_SCROLL_LOCK_EVENT",["CHANNEL_WINDOW_SCROLL_LOCK_EVENT","onScrollLockEvent"],"CHANNEL_WINDOW_SUBMIT_EVENT","CHANNEL_WINDOW_TRANSITIONCANCEL_EVENT","CHANNEL_WINDOW_TRANSITIONEND_EVENT","CHANNEL_WINDOW_TRANSITIONRUN_EVENT","CHANNEL_WINDOW_TRANSITIONSTART_EVENT","CHANNEL_WINDOW_UNLOAD_EVENT","CHANNEL_WINDOW_WHEEL_EVENT"]}onScrollLockEvent(e){let{action:t,scrollLock:r}=e.payload;window.Spyne.config.scrollLock=r,!0===r&&(window.Spyne.config.scrollLockX=window.scrollX,window.Spyne.config.scrollLockY=window.scrollY),this.sendChannelPayload(t,{scrollLock:r})}onSetElementToScroll(e){let{config:t,scrollElement:r}=e.payload;t=v(this.domChannelConfig,t),this.createScrollObservable(t,r).subscribe((e=>{let{action:t,payload:r,srcElement:s,event:o}=e;this.sendChannelPayload(t,r,s,o)}))}bindStaticMethods(){this.createMediaQueryHandler=me.createMediaQueryHandler.bind(this),this.createMergedObsFromObj=me.createMergedObsFromObj.bind(this)}}class ye extends ce{constructor(e={}){super("CHANNEL_LIFECYCLE",e)}addRegisteredActions(){return["CHANNEL_LIFECYCLE_RENDERED_EVENT","CHANNEL_LIFECYCLE_DISPOSED_EVENT"]}onViewStreamInfo(e){let{data:t,action:r,srcElement:s}=e,o=s;o.action=r,this.onSendEvent(r,o)}onSendEvent(e,t={}){const r=this.channelActions[e],s={};window.setTimeout((()=>this.sendChannelPayload(r,t,s,void 0)),0)}}class _e extends ce{constructor(t,r={}){r.isProxy=!0,super(t,r),this.props=r,this.subject$=new w.Subject,this.replaySub$=new w.ReplaySubject(1),this.observer$=(0,w.merge)(this.subject$,this.replaySub$),!0==(!0===(0,e.path)(["Spyne","config","debug"],window))&&this.checkIfChannelIsStillProxy(t)}getMergedSubject(e=!1){return!0===e?this.replaySub$:this.subject$}checkIfChannelIsStillProxy(t){let r=t;window.setTimeout((()=>{!0!==(0,e.includes)(r,window.Spyne.channels.listRegisteredChannels())&&console.warn(`Spyne Warning: The channel, ${r} does not appear to be registered!`)}),1e3)}get replaySubject(){return this.replaySub$}get subject(){return this.subject$}}const Se=n(205).map;class Te{constructor(){this.addMixins(),this.map=new Map,this.map.set("DISPATCHER",new w.Subject),this.listRegisteredChannels=Te.listRegisteredChannels.bind(this),this.getChannelsList=Te.getChannelsList.bind(this)}static getChannelsList(){return Array.from(window.Spyne.channels.map,((e,t)=>({key:e[0],val:e[1].constructor.name})))}static listRegisteredChannels(t=!1){let r=this.getChannelsList(),s=(0,e.reject)((0,e.propEq)("val","ChannelProxy")),o=(0,e.filter)((0,e.propEq)("val","ChannelProxy")),n=(!0===t?o:s)(r);return(0,e.pluck)(["key"],n)}listProxyChannels(){return this.listRegisteredChannels(!0)}checkForMissingChannels(){let t=this.getChannelsList(),r=(0,e.filter)((0,e.propEq)("val","ChannelProxy"))(t);if(r.length>=1){let t=`Spyne Warning: The following ${1===r.length?"Channel has":"Channels have"} not been initialized: ${(0,e.compose)((0,e.join)(", "),Se((0,e.prop)("key")))(r)}`;console.warn(t)}}init(){this.createMainStreams()}createObserver(e){U(e.validations,e.init),this.map.set(e.init.name,e.init.observable())}createMainStreams(){this.routeStream=new ue,this.map.set("CHANNEL_ROUTE",this.routeStream),this.uiStream=new Ee,this.map.set("CHANNEL_UI",this.uiStream),this.domStream=new ge,this.map.set("CHANNEL_WINDOW",this.domStream),this.viewStreamLifecycle=new ye,this.map.set("CHANNEL_LIFECYCLE",this.viewStreamLifecycle),this.routeStream.initializeStream(),this.domStream.initializeStream()}addKeyEvent(e){this.map.get("UI").addKeyEvent(e)}registerStream(t){let r=t.channelName;this.map.has(r)&&(0,e.compose)((0,e.pathEq)(["props","isRegistered"],!0))(this.map.get(r))?console.warn(`Spyne Warning: The Channel, ${r}, has already been registered!`):(this.map.set(r,t),t.initializeStream())}getChannelActions(e){return this.map.get(e).addRegisteredActions()}getProxySubject(e,t=!1){let r=!0===t?"replaySubject":"subject";return this.map.get(e)[r]}testStream(e){return void 0!==this.map.get(e)}getStream(e){return!1===this.testStream(e)&&this.map.set(e,new _e(e)),this.map.get(e)}addMixins(){}}class Ae{constructor(){this._packetMap=new Map,this._iter=0,this.createFilterGateway=Ae.createFilterGateway.bind(this),this.createDataPacket=Ae.createDataPacket.bind(this),this.createLabel=Ae.createLabel.bind(this)}static deepFreeze(e){try{Object.freeze(e),Object.getOwnPropertyNames(e).forEach((function(t){!e.hasOwnProperty(t)||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||Ae.deepFreeze(e[t])}))}catch(t){return e}return e}static createDataPacket(t={},r=[]){t=Ae.deepFreeze(t);const s=this.createLabel();this._packetMap.set(s,t);const o=(0,e.compose)(e.keys,(0,e.omit)(["props"]))(t),n=Ae.createTimeStamp(),i=this.createFilterGateway(t),a=r.reduce(((e={},r)=>("props"===r||(e[r]=t[r]),e)),{}),c=(0,e.ifElse)((0,e.prop)("props"),(0,e.invoker)(0,"props"),e.identity),l=()=>{const e=this._packetMap.get(s);o.forEach((t=>{p[t]=e[t]}))};let d=Object.create(null),p=(0,e.mergeAll)([{timestamp:n,label:s,props:()=>c(this._packetMap.get(s)),users:()=>this._packetMap.get(s).payload.users,isPacket:!0,packedData:()=>this._packetMap.get(s),unpack:l,filterGateway:i},a]);return p=v(p,d),p}static createAllPassFilterGateway(){}static createFilterGateway(e,t=this._packetMap){return r=>{if("function"==typeof r)try{return r(t.get(e))}catch(e){console.log("predicate not working -> ",e)}return!1}}static createUnpackedDataArr(t){return(0,e.keys)(t)}static createLabel(e=this._iter++){return`packet_num_${this._iter}`}static createTimeStamp(){return Date.now()}static createPacketUnpacker(){}}class fe{constructor(e,t="",r=!0){return this.parentContext=e,this.omittedMethods=["autoBinder","initAutoBinder","getEnhancerMethods","checkForMalformedMethods","caller","arguments","bindParentViewStream"],this.prefix=t,!0===r&&this.autoBinder(),this.allMethodsList}initAutoBinder(){this.autoBinder()}getEnhancerMethods(){return r(this,this.omittedMethods)}checkForMalformedMethods(t){if(""===this.prefix)return void console.warn(`SPYNE WARNING: The following SpyneTrait ${this.constructor.name} needs a prefix`);let r=(0,e.reject)((e=>0===e.indexOf(this.prefix)),t);if(r.length>=1){let e=`Spyne Warning: The following method(s) in ${this.constructor.name} require the prefix, "${this.prefix}": [${r.join(", ")}];`;console.warn(e)}}bindParentViewStream(t,r){this.checkForMalformedMethods(t.allMethods);let s={};const o=(e,t=!1)=>{let o=!0===t?this.constructor:this;var n;"function"==typeof o[e]&&(s[e]=r[n=e]=o[n].bind(r))},n=(0,e.curryN)(2,o)(e.__,!0);return(0,e.map)(n,t.staticMethods),(0,e.map)(o,t.methods),s}autoBinder(){let e=this.getEnhancerMethods();return this.allMethodsList=this.bindParentViewStream(e,this.parentContext),this.allMethodsList}}class Ce{constructor(e,t,r){this._mapFn=Ce.setMapFn(e),this._url=Ce.setUrl(e),this._responseType=Ce.setResponseType(e),this._serverOptions=Ce.setServerOptions(e),this._subscriber=void 0!==t?t:e=>console.log("FETCH RETURNED ",e),this.debug=void 0!==e.debug&&e.debug;let s={mapFn:this.mapFn,url:this.url,serverOptions:this.serverOptions,responseType:this.responseType,debug:this.debug};!0!==r&&Ce.startWindowFetch(s,this._subscriber)}static startWindowFetch(e,t){let{mapFn:r,url:s,serverOptions:o,responseType:n,debug:i}=e;const a=!0===i?e=>console.log("DEBUG FETCH :",e):()=>{};let c=(0,w.from)(window.fetch(s,o)).pipe((0,R.tap)(a),(0,R.flatMap)((e=>(0,w.from)(e[n]()))),(0,R.map)(r),(0,R.publish)());c.connect(),c.subscribe(t)}static setMapFn(t){return(0,e.compose)((0,e.defaultTo)((e=>e)),(0,e.prop)("mapFn"))(t)}static setUrl(t){let r=(0,e.prop)("url",t);return void 0===r&&console.warn("SPYNE WARNING: URL is undefined for data channel"),r}static setResponseType(t){return(0,e.defaultTo)("json",(0,e.prop)("responseType",t))}get mapFn(){return this._mapFn}get url(){return this._url}get serverOptions(){return this._serverOptions}get responseType(){return this._responseType}static stringifyBodyIfItExists(t){return(0,e.when)((0,e.propIs)(Object,"body"),(0,e.compose)((0,e.over)((0,e.lensProp)("body"),JSON.stringify)))(t)}static updateMethodWhenBodyExists(t){const r=(0,e.has)("body"),s=(0,e.propEq)("method","GET"),o=(0,e.allPass)([r,s]);return(0,e.when)(o,(0,e.assoc)("method","POST"))(t)}static setServerOptions(t){let r=(0,e.pick)(["header","body","mode","method"],t),s=(0,e.mergeDeepRight)(Ce.baseOptions(),r);return s=Ce.updateMethodWhenBodyExists(s),s=Ce.stringifyBodyIfItExists(s),s}static baseOptions(){return{method:"GET",headers:{Accept:"application/json, text/plain, */*"}}}}class be extends ce{constructor(e,t={}){void 0!==t.map&&(t.mapFn=t.map),t.extendedActionsArr=[`${e}_DATA_EVENT`,[`${e}_UPDATE_DATA_EVENT`,"onFetchUpdate"]],t.sendCachedPayload=!0,super(e,t)}onRegistered(){this.startFetch()}addRegisteredActions(t){let r=(0,e.compose)((0,e.defaultTo)([]),(0,e.path)(["props","extendedActionsArr"]));return["CHANNEL_DATA_EVENT",["CHANNEL_UPDATE_DATA_EVENT","onFetchUpdate"]].concat(r(this))}startFetch(e={},t=this.onFetchReturned.bind(this)){let r=this.consolidateAllFetchProps(e);return new Ce(r,t)}onFetchUpdate(e){let t=this.getPropsForFetch(e);this.startFetch(t)}onFetchReturned(e){this.createChannelPayloadItem(e)}createChannelPayloadItem(e,t=`${this.props.name}_DATA_EVENT`){this.sendChannelPayload(t,e)}getPropsForFetch(t){let r=(0,e.path)(["viewStreamInfo","payload"],t);return(0,e.pick)(["mapFn","url","header","body","mode","method","responseType","debug"],r)}consolidateAllFetchProps(t,r=this.props){let s=(0,e.pick)(["mapFn","url","header","body","mode","method","responseType","debug"],r);const o=(0,e.reject)(e.isNil);return(0,e.compose)(o,((t,r)=>(0,e.mergeDeepRight)(t,r)))(s,t)}get observer(){return this.observer$}}class ve{constructor(e={}){let{name:t,config:r,parentEl:s}=e;if(this.props=e,this.name=t||"empty",this.props.name=t,r=ve.mergeDefaultConfig(r,this.defaultConfig()),this.props.parentEl=s||ve.createParentEl(),this.props.spyneApp=ve.getSpyneApp(t,r),console.log("SPYNE APP ",{name:t},this.name,this.props.spyneApp),!1===this.props.spyneApp)return!1;this.onBeforeRegistered(),this.onRegistered(),this.onRender()}onBeforeRegistered(){this.props.pluginName=this.props.name,this.props.config=(0,e.path)(["Spyne","config","plugins",this.props.name],window)}static mergeDefaultConfig(e={},t=this.defaultConfig()){return Object.assign(t,e)}defaultConfig(){return{}}static getSpyneApp(t,r){const s=window||{};let o=(0,e.prop)("Spyne",s);return o=!0==("object"==typeof o)?o:new o,!1!==ve.updateSpyneConfig(o,t,r)&&o}static updateSpyneConfig(t,r,s){return!0===(0,e.pathSatisfies)((0,e.is)(Object),["config","plugins",r])(t)?(!0===t.config.debug&&console.warn(`Spyne Warning: The plugin, ${r}, already exists`),!1):(t.config.plugins[r]=s,t.config.plugins[r])}static createParentEl(e){return e||document.getElementById("spyne-plugins")||(()=>{const e=new I({id:"spyne-plugins"});document.body.appendChild(e.render());const t=document.getElementById("spyne-plugins");return t.style.cssText="position:absolute; top:0;left:0;width:100%;height:100%;min-height:100vh; pointer-events:none",t})()}onRegistered(){}onRender(){}}class Oe{constructor(e={}){this.channels=new Te,this.VERSION="0.16.1",this.ViewStream=ne,this.BasicView=V,this.DomEl=I,this.ViewStreamBroadcaster=j,this.ChannelsPayload=x,this.ChannelsController=Te,this.ChannelsBase=ce,this.ChannelPayloadItem=T,this._channelDataPacketGenerator=new Ae,window.Spyne=this;void 0!==e&&(e=de.conformRouteObject(e),window.Spyne.config=v({scrollLock:!1,scrollLockX:31,scrollLockY:0,debug:!1,utils:{tableRE:/^([^>]*?)(<){1}(\b)(thead|col|colgroup|tbody|td|tfoot|tr|th)(\b)([^\0]*)$/},tmp:{},plugins:{},channels:{WINDOW:{mediqQueries:{},events:[],listenForResize:!0,listenForOrientation:!0,listenForScroll:!1,listenForMouseWheel:!1,debounceMSTimeForResize:200,debounceMSTimeForScroll:150},ROUTE:{type:"slash",isHash:!1,isHidden:!1,add404s:!1,routes:{routePath:{routeName:"change"}}},CHANNEL_ROUTE:{},CHANNEL_UI:{}}},e)),this.getChannelActions=e=>window.Spyne.channels.getChannelActions(e),this.registerChannel=e=>this.channels.registerStream(e),this.registerDataChannel=e=>this.channels.registerStream(e),this.listChannels=()=>Array.from(window.Spyne.channels.map.keys());let t=new ne({id:"spyne-null-views"});t.appendToDom(document.body),t.props.el.style.cssText="display:none; opacity:0; pointer-events:none;",this.channels.init()}get createDataPacket(){return this._channelDataPacketGenerator.createDataPacket}static listChannels(){return Array.from(window.Spyne.channels.map.keys())}static getChannelActions(e){return window.Spyne.channels.getChannelActions(e)}static registerChannel(e){if(void 0!==window.Spyne)return window.Spyne.channels.registerStream(e);console.warn("Spyne has not been initialized")}}window.Spyne=Oe})(),i})()}));