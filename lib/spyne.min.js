!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("ramda"),require("rxjs/operators"),require("rxjs")):"function"==typeof define&&define.amd?define("spyne",["ramda","rxjs/operators","rxjs"],t):"object"==typeof exports?exports.spyne=t(require("ramda"),require("rxjs/operators"),require("rxjs")):e.spyne=t(e.R,e.rxjs.operators,e.rxjs)}(window,(function(e,t,r){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t,r){e.exports=r(4)},function(e,t){e.exports=o;var r=Object.create,s=function(){throw new Error("Not implemented.")},n=function(){return this};function o(){}function i(e){this.value=e}function a(e){this.value=e}i.prototype=r(o.prototype),a.prototype=r(o.prototype),o.Failure=function(e){return new i(e)},o.prototype.Failure=o.Failure,o.Success=function(e){return new a(e)},o.prototype.Success=o.Success,o.fromNullable=function(e){return null!=e?new a(e):new i(e)},o.prototype.fromNullable=o.fromNullable,o.fromEither=function(e){return e.fold(o.Failure,o.Success)},o.prototype.isFailure=!1,i.prototype.isFailure=!0,o.prototype.isSuccess=!1,a.prototype.isSuccess=!0,o.of=function(e){return new a(e)},o.prototype.of=o.of,o.prototype.ap=s,i.prototype.ap=function(e){return e.isFailure?this.Failure(this.value.concat(e.value)):this},a.prototype.ap=function(e){return e.isFailure?e:e.map(this.value)},o.prototype.map=s,i.prototype.map=n,a.prototype.map=function(e){return this.of(e(this.value))},o.prototype.toString=s,i.prototype.toString=function(){return"Validation.Failure("+this.value+")"},a.prototype.toString=function(){return"Validation.Success("+this.value+")"},o.prototype.isEqual=s,i.prototype.isEqual=function(e){return e.isFailure&&e.value===this.value},a.prototype.isEqual=function(e){return e.isSuccess&&e.value===this.value},o.prototype.get=s,i.prototype.get=function(){throw new TypeError("Can't extract the value of a Failure(a).")},a.prototype.get=function(){return this.value},o.prototype.getOrElse=s,i.prototype.getOrElse=function(e){return e},a.prototype.getOrElse=function(e){return this.value},o.prototype.orElse=s,a.prototype.orElse=n,i.prototype.orElse=function(e){return e(this.value)},o.prototype.merge=function(){return this.value},o.prototype.fold=s,i.prototype.fold=function(e,t){return e(this.value)},a.prototype.fold=function(e,t){return t(this.value)},o.prototype.cata=s,i.prototype.cata=function(e){return e.Failure(this.value)},a.prototype.cata=function(e){return e.Success(this.value)},o.prototype.swap=s,i.prototype.swap=function(){return this.Success(this.value)},a.prototype.swap=function(){return this.Failure(this.value)},o.prototype.bimap=s,i.prototype.bimap=function(e,t){return this.Failure(e(this.value))},a.prototype.bimap=function(e,t){return this.Success(t(this.value))},o.prototype.failureMap=s,a.prototype.failureMap=n,i.prototype.failureMap=function(e){return this.Failure(e(this.value))},o.prototype.leftMap=o.prototype.failureMap,a.prototype.leftMap=a.prototype.failureMap,i.prototype.leftMap=i.prototype.failureMap},function(e,t,r){"use strict";r.r(t),r.d(t,"ViewStreamElement",(function(){return H})),r.d(t,"Channel",(function(){return ne})),r.d(t,"ChannelFetch",(function(){return Te})),r.d(t,"ChannelFetchUtil",(function(){return _e})),r.d(t,"ChannelsDelegator",(function(){return Oe})),r.d(t,"ViewStreamPayload",(function(){return G})),r.d(t,"ChannelPayload",(function(){return S})),r.d(t,"ChannelPayloadFilter",(function(){return B})),r.d(t,"DomElement",(function(){return L})),r.d(t,"DomEl",(function(){return D})),r.d(t,"ViewStream",(function(){return te})),r.d(t,"ViewStreamSelector",(function(){return Z})),r.d(t,"ViewStreamBroadcaster",(function(){return q})),r.d(t,"SpyneTrait",(function(){return Ne})),r.d(t,"SpyneApp",(function(){return ge})),r.d(t,"deepMerge",(function(){return C}));var s=r(0);const n=e=>{if(void 0!==e.constructor.name)return e.constructor.name;let t=e.toString();return Object(s.defaultTo)(String(t).substr(0,12),Object(s.match)(/^(function\s)(\w+)(\(.*)$/,t)[2])},o=(e,t=[])=>{t=Object(s.concat)(["length","name","prototype","constructor"],t);let r=Object(s.compose)(Object(s.without)(t),s.uniq),n=r(Object.getOwnPropertyNames(e.constructor.prototype)),o=r((i=e.constructor,Object.getOwnPropertyNames(i)));var i;return{methods:n,staticMethods:o,allMethods:Object(s.concat)(n,o)}},i=r(2),a=r(2);let c=()=>({includes:()=>void 0!==window.Spyne?(e=>{let t=[];return Object(s.forEach)((e,r,s)=>t.push(r),e),t})(window.Spyne.channels.map):["CHANNEL_ROUTE","CHANNEL_UI","CHANNEL_WINDOW","DISPATCHER"]}),l=["LOAD","RENDER","MOUNT","UNMOUNT","DISPOSE","GARBAGE_COLLECT","UPDATE"],d=["parent","self","child","children","view"],h=["Observable","BehaviorSubject","Subject","Observer","Subscriber","FromEventObservable"],p=["subscribe","combineLatest"],u=[],E=[],m=[],b=[],O=[],N=[],_=[],T=[],g=[];if(void 0!==s.compose&&void 0!==i){u=[{error:`need to match a valid name within ${h}`,predicate:e=>c().includes(e.name)},{error:"param 'observable' must contain a valid Observable",predicate:e=>void 0!==e.observable.subscribe},{error:"param action must be a registered action",predicate:e=>p.includes(e.action)}],E=[{error:"needs vsid number in srcElement",predicate:Object(s.compose)(Object(s.is)(String),Object(s.path)(["data","srcElement","vsid"]))},{error:"needs a id in srcElement",predicate:Object(s.compose)(Object(s.is)(String),Object(s.path)(["data","srcElement","id"]))}],m=function(){return[].concat(u).concat(E)};let e=[{error:`need to match a valid name within ${h}`,predicate:e=>c().includes(e.name)},{error:`needs one of the following step strings: ${l}`,predicate:e=>l.includes(e.STEP)},{error:`type needs to one of the following: ${d}`,predicate:e=>d.includes(e.type)},{error:"viewId needs to be added ",predicate:e=>void 0!==e.viewId}];O=function(){return[].concat(e)},N=function(){return[{error:"DISPOSE STEP requires a disposeItem param in the data object",predicate:e=>"DISPOSE"===e.STEP&&void 0!==e.data.disposeItems}].concat(e)},_=function(){return[{error:"UPDATE STEP requires a data object ",predicate:e=>"UPDATE"===e.STEP&&void 0!==e.data}].concat(e)},b=function(){return e.concat(u).concat(E)},T=function(){return[].concat(u).concat(E)},g=function(){let e=[{error:"param 'name' must be of a registered type",predicate:e=>c().includes(e.name)},{error:"param 'observable' must contain a valid Observable",predicate:e=>h.includes((0,e.observable)().constructor.name)},{error:"param action must be a registered action",predicate:e=>p.includes(e.action)}];return{streams:[{init:{name:"DISPATCHER",observable:()=>new a,action:"subscribe"},structure:{type:String,observable:i||a,action:String},validations:e},{init:{name:"UBU",observable:()=>new a,action:"subscribe"},structure:{type:String,observable:i||a,action:String},validations:e}]}}}class S{constructor(e,t,r,n,o){let i=e,a={channelName:e,action:t,payload:r,srcElement:n,event:o};if(Object.defineProperty(a,"payload",{get:()=>Object(s.clone)(r)}),!0===Object(s.pathEq)(["Spyne","config","debug"],!0)(window)&&r.hasOwnProperty("payload")){let e=JSON.stringify(r);console.warn(`Spyne Warning: the following payload contains a nested payload property which may create conflicts: Action: ${t}, ${e}`)}a.props=()=>Object(s.mergeAll)([{payload:a.payload},a.payload,{channel:i},{event:o},a.srcElement,{action:a.action}]);const c=window.Spyne.getChannelActions(i);return S.validateAction(t,i,c),"CHANNEL_ROUTE"===i&&(a.location=S.getLocationData()),a}static validateAction(e,t,r){let n=Object(s.includes)(e,r);return!1===n&&void 0!==window.Spyne&&console.warn(`warning: Action: '${e}' is not registered within the ${t} channel!`),n}static getLocationData(){return Object(s.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getStreamItem(){}static getMouseEventKeys(){return["altKey","bubbles","cancelBubble","cancelable","clientX","clientY","composed","ctrlKey","currentTarget","defaultPrevented","detail","eventPhase","fromElement","isTrusted","layerX","layerY","metaKey","movementX","movementY","offsetX","offsetY","pageX","pageY","path","relatedTarget","returnValue","screenX","screenY","shiftKey","sourceCapabilities","srcElement","target","timeStamp","toElement","type","view","which","x","y"]}}function j(){return{createpropsMap:function(){let e=new WeakMap,t={vsid:this.props.vsid};return e.set(t,this.props),{key:t,weakMap:e}},gc:function(){for(let e in this)delete this[e]},createId:function(){return Math.random().toString(36).replace(/\d/gm,"").substring(1,8)},setTraceFunc:function(e){return!0===e?console.log:()=>{}}}}function f(e){return e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function y(e,t){return t&&!0===t.clone&&f(e)?C((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function A(e,t,r){let s=e.slice();return t.forEach((function(t,n){void 0===s[n]?s[n]=y(t,r):f(t)?s[n]=C(e[n],t,r):-1===e.indexOf(t)&&s.push(y(t,r))})),s}function C(e,t,r){let s=Array.isArray(t),n=(r||{arrayMerge:A}).arrayMerge||A;return s?Array.isArray(e)?n(e,t,r):y(t,r):function(e,t,r){let s={};return f(e)&&Object.keys(e).forEach((function(t){s[t]=y(e[t],r)})),Object.keys(t).forEach((function(n){f(t[n])&&e[n]?s[n]=C(e[n],t[n],r):s[n]=y(t[n],r)})),s}(e,t,r)}function v(e){return(window.Spyne.config.utils.tableRE||function(){const e=/^([^>]*?)(<){1}(\b)(thead|col|colgroup|tbody|td|tfoot|tr|th)(\b)([^\0]*)$/,t=["Spyne","config","utils","tableRE"];return window&&Object(s.assocPath)(t,e,window),e}()).test(e)}C.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce((function(e,r){return C(e,r,t)}))};class I{constructor(e,t){this.template=this.formatTemplate(e);(()=>{!0===Object(s.is)(Array,t)&&(t={spyneData:t},this.template=this.template.replace("{{/}}","{{/spyneData}}"),this.template=this.template.replace("{{#}}","{{#spyneData}}"))})(),this.templateData=t;let r=I.getStringArray(this.template),n=this.template.match(I.findTmplLoopsRE());n=null===n?[]:n;const o=Object(s.includes)(s.__,n),i=Object(s.ifElse)(o,(e,t)=>e.replace(I.parseTmplLoopsRE(),this.parseTheTmplLoop.bind(this)),this.addParams.bind(this));this.finalArr=r.map(i)}static getStringArray(e){let t=e.split(I.findTmplLoopsRE());const r=/^([\\n\s\W]+)$/;return Object(s.reject)(e=>e.match(r),t)}static findTmplLoopsRE(){return/({{#\w+}}[\w\n\s\W]+?{{\/\w+}})/gm}static parseTmplLoopsRE(){return/({{#(\w+)}})([\w\n\s\W]+?)({{\/\2}})/gm}static swapParamsForTagsRE(){return/({{)(.*?)(}})/gm}removeThis(){this.finalArr=void 0,this.templateData=void 0,this.template=void 0}renderDocFrag2(){const e=this.finalArr.join(""),t=document.createRange().createContextualFragment(e);return window.setTimeout(this.removeThis.bind(this),5),t}renderDocFragT(){const e=this.finalArr.join(""),t=document.createElement("template");t.innerHTML=e;const r=t.content;return window.setTimeout(this.removeThis(),10),r}renderDocFragHTML(){const e=this.finalArr.join("");return window.setTimeout(this.removeThis(),10),e}renderDocFrag(){const e=this.finalArr.join(""),t=/^([^>]*?)(<){1}(\b)(thead|col|colgroup|tbody|td|tfoot|tr|th)(\b)([^\0]*)$/.test(e)?e:document.createRange().createContextualFragment(e);return window.setTimeout(this.removeThis(),10),t}renderDocFrag4(){const e=this.finalArr.join(""),t=v(e)?e:document.createRange().createContextualFragment(e);return window.setTimeout(this.removeThis(),10),t}renderDocFrag5(e=!1){const t=this.finalArr.join(""),r=!!e&&v(t),s=document.createRange().createContextualFragment(t);return window.setTimeout(this.removeThis(),10),r?t:s}getTemplateString(){return this.finalArr.join("")}formatTemplate(e){return"SCRIPT"===Object(s.prop)("nodeName",e)?e.innerHTML:e}addParams(e){return e.replace(I.swapParamsForTagsRE(),(e,t,r,n)=>{let o=Object(s.compose)(Object(s.path)(s.__,this.templateData),Object(s.split)("."))(r);return Object(s.defaultTo)("")(o)})}parseTheTmplLoop(e,t,r,n){const o=n;let i=this.templateData[r];return!0===Object(s.isNil)(i)||Object(s.isEmpty)(i)?"":(void 0===i.length&&(i=[i]),i.map(e=>e="string"==typeof e?((e,t)=>t.replace(I.swapParamsForTagsRE(),e))(e,o):((e,t)=>t.replace(I.swapParamsForTagsRE(),(t,r,n)=>Object(s.compose)(Object(s.path)(s.__,e),Object(s.split)("."))(n)))(e,o)).join(""))}}class L{constructor(e={}){var t,r;e.tagName=(t="div",r=e.tagName,Object(s.defaultTo)(t)(r)),e.attributes=void 0!==e.attributes?e.attributes:this.getDomAttributes(e),e.attrs=this.updateAttrs(e.attributes),e.fragment=document.createDocumentFragment(),this.props=e,this.addMixins()}setProp(e,t){this.props[e]=t}getProp(e){return this.props[e]}get el(){return this.props.el}setElAttrs(e,t){return this.getProp("attrs").forEach((t,r)=>{let n=(t,r)=>{e.dataset[r]=t};"dataset"===r?Object(s.forEachObjIndexed)(n,t):e.setAttribute(r,t)}),e}updateAttrs(e,t){let r=void 0!==t?t:new Map;return Object(s.mapObjIndexed)((e,t)=>r.set(t,e),e),r}addTemplate(e){let t=this.getProp("template");return void 0!==t?(t=>{let r=this.getProp("data");r=Object(s.is)(Object,r)?r:{};let n=new I(t,r).renderDocFrag();return Object(s.is)(String,n)?e.innerHTML=n:e.appendChild(n),e})(t):e}createElement(e="div"){return document.createElement(e)}addContent(e){let t=this.getProp("data");if(!0===Object(s.is)(String,t)){let r=document.createTextNode(t);e.appendChild(r)}return e}execute(){let e=Object(s.pipe)(this.createElement.bind(this),this.setElAttrs.bind(this),this.addTemplate.bind(this),this.addContent.bind(this))(this.getProp("tagName"));this.props.el=e}render(){return this.execute(),this.props.template=void 0,this.props.data=void 0,this.props.attributes=void 0,this.getProp("el")}returnIfDefined(e,t){if(void 0!==t){let r=void 0===t;e[t]=!1===r?t:C(e[t],t)}}updateprops(e){return this.returnIfDefined(this.props,e),this}updatepropsAndRun(e){return this.updateprops(e),this.execute(),this.getProp("fragment")}unmount(){void 0!==this.props&&(this.getProp("el").remove(),this.props=void 0,this.gc())}updateTag(e="div"){this.updateprops(e)}updateAttributes(e={}){this.updateprops(e)}updateTemplate(e){this.updateprops(e)}updateData(e={}){this.updateprops(e)}addTagAndRender(e="div"){this.updatepropsAndRun(e)}addAttrsibutesAndRender(e={}){this.updatepropsAndRun(e)}addTemplateAndRender(e){this.updatepropsAndRun(e)}addDataAndRender(e={}){this.updatepropsAndRun(e)}addMixins(){let e=j();this.gc=e.gc.bind(this)}getDomAttributes(e){return Object(s.pick)(this.attributesArray,e)}get attributesArray(){return["accept","accept-charset","accesskey","action","align","allow","alt","async","autocapitalize","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","dataset","datetime","decoding","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","importance","integrity","ismap","itemprop","keytype","kind","label","lang","language","lazyload","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","referrerpolicy","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","value","width","wrap"]}}const D=L;let w=(e=!1,t=1,r="ease",s=!1)=>`${!0===s?"opacity:0;":""}transition: opacity ${t}s ${r}; opacity: ${!0===e?1:0};`;var R=r(2),P=r(1);class V{constructor(e){this.props.observableStreams=V.createDirectionalObservables()}static createDirectionalFiltersObject(){return{P:["parent"],C:["child"],PCI:["parent","internal","child"],CI:["child","internal"],PI:["parent","internal"],PC:["parent","child"]}}static addDefaultDir(e){return Object(s.flip)(s.mergeRight)({$dir:["internal"]},Object(s.clone)(e))}static addDownInternalDir(e,t=["internal","down"]){return Object(s.flip)(s.mergeRight)(Object(s.clone)(e),{$dir:t})}static addChildAndInternalDir(e,t=["child","down"]){return Object(s.flip)(s.mergeRight)(Object(s.clone)(e),{$dir:t})}static mapToDefaultDir(e){return this.addDefaultDir(e)}static createDirectionalObservables(e=new R.Subject,t,r){void 0!==t&&void 0!==r&&(e.viewName=t,e.vsid=r);const n=e=>Object(s.propSatisfies)(t=>t.includes(e),"$dir"),o=n("parent"),i=n("child"),a=n("internal"),c=e=>Object(s.mergeRight)({from$:e}),l=c("child"),d=c("internal"),h=c("parent"),p=e.pipe(Object(P.filter)(e=>void 0!==e&&void 0!==e.action)),u=e.pipe(Object(P.filter)(a),Object(P.map)(d)),E=e.pipe(Object(P.filter)(o),Object(P.map)(l)),m=e.pipe(Object(P.filter)(i),Object(P.map)(h)),b={parent:E,internal:u,child:m};return{raw$:p,toInternal$:u,toParent$:E,toChild$:m,completeAll:()=>{Object(s.forEach)(e=>{e.complete(),e.isStopped=!0},[p,u,E,m])},completeStream:(e=[])=>{const t=e=>{if(void 0!==b[e]){(t=b[e]).complete(),t.isStopped=!0}var t};void 0!==e&&e.length>=1&&e.forEach(t)}}}}class H{constructor(e,t={},r="",s="theName"){this.addMixins(),this._state="INIT",this.vsid=r,this.vsName=s,this.defaults={debug:!1,extendedHashMethods:{}},this.options=C(this.defaults,t);this.addActionListeners().forEach(e=>{let[t,r]=e;this.options.extendedHashMethods[t]=e=>this[r](e)}),this.options.hashMethods=this.setHashMethods(this.options.extendedHashMethods),this.sink$=e,this.sink$.subscribe(this.onObsSinkSubscribe.bind(this)),this.$dirs=V.createDirectionalFiltersObject(),this.addDefaultDir=V.addDefaultDir,this.sourceStreams=V.createDirectionalObservables(new R.Subject,this.vsName,this.vsid),this._source$=this.sourceStreams.toInternal$}addActionListeners(){return[]}setHashMethods(e={}){return C({VS_DETRITUS_COLLECT:e=>this.onGarbageCollect(e),READY_FOR_VS_DETRITUS_COLLECT:e=>this.onReadyForGC(e),EXTIRPATE:e=>this.onDispose(e),VS_SPAWN:e=>this.onRender(e),VS_SPAWN_AND_ATTACH_TO_PARENT:e=>this.onRenderAndAttachToParent(e),VS_SPAWN_AND_ATTACH_TO_DOM:e=>this.onRenderAndAttachToDom(e),ATTACH_CHILD_TO_SELF:e=>this.onAttachChildToSelf(e)},e)}createDomItem(){this.props=void 0!==this.props?this.props:{};let e=Object(s.filter)(e=>void 0!==e,Object(s.pick)(["id","className"],this.props)),{tagName:t,data:r,template:n}=this.props;return new L(t,e,r,n)}onDisposeCompleted(e){}animateInTween(e,t){!function(e,t){let r=1*window.getComputedStyle(e).opacity,s=w(!0,t,"ease",1===r);e.style.cssText+=s}(e,t)}animateOutTween(e,t,r){!function(e,t,r){let s=w(!1,t,"ease");e.style.cssText+=s,e.addEventListener("transitionend",r,!1)}(e,t,r)}setAnimateIn(e){if(!0===e.animateIn){let t=void 0!==e.el?e.el:this.domItem.el;this.animateInTween(t,e.animateInTime)}}disposeMethod(e){let t=void 0!==e.el.el?e.el.el:e.el;const r={action:"READY_FOR_VS_DETRITUS_COLLECT",$dir:this.$dirs.PI,el:t};let s=Object(R.bindCallback)((e,r)=>{this.animateOutTween(t,e.animateOutTime,r)}),n=e=>{this._source$.next(r)};return(!0===e.animateOut?e=>(s(e).subscribe(n),{action:"EXTIRPATING",$dir:this.$dirs.CI}):()=>({action:"EXTIRPATE_AND_READY_FOR_VS_DETRITUS_COLLECT",$dir:this.$dirs.CI}))(e)}onDispose(e){return this.disposeMethod(e)}removeStream(){void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["internal","child"])}onReadyForGC(e){this.removeStream()}onGarbageCollect(e){void 0!==this.domItem&&this.domItem.unmount(),void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["parent"])}getSourceStream(){return this._source$}combineDomItems(e){let t=Object(s.isNil)(e.query)?e.node:e.query;("appendChild"===e.attachType?(e,t)=>e.appendChild(t):(e,t)=>e.insertBefore(t,e.firstChild))(t,this.domItem.render()),this.setAnimateIn(e)}onAttachChildToSelf(e){let t=e.childRenderData;return this.combineDomItems(t),{action:"CHILD_ATTACHED",$dir:this.$dirs.PI}}onRenderAndAttachToParent(e){return this.onRender(e),this.combineDomItems(e),{action:"VS_SPAWNED_AND_ATTACHED_TO_PARENT",el:this.domItem.el,$dir:this.$dirs.PI}}renderDomItem(e){let t,r,s,n;return[t,r,s,n]=e,this.domItem=new L({tagName:t,attributes:r,data:s,template:n}),this.domItem}onRender(e){return{action:"VS_SPAWNED",el:(e=>this.renderDomItem(e))(Object(s.props)(["tagName","domAttributes","data","template"],e)),$dir:this.$dirs.I}}extendedMethods(e){}onRenderAndAttachToDom(e){return e.attachData.el=(e=>this.renderDomItem(e))(Object(s.props)(["tagName","domAttributes","data","template"],e)),this.combineDomItems(e.attachData),{action:"VS_SPAWNED_AND_ATTACHED_TO_DOM",el:e.attachData.el.el,$dir:this.$dirs.CI}}onObsSinkSubscribe(e){let t=e.action,r=Object(s.defaultTo)(e=>this.extendedMethods(e))(this.options.hashMethods[t])(e);void 0!==r&&(e=>{this._source$.next(e)})(Object.freeze(r))}addMixins(){}}class M{constructor(e,t){this.context=e,this.enhancersMap=new Map,this.enhancersArr=t,this.initMap(),this.addAllEnhancerMethods()}initMap(){this.enhancersMap.set("ALL",[]);let e=o(this.context).allMethods;this.updateMap("LOCAL",e)}getEnhancersMap(){return this.enhancersMap}updateMap(e,t){let r=Object(s.concat)(this.enhancersMap.get("ALL"),t);this.enhancersMap.set(e,t),this.enhancersMap.set("ALL",r)}getMethodsArr(e){return this.enhancersMap.get(e)}createEnhancerMethodsObj(e){const t=e=>console.error(`Spyne Error: The following enhancer method, "${e}", already exists and cannot be added to the ${r.name} Enhancer!`);let r=new e(this.context);let n=r.getEnhancerMethods(),o=(e=>{let r=Object(s.includes)(s.__,this.getMethodsArr("ALL")),n=Object(s.filter)(r,e);return n.forEach(t),n})(n.allMethods),i=Object(s.dropWhile)(Object(s.includes)(s.__,o));return n=Object(s.map)(i,n),this.updateMap(r.name,n.allMethods),n.enhancer=r,n.name=r.name,n}addAllEnhancerMethods(){Object(s.forEach)(e=>{let t=this.createEnhancerMethodsObj(e);t.enhancer.bindParentViewStream(t,this.context)},this.enhancersArr)}}var W=r(3),F=r.n(W);const U=F.a.Success,$=F.a.Failure;let x=()=>{};function k(){setTimeout(()=>{Object(s.forEach)(e=>{},this)},1)}void 0!==s.curry&&(x=Object(s.curry)((e,t)=>{const r=U(Object(s.curryN)(Object(s.length)(e),Object(s.always)(t)));return Object(s.reduce)((e,r)=>e.ap(r.predicate(t)?U(t):$([r.error])),r,e)}));class G{constructor(e,t,r,s="subscribe",n=!1){this.addMixins(),this.options={name:e,observable:t,data:r,action:s},this.getValidationChecks(e)}getValidationChecks(e){let t=e=>this.onRunValidations(e);return!0===window.Spyne.channels.map.has(e)?t(m):(r="payload Needs a Valid Stream Name!",console.warn(r));var r}onRunValidations(e){x(e(),this.options).fold(this.onError.bind(this),this.onSuccess.bind(this))}onPayloadValidated(e){this.sendToDirectorStream(e)}sendToDirectorStream(e){window.Spyne.channels.getStream("DISPATCHER").next(e),this.gc()}onError(e){console.warn("payload failed due to:\n"+e.map(e=>"* "+e).join("\n")),this.gc()}onSuccess(e){this.onPayloadValidated(e)}addMixins(){this.gc=k}}class q{constructor(e,t){this.addMixins(),this.props=e,this.broadcastFn=t,this.broadcaster(this.broadcastFn)}addDblClickEvt(e){return Object(R.fromEvent)(e,"dblclick").pipe(Object(P.map)(e=>{let t=Object(s.clone)(e);return t.typeOverRide="dblclick",t}))}broadcast(e){let t,r={UI:this.sendUIPayload,ROUTE:this.sendRoutePayload},[n,o,i]=e,a=this.props.el.querySelectorAll(n);if(a.length<=0){let e=this.props.el;const t=t=>{t===e&&(a=[t])};(()=>{let r=(null!==e.parentElement?e.parentElement:document).querySelectorAll(n);r.forEach=Array.prototype.forEach,r.forEach(t)})()}let c=void 0!==i,l=e=>{let n="dblClick"!==o?Object(R.fromEvent)(e,o,{preventDefault:()=>!0}):this.addDblClickEvt(e);t=e.dataset.channel;let i={};i.payload=(e=>{let t={};for(let r in e)t[r]=e[r];return t})(e.dataset),i.payload=Object(s.omit)(["channel"],i.payload),i.channel=t,i.srcElement={},i.srcElement.id=this.props.id,i.srcElement.vsid=this.props.vsid,i.srcElement.isLocalEvent=c,i.srcElement.srcEvent=o,i.srcElement.el=e,(void 0!==t?r[t]:r.UI)(n,i)},d=!0===Object(s.path)(["Spyne","config","debug"],window);!0===(void 0===a||a.length<=0)&&!0===d?console.warn(`Spyne Warning: The item ${n}, does not appear to exist!`):(a.forEach=Array.prototype.forEach,a.forEach(l))}broadcaster(e){e().forEach(e=>this.broadcast(e))}addMixins(){let e={testFunc:function(e){console.log("stream mixin is ",e)},sendRoutePayload:function(e,t){return new G("CHANNEL_ROUTE",e,t,"subscribe")},sendUIPayload:function(e,t){return new G("CHANNEL_UI",e,t,"subscribe")}};this.sendUIPayload=e.sendUIPayload,this.sendRoutePayload=e.sendRoutePayload}}const Y=r(0).map;class B{constructor(e={}){void 0!==e.props&&(e.propFilters=Object(s.prop)("props",e));let{selector:t,propFilters:r,label:n}=e;const o=Object(s.compose)(s.not,s.isEmpty),i=Object(s.allPass)([Object(s.is)(String),o]),a=Object(s.allPass)([Object(s.is)(Array),o]),c=i(t)?B.filterSelector([t]):void 0,l=a(t)?B.filterSelector(t):void 0,d=Object(s.is)(Object,r)?B.filterData(r,n):void 0;let h=Object(s.reject)(s.isNil,[c,l,d]);return Object(s.isEmpty)(h)&&(h=[Object(s.always)(!1)],!0===Object(s.path)(["Spyne","config","debug"],window)&&console.warn(`Spyne Warning: The Channel Filter, with selector: ${t}, and propFilters:${r} appears to be empty!`)),Object(s.allPass)(h)}static filterData(e,t){const r=t;return(()=>{if(Object(s.isEmpty)(e))return Object(s.always)(!1);e=Y((e,t,r)=>{return!0===Object(s.is)(String,e)?(n=e,e=>e===n):e;var n},e);let t=Object(s.where)(e);const n=Object(s.ifElse)(Object(s.prop)("props"),Object(s.invoker)(0,"props"),s.identity);return Object(s.compose)(t,t=>{if(void 0===r)return t;const n={};return Object(s.forEachObjIndexed)((e,r)=>n[r]=e(Object(s.prop)(r,t)),e),console.log(`%c CHANNEL PAYLOAD FILTER DEBUGGER '${r}': `,"color:orange;",{propsBooleans:n,comparedObj:t}),t},Object(s.defaultTo)({}),n)})()}static checkPayloadSelector(e,t){t=!0===Object(s.compose)(Object(s.equals)("Function"),s.type,Object(s.prop)("props"))(t)?t.props():t;let r=Object(s.path)(["el"],t);const n=e=>e.isEqualNode(r);if("object"!=typeof r)return!1;let o=Object(s.compose)(s.flatten,Y(e=>{let t=Object(s.flatten)(document.querySelectorAll(e));return Y(n,t)}))(e);return!0!==Object(s.isEmpty)(o)&&Object(s.any)(Object(s.equals)(!0),o)}static filterSelector(e){let t=Object(s.reject)(s.isEmpty,e);return Object(s.curry)(B.checkPayloadSelector)(t)}}function z(){return!0===Object(s.path)(["Spyne","config","debug"],window)}function K(e,t,r=!1){let n=X(e,t,r);return 1===n.length?Object(s.head)(n):n}function Q(e,t,r){let n=document.querySelector(e);if(!1!==Object(s.compose)(Object(s.lte)(0),Object(s.defaultTo)(-1),Object(s.prop)("nodeType"))(n)){if(void 0!==t){null===n.querySelector(t)&&!0===z()&&!0===r&&console.warn(`Spyne Warning: the selector, ${t} does not exist in this el, ${e}`)}}else console.warn(`Spyne Warning: the el object is not a valid single element, ${n}`)}function X(e,t,r=!1){let s=void 0!==t?`${e} ${t}`:e;return!0===r&&Q(e,t,r),(e=>{try{document.querySelectorAll(e)}catch(e){return[]}return document.querySelectorAll(e)})(s)}function J(e,t,r){return X(t,r).forEach(t=>{t.style.cssText=e}),this}function Z(e,t){function r(t){return Z(e,t)}return Q(e="string"==typeof e?e:function(e){let t=`${Math.random().toString(36).replace(/\d/gm,"").substring(1,8)}`;return void 0===e.dataset.vsid?e.dataset.vsid=t:t=e.dataset.vsid,`[data-vsid='${t}']`}(e),t,!1),r.map=r=>Array.from(X(e,t)).map(r),r.forEach=r=>Array.from(X(e,t)).map(r),r.getNodeListArray=()=>X(e,t),r.addClass=r=>(X(e,t).forEach(e=>e.classList.add(r)),this),r.removeClass=r=>(X(e,t).forEach(e=>{e.classList.remove(r)}),this),r.setClass=r=>(X(e,t).forEach(e=>{let t=Object(s.compose)(Object(s.reject)(s.isEmpty),Object(s.split)(" "))(e.className),n=r.split(" ");t.forEach(t=>e.classList.remove(t)),n.forEach(t=>e.classList.add(t))}),this),r.unmount=()=>{},r.toggleClass=(r,s)=>(X(e,t).forEach(e=>{(s=void 0!==s?s:!e.classList.contains(r))?e.classList.add(r):e.classList.remove(r)}),this),r.toggle=(e,t)=>(r.toggleClass(e,t),this),r.appendChild=e=>(0!==r.el.length?r.el.appendChild(e):console.warn(`Spyne Warning: The selector, ${t} does not appear to be valid!`),r.el),r.addAnimClass=r=>{window.setTimeout(()=>{X(e,t).forEach(e=>e.classList.add(r))},1)},r.setActiveItem=(r,n)=>{let o=X(e,t),i="string"==typeof n?K(e,n):n;const a=e=>e.isEqualNode(i)?e.classList.add(r):e.classList.remove(r);var c;return!0===(c=i,Object(s.compose)(Object(s.lte)(0),Object(s.defaultTo)(-1),Object(s.prop)("nodeType"))(c))?o.forEach(a):!0===z()&&console.warn(`Spyne Warning: The selector, ${n}, does not appear to be a valid item in setActiveItem: ${r}`),this},Object.defineProperty(r,"el",{get:()=>K(e,t,!0)}),Object.defineProperty(r,"els",{get:()=>X(e,t)}),Object.defineProperty(r,"len",{get:()=>X(e,t,!1).length}),Object.defineProperty(r,"exists",{get:()=>X(e,t,!1).length>=1}),Object.defineProperty(r,"exist",{get:()=>X(e,t,!1).length>=1}),Object.defineProperty(r,"nodeList",{get:()=>X(e,t)}),Object.defineProperty(r,"arr",{get:()=>{let r=K(e,t,!0);return void 0===r?[]:void 0===r.length?[r]:Array.from(r)}}),Object.defineProperty(r,"inline",{set:r=>J(r,e,t)}),Object.defineProperty(r,"inlineCss",{set:r=>J(r,e,t)}),r}const ee=r(0).map;class te{constructor(e={}){this.vsnum=Math.random(),this.addMixins(),this.defaults=()=>{const t=this.createId(),r=e.id?e.id:t;return{vsid:t,id:r,tagName:"div",el:void 0,data:void 0,animateIn:!1,animateInTime:.5,animateOut:!1,animateOutTime:.5,sendLifecyleEvents:!1,hashId:`#${r}`,id$:`#${r}`,viewClass:H,extendedSourcesHashMethods:{},debug:!1,template:void 0,node:document.createDocumentFragment(),name:n(this)}},this._state={},this.$dirs=V.createDirectionalFiltersObject(),this.addDefaultDirection=V.addDefaultDir,this.addDownInternalDir=V.addDownInternalDir,this.props=C(this.defaults(),e),this.sendLifecycleMethod=!0===this.props.sendLifecyleEvents?this.sendLifecycleMethodActive.bind(this):this.sendLifecycleMethodInactive.bind(this);let t=this.attributesArray;this.props.domAttributes=Object(s.pick)(t,this.props),void 0!==this.props.traits&&this.addTraits(this.props.traits),this.loadEnhancers(),this.loadAllMethods(),this.props.action="LOADED",this.sink$=new R.Subject;const r=this.props.viewClass;this.view=new r(this.sink$,{},this.props.vsid,this.props.id),this.sourceStreams=this.view.sourceStreams,this._rawSource$=this.view.getSourceStream(),this._rawSource$.viewName=this.props.name,this.sendEventsDownStream=this.sendEventsDownStreamFn,this.initViewStream(),this.isDevMode=te.isDevMode(),this.props.addedChannels=[],this.checkIfElementAlreadyExists()}updatePropsToMatchEl(){const e=Object(s.compose)(s.toLower,Object(s.either)(Object(s.prop)("tagName"),Object(s.always)("")));this.props.tagName=e(this.props.el)}checkIfElementAlreadyExists(){const e=Object(s.compose)(Object(s.lte)(0),Object(s.defaultTo)(-1),Object(s.prop)("nodeType"));Object(s.propSatisfies)(Object(s.allPass)([e=>document.body.contains(e),e]),"el")(this.props)&&(this.updatePropsToMatchEl(),this.postRender())}loadEnhancers(e=[]){let t=new M(this,e);this.props.enhancersMap=t.getEnhancersMap(),t=void 0}loadAllMethods(){const e=Object(s.curry)(this.onChannelMethodCall.bind(this));this.addActionListeners().forEach(t=>{let[r,n,o]=t;Object(s.is)(String,o)&&(o=new B({selector:o})),this.props.extendedSourcesHashMethods[r]=e(n,o)}),this.props.hashSourceMethods=this.setSourceHashMethods(this.props.extendedSourcesHashMethods)}addActionListeners(){return[]}onChannelMethodCall(e,t,r){const n=t=>{void 0===this[e]?console.warn(`Spyne Warning: The method, ${e} does not appear to exist in ${this.constructor.name}!`):this[e](t)};if(void 0!==r.$dir&&r.$dir.includes("child")&&!0!==this.deleted){let e=C({},r);e.$dir=this.$dirs.C,this.sourceStreams.raw$.next(e)}!0===Object(s.defaultTo)(Object(s.always)(!0),t)(r.props())&&n(r=Object(s.omit)(["$dir"],r))}setSourceHashMethods(e={}){let t={EXTIRPATING:e=>this.checkParentDispose(e),EXTIRPATE:e=>this.disposeViewStream(e),VS_SPAWNED:e=>this.onVSRendered(e),VS_SPAWNED_AND_ATTACHED_TO_DOM:e=>this.onVSRendered(e),VS_SPAWNED_AND_ATTACHED_TO_PARENT:e=>this.onVSRendered(e),READY_FOR_VS_DETRITUS_COLLECT:e=>this.onReadyToGC(e),VS_NULLITY:()=>({})};return C.all([{},t,e])}initViewStream(){this._source$=this._rawSource$.pipe(Object(P.map)(e=>this.onMapViewSource(e)),Object(P.takeWhile)(this.notGCSTATE)),this.initAutoMergeSourceStreams(),this.updateSourceSubscription(this._source$,!0)}notGCSTATE(e){return!e.action.includes("READY_FOR_VS_DETRITUS_COLLECT")}eqGCSTATE(e){return!e.action.includes("READY_FOR_VS_DETRITUS_COLLECT")}notCOMPLETED(e){return!e.action.includes("COMPLETED")}notGCCOMPLETE(e){return!e.action.includes("GC_COMPLETE")}testVal(e){console.log("TESTING VALL IS ",e)}addParentStream(e,t){this.parent$=e.pipe(Object(P.filter)(e=>void 0!==e&&void 0!==e.action),Object(P.map)(e=>{let t=C({},e);return"EXTIRPATE_AND_READY_FOR_VS_DETRITUS_COLLECT"===t.action&&(this.disposeViewStream(t),t.action="READY_FOR_VS_DETRITUS_COLLECT"),t})),this.updateSourceSubscription(this.parent$,!1,"PARENT"),this.renderAndAttachToParent(t)}addChildStream(e){let t=e.pipe(Object(P.filter)(e=>void 0!==e&&void 0!==e.action),Object(P.tap)(e=>this.tracer("addChildStraem do ",e)),Object(P.map)(e=>e),Object(P.finalize)(e=>this.onChildCompleted(t.source)));this.updateSourceSubscription(t,!0,"CHILD")}onChildDisposed(e){}onChildCompleted(e){let t=(e=>{let t=e=>{for(;void 0!==e.destination;)e=t(e.destination);return e};return Object(s.pick)(["id","vsid"],t(e))})(e);return this.tracer("onChildCompleted ",this.vsnum,e),this.onChildDisposed(t,e),t}initAutoMergeSourceStreams(){let e={next:this.onSubscribeToSourcesNext.bind(this),error:this.onSubscribeToSourcesError.bind(this),complete:this.onSubscribeToSourcesComplete.bind(this)},t=()=>{this.props.el$=void 0,this.uberSource$.complete(),this.autoSubscriber$.complete(),this.sink$.complete(),this.props=void 0,this.deleted=!0,this.tracer("completeAll",this.deleted,this.props)},r=()=>{s-=1,0===s&&t()},s=0;this.uberSource$=new R.Subject;this.autoMergeSubject$=this.uberSource$.pipe(Object(P.mergeMap)(e=>{let t=e.observable.pipe(Object(P.filter)(e=>void 0!==e&&void 0!==e.action),Object(P.map)(e=>{let t=C({},e);return t.action=e.action,this.tracer("autoMergeSubject$",t),t}));return!1===e.autoClosesBool?t:(s+=1,t.pipe(Object(P.finalize)(r)))})),this.autoSubscriber$=this.autoMergeSubject$.pipe(Object(P.filter)(e=>void 0!==e&&void 0!==e.action)).subscribe(e)}updateSourceSubscription(e,t=!1,r){let s={observable:e,autoClosesBool:t,rel:r};this.tracer("updateSourceSubscription ",this.vsnum,s),this.uberSource$.next(s)}onSubscribeToSourcesNext(e={}){let t=Object(s.defaultTo)(e=>this.sendExtendedStreams(e));const r=((e,t)=>{if(void 0!==e[t])return t;return Object(s.compose)(s.head,Object(s.filter)(Object(s.compose)(Object(s.test)(s.__,t),e=>new RegExp(e))))(Object(s.keys)(e))})(this.props.hashSourceMethods,e.action);t(this.props.hashSourceMethods[r])(e),this.tracer("onSubscribeToSourcesNext",{payload:e})}onSubscribeToSourcesError(e=""){console.log("ALL ERROR  ",this.constructor.name,e)}onSubscribeToSourcesComplete(){this.tracer("onSubscribeToSourcesComplete","VS_DETRITUS_COLLECT"),this.openSpigot("VS_DETRITUS_COLLECT")}get source$(){return this._source$}sendExtendedStreams(e){this.tracer("sendExtendedStreams",e),this.openSpigot(e.action,e)}renderAndAttachToParent(e){this.openSpigot("VS_SPAWN_AND_ATTACH_TO_PARENT",e)}renderView(){this.openSpigot("VS_SPAWN")}renderViewAndAttachToDom(e,t,r){let s={node:e,type:t,attachType:r};this.openSpigot("VS_SPAWN_AND_ATTACH_TO_DOM",{attachData:s})}checkParentDispose(e){"parent"===e.from$&&this.disposeViewStream(e)}onBeforeDispose(){}setTimeout(e,t=0,r=!1){window.setTimeout((...t)=>{if(void 0!==this&&void 0!==this.props){const n=!0===r?e.bind(this):e;Object(s.apply)(n,t)}},t)}disposeViewStream(e){this.onBeforeDispose(),this.openSpigot("EXTIRPATE")}onChildDispose(e){}onParentDisposing(e){this.openSpigot("EXTIRPATE")}onReadyToGC(e){const t=void 0!==e.from$&&"internal"===e.from$;this.tracer("onReadyToGC",t,e)}openSpigot(e,t={}){if(void 0!==this.props){this.props.action=e;let r=Object(s.mergeRight)(this.props,t);this.sink$.next(Object.freeze(r))}}static isDevMode(){return!0===Object(s.path)(["Spyne","config","debug"],window)}setAttachData(e,t){return{node:this.props.el,type:"ViewStreamObservable",attachType:e,query:(()=>{let e=this.props.el.querySelector(t);return!0===te.isDevMode()&&Object(s.is)(String,t)&&Object(s.isNil)(e)&&console.warn(`Spyne Warning: The appendView query in ${this.props.name}, '${t}', appears to not exist!`),e})()}}getParentEls(e,t){let r=e=>e.parentElement,s=0,n=e;for(;s<t;)n=r(n),s++;return n}setAttachParentData(e,t,r){return t=""!==t?t:void 0,{node:this.getParentEls(this.props.el,r),type:"ViewStreamObservable",attachType:e,query:this.props.el.parentElement.querySelector(t)}}onMapViewSource(e={}){return this.props=Object(s.mergeRight)(this.props,e),e}exchangeViewsWithChild(e,t){this.addChildStream(e.sourceStreams.toParent$),e.addParentStream(this.sourceStreams.toChild$,t)}appendToDom(e){void 0!==this.props.el&&console.warn(`Spyne Warning: The ViewStream, ${this.props.name}, has an element, ${this.props.el}, that is already rendered and does not need to be appendedToDom. This may create unsusual side effects!`),this.renderViewAndAttachToDom(e,"dom","appendChild")}prependToDom(e){void 0!==this.props.el&&console.warn(`Spyne Warning: The ViewStream, ${this.props.name}, has an element, ${this.props.el}, that is already rendered and does not need to be prependedToDom. This may create unsusual side effects!`),this.renderViewAndAttachToDom(e,"dom","prependChild")}appendView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("appendChild",t))}appendViewToParentEl(e,t,r=1){this.exchangeViewsWithChild(e,this.setAttachParentData("appendChild",t,r))}prependViewToParentEl(e,t,r=1){this.exchangeViewsWithChild(e,this.setAttachParentData("prependChild",t,r))}prependView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("prependChild",t))}appendToNull(){let e=document.getElementById("spyne-null-views");this.renderViewAndAttachToDom(e,"dom","appendChild")}onVSRendered(e){"internal"===e.from$&&this.postRender()}postRender(){if(this.beforeAfterRender(),this.afterRender(),this.onRendered(),!0===this.isDevMode){const e=this.broadcastEvents();!1===te.isValidNestedArr(e)&&console.warn(`Spyne Warning: The array returned from broadcastEvents in ${this.props.name}, '${JSON.stringify(e)}', does not appear to be properly formatted!`)}this.viewsStreamBroadcaster=new q(this.props,this.broadcastEvents.bind(this)),this.afterBroadcastEvents()}addTraits(e){"Array"!==e.constructor.name&&(e=[e]);if(e.forEach(e=>{new e(this)}),!0===this.isDevMode){this.addActionListeners()}}afterBroadcastEvents(){if(!0===this.isDevMode){const e=e=>e[0],t=this.addActionListeners();let r=t.map(e);if(!1===te.isValidNestedArr(t))console.warn(`Spyne Warning: The array returned from addActionsListeners in ${this.props.name}, '${JSON.stringify(t)}', does not appear to be properly formatted!`);else{const e=e=>{const t=Object(s.defaultTo)("",e[1]);!1===Object(s.is)(Function,this[t])&&console.warn(`Spyne Warning: The method in addActionListeners nested Array, '${JSON.stringify(e)}', in ${this.props.name}, does not appear to exist!`)};Object(s.compose)(Object(s.forEach)(e),Object(s.defaultTo)([]))(t)}const n=()=>{void 0!==Object(s.path)(["props","addedChannels"],this)&&te.checkIfActionsAreRegistered.bind(this)(this.props.addedChannels,r)};this.setTimeout(n,500)}}static checkIfActionsAreRegistered(e=[],t){if(t.length>0){const r=t=>{let r=new RegExp(t);if(Object(s.findIndex)(Object(s.test)(r),n)<0){let r=1===e.length?"from added channel":"from added dchannels";console.warn(`Spyne Warning: The action, ${t}, in ${this.props.name}, does not match any of the registered actions ${r}, ${e.join(", ")}`)}};let n=(e=>{let t=e.map(e=>window.Spyne.channels.getChannelActions(e));return Object(s.flatten)(t)})(e);t.forEach(r)}}setDataVSID(){this.props.el.dataset.vsid=this.props.vsid}beforeAfterRender(){this.setDataVSID(),this.props.el$=Z(this.props.el)}downStream(){}onRendered(){}afterRender(){}static isValidNestedArr(e){const t=Object(s.equals)(!0),r=Object(s.all)(t),n=Object(s.is)(String),o=Object(s.compose)(r,ee(n),Object(s.slice)(0,2),Object(s.defaultTo)([]));return Object(s.compose)(r,ee(o),Object(s.defaultTo)([]))(e)}broadcastEvents(){return[]}getChannel(e){return Object(s.ifElse)(e=>c().includes(e),e=>window.Spyne.channels.getStream(e).observer.pipe(Object(P.takeWhile)(e=>!0!==this.deleted)),e=>console.warn(`channel name ${e} is not within ${c}`))(e)}addChannel(e,t=!1,r=!1,n=!1){const o=!0===r?this.$dirs.CI:this.$dirs.I,i=Object(s.path)(["srcElement","isLocalEvent"]),a=Object(s.path)(["srcElement","vsid"]),c=[Object(P.map)(e=>{let t=Object(s.defaultTo)({},Object(s.clone)(e));return C({$dir:o},t)}),Object(P.filter)(e=>{let t=a(e);return!0!==i(e)||t===this.props.vsid})];!0===t&&c.unshift(Object(P.skip)(1));let l=this.getChannel(e).pipe(...c);this.updateSourceSubscription(l,!1),this.props.addedChannels.push(e)}checkIfChannelExists(e){let t=void 0!==window.Spyne.channels.map.get(e);return!0!==t&&console.warn(`SPYNE WARNING: The ChannelPayload from ${this.props.name}, has been sent to a channel, ${e}, that has not been registered!`),t}sendInfoToChannel(e,t={},r="VIEWSTREAM_EVENT"){let n={payload:t,action:r};if(n.srcElement=Object(s.compose)(Object(s.pick)(["id","vsid","class","tagName"]),Object(s.prop)("props"))(this),!0===this.checkIfChannelExists(e)){let t=Object(R.of)(n);return new G(e,t,n)}}tracer(...e){this.sendLifecycleMethod(...e)}sendLifecycleMethodInactive(){}sendLifecycleMethodActive(e,t){let r="VS_DETRITUS_COLLECT"===t;!0===Object(s.where)({from$:Object(s.equals)("internal"),action:Object(s.equals)("VS_SPAWNED_AND_ATTACHED_TO_PARENT")},t)?this.sendInfoToChannel("CHANNEL_LIFECYCLE",{action:"CHANNEL_LIFECYCLE_RENDERED_EVENT"},"CHANNEL_LIFECYCLE_RENDERED_EVENT"):!0===r&&this.sendInfoToChannel("CHANNEL_LIFECYCLE",{action:"CHANNEL_LIFECYCLE_DISPOSED_EVENT"},"CHANNEL_LIFECYCLE_DISPOSED_EVENT")}createActionFilter(e,t){return new B(e,t)}isLocalEvent(e){return void 0!==Object(s.path)(["srcElement","el"],e)&&this.props.el.contains(e.srcElement.el)}get attributesArray(){return["accept","accept-charset","accesskey","action","align","allow","alt","aria-autocomplete","aria-checked","aria-disabled","aria-expanded","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-level","aria-multiline","aria-multiselectable","aria-orientation","aria-pressed","aria-readonly","aria-required","aria-selected","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","aria-atomic","aria-busy","aria-live","aria-relevant","aria-dropeffect","aria-grabbed","aria-activedescendant","aria-controls","aria-describedby","aria-flowto","aria-labelledby","aria-owns","aria-posinset","aria-setsize","async","autocapitalize","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","dataset","datetime","decoding","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","importance","integrity","ismap","itemprop","keytype","kind","label","lang","language","lazyload","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","referrerpolicy","rel","required","reversed","role","rows","rowspan","sandbox","scope","scoped","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","value","width","wrap"]}addMixins(){let e=j();this.createId=e.createId}}class re{constructor(e){let t=String(e.props.name),r=`${t}_ROUTE_UPDATER`;return Object(s.curry)(re.createTemporaryViewStreamObj)({id:r,name:t})}static createTemporaryViewStreamObj(e,t){let{name:r,id:s}=e,n=t,o=new te({id:s,name:r,data:t});o.onRendered=()=>{o.sendInfoToChannel("CHANNEL_ROUTE",n)},o.afterBroadcastEvents=()=>{o.disposeViewStream()},o.appendToNull()}}const se=r(0).map;class ne{constructor(e,t={}){this.addRegisteredActions.bind(this),this.createChannelActionsObj(e,t.extendedActionsArr),t.name=e,this.props=t,this.props.isRegistered=!1,this.props.isProxy=void 0!==this.props.isProxy&&this.props.isProxy,this.props.sendCachedPayload=void 0!==this.props.sendCachedPayload&&this.props.sendCachedPayload,this.sendPayloadToRouteChannel=new re(this),this.createChannelActionMethods(),this.streamsController=window.Spyne.channels;let r=this.getMainObserver();this.observer$=this.props.observer=r,this.streamsController.getStream("DISPATCHER").subscribe(e=>this.onReceivedObservable(e))}getMainObserver(){return!0===this.streamsController.testStream(this.props.name)?this.streamsController.getProxySubject(this.props.name,this.props.sendCachedPayload):!0===this.props.sendCachedPayload?new R.ReplaySubject(1):new R.Subject}onChannelInitialized(){}onRegistered(){}get isProxy(){return this.props.isProxy}get channelName(){return this.props.name}get observer(){return this.observer$}checkForTraits(){const e=e=>{"Array"!==e.constructor.name&&(e=[e]);e.forEach(e=>{new e(this)})};void 0!==this.props.traits&&e(this.props.traits)}initializeStream(){this.checkForTraits(),this.onChannelInitialized(),this.onRegistered(),this.props.isRegistered=!0}setTrace(e){}createChannelActionsObj(e,t=[]){const r=Object(s.ifElse)(Object(s.is)(String),s.identity,s.head);let n=t.concat(this.addRegisteredActions(e)),o=se(r,n);let i=Object(s.mergeAll)(Object(s.chain)(e=>Object(s.objOf)(e,e),o));this.channelActions=i}createChannelActionMethods(){const e=Object(s.ifElse)(Object(s.is)(String),s.identity,s.head),t=Object(s.ifElse)(Object(s.is)(String),Object(s.always)("onViewStreamInfo"),e=>{const t=Object(s.view)(Object(s.lensIndex)(1),e);return!0===("function"==typeof this[t])?this[t].bind(this):console.warn(`"${this.props.name}", REQUIRES THE FOLLOWING METHOD ${t} FOR ACTION, ${e[0]}`),t});this.channelActionMethods=Object(s.fromPairs)(se(r=>[e(r),t(r)],this.addRegisteredActions()))}addRegisteredActions(){return[]}onReceivedObservable(e){this.onIncomingObservable(e)}getActionMethodForObservable(e){const t=this.onViewStreamInfo.bind(this);let r=Object(s.path)(["data","action"],e);const n=Object(s.prop)(r,this.channelActionMethods);let o=t;if(void 0!==n&&"onViewStreamInfo"!==n){!0===("function"==typeof this[n])&&(o=this[n].bind(this))}return o}onIncomingObservable(e){let t=Object(s.equals)(e.name,this.props.name),{action:r,payload:n,srcElement:o}=e.data;let i=t=>({props:()=>{return t=e.data,Object(s.mergeAll)([t,{action:Object(s.prop)("action",t)},Object(s.prop)("payload",t),Object(s.prop)("srcElement",t)]);var t},action:r,payload:n,srcElement:o,event:t});return!0===t?(e=>e.observable.pipe(Object(P.map)(i)).subscribe(this.getActionMethodForObservable(e)))(e):void 0}onViewStreamInfo(e){}sendChannelPayload(e,t,r={},s={},n=this.observer$){let o=new S(this.props.name,e,t,r,s);n.next(o)}getChannel(e,t){return Object(s.ifElse)(e=>c().includes(e),e=>{let r=this.streamsController.getStream(e).observer;return void 0!==t?r.pipe(Object(P.filter)(t)):r},e=>console.warn(`channel name ${e} is not within ${c}`))(e)}setTimeout(e,t=0,r=!1){window.setTimeout((...t)=>{if(void 0!==this&&void 0!==this.props){const n=!0===r?e.bind(this):e;Object(s.apply)(n,t)}},t)}}class oe{constructor(){this.checkIfObjIsNotEmptyOrNil=oe.checkIfObjIsNotEmptyOrNil.bind(this)}static checkIfObjIsNotEmptyOrNil(e){const t=Object(s.compose)(Object(s.complement)(s.isEmpty),s.head,s.values),r=Object(s.compose)(Object(s.complement)(s.isNil),s.head,s.values);return Object(s.allPass)([t,r])(e)}static checkIfParamValueMatchesRegex(e,t){const r=Object(s.reject)(Object(s.equals)("routeName")),n=Object(s.compose)(r,s.keys),o=Object(s.compose)(Object(s.find)(t=>Object(s.test)(new RegExp(t),e)),n)(t);return Object(s.is)(String,o)&&(t=Object(s.assoc)(e,Object(s.prop)(o,t),t)),t}static formatStrAsWindowLocation(e){return{hash:e,search:e,pathname:e}}static getLocationStrByType(e,t=!1,r=window.location){const n={slash:"pathname",query:"search",hash:"hash"}[!0===t?"hash":e];return Object(s.prop)(n,r).replace(/^(\/)?(#)?(\/)?(.*)$/,"$4")}static createRouteArrayFromParams(e,t,r="slash",n){let o=[],i=t=>{let r={},a=t.routeName,c=void 0!==e[a]?e[a]:Object(s.prop)(a,n);const l=typeof t[c];"string"===l?c=t[c]:"undefined"===l&&(t=this.checkIfParamValueMatchesRegex(c,t)),r[a]=c,this.checkIfObjIsNotEmptyOrNil(r)&&o.push(r);const d=Object(s.is)(Object,t),h=Object(s.has)(c,t),p=Object(s.has)("routePath",t);if(!0===(h&&d)){let e=t[c];Object(s.has)("routePath",e)&&i(e.routePath)}else!0===p&&void 0!==c&&i(t.routePath)};return i(t),o}static createSlashString(e){const t=Object(s.reject)(s.isNil),r=Object(s.when)(Object(s.complement)(s.isNil,s.__),Object(s.join)("/")),n=Object(s.replace)(/^(\^*)(.*|^\$)(\$)$/,"$2");return Object(s.compose)(n,r,t,s.flatten,Object(s.map)(s.values))(e)}static createQueryString(e){const t=Object(s.reject)(s.isNil),r=this.checkIfObjIsNotEmptyOrNil,n=Object(s.compose)(Object(s.join)("="),s.flatten,s.toPairs),o=Object(s.ifElse)(r,n,Object(s.always)(void 0)),i=Object(s.map)(o),a=Object(s.when)(Object(s.complement)(s.isEmpty),Object(s.concat)("?"));return Object(s.compose)(a,Object(s.join)("&"),t,i)(e)}static checkPayloadForRegexOverrides(e,t,r="Value"){const n=Object(s.compose)(e=>Object(s.prop)(`${e}${r}`,t),s.head,s.keys);return Object(s.map)(e=>{let t=n(e);return void 0!==t?Object(s.assoc)(Object(s.compose)(s.head,s.keys)(e),t,e):e},e)}static convertParamsToRoute(e,t=window.Spyne.config.channels.ROUTE,r,s){const n=void 0!==r?r:t.type,o=t.isHash;let i=t.routes.routePath,a=void 0!==s?s:this.getLocationStrByType(n,o),c=this.convertRouteToParams(a,t,n).routeData,l=this.createRouteArrayFromParams(e,i,n,c);return l=oe.checkPayloadForRegexOverrides(l,e),"query"===n?this.createQueryString(l):this.createSlashString(l)}static findIndexOfMatchedStringOrRegex(e,t){const r=Object(s.replace)(/^$/,"^$"),n=Object(s.either)(Object(s.propEq)("str",e),Object(s.compose)(Object(s.test)(s.__,e),Object(s.prop)("re")));return Object(s.compose)(Object(s.findLastIndex)(Object(s.equals)(!0)),Object(s.map)(n),Object(s.map)(e=>{return{str:e,re:(t=e,new RegExp(t))};var t}),Object(s.map)(r))(t)}static checkIfValueShouldMapToParam(e,t,r){let n=Object(s.compose)(Object(s.map)(s.last),Object(s.map)(Object(s.filter)(Object(s.is)(String))),s.toPairs)(e),o=oe.findIndexOfMatchedStringOrRegex(t,n),i=t;if(o>=0){let t=n[o],r=Object(s.invert)(e),a=Object(s.compose)(s.head,Object(s.defaultTo)([]),Object(s.prop)(t))(r);!0===/^([-\$\w]*)$/.test(a)&&!0===Object(s.is)(String,a)&&(i=a)}return i}static createArrFromSlashStr(e){return e.replace(/^([/])?(.*)$/,"$2").split("/")}static convertSlashRouteStrToParamsObj(e,t,r){const n=t;let o=this.createArrFromSlashStr(t),i=[],a=[],c=e;Object(s.reduce)((e,t)=>{let n=this.checkIfValueShouldMapToParam(c,t,r);c=this.checkIfParamValueMatchesRegex(t,c);const o=Object(s.either)(s.isEmpty,s.isNil);void 0!==c&&(e=>e!==Object(s.last)(i))(c.routeName)&&!1===o(n)&&(i.push(c.routeName),a.push(n));let l=[t,"routePath"],d=Object(s.path)(l,c),h=Object(s.path)(["routePath"],c);void 0!==d?c=d:void 0!==h&&(c=h)},0,o);let l=Object(s.zipObj)(i,a);const d=this.getLastArrVal(i);return{paths:i,pathInnermost:d,routeData:l,routeValue:n}}static getLastArrVal(e){return t=e,void 0!==Object(s.last)(t)?Object(s.last)(t):"";var t}static createDefaultParamFromEmptyStr(e,t){let r={};return r[e.routeName]=this.checkIfValueShouldMapToParam(e,t),r}static convertQueryStrToParams(e,t,r){const n=t;let o=t.replace(/^([?])?(.*)$/,"$2"),i=Object(s.compose)(Object(s.map)(Object(s.split)("=")),Object(s.split)("&"))(o),a=Object(s.fromPairs)(i),c=Object(s.map)(s.head,i);return!0===Object(s.isEmpty)(t)&&(a=this.createDefaultParamFromEmptyStr(e,t,r),c=Object(s.keys)(a)),{paths:c,pathInnermost:this.getLastArrVal(c),routeData:a,routeValue:n}}static convertRouteToParams(e,t,r){if(void 0===t)return{};const n=void 0!==r?r:t.type,o=Object(s.defaultTo)({},Object(s.prop)("regexTokens",t));let i=t.routes.routePath;return"query"===n?this.convertQueryStrToParams(i,e):(e=e.replace(/\/$|$/,"/"),this.convertSlashRouteStrToParamsObj(i,e,o))}}class ie{constructor(){this.createPopStateStream=ie.createPopStateStream.bind(this)}static createPopStateStream(e){Object(R.fromEventPattern)((function(e){window.onpopstate=e}),(function(){window.onpopstate=function(){}})).subscribe(e)}static getLastArrVal(e){return t=e,void 0!==Object(s.last)(t)?Object(s.last)(t):"";var t}static compareRouteKeywords(e={},t){const r=(e,t)=>void 0!==t?Object(s.pick)(t,e):e;let n=r(e,t);return{pickValues:r,compare:(e={},t)=>{let o=r(e,t);const i=e=>Object(s.compose)(s.keys,Object(s.filter)(Object(s.propEq)(e,!0))),a=Object(s.compose)(Object(s.map)(e=>{let t=Object(s.prop)(e,n),r=Object(s.prop)(e,o),i=Object(s.equals)(t,r),a=void 0!==t,c=void 0!==r,l=!i,d=!1===a&&!0===c,h=!0===a&&!1===c,p={};return p[e]={same:i,changed:l,added:d,removed:h,previousExists:a,nextExists:c},p}),s.uniq,Object(s.chain)(s.keys))([n,o]);let c=Object(s.chain)(i("changed"),a),l=Object(s.chain)(i("added"),a),d=Object(s.chain)(i("removed"),a);return n=o,{pathsAdded:l,pathsRemoved:d,pathsChanged:c}},getComparer:()=>n}}static getRouteArrData(e,t){let r=Object(s.filter)(Object(s.includes)(s.__,e),t);return{paths:r,pathInnermost:ie.getLastArrVal(r)}}static flattenConfigObject(e){const t=e=>Object(s.chain)(([e,r])=>"[object Object]"===Object.prototype.toString.call(r)?Object(s.map)(([t,r])=>[`${e}.${t}`,r],t(r)):[[e,r]],Object(s.toPairs)(e));return Object(s.values)(Object(s.fromPairs)(t(e)))}static addRouteDatasets(e){const{type:t,isHash:r}=e,n=s=>{const n="query"===t?"":!0===r?"#":"/",o=oe.convertParamsToRoute(s,e);return n+o.replace(/^(.*\/)([\w\-]*\/?)(.*)$/gm,"$1$2")},o=/^([A-Za-z0-9_\-])+$/m,i=(e=[],t,r={})=>{let{routeName:a}=t;return Object(s.toPairs)(t).reduce((t,c)=>{const[l,d]=c,h=Object(s.is)(Object,d),p=e=>Object(s.test)(o,e)?String(e).toUpperCase():l;if("routeName"===l||"404"===l)return t;a=a||Object(s.prop)("routeName",d);let u=Object(s.clone)(r);if(u[a]=String(l).replace(/([^A-Za-z0-9-_])/g,""),!0===h){if(1===Object(s.keys)(u).length){const e=Object(s.path)(["routePath","routeName"],d);if(e){const o=Object(s.clone)(u);o[e]="",o.navLevel=Object(s.keys)(r).length,o.title=p(l),o.href=n(o),t.push(o)}}u=i(e,d,u)}else u.title=p(l),u.href=n(u);return u.navLevel=Object(s.keys)(r).length,t.push(u),t},[])};let a=i([],e.routes);const c=Object(s.flatten)(a);return{routeDatasetsArr:c,routeNamesArr:(e=>{const t=Object(s.reject)(Object(s.includes)(s.__,["title","href","navLevel"]));return Object(s.compose)(s.uniq,t,s.flatten,Object(s.map)(s.keys))(e)})(c)}}static conformRouteObject(e={},t=!1){const r=Object(s.path)(["channels","ROUTE"],e);let{add404s:n}=void 0!==r?r:e;n=n||t;const o=e=>{let t=e[1];const r=Object(s.is)(Array,t);return""===t?e[1]="^$":r&&(e[1]=t.join("|")),e},i=Object(s.compose)(s.fromPairs,Object(s.map)(e=>{let[t,r]=e;const a=n?{404:".+"}:{},c=Object(s.is)(Object,r),l=Object(s.is)(Array,r),d="routePath"===t;return!0===c&&!1===l&&(e[1]=i(e[1]),d&&(e[1]=Object(s.compose)(Object(s.mergeDeepRight)(a),s.fromPairs,Object(s.map)(o),s.toPairs)(e[1]))),e}),s.toPairs);if(void 0!==r){e.channels.ROUTE=i(e.channels.ROUTE);const t=ie.addRouteDatasets(e.channels.ROUTE);return e.channels.ROUTE=Object(s.mergeRight)(e.channels.ROUTE,t),e}return i(e)}static getLocationData(){return Object(s.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}}const ae=r(0).filter,ce=r(0).mergeRight;class le extends ne{constructor(e="CHANNEL_ROUTE",t={}){t.sendCachedPayload=!0,super("CHANNEL_ROUTE",t),this.createChannelActionsObj(),this.routeConfigJson=this.getRouteConfig(),this.bindStaticMethods(),this.navToStream$=new R.ReplaySubject(1),this.observer$=this.navToStream$.pipe(Object(P.map)(e=>this.onMapNext(e))),this.compareRouteKeywords=ie.compareRouteKeywords()}checkConfigForHash(){!0===("hash"===window.Spyne.config.channels.ROUTE.type)&&(window.Spyne.config.channels.ROUTE.type="slash",window.Spyne.config.channels.ROUTE.isHash=!0)}onRegistered(){this.checkConfigForHash(),this.initStream()}createChannelActionsObj(){let e=this.addRegisteredActions();let t=Object(s.mergeAll)(Object(s.chain)(e=>Object(s.objOf)(e,e),e));this.channelActions=t}addRegisteredActions(){return["CHANNEL_ROUTE_DEEPLINK_EVENT","CHANNEL_ROUTE_CHANGE_EVENT","CHANNEL_ROUTE_CONFIG_UPDATED_EVENT",["CHANNEL_ROUTE_UPDATE_CONFIG_EVENT","updateRouteConfig"]]}updateRouteConfig(e){const t=Object(s.pick)(["isHash","isHidden","routes","type"],e.payload);window.Spyne.config.channels.ROUTE=Object(s.mergeRight)(window.Spyne.config.channels.ROUTE,t);Object(s.clone)(window.Spyne.config.channels.ROUTE);window.Spyne.config=ie.conformRouteObject(window.Spyne.config);const r=this.getRouteConfig();this.routeConfigJson=r,this.bindStaticMethodsWithConfigData(),this.sendChannelPayload("CHANNEL_ROUTE_CONFIG_UPDATED_EVENT",r,{},{},this.navToStream$)}getRouteConfig(){const e=window.Spyne.config;let t=Object(s.path)(["channels","ROUTE"],e);"query"===t.type&&(t.isHash=!1);let r=ie.flattenConfigObject(t.routes);return t.paramsArr=r,t}initStream(){this.firstLoadStream$=new R.ReplaySubject(1),this.onIncomingDomEvent(void 0,this.routeConfigJson,"CHANNEL_ROUTE_DEEPLINK_EVENT"),ie.createPopStateStream(this.onIncomingDomEvent.bind(this)),this.observer$=Object(R.merge)(this.firstLoadStream$,this.navToStream$)}onMapNext(e,t=!1){return e.action="CHANNEL_ROUTE_CHANGE_EVENT",e}static removeSSID(e){const t=Object(s.lensProp)(["routeData"]);return Object(s.over)(t,Object(s.omit)(["vsid"]))(e)}static onIncomingDomEvent(e,t=this.routeConfigJson,r){let n=void 0!==r?r:this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT,o=Object(s.path)(["state","routeCount"],e),i=!0===Object(s.is)(Number,o),a=this.getDataFromString(t,i);!0===i&&(a.routeCount=o);let c=this.compareRouteKeywords.compare(a.routeData,a.paths);a=ce(a,c),this.sendChannelPayload(n,a,void 0,void 0,this.navToStream$)}static checkForRouteParamsOverrides(e){return e}static checkForEventMethods(e){const t=Object(s.compose)(ae(Object(s.test)(/^(event)([A-Z].*)([A-Z].*)$/gm)),s.keys,Object(s.prop)("payload"))(e);if(t.length>=1){const r=Object(s.prop)("event",e);if(void 0!==r){const e=(e,t,r,s,n)=>String(r).toLowerCase()+s+n,n=Object(s.replace)(/^(event)([A-Z])(.*)([A-Z].*)$/gm,e),o=e=>{const t=n(e);void 0!==r[t]&&r[t]()};t.forEach(o)}}return e}onViewStreamInfo(e){let t=this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT;le.checkForEventMethods(e);let r=this.getDataFromParams(e),n=Object(s.prop)("srcElement",e),o=Object(s.prop)("event",e),i=!r.isHidden,a=this.compareRouteKeywords.compare(r.routeData,r.paths);r=ce(r,a),this.sendRouteStream(r,i),r=le.removeSSID(r),this.sendChannelPayload(t,r,n,o,this.navToStream$)}static checkAndConvertStrWithRegexTokens(e,t){return Object(s.keys)(t)}sendRouteStream(e,t=!0){!0===t&&this.setWindowLocation(e)}static getRouteState(){return"CHANNEL_ROUTE_CHANGE_EVENT"}static getIsDeepLinkBool(e){return!1===e&&0===this._routeCount}static getRouteCount(e=!1){return void 0===this._routeCount?(this._routeCount=0,this._routeCount):(!1===e&&(this._routeCount+=1),this._routeCount)}static getExtraPayloadParams(e=this.routeConfigJson,t=!1){return{routeCount:this.getRouteCount(t),isDeepLink:this.getIsDeepLinkBool(t),isHash:e.isHash,isHidden:e.isHidden,routeType:e.type}}static getDataFromParams(e,t=this.routeConfigJson){let r=Object(s.prop)("payload",e),n=this.getRouteStrFromParams(r,t);const o=(e,r)=>Object(s.defaultTo)(r,Object(s.prop)(e,t));let i=o("type","slash"),a=o("isHash",!1),c=oe.formatStrAsWindowLocation(n),l=this.getDataFromLocationStr(i,a,c),{pathInnermost:d,paths:h}=l;r=ce(l.routeData,r);let{routeCount:p,isDeepLink:u,isHash:E,isHidden:m,routeType:b}=this.getExtraPayloadParams(t);return{isDeepLink:u,routeCount:p,pathInnermost:d,paths:h,routeData:r,routeValue:n,isHash:E,isHidden:m,routeType:b}}static getDataFromString(e=this.routeConfigJson,t=!1){const r=e.type,s=!0===e.isHash,n=oe.getLocationStrByType(r,s);let{paths:o,pathInnermost:i,routeData:a,routeValue:c}=le.getParamsFromRouteStr(n,e,r),{routeCount:l,isDeepLink:d,isHash:h,routeType:p,isHidden:u}=this.getExtraPayloadParams(e,t);return{isDeepLink:d,routeCount:l,pathInnermost:i,paths:o,routeData:a,routeValue:c,isHash:h,isHidden:u,routeType:p}}static getDataFromLocationStr(e="slash",t=this.routeConfigJson.isHash,r=window.location){const s=void 0!==this.routeConfigJson?this.routeConfigJson.type:e,n=oe.getLocationStrByType(s,t,r);let{paths:o,pathInnermost:i,routeData:a,routeValue:c}=this.getParamsFromRouteStr(n,this.routeConfigJson,s);return{paths:o,pathInnermost:i,routeData:a,routeValue:c,action:this.getRouteState()}}static getLocationData(){return Object(s.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getRouteStrFromParams(e,t,r){const s=void 0!==r?r:t.type;return oe.convertParamsToRoute(e,t,s)}static getParamsFromRouteStr(e,t,r){const s=void 0!==r?r:t.type;return oe.convertRouteToParams(e,t,s)}checkEmptyRouteStr(e,t=!1){const r=Object(s.isEmpty)(e);return!0===(!0===r&&!1===t)||!0===(!0===r&&!0===t)?"/":!0===(!1===r&&!0===t)?Object(s.concat)("#",e):e}static removeLastSlash(e){return e.replace(/^(.*)(\/)$/,"$1")}setWindowLocation(e){let{isHash:t,routeValue:r}=e;r=this.checkEmptyRouteStr(r,t);let{routeCount:n}=e;if(!0===t){r=le.removeLastSlash(window.location.pathname)+r,window.history.pushState({routeCount:n},"",r)}else{const e=Object(s.when)(Object(s.compose)(Object(s.complement)(Object(s.equals)("/")),s.head),Object(s.concat)("/",s.__));window.history.pushState({routeCount:n},"",e(r))}}getWindowLocation(){return window.location.pathname}bindStaticMethods(){this.getIsDeepLinkBool=le.getIsDeepLinkBool.bind(this),this.getDataFromLocationStr=le.getDataFromLocationStr.bind(this),this.onIncomingDomEvent=le.onIncomingDomEvent.bind(this),this.getDataFromString=le.getDataFromString.bind(this),this.getParamsFromRouteStr=le.getParamsFromRouteStr.bind(this),this.getLocationData=le.getLocationData.bind(this),this.getRouteState=le.getRouteState.bind(this),this.getDataFromParams=le.getDataFromParams.bind(this),this.getRouteCount=le.getRouteCount.bind(this),this.getExtraPayloadParams=le.getExtraPayloadParams.bind(this),this.bindStaticMethodsWithConfigData()}bindStaticMethodsWithConfigData(){const e=Object(s.curryN)(3,le.getRouteStrFromParams);this.getRouteStrFromParams=e(s.__,this.routeConfigJson,this.routeConfigJson.type)}}class de extends ne{constructor(e="CHANNEL_UI",t={}){t.sendCachedPayload=!1,super(e,t),this.keyEventsLoaded=!1,this.keyCodeArr=[]}addRegisteredActions(){return["CHANNEL_UI_ANIMATIONEND_EVENT","CHANNEL_UI_ANIMATIONITERATION_EVENT","CHANNEL_UI_ANIMATIONSTART_EVENT","CHANNEL_UI_AUDIOEND_EVENT","CHANNEL_UI_AUDIOPROCESS_EVENT","CHANNEL_UI_AUDIOSTART_EVENT","CHANNEL_UI_BLUR_EVENT","CHANNEL_UI_CACHED_EVENT","CHANNEL_UI_CANPLAYTHROUGH_EVENT","CHANNEL_UI_CANPLAY_EVENT","CHANNEL_UI_CHANGE_EVENT","CHANNEL_UI_CHECKBOXSTATECHANGE_EVENT","CHANNEL_UI_CLICK_EVENT","CHANNEL_UI_COMPLETE_EVENT","CHANNEL_UI_COPY_EVENT","CHANNEL_UI_CUT_EVENT","CHANNEL_UI_DBLCLICK_EVENT","CHANNEL_UI_DURATIONCHANGE_EVENT","CHANNEL_UI_EMPTIED_EVENT","CHANNEL_UI_ENDED_EVENT","CHANNEL_UI_EVENT","CHANNEL_UI_FOCUSIN_EVENT","CHANNEL_UI_FOCUSOUT_EVENT","CHANNEL_UI_FOCUS_EVENT","CHANNEL_UI_HASHCHANGE_EVENT","CHANNEL_UI_INPUT_EVENT","CHANNEL_UI_KEYDOWN_EVENT","CHANNEL_UI_KEYPRESS_EVENT","CHANNEL_UI_KEYUP_EVENT","CHANNEL_UI_LOADEDDATA_EVENT","CHANNEL_UI_LOADEDMETADATA_EVENT","CHANNEL_UI_MOUSEDOWN_EVENT","CHANNEL_UI_MOUSEENTER_EVENT","CHANNEL_UI_MOUSELEAVE_EVENT","CHANNEL_UI_MOUSEMOVE_EVENT","CHANNEL_UI_MOUSEOUT_EVENT","CHANNEL_UI_MOUSEOVER_EVENT","CHANNEL_UI_MOUSEUP_EVENT","CHANNEL_UI_MOUSEWHEEL_EVENT","CHANNEL_UI_PAUSE_EVENT","CHANNEL_UI_PLAYING_EVENT","CHANNEL_UI_PLAY_EVENT","CHANNEL_UI_RADIOSTATECHANGE_EVENT","CHANNEL_UI_RATECHANGE_EVENT","CHANNEL_UI_READYSTATECHANGE_EVENT","CHANNEL_UI_SEEKED_EVENT","CHANNEL_UI_SEEKING_EVENT","CHANNEL_UI_SELECT_EVENT","CHANNEL_UI_STALLED_EVENT","CHANNEL_UI_SUBMIT_EVENT","CHANNEL_UI_SUSPEND_EVENT","CHANNEL_UI_SVGABORT_EVENT","CHANNEL_UI_SVGERROR_EVENT","CHANNEL_UI_SVGLOAD_EVENT","CHANNEL_UI_SVGRESIZE_EVENT","CHANNEL_UI_SVGSCROLL_EVENT","CHANNEL_UI_SVGUNLOAD_EVENT","CHANNEL_UI_SVGZOOM_EVENT","CHANNEL_UI_TIMEUPDATE_EVENT","CHANNEL_UI_TOUCHCANCEL_EVENT","CHANNEL_UI_TOUCHEND_EVENT","CHANNEL_UI_TOUCHMOVE_EVENT","CHANNEL_UI_TOUCHSTART_EVENT","CHANNEL_UI_TRANSITIONEND_EVENT","CHANNEL_UI_VALUECHANGE_EVENT","CHANNEL_UI_VOLUMECHANGE_EVENT","CHANNEL_UI_WAITING_EVENT","CHANNEL_UI_WHEEL_EVENT"]}loadKeyStream(){let e=R.Observable.fromEvent(document,"keyup");this.keyPresses$=e.groupBy(e=>e.keyCode).mergeAll().filter(e=>this.keyCodeArr.indexOf(e.keyCode)>=0).repeat().subscribe(this.onKeyPressed.bind(this))}addKeyEvent(e){!1===this.keyEventsLoaded&&this.loadKeyStream(),this.keyEventsLoaded=!0,this.registerKey(e)}registerKey(e){this.keyCodeArr.push(e)}onKeyPressed(e){console.log("key is ",e)}static removeSSID(e){const t=Object(s.lensProp)(["payload"]);return Object(s.over)(t,Object(s.omit)(["vsid"]))(e)}onIncomingObservable(e){let t=Object(s.equals)(e.name,this.props.name);e.data=de.removeSSID(e.data);let{payload:r,srcElement:n}=e.data,o=e=>({payload:r,srcElement:n,event:e});return!0===t?(e=>e.observable.pipe(Object(P.map)(o)).subscribe(this.onUIEvent.bind(this)))(e):void 0}getActionState(e){let t=Object(s.path)(["event","type"]),r=Object(s.path)(["event","typeOverRide"]),n=Object(s.compose)(s.toUpper,Object(s.either)(r,t))(e);return void 0!==n?`CHANNEL_UI_${n}_EVENT`:"CHANNEL_UI"}static checkForEventMethods(e){const t=Object(s.compose)(Object(s.filter)(Object(s.test)(/^(event)([A-Z].*)([A-Z].*)$/gm)),s.keys,Object(s.prop)("payload"))(e);if(t.length>=1){const r=Object(s.prop)("event",e);if(void 0!==r){const e=(e,t,r,s,n)=>String(r).toLowerCase()+s+n,n=Object(s.replace)(/^(event)([A-Z])(.*)([A-Z].*)$/gm,e),o=e=>{const t=n(e);void 0!==r[t]&&"function"==typeof r[t]&&r[t]()};t.forEach(o)}}return e}onUIEvent(e){de.checkForEventMethods(e),e.action=this.getActionState(e);const t=e.action,{payload:r,srcElement:s}=e,n=e.event;this.sendChannelPayload(t,r,s,n)}}class he{constructor(){this.createDomObservableFromEvent=he.createDomObservableFromEvent.bind(this)}static createDomObservableFromEvent(e,t,r=!0,s=window){return t=void 0===t?e=>e:t,Object(R.fromEventPattern)(t=>s.addEventListener(e,t,{passive:r}),()=>{s[e]=e=>e}).pipe(Object(P.map)(t))}static createMediaQuery(e){const t=window.matchMedia(e);return this.checkIfValidMediaQuery(t,e),!1!==t&&t}static checkIfValidMediaQuery(e,t){const r=e=>e.replace(/\s+/gm,""),s=void 0!==e.matches&&r(e.media).indexOf(r(t))>=0;return!1===s&&(t=>{console.warn(`Spyne Info: the following query string, "${t}", has been optimized to "${e.media}" by the browser and may not be a valid Media Query item!`)})(t),s}static createMediaQueryHandler(e,t){let r=(e=>t=>(t.mediaQueryName=e,t))(t),s=(n=e,{addHandler:e=>{n.addListener(e)},removeHandler:e=>{n.onchange=()=>{}}});var n;return new R.fromEventPattern(s.addHandler,s.removeHandler).pipe(Object(P.map)(r))}static createMergedObsFromObj(e){let t=e.mediqQueries,r=[];return Object(s.mapObjIndexed)((e,t,s)=>{let n=he.createMediaQuery(e);return!1!==n&&r.push(he.createMediaQueryHandler(n,t)),r},t),r}}const pe=r(0).map;class ue extends ne{constructor(e="CHANNEL_WINDOW"){super(e),this.bindStaticMethods(),this.currentScrollY=0}initializeStream(){this.domChannelConfig=window.Spyne.config.channels.WINDOW;let e=this.getActiveObservables(),t=Object(R.merge)(...e);this.dom$=t,t.subscribe(e=>{let{action:t,payload:r,srcElement:s,event:n}=e;this.sendChannelPayload(t,r,s,n)})}static getMouseWheelMapFn(e){let t=this.channelActions.CHANNEL_WINDOW_MOUSEWHEEL_EVENT,r=e.deltaY<=0?"up":"down",{deltaX:s,deltaY:n,deltaZ:o}=e;return{action:t,payload:{scrollDir:r,deltaX:s,deltaY:n,deltaZ:o},srcElement:e.srcElement,event:e}}static createCurriedGenericEvent(e){let t=`CHANNEL_WINDOW_${e.toUpperCase()}_EVENT`;return Object(s.curry)(ue.mapGenericEvent)(t)}static mapGenericEvent(e,t){return{action:e,payload:t,srcElement:t.srcElement,event:t}}static getResizeMapFn(e){return{action:this.channelActions.CHANNEL_WINDOW_RESIZE_EVENT,payload:Object(s.pick)(["innerWidth","innerHeight","outerWidth","outerHeight"],window),srcElement:e.srcElement,event:e}}static getOrientationMapFn(e){let t=this.channelActions.CHANNEL_WINDOW_ORIENTATION_EVENT;let r=window.matchMedia("(orientation: portrait)").matches,n=Object(s.pick)(["innerWidth","innerHeight","outerWidth","outerHeight"],window);return n.orientation=!0===r?"portrait":"landscape",{action:t,payload:n,srcElement:e.srcElement,event:e}}getMediaQueryMapFn(e){return{action:this.channelActions.CHANNEL_WINDOW_MEDIA_QUERY_EVENT,payload:Object(s.pick)(["matches","media","mediaQueryName"],e),srcElement:e.srcElement,event:e}}createMouseWheelObservable(e){const t=e.debounceMSTimeForScroll;return he.createDomObservableFromEvent("mousewheel",ue.getMouseWheelMapFn.bind(this)).pipe(Object(P.debounceTime)(t))}static getScrollData(){let e=0;return t=>{let r=e-t;return e=t,{scrollY:t,scrollDistance:r,scrollDir:r>=0?"up":"down"}}}static getScrollY(e){return void 0!==e.pageYOffset?e.pageYOffset:e.scrollTop}static getScrollMapFn(e,t,r,s,n){let o=s(ue.getScrollY(n)),{scrollDistance:i}=o;return{action:r,payload:o,srcElement:e.srcElement,scrollDistance:i,event:e}}createScrollObservable(e,t=window){const r=e.debounceMSTimeForScroll,n=t===window,o=void 0!==e.scrollElForVals?e.scrollElForVals:t,i=n?"CHANNEL_WINDOW_SCROLL_EVENT":"CHANNEL_WINDOW_ELEMENT_SCROLL_EVENT",a=ue.getScrollData(),c=Object(s.partialRight)(ue.getScrollMapFn,[i,a,o]).bind(this);return he.createDomObservableFromEvent("scroll",c).pipe(Object(P.debounceTime)(r),Object(P.skipWhile)(e=>0===e.scrollDistance),Object(P.map)(e=>{const t=ue.getScrollY(window);return e.payload.scrollDistanceAbs=Math.abs(this.currentScrollY-t),this.currentScrollY=t,e}))}createOrientationObservable(e){return he.createDomObservableFromEvent("orientationchange",ue.getOrientationMapFn.bind(this))}createResizeObservable(e){const t=e.debounceMSTimeForResize;return he.createDomObservableFromEvent("resize",ue.getResizeMapFn.bind(this)).pipe(Object(P.debounceTime)(t))}getEventsFromConfig(e=this.domChannelConfig){let t=e.events;return pe(e=>{let t=ue.createCurriedGenericEvent(e);return he.createDomObservableFromEvent(e,t)},t)}getActiveObservables(e=this.domChannelConfig){let t=[];e.listenForMediaQueries=(e=>{const t=Object(s.compose)(Object(s.complement)(s.isEmpty),s.head,s.values),r=Object(s.compose)(Object(s.complement)(s.isNil),s.head,s.values);return Object(s.allPass)([t,r])(e)})(e.mediqQueries);let r={listenForResize:this.createResizeObservable.bind(this),listenForOrientation:this.createOrientationObservable.bind(this),listenForScroll:this.createScrollObservable.bind(this),listenForMouseWheel:this.createMouseWheelObservable.bind(this)};Object(s.mapObjIndexed)((r,s,n)=>{e[s]&&t.push(r(e))},r),this.checkForMediaQueries(e.listenForMediaQueries);let n=this.getEventsFromConfig(e);return t=t.concat(n),t}checkForMediaQueries(e){const t=e=>{let{action:t,payload:r,srcElement:s,event:n}=e;this.sendChannelPayload(t,r,s,n,this.observer$)};!0===e&&this.getMediaQueryObservable(this.domChannelConfig).subscribe(t)}getMediaQueryObservable(e){let t=this.createMergedObsFromObj(e);return Object(s.apply)(R.merge,t).pipe(Object(P.map)(this.getMediaQueryMapFn.bind(this)))}addRegisteredActions(){return["CHANNEL_WINDOW_ABORT_EVENT","CHANNEL_WINDOW_AFTERPRINT_EVENT","CHANNEL_WINDOW_ANIMATIONEND_EVENT","CHANNEL_WINDOW_ANIMATIONITERATION_EVENT","CHANNEL_WINDOW_ANIMATIONSTART_EVENT","CHANNEL_WINDOW_APPINSTALLED_EVENT","CHANNEL_WINDOW_BEFOREPRINT_EVENT","CHANNEL_WINDOW_BEFOREUNLOAD_EVENT","CHANNEL_WINDOW_BEGINEVENT_EVENT","CHANNEL_WINDOW_BLUR_EVENT","CHANNEL_WINDOW_CACHED_EVENT","CHANNEL_WINDOW_CHANGE_EVENT","CHANNEL_WINDOW_CLICK_EVENT","CHANNEL_WINDOW_CLOSE_EVENT","CHANNEL_WINDOW_COMPOSITIONEND_EVENT","CHANNEL_WINDOW_COMPOSITIONSTART_EVENT","CHANNEL_WINDOW_COMPOSITIONUPDATE_EVENT","CHANNEL_WINDOW_COPY_EVENT","CHANNEL_WINDOW_CUT_EVENT","CHANNEL_WINDOW_DEVICECHANGE_EVENT","CHANNEL_WINDOW_DEVICELIGHT_EVENT","CHANNEL_WINDOW_DEVICEMOTION_EVENT","CHANNEL_WINDOW_DEVICEORIENTATION_EVENT","CHANNEL_WINDOW_DEVICEPROXIMITY_EVENT","CHANNEL_WINDOW_DOMATTRIBUTENAMECHANGED_EVENT","CHANNEL_WINDOW_DOMATTRMODIFIED_EVENT","CHANNEL_WINDOW_DOMCHARACTERDATAMODIFIED_EVENT","CHANNEL_WINDOW_DOMCONTENTLOADED_EVENT","CHANNEL_WINDOW_DOMELEMENTNAMECHANGED_EVENT","CHANNEL_WINDOW_ERROR_EVENT","CHANNEL_WINDOW_FOCUSIN_EVENT","CHANNEL_WINDOW_FOCUS_EVENT","CHANNEL_WINDOW_FULLSCREENCHANGE_EVENT","CHANNEL_WINDOW_FULLSCREENERROR_EVENT","CHANNEL_WINDOW_LOAD_EVENT","CHANNEL_WINDOW_MEDIA_QUERY_EVENT","CHANNEL_WINDOW_MESSAGE_EVENT","CHANNEL_WINDOW_MOUSEWHEEL_EVENT","CHANNEL_WINDOW_OFFLINE_EVENT","CHANNEL_WINDOW_ONLINE_EVENT","CHANNEL_WINDOW_OPEN_EVENT","CHANNEL_WINDOW_ORIENTATION_EVENT","CHANNEL_WINDOW_PAGEHIDE_EVENT","CHANNEL_WINDOW_PAGESHOW_EVENT","CHANNEL_WINDOW_POPSTATE_EVENT","CHANNEL_WINDOW_RESET_EVENT","CHANNEL_WINDOW_RESIZE_EVENT","CHANNEL_WINDOW_ELEMENT_SCROLL_EVENT",["CHANNEL_WINDOW_SET_ELEMENT_TO_SCROLL_EVENT","onSetElementToScroll"],"CHANNEL_WINDOW_SCROLL_EVENT","CHANNEL_WINDOW_SCROLL_LOCK_EVENT",["CHANNEL_WINDOW_SCROLL_LOCK_EVENT","onScrollLockEvent"],"CHANNEL_WINDOW_SUBMIT_EVENT","CHANNEL_WINDOW_TRANSITIONCANCEL_EVENT","CHANNEL_WINDOW_TRANSITIONEND_EVENT","CHANNEL_WINDOW_TRANSITIONRUN_EVENT","CHANNEL_WINDOW_TRANSITIONSTART_EVENT","CHANNEL_WINDOW_UNLOAD_EVENT","CHANNEL_WINDOW_WHEEL_EVENT"]}onScrollLockEvent(e){let{action:t,scrollLock:r}=e.props();window.Spyne.config.scrollLock=r,!0===r&&(window.Spyne.config.scrollLockX=window.scrollX,window.Spyne.config.scrollLockY=window.scrollY),this.sendChannelPayload(t,{scrollLock:r})}onSetElementToScroll(e){let{config:t,scrollElement:r}=e.props();t=C(this.domChannelConfig,t),this.createScrollObservable(t,r).subscribe(e=>{let{action:t,payload:r,srcElement:s,event:n}=e;this.sendChannelPayload(t,r,s,n)})}bindStaticMethods(){this.createMediaQueryHandler=he.createMediaQueryHandler.bind(this),this.createMergedObsFromObj=he.createMergedObsFromObj.bind(this)}}class Ee extends ne{constructor(e={}){super("CHANNEL_LIFECYCLE",e)}addRegisteredActions(){return["CHANNEL_LIFECYCLE_RENDERED_EVENT","CHANNEL_LIFECYCLE_DISPOSED_EVENT"]}onViewStreamInfo(e){let{data:t,action:r,srcElement:s}=e.props(),n=s;n.action=r,this.onSendEvent(r,n)}onSendEvent(e,t={}){const r=this.channelActions[e],s={};window.setTimeout(()=>this.sendChannelPayload(r,t,s,void 0),0)}}class me extends ne{constructor(e,t={}){t.isProxy=!0,super(e,t),this.props=t,this.subject$=new R.Subject,this.replaySub$=new R.ReplaySubject(1),this.observer$=Object(R.merge)(this.subject$,this.replaySub$),!0===(!0===Object(s.path)(["Spyne","config","debug"],window))&&this.checkIfChannelIsStillProxy(e)}getMergedSubject(e=!1){return!0===e?this.replaySub$:this.subject$}checkIfChannelIsStillProxy(e){let t=e;window.setTimeout(()=>{!0!==Object(s.includes)(t,window.Spyne.channels.listRegisteredChannels())&&console.warn(`Spyne Warning: The channel, ${t} does not appear to be registered!`)},1e3)}get replaySubject(){return this.replaySub$}get subject(){return this.subject$}}const be=r(0).map;class Oe{constructor(){this.addMixins(),this.map=new Map,this.map.set("DISPATCHER",new R.Subject),this.listRegisteredChannels=Oe.listRegisteredChannels.bind(this),this.getChannelsList=Oe.getChannelsList.bind(this)}static getChannelsList(){return Array.from(window.Spyne.channels.map,(e,t)=>({key:e[0],val:e[1].constructor.name}))}static listRegisteredChannels(e=!1){let t=this.getChannelsList(),r=Object(s.reject)(Object(s.propEq)("val","ChannelProxy")),n=Object(s.filter)(Object(s.propEq)("val","ChannelProxy")),o=(!0===e?n:r)(t);return Object(s.pluck)(["key"],o)}listProxyChannels(){return this.listRegisteredChannels(!0)}checkForMissingChannels(){let e=this.getChannelsList(),t=Object(s.filter)(Object(s.propEq)("val","ChannelProxy"))(e);if(t.length>=1){let e=`Spyne Warning: The following ${1===t.length?"Channel has":"Channels have"} not been initialized: ${Object(s.compose)(Object(s.join)(", "),be(Object(s.prop)("key")))(t)}`;console.warn(e)}}init(){this.createMainStreams()}createObserver(e){x(e.validations,e.init),this.map.set(e.init.name,e.init.observable())}createMainStreams(){this.routeStream=new le,this.map.set("CHANNEL_ROUTE",this.routeStream),this.uiStream=new de,this.map.set("CHANNEL_UI",this.uiStream),this.domStream=new ue,this.map.set("CHANNEL_WINDOW",this.domStream),this.viewStreamLifecycle=new Ee,this.map.set("CHANNEL_LIFECYCLE",this.viewStreamLifecycle),this.routeStream.initializeStream(),this.domStream.initializeStream()}addKeyEvent(e){this.map.get("UI").addKeyEvent(e)}registerStream(e){let t=e.channelName;if(this.map.has(t)){if(Object(s.compose)(Object(s.pathEq)(["props","isRegistered"],!0))(this.map.get(t)))return void console.warn(`Spyne Warning: The Channel, ${t}, has already been registered!`)}this.map.set(t,e),e.initializeStream()}getChannelActions(e){return this.map.get(e).addRegisteredActions()}getProxySubject(e,t=!1){let r=!0===t?"replaySubject":"subject";return this.map.get(e)[r]}testStream(e){return void 0!==this.map.get(e)}getStream(e){return!1===this.testStream(e)&&this.map.set(e,new me(e)),this.map.get(e)}addMixins(){}}class Ne{constructor(e,t="",r=!0){return this.parentContext=e,this.omittedMethods=["autoBinder","initAutoBinder","getEnhancerMethods","checkForMalformedMethods","caller","arguments","bindParentViewStream"],this.prefix=t,!0===r&&this.autoBinder(),this.allMethodsList}initAutoBinder(){this.autoBinder()}getEnhancerMethods(){return o(this,this.omittedMethods)}checkForMalformedMethods(e){if(""===this.prefix)return void console.warn(`SPYNE WARNING: The following SpyneTrait ${this.constructor.name} needs a prefix`);let t=Object(s.reject)(e=>0===e.indexOf(this.prefix),e);if(t.length>=1){let e=`Spyne Warning: The following method(s) in ${this.constructor.name} require the prefix, "${this.prefix}": [${t.join(", ")}];`;console.warn(e)}}bindParentViewStream(e,t){this.checkForMalformedMethods(e.allMethods);let r={};const n=(e,s=!1)=>{let n=!0===s?this.constructor:this;var o;"function"===typeof n[e]&&(r[e]=t[o=e]=n[o].bind(t))},o=Object(s.curryN)(2,n)(s.__,!0);return Object(s.map)(o,e.staticMethods),Object(s.map)(n,e.methods),r}autoBinder(){let e=this.getEnhancerMethods();return this.allMethodsList=this.bindParentViewStream(e,this.parentContext),this.allMethodsList}}class _e{constructor(e,t,r){this._mapFn=_e.setMapFn(e),this._url=_e.setUrl(e),this._responseType=_e.setResponseType(e),this._serverOptions=_e.setServerOptions(e),this._subscriber=void 0!==t?t:e=>console.log("FETCH RETURNED ",e),this.debug=void 0!==e.debug&&e.debug;let s={mapFn:this.mapFn,url:this.url,serverOptions:this.serverOptions,responseType:this.responseType,debug:this.debug};!0!==r&&_e.startWindowFetch(s,this._subscriber)}static startWindowFetch(e,t){let{mapFn:r,url:s,serverOptions:n,responseType:o,debug:i}=e;const a=!0===i?e=>console.log("DEBUG FETCH :",e):()=>{};let c=Object(R.from)(window.fetch(s,n)).pipe(Object(P.tap)(a),Object(P.flatMap)(e=>Object(R.from)(e[o]())),Object(P.map)(r),Object(P.publish)());c.connect(),c.subscribe(t)}static setMapFn(e){return Object(s.compose)(Object(s.defaultTo)(e=>e),Object(s.prop)("mapFn"))(e)}static setUrl(e){let t=Object(s.prop)("url",e);return void 0===t&&console.warn("SPYNE WARNING: URL is undefined for data channel"),t}static setResponseType(e){return Object(s.defaultTo)("json",Object(s.prop)("responseType",e))}get mapFn(){return this._mapFn}get url(){return this._url}get serverOptions(){return this._serverOptions}get responseType(){return this._responseType}static stringifyBodyIfItExists(e){return Object(s.when)(Object(s.propIs)(Object,"body"),Object(s.compose)(Object(s.over)(Object(s.lensProp)("body"),JSON.stringify)))(e)}static updateMethodWhenBodyExists(e){const t=Object(s.has)("body"),r=Object(s.propEq)("method","GET"),n=Object(s.allPass)([t,r]);return Object(s.when)(n,Object(s.assoc)("method","POST"))(e)}static setServerOptions(e){let t=Object(s.pick)(["header","body","mode","method"],e),r=Object(s.mergeDeepRight)(_e.baseOptions(),t);return r=_e.updateMethodWhenBodyExists(r),r=_e.stringifyBodyIfItExists(r),r}static baseOptions(){return{method:"GET",headers:{Accept:"application/json, text/plain, */*"}}}}class Te extends ne{constructor(e,t={}){void 0!==t.map&&(t.mapFn=t.map),t.extendedActionsArr=[`${e}_DATA_EVENT`,[`${e}_UPDATE_DATA_EVENT`,"onFetchUpdate"]],t.sendCachedPayload=!0,super(e,t)}onRegistered(){this.startFetch()}addRegisteredActions(e){let t=Object(s.compose)(Object(s.defaultTo)([]),Object(s.path)(["props","extendedActionsArr"]));return["CHANNEL_DATA_EVENT",["CHANNEL_UPDATE_DATA_EVENT","onFetchUpdate"]].concat(t(this))}startFetch(e={},t=this.onFetchReturned.bind(this)){let r=this.consolidateAllFetchProps(e);return new _e(r,t)}onFetchUpdate(e){let t=this.getPropsForFetch(e);this.startFetch(t)}onFetchReturned(e){this.createChannelPayloadItem(e)}createChannelPayloadItem(e,t=`${this.props.name}_DATA_EVENT`){this.sendChannelPayload(t,e)}getPropsForFetch(e){let t=Object(s.path)(["viewStreamInfo","payload"],e);return Object(s.pick)(["mapFn","url","header","body","mode","method","responseType","debug"],t)}consolidateAllFetchProps(e,t=this.props){let r=Object(s.pick)(["mapFn","url","header","body","mode","method","responseType","debug"],t);const n=Object(s.reject)(s.isNil);return Object(s.compose)(n,(e,t)=>Object(s.mergeDeepRight)(e,t))(r,e)}get observer(){return this.observer$}}class ge{constructor(e={}){this.channels=new Oe,this.VERSION="0.14.10",
/*!
 * Spyne 0.14.10
 * https://spynejs.org
 *
 * @license Copyright 2017-2020, Frank Batista, Relevant Context, LLC. All rights reserved.
 * Spyne is licensed under the GNU Lesser General Public License v3.0
 *
 * @author: Frank Batista,
 * @email:  frbatista.nyc@gmail.com
*/
this.ViewStream=te,this.BasicView=H,this.DomEl=L,this.ViewStreamBroadcaster=q,this.ChannelsPayload=G,this.ChannelsController=Oe,this.ChannelsBase=ne,this.ChannelPayloadItem=S,window.Spyne=this;let t={scrollLock:!1,scrollLockX:31,scrollLockY:0,debug:!1,utils:{tableRE:/^([^>]*?)(<){1}(\b)(thead|col|colgroup|tbody|td|tfoot|tr|th)(\b)([^\0]*)$/},channels:{WINDOW:{mediqQueries:{},events:[],listenForResize:!0,listenForOrientation:!0,listenForScroll:!1,listenForMouseWheel:!1,debounceMSTimeForResize:200,debounceMSTimeForScroll:150},ROUTE:{type:"slash",isHash:!1,isHidden:!1,add404s:!1,routes:{routePath:{routeName:"change"}}}}};void 0!==e&&(e=ie.conformRouteObject(e),window.Spyne.config=C(t,e)),this.getChannelActions=e=>window.Spyne.channels.getChannelActions(e),this.registerChannel=e=>this.channels.registerStream(e),this.registerDataChannel=e=>this.channels.registerStream(e),this.listChannels=()=>Array.from(window.Spyne.channels.map.keys());let r=new te({id:"spyne-null-views"});r.appendToDom(document.body),r.props.el.style.cssText="display:none; opacity:0; pointer-events:none;",this.channels.init()}static listChannels(){return Array.from(window.Spyne.channels.map.keys())}static getChannelActions(e){return window.Spyne.channels.getChannelActions(e)}static registerChannel(e){if(void 0!==window.Spyne)return window.Spyne.channels.registerStream(e);console.warn("Spyne has not been initialized")}}window.Spyne=ge}])}));