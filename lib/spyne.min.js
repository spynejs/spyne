/*! For license information please see spyne.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs"),require("ramda"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("spyne",["rxjs","ramda","rxjs/operators"],t):"object"==typeof exports?exports.spyne=t(require("rxjs"),require("ramda"),require("rxjs/operators")):e.spyne=t(e.rxjs,e.R,e.rxjs.operators)}(self,(function(e,t,r){return(()=>{var s={360:(e,t,r)=>{e.exports=r(989)},989:e=>{e.exports=o;var t=Object.create,r=function(){throw new Error("Not implemented.")},s=function(){return this};function o(){}function n(e){this.value=e}function i(e){this.value=e}n.prototype=t(o.prototype),i.prototype=t(o.prototype),o.Failure=function(e){return new n(e)},o.prototype.Failure=o.Failure,o.Success=function(e){return new i(e)},o.prototype.Success=o.Success,o.fromNullable=function(e){return null!=e?new i(e):new n(e)},o.prototype.fromNullable=o.fromNullable,o.fromEither=function(e){return e.fold(o.Failure,o.Success)},o.prototype.isFailure=!1,n.prototype.isFailure=!0,o.prototype.isSuccess=!1,i.prototype.isSuccess=!0,o.of=function(e){return new i(e)},o.prototype.of=o.of,o.prototype.ap=r,n.prototype.ap=function(e){return e.isFailure?this.Failure(this.value.concat(e.value)):this},i.prototype.ap=function(e){return e.isFailure?e:e.map(this.value)},o.prototype.map=r,n.prototype.map=s,i.prototype.map=function(e){return this.of(e(this.value))},o.prototype.toString=r,n.prototype.toString=function(){return"Validation.Failure("+this.value+")"},i.prototype.toString=function(){return"Validation.Success("+this.value+")"},o.prototype.isEqual=r,n.prototype.isEqual=function(e){return e.isFailure&&e.value===this.value},i.prototype.isEqual=function(e){return e.isSuccess&&e.value===this.value},o.prototype.get=r,n.prototype.get=function(){throw new TypeError("Can't extract the value of a Failure(a).")},i.prototype.get=function(){return this.value},o.prototype.getOrElse=r,n.prototype.getOrElse=function(e){return e},i.prototype.getOrElse=function(e){return this.value},o.prototype.orElse=r,i.prototype.orElse=s,n.prototype.orElse=function(e){return e(this.value)},o.prototype.merge=function(){return this.value},o.prototype.fold=r,n.prototype.fold=function(e,t){return e(this.value)},i.prototype.fold=function(e,t){return t(this.value)},o.prototype.cata=r,n.prototype.cata=function(e){return e.Failure(this.value)},i.prototype.cata=function(e){return e.Success(this.value)},o.prototype.swap=r,n.prototype.swap=function(){return this.Success(this.value)},i.prototype.swap=function(){return this.Failure(this.value)},o.prototype.bimap=r,n.prototype.bimap=function(e,t){return this.Failure(e(this.value))},i.prototype.bimap=function(e,t){return this.Success(t(this.value))},o.prototype.failureMap=r,i.prototype.failureMap=s,n.prototype.failureMap=function(e){return this.Failure(e(this.value))},o.prototype.leftMap=o.prototype.failureMap,i.prototype.leftMap=i.prototype.failureMap,n.prototype.leftMap=n.prototype.failureMap},205:e=>{"use strict";e.exports=t},443:e=>{"use strict";e.exports=r},318:t=>{"use strict";t.exports=e}},o={};function n(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={exports:{}};return s[e](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";n.r(i),n.d(i,{Channel:()=>le,ChannelFetch:()=>ve,ChannelFetchUtil:()=>be,ChannelPayload:()=>f,ChannelPayloadFilter:()=>J,ChannelsDelegator:()=>fe,DomEl:()=>w,DomElTemplate:()=>e.DomElTemplate,DomElement:()=>L,SpyneApp:()=>Ie,SpynePlugin:()=>Oe,SpyneTrait:()=>Ce,ViewStream:()=>ie,ViewStreamBroadcaster:()=>G,ViewStreamElement:()=>H,ViewStreamPayload:()=>j,ViewStreamSelector:()=>oe,deepMerge:()=>O});var e={};n.r(e),n.d(e,{V:()=>I});var t=n(205);const r=e=>{if(void 0!==e.constructor.name)return e.constructor.name;let r=e.toString();return(0,t.defaultTo)(String(r).substr(0,12),(0,t.match)(/^(function\s)(\w+)(\(.*)$/,r)[2])},s=(e,r=[])=>{r=(0,t.concat)(["length","name","prototype","constructor"],r);let s=(0,t.compose)((0,t.without)(r),t.uniq),o=s(Object.getOwnPropertyNames(e.constructor.prototype)),n=s((i=e.constructor,Object.getOwnPropertyNames(i)));var i;return{methods:o,staticMethods:n,allMethods:(0,t.concat)(o,n)}},o=n(318),a=n(318);let c=()=>({includes:()=>void 0!==window.Spyne?(e=>{let r=[];return(0,t.forEach)(((e,t,s)=>r.push(t)),e),r})(window.Spyne.channels.map):["CHANNEL_ROUTE","CHANNEL_UI","CHANNEL_WINDOW","DISPATCHER"]}),l=["LOAD","RENDER","MOUNT","UNMOUNT","DISPOSE","GARBAGE_COLLECT","UPDATE"],p=["parent","self","child","children","view"],d=["Observable","BehaviorSubject","Subject","Observer","Subscriber","FromEventObservable"],h=["subscribe","combineLatest"],u=[],E=[],m=[],N=null,g=null,_=null,y=null,S=null,T=null;if(void 0!==t.compose&&void 0!==o){u=[{error:`need to match a valid name within ${d}`,predicate:e=>c().includes(e.name)},{error:"param 'observable' must contain a valid Observable",predicate:e=>void 0!==e.observable.subscribe},{error:"param action must be a registered action",predicate:e=>h.includes(e.action)}],E=[{error:"needs vsid number in srcElement",predicate:(0,t.compose)((0,t.is)(String),(0,t.path)(["data","srcElement","vsid"]))},{error:"needs a id in srcElement",predicate:(0,t.compose)((0,t.is)(String),(0,t.path)(["data","srcElement","id"]))}],m=function(){return[].concat(u).concat(E)};let e=[{error:`need to match a valid name within ${d}`,predicate:e=>c().includes(e.name)},{error:`needs one of the following step strings: ${l}`,predicate:e=>l.includes(e.STEP)},{error:`type needs to one of the following: ${p}`,predicate:e=>p.includes(e.type)},{error:"viewId needs to be added ",predicate:e=>void 0!==e.viewId}];g=function(){return[].concat(e)},_=function(){return[{error:"DISPOSE STEP requires a disposeItem param in the data object",predicate:e=>"DISPOSE"===e.STEP&&void 0!==e.data.disposeItems}].concat(e)},y=function(){return[{error:"UPDATE STEP requires a data object ",predicate:e=>"UPDATE"===e.STEP&&void 0!==e.data}].concat(e)},N=function(){return e.concat(u).concat(E)},S=function(){return[].concat(u).concat(E)},T=function(){let e=[{error:"param 'name' must be of a registered type",predicate:e=>c().includes(e.name)},{error:"param 'observable' must contain a valid Observable",predicate:e=>d.includes((0,e.observable)().constructor.name)},{error:"param action must be a registered action",predicate:e=>h.includes(e.action)}];return{streams:[{init:{name:"DISPATCHER",observable:()=>new a,action:"subscribe"},structure:{type:String,observable:o||a,action:String},validations:e},{init:{name:"UBU",observable:()=>new a,action:"subscribe"},structure:{type:String,observable:o||a,action:String},validations:e}]}}}class f{constructor(e,r,s,o,n,i){let a=e;i&&console.time(i);let c={channelName:e,action:r,srcElement:o,event:n};if(c.payload=f.deepFreeze(s),!0===(0,t.pathEq)(["Spyne","config","debug"],!0)(window)&&s.hasOwnProperty("payload")){let e=JSON.stringify(s);console.warn(`Spyne Warning: the following payload contains a nested payload property which may create conflicts: Action: ${r}, ${e}`)}c.props=()=>(0,t.clone)((0,t.mergeAll)([{payload:f.deepClone(c.payload)},c.payload,{channel:a},{event:n},c.srcElement,{action:c.action}]));const l=window.Spyne.getChannelActions(a);return f.validateAction(r,a,l),"CHANNEL_ROUTE"===a&&(c.location=f.getLocationData()),c._dir=void 0,Object.defineProperties(c,{$dir:{get:()=>c._dir,set:e=>c._dir=e}}),i&&console.timeEnd(i),c}static validateAction(e,r,s){let o=(0,t.includes)(e,s);return!1===o&&void 0!==window.Spyne&&console.warn(`warning: Action: '${e}' is not registered within the ${r} channel!`),o}static getLocationData(){return(0,t.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getStreamItem(){}static deepClone(e){const r=(0,t.is)(Array),s=(0,t.is)(Object);var o;return!1===r(o=e)&&!0===s(o)?(0,t.compose)(t.fromPairs,t.toPairs,t.clone)(e):(0,t.clone)(e)}static deepFreeze(e){const r=(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"));try{Object.freeze(e),Object.getOwnPropertyNames(e).forEach((function(t){!e.hasOwnProperty(t)||!1!==r(e[t])||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||f.deepFreeze(e[t])}))}catch(t){return e}return e}static getMouseEventKeys(){return["altKey","bubbles","cancelBubble","cancelable","clientX","clientY","composed","ctrlKey","currentTarget","defaultPrevented","detail","eventPhase","fromElement","isTrusted","layerX","layerY","metaKey","movementX","movementY","offsetX","offsetY","pageX","pageY","path","relatedTarget","returnValue","screenX","screenY","shiftKey","sourceCapabilities","srcElement","target","timeStamp","toElement","type","view","which","x","y"]}}function A(){return{createpropsMap:function(){let e=new WeakMap,t={vsid:this.props.vsid};return e.set(t,this.props),{key:t,weakMap:e}},gc:function(){for(let e in this)delete this[e]},createId:function(){return Math.random().toString(36).replace(/\d/gm,"").substring(1,8)},setTraceFunc:function(e){return!0===e?console.log:()=>{}}}}function C(e){return e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function b(e,t){return t&&!0===t.clone&&C(e)?O((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function v(e,t,r){let s=e.slice();return t.forEach((function(t,o){void 0===s[o]?s[o]=b(t,r):C(t)?s[o]=O(e[o],t,r):-1===e.indexOf(t)&&s.push(b(t,r))})),s}function O(e,t,r){let s=Array.isArray(t),o=(r||{arrayMerge:v}).arrayMerge||v;return s?Array.isArray(e)?o(e,t,r):b(t,r):function(e,t,r){let s={};return C(e)&&Object.keys(e).forEach((function(t){s[t]=b(e[t],r)})),Object.keys(t).forEach((function(o){C(t[o])&&e[o]?s[o]=O(e[o],t[o],r):s[o]=b(t[o],r)})),s}(e,t,r)}O.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce((function(e,r){return O(e,r,t)}))};class I{constructor(e,r){this.template=this.formatTemplate(e);const s=`template-${Math.floor(99999*Math.random())}`;this.tempL=s,(()=>{!0===(0,t.is)(Array,r)&&(r={spyneData:r},this.template=this.template.replace("{{/}}","{{/spyneData}}"),this.template=this.template.replace("{{#}}","{{#spyneData}}"))})(),this.templateData=r;let o=I.getStringArray(this.template),n=this.template.match(I.findTmplLoopsRE());n=null===n?[]:n;const i=(0,t.includes)(t.__,n),a=(0,t.ifElse)(i,((e,t)=>e.replace(I.parseTmplLoopsRE(),this.parseTheTmplLoop.bind(this))),this.addParams.bind(this));this.finalArr=o.map(a)}static getStringArray(e){let r=e.split(I.findTmplLoopsRE());const s=/^([\\n\s\W]+)$/;return(0,t.reject)((e=>e.match(s)),r)}static findTmplLoopsRE(){return/({{#\w+}}[\w\n\s\W]+?{{\/\w+}})/gm}static parseTmplLoopsRE(){return/({{#(\w+)}})([\w\n\s\W]+?)({{\/\2}})/gm}static swapParamsForTagsRE(){return/({{)(.*?)(}})/gm}removeThis(){this.finalArr=void 0,this.templateData=void 0,this.template=void 0}renderDocFrag(){const e=this.finalArr.join(""),t=/^([^>]*?)(<){1}(\b)(thead|col|colgroup|tbody|td|tfoot|tr|th)(\b)([^\0]*)$/.test(e)?e:document.createRange().createContextualFragment(e);return window.setTimeout(this.removeThis(),2),t}renderToString(){const e=this.finalArr.join("");return window.setTimeout(this.removeThis(),2),e}getTemplateString(){return this.finalArr.join("")}formatTemplate(e){return"SCRIPT"===(0,t.prop)("nodeName",e)?e.innerHTML:e}addParams(e){return e.replace(I.swapParamsForTagsRE(),((e,r,s,o)=>{if((0,t.is)(String,s)&&String(s).indexOf(".")<0&&void 0!==this.templateData[s])return this.templateData[s];let n=(0,t.compose)((0,t.path)(t.__,this.templateData),(0,t.split)("."))(s);return(0,t.defaultTo)("")(n)}))}parseTheTmplLoop(e,r,s,o){const n=o;let i=this.templateData[s];return!0===(0,t.isNil)(i)||(0,t.isEmpty)(i)?"":(void 0===i.length&&(i=[i]),i.map((e=>"string"==typeof e?((e,t)=>t.replace(I.swapParamsForTagsRE(),e))(e,n):((e,r)=>r.replace(I.swapParamsForTagsRE(),((r,s,o)=>(0,t.is)(String,o)&&String(o).indexOf(".")<0&&void 0!==e[o]?e[o]:(0,t.compose)((0,t.path)(t.__,e),(0,t.split)("."))(o))))(e,n))).join(""))}}class L{constructor(e={}){var r;e.tagName=("div",r=e.tagName,(0,t.defaultTo)("div")(r)),e.attributes=void 0!==e.attributes?e.attributes:this.getDomAttributes(e),e.attrs=this.updateAttrs(e.attributes),e.fragment=document.createDocumentFragment(),this.props=e,this.addMixins()}setProp(e,t){this.props[e]=t}getProp(e){return this.props[e]}get el(){return this.props.el}setElAttrs(e,r){return this.getProp("attrs").forEach(((r,s)=>{"dataset"===s?(0,t.forEachObjIndexed)(((t,r)=>{e.dataset[r]=t}),r):e.setAttribute(s,r)})),e}updateAttrs(e,r){let s=void 0!==r?r:new Map;return(0,t.mapObjIndexed)(((e,t)=>s.set(t,e)),e),s}addTemplate(e){let r=this.getProp("template");return void 0!==r?(r=>{let s=this.getProp("data");s=(0,t.is)(Object,s)?s:{};let o=new I(r,s).renderDocFrag();return(0,t.is)(String,o)?e.innerHTML=o:e.appendChild(o),e})(r):e}createElement(e="div"){return document.createElement(e)}addContent(e){let r=this.getProp("data");if(!0===(0,t.is)(String,r)){let t=document.createTextNode(r);e.appendChild(t)}return e}execute(){let e=(0,t.pipe)(this.createElement.bind(this),this.setElAttrs.bind(this),this.addTemplate.bind(this),this.addContent.bind(this))(this.getProp("tagName"));this.props.el=e}render(){return this.execute(),this.props.template=void 0,this.props.data=void 0,this.props.attributes=void 0,this.getProp("el")}renderToHTMLString(){return this.execute(),this.props.template=void 0,this.props.data=void 0,this.props.attributes=void 0,this.getProp("el").outerHTML}returnIfDefined(e,t){if(void 0!==t){let r=void 0===t;e[t]=!1===r?t:O(e[t],t)}}updateprops(e){return this.returnIfDefined(this.props,e),this}updatepropsAndRun(e){return this.updateprops(e),this.execute(),this.getProp("fragment")}unmount(){void 0!==this.props&&(this.getProp("el").remove(),this.props=void 0,this.gc())}updateTag(e="div"){this.updateprops(e)}updateAttributes(e={}){this.updateprops(e)}updateTemplate(e){this.updateprops(e)}updateData(e={}){this.updateprops(e)}addTagAndRender(e="div"){this.updatepropsAndRun(e)}addAttrsibutesAndRender(e={}){this.updatepropsAndRun(e)}addTemplateAndRender(e){this.updatepropsAndRun(e)}addDataAndRender(e={}){this.updatepropsAndRun(e)}addMixins(){let e=A();this.gc=e.gc.bind(this)}getDomAttributes(e){return(0,t.pick)(this.attributesArray,e)}get attributesArray(){return["accept","accept-charset","accesskey","action","align","allow","alt","async","autocapitalize","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","dataset","datetime","decoding","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","importance","integrity","ismap","itemprop","keytype","kind","label","lang","language","lazyload","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","referrerpolicy","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","value","width","wrap"]}}const w=L;let D=(e=!1,t=1,r="ease",s=!1)=>`${!0===s?"opacity:0;":""}transition: opacity ${t}s ${r}; opacity: ${!0===e?1:0};`;var R=n(318),P=n(443);class V{constructor(e){this.props.observableStreams=V.createDirectionalObservables()}static createDirectionalFiltersObject(){const e="internal",t="parent",r="child";return{P:[t],C:[r],PCI:[t,e,r],CI:[r,e],PI:[t,e],PC:[t,r]}}static addDefaultDir(e){return(0,t.flip)(t.mergeRight)({$dir:["internal"]},(0,t.clone)(e))}static addDownInternalDir(e,r=["internal","down"]){return(0,t.flip)(t.mergeRight)((0,t.clone)(e),{$dir:r})}static addChildAndInternalDir(e,r=["child","down"]){return(0,t.flip)(t.mergeRight)((0,t.clone)(e),{$dir:r})}static mapToDefaultDir(e){return this.addDefaultDir(e)}static createDirectionalObservables(e=new R.Subject,r,s){void 0!==r&&void 0!==s&&(e.viewName=r,e.vsid=s);const o=e=>(0,t.propSatisfies)((t=>t.includes(e)),"$dir"),n=o("parent"),i=o("child"),a=o("internal"),c=e=>(0,t.mergeRight)({from$:e}),l=c("child"),p=c("internal"),d=c("parent"),h=e.pipe((0,P.filter)((e=>void 0!==e&&void 0!==e.action))),u=e.pipe((0,P.filter)(a),(0,P.map)(p)),E=e.pipe((0,P.filter)(n),(0,P.map)(l)),m=e.pipe((0,P.filter)(i),(0,P.map)(d)),N={parent:E,internal:u,child:m};return{raw$:h,toInternal$:u,toParent$:E,toChild$:m,completeAll:()=>{(0,t.forEach)((e=>{e.complete(),e.isStopped=!0}),[h,u,E,m])},completeStream:(e=[])=>{void 0!==e&&e.length>=1&&e.forEach((e=>{var t;void 0!==N[e]&&((t=N[e]).complete(),t.isStopped=!0)}))}}}}class H{constructor(e,t={},r="",s="theName"){this.addMixins(),this._state="INIT",this.vsid=r,this.vsName=s,this.defaults={debug:!1,extendedHashMethods:{}},this.options=O(this.defaults,t),this.addActionListeners().forEach((e=>{let[t,r]=e;this.options.extendedHashMethods[t]=e=>this[r](e)})),this.options.hashMethods=this.setHashMethods(this.options.extendedHashMethods),this.sink$=e,this.sink$.subscribe(this.onObsSinkSubscribe.bind(this)),this.$dirs=V.createDirectionalFiltersObject(),this.addDefaultDir=V.addDefaultDir,this.sourceStreams=V.createDirectionalObservables(new R.Subject,this.vsName,this.vsid),this._source$=this.sourceStreams.toInternal$}addActionListeners(){return[]}setHashMethods(e={}){return O({VS_DETRITUS_COLLECT:e=>this.onGarbageCollect(e),READY_FOR_VS_DETRITUS_COLLECT:e=>this.onReadyForGC(e),EXTIRPATE:e=>this.onDispose(e),VS_SPAWN:e=>this.onRender(e),VS_SPAWN_AND_ATTACH_TO_PARENT:e=>this.onRenderAndAttachToParent(e),VS_SPAWN_AND_ATTACH_TO_DOM:e=>this.onRenderAndAttachToDom(e),ATTACH_CHILD_TO_SELF:e=>this.onAttachChildToSelf(e)},e)}createDomItem(){this.props=void 0!==this.props?this.props:{};let e=(0,t.filter)((e=>void 0!==e),(0,t.pick)(["id","className"],this.props)),{tagName:r,data:s,template:o}=this.props;return new L(r,e,s,o)}onDisposeCompleted(e){}animateInTween(e,t){!function(e,t){let r=1*window.getComputedStyle(e).opacity,s=D(!0,t,"ease",1===r);e.style.cssText+=s}(e,t)}animateOutTween(e,t,r){!function(e,t,r){let s=D(!1,t,"ease");e.style.cssText+=s,e.addEventListener("transitionend",r,!1)}(e,t,r)}setAnimateIn(e){if(!0===e.animateIn){let t=void 0!==e.el?e.el:this.domItem.el;this.animateInTween(t,e.animateInTime)}}disposeMethod(e){let t=void 0!==e.el.el?e.el.el:e.el;const r={action:"READY_FOR_VS_DETRITUS_COLLECT",$dir:this.$dirs.PI,el:t};let s=(0,R.bindCallback)(((e,r)=>{this.animateOutTween(t,e.animateOutTime,r)})),o=e=>{this._source$.next(r)};return(!0===e.animateOut?e=>(s(e).subscribe(o),{action:"EXTIRPATING",$dir:this.$dirs.CI}):()=>({action:"EXTIRPATE_AND_READY_FOR_VS_DETRITUS_COLLECT",$dir:this.$dirs.CI}))(e)}onDispose(e){return this.disposeMethod(e)}removeStream(){void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["internal","child"])}onReadyForGC(e){this.removeStream()}onGarbageCollect(e){void 0!==this.domItem&&this.domItem.unmount(),void 0!==this.sourceStreams&&this.sourceStreams.completeStream(["parent"])}getSourceStream(){return this._source$}combineDomItems(e){let r=(0,t.isNil)(e.query)?e.node:e.query;("appendChild"===e.attachType?(e,t)=>e.appendChild(t):(e,t)=>e.insertBefore(t,e.firstChild))(r,this.domItem.render()),this.setAnimateIn(e)}onAttachChildToSelf(e){let t=e.childRenderData;return this.combineDomItems(t),{action:"CHILD_ATTACHED",$dir:this.$dirs.PI}}onRenderAndAttachToParent(e){return this.onRender(e),this.combineDomItems(e),{action:"VS_SPAWNED_AND_ATTACHED_TO_PARENT",el:this.domItem.el,$dir:this.$dirs.PI}}renderDomItem(e){let t,r,s,o;return[t,r,s,o]=e,this.domItem=new L({tagName:t,attributes:r,data:s,template:o}),this.domItem}onRender(e){return{action:"VS_SPAWNED",el:(e=>this.renderDomItem(e))((0,t.props)(["tagName","domAttributes","data","template"],e)),$dir:this.$dirs.I}}extendedMethods(e){}onRenderAndAttachToDom(e){return e.attachData.el=(e=>this.renderDomItem(e))((0,t.props)(["tagName","domAttributes","data","template"],e)),this.combineDomItems(e.attachData),{action:"VS_SPAWNED_AND_ATTACHED_TO_DOM",el:e.attachData.el.el,$dir:this.$dirs.CI}}onObsSinkSubscribe(e){let r=e.action,s=(0,t.defaultTo)((e=>this.extendedMethods(e)))(this.options.hashMethods[r])(e);void 0!==s&&(e=>{this._source$.next(e)})(Object.freeze(s))}addMixins(){}}class M{constructor(e,t){this.context=e,this.enhancersMap=new Map,this.enhancersArr=t,this.initMap(),this.addAllEnhancerMethods()}initMap(){this.enhancersMap.set("ALL",[]);let e=s(this.context).allMethods;this.updateMap("LOCAL",e)}getEnhancersMap(){return this.enhancersMap}updateMap(e,r){let s=(0,t.concat)(this.enhancersMap.get("ALL"),r);this.enhancersMap.set(e,r),this.enhancersMap.set("ALL",s)}getMethodsArr(e){return this.enhancersMap.get(e)}createEnhancerMethodsObj(e){const r=e=>console.error(`Spyne Error: The following enhancer method, "${e}", already exists and cannot be added to the ${s.name} Enhancer!`);let s=new e(this.context),o=s.getEnhancerMethods(),n=(e=>{let s=(0,t.includes)(t.__,this.getMethodsArr("ALL")),o=(0,t.filter)(s,e);return o.forEach(r),o})(o.allMethods),i=(0,t.dropWhile)((0,t.includes)(t.__,n));return o=(0,t.map)(i,o),this.updateMap(s.name,o.allMethods),o.enhancer=s,o.name=s.name,o}addAllEnhancerMethods(){(0,t.forEach)((e=>{let t=this.createEnhancerMethodsObj(e);t.enhancer.bindParentViewStream(t,this.context)}),this.enhancersArr)}}var F=n(360),W=n.n(F);const $=W().Success,U=W().Failure;let k=()=>{};function x(){setTimeout((()=>{(0,t.forEach)((e=>{}),this)}),1)}void 0!==t.curry&&(k=(0,t.curry)(((e,r)=>{const s=$((0,t.curryN)((0,t.length)(e),(0,t.always)(r)));return(0,t.reduce)(((e,t)=>e.ap(t.predicate(r)?$(r):U([t.error]))),s,e)})));class j{constructor(e,t,r,s="subscribe",o=!1){this.addMixins(),this.options={name:e,observable:t,data:r,action:s},this.getValidationChecks(e)}getValidationChecks(e){return!0===window.Spyne.channels.map.has(e)?(e=>this.onRunValidations(e))(m):("payload Needs a Valid Stream Name!",console.warn("payload Needs a Valid Stream Name!"))}onRunValidations(e){k(e(),this.options).fold(this.onError.bind(this),this.onSuccess.bind(this))}onPayloadValidated(e){this.sendToDirectorStream(e)}sendToDirectorStream(e){window.Spyne.channels.getStream("DISPATCHER").next(e),this.gc()}onError(e){console.warn("payload failed due to:\n"+e.map((e=>"* "+e)).join("\n")),this.gc()}onSuccess(e){this.onPayloadValidated(e)}addMixins(){this.gc=x}}class G{constructor(e,t){this.addMixins(),this.props=e,this.broadcastFn=t,this.broadcaster(this.broadcastFn)}addDblClickEvt(e){return(0,R.fromEvent)(e,"dblclick").pipe((0,P.map)((e=>{let r=(0,t.clone)(e);return r.typeOverRide="dblclick",r})))}broadcast(e){let r,s={UI:this.sendUIPayload,ROUTE:this.sendRoutePayload},[o,n,i]=e,a=this.props.el.querySelectorAll(o);if(a.length<=0){let e=this.props.el;const t=t=>{t===e&&(a=[t])};(()=>{let r=(null!==e.parentElement?e.parentElement:document).querySelectorAll(o);r.forEach=Array.prototype.forEach,r.forEach(t)})()}let c=void 0!==i,l=!0===(0,t.path)(["Spyne","config","debug"],window);!0==(void 0===a||a.length<=0)&&!0===l?console.warn(`Spyne Warning: The item ${o}, does not appear to exist!`):(a.forEach=Array.prototype.forEach,a.forEach((e=>{let o="dblClick"!==n?(0,R.fromEvent)(e,n,{preventDefault:()=>!0}):this.addDblClickEvt(e);r=e.dataset.channel;let i={};i.payload=(e=>{let t={};for(let r in e)t[r]=e[r];return t})(e.dataset),i.payload=(0,t.omit)(["channel"],i.payload),i.channel=r,i.srcElement={},i.srcElement.id=this.props.id,i.srcElement.vsid=this.props.vsid,i.srcElement.isLocalEvent=c,i.srcElement.srcEvent=n,i.srcElement.el=e,(void 0!==r?s[r]:s.UI)(o,i)})))}broadcaster(e){e().forEach((e=>this.broadcast(e)))}addMixins(){let e=function(e,t){return new j("CHANNEL_ROUTE",e,t,"subscribe")},t=function(e,t){return new j("CHANNEL_UI",e,t,"subscribe")};this.sendUIPayload=t,this.sendRoutePayload=e}}const q=n(205).map,Y=(0,t.compose)(t.not,(0,t.is)(Array)),B=(0,t.compose)(t.not,t.isEmpty),z=(0,t.allPass)([(0,t.is)(String),B]),K=(0,t.allPass)([(0,t.is)(Array),B]),Q=(0,t.compose)((0,t.allPass)([Y,(0,t.is)(Object)])),X=(0,t.compose)((0,t.allPass)([B,Y,(0,t.is)(Object)]));class J{constructor(e,r={},s,o){Q(e)&&(r=e,e=(0,t.prop)("selector",r),o=o||(0,t.prop)("testMode",r));const n=[s,(0,t.prop)("debugLabel",r)];s=(0,t.compose)((0,t.find)((0,t.is)(String)))(n);let i=(0,t.omit)(["debugLabel","label","selector","props","testMode","propFilters"],r);void 0!==r.props?i=(0,t.mergeAll)([r.props,i]):void 0!==r.propFilters&&(i=(0,t.mergeAll)([r.propFilters,i])),r.propFilters=i;let{propFilters:a}=r;const c=z(e)?J.filterSelector([e],s):void 0,l=K(e)?J.filterSelector(e,s):void 0,p=X(a)?J.filterData(a,s):void 0;let d=(0,t.reject)(t.isNil,[c,l,p]);const h=(0,t.isEmpty)(d);return h&&(d=[(0,t.always)(!1)],!0===(0,t.path)(["Spyne","config","debug"],window)&&!0!==o&&console.warn(`Spyne Warning: The Channel Filter, with selector: ${e}, and propFilters:${a} appears to be empty!`)),!0===o?{selector:e,propFilters:a,debugLabel:s,filters:r,testMode:o,filtersAreEmpty:h}:(0,t.allPass)(d)}static filterData(e,r){const s=r;return(()=>{if((0,t.isEmpty)(e))return(0,t.always)(!1);e=q(((e,r,s)=>{return!0===(0,t.is)(String,e)?(o=e,e=>e===o):e;var o}),e);let r=(0,t.where)(e);return(0,t.compose)(r,(r=>{if(void 0===s)return r;const o={};return(0,t.forEachObjIndexed)(((e,s)=>o[s]=e((0,t.prop)(s,r))),e),console.log(`%c CHANNEL PAYLOAD FILTER DEBUGGER ["${s}"] - values:    `,"color:orange;",{propsBooleans:o,comparedObj:r}),r}),(0,t.defaultTo)({}),(e=>{const{payload:t,srcElement:r,event:s}=e||{};return Object.assign({},e,s,r,t)}))})()}static checkPayloadSelector(e,r,s){const{payload:o,srcElement:n,event:i}=s||{},a=[n,o,(0,t.prop)("srcElement",i),s].reduce(((e,r)=>{const s=(0,t.prop)("el",r);return J.elIsDomElement(s)&&void 0===e&&(e=s),e}),void 0),c=e=>e.isEqualNode(a),l=e=>{let r=(0,t.flatten)(document.querySelectorAll(e));return q(c,r)};if(void 0!==r){let s=(0,t.compose)(t.flatten,q(l))(e);const o=e;console.log(`%c CHANNEL PAYLOAD FILTER DEBUGGER ["${r}"] - selectors: `,"color:orange;",{el:a,selectorsArr:o,nodeArrResultsDebugger:s})}if("object"!=typeof a)return!1;let p=(0,t.compose)(t.flatten,q(l))(e);return!0!==(0,t.isEmpty)(p)&&(0,t.any)((0,t.equals)(!0),p)}static elIsDomElement(e){return(0,t.is)(String,e)&&(e=document.querySelector(e)),(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"))(e)}static filterSelector(e,r){let s=(0,t.reject)(t.isEmpty,e);return(0,t.curry)(J.checkPayloadSelector)(s,r)}}function Z(){return!0===(0,t.path)(["Spyne","config","debug"],window)}function ee(e,r,s=!1){let o=re(e,r,s);return 1===o.length?(0,t.head)(o):o}function te(e,r,s){let o=document.querySelector(e);!1!==(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"))(o)?void 0!==r&&null===o.querySelector(r)&&!0===Z()&&!0===s&&console.warn(`Spyne Warning: the selector, ${r} does not exist in this el, ${e}`):console.warn(`Spyne Warning: the el object is not a valid single element, ${o}`)}function re(e,t,r=!1){let s=void 0!==t?`${e} ${t}`:e;return!0===r&&te(e,t,r),(e=>{try{document.querySelectorAll(e)}catch(e){return[]}return document.querySelectorAll(e)})(s)}function se(e,t,r){return re(t,r).forEach((t=>{t.style.cssText=e})),this}function oe(e,r){function s(t){return oe(e,t)}return te(e="string"==typeof e?e:function(e){let t=`${Math.random().toString(36).replace(/\d/gm,"").substring(1,8)}`;return void 0===e.dataset.vsid?e.dataset.vsid=t:t=e.dataset.vsid,`[data-vsid='${t}']`}(e),r,!1),s.map=t=>Array.from(re(e,r)).map(t),s.forEach=t=>Array.from(re(e,r)).map(t),s.getNodeListArray=()=>re(e,r),s.addClass=t=>(re(e,r).forEach((e=>e.classList.add(t))),this),s.removeClass=t=>(re(e,r).forEach((e=>{e.classList.remove(t)})),this),s.setClass=s=>(re(e,r).forEach((e=>{let r=(0,t.compose)((0,t.reject)(t.isEmpty),(0,t.split)(" "))(e.className),o=s.split(" ");r.forEach((t=>e.classList.remove(t))),o.forEach((t=>e.classList.add(t)))})),this),s.unmount=()=>{},s.toggleClass=(t,s)=>(re(e,r).forEach((e=>{(s=void 0!==s?s:!e.classList.contains(t))?e.classList.add(t):e.classList.remove(t)})),this),s.toggle=(e,t)=>(s.toggleClass(e,t),this),s.appendChild=e=>(0!==s.el.length?s.el.appendChild(e):console.warn(`Spyne Warning: The selector, ${r} does not appear to be valid!`),s.el),s.addAnimClass=t=>{window.setTimeout((()=>{re(e,r).forEach((e=>e.classList.add(t)))}),1)},s.setActiveItem=(s,o)=>{let n=re(e,r),i="string"==typeof o?ee(e,o):o;var a;return!0===(a=i,(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"))(a))?n.forEach((e=>e.isEqualNode(i)?e.classList.add(s):e.classList.remove(s))):!0===Z()&&console.warn(`Spyne Warning: The selector, ${o}, does not appear to be a valid item in setActiveItem: ${s}`),this},Object.defineProperty(s,"el",{get:()=>ee(e,r,!0)}),Object.defineProperty(s,"els",{get:()=>re(e,r)}),Object.defineProperty(s,"len",{get:()=>re(e,r,!1).length}),Object.defineProperty(s,"exists",{get:()=>re(e,r,!1).length>=1}),Object.defineProperty(s,"exist",{get:()=>re(e,r,!1).length>=1}),Object.defineProperty(s,"nodeList",{get:()=>re(e,r)}),Object.defineProperty(s,"arr",{get:()=>{let t=ee(e,r,!0);return void 0===t?[]:void 0===t.length?[t]:Array.from(t)}}),Object.defineProperty(s,"inline",{set:t=>se(t,e,r)}),Object.defineProperty(s,"inlineCss",{set:t=>se(t,e,r)}),s}const ne=n(205).map;class ie{constructor(e={}){this.vsnum=Math.random(),this.addMixins(),this.defaults=()=>{const t=this.createId(),s=e.id?e.id:t;return{vsid:t,id:s,tagName:"div",el:void 0,data:void 0,animateIn:!1,animateInTime:.5,animateOut:!1,animateOutTime:.5,sendLifecyleEvents:!1,hashId:`#${s}`,id$:`#${s}`,viewClass:H,extendedSourcesHashMethods:{},debug:!1,template:void 0,node:document.createDocumentFragment(),name:r(this)}},this._state={},this.$dirs=V.createDirectionalFiltersObject(),this.addDefaultDirection=V.addDefaultDir,this.addDownInternalDir=V.addDownInternalDir,this.props=O(this.defaults(),e),this.sendLifecycleMethod=!0===this.props.sendLifecyleEvents?this.sendLifecycleMethodActive.bind(this):this.sendLifecycleMethodInactive.bind(this);let s=this.attributesArray;this.props.domAttributes=(0,t.pick)(s,this.props),void 0!==this.props.traits&&this.addTraits(this.props.traits),this.loadEnhancers(),this.loadAllMethods(),this.props.action="LOADED",this.sink$=new R.Subject;const o=this.props.viewClass;this.view=new o(this.sink$,{},this.props.vsid,this.props.id),this.sourceStreams=this.view.sourceStreams,this._rawSource$=this.view.getSourceStream(),this._rawSource$.viewName=this.props.name,this.sendEventsDownStream=this.sendEventsDownStreamFn,this.initViewStream(),this.isDevMode=ie.isDevMode(),this.props.addedChannels=[],this.checkIfElementAlreadyExists()}updatePropsToMatchEl(){const e=(0,t.compose)(t.toLower,(0,t.either)((0,t.prop)("tagName"),(0,t.always)("")));this.props.tagName=e(this.props.el)}checkIfElementAlreadyExists(){const e=(0,t.compose)((0,t.lte)(0),(0,t.defaultTo)(-1),(0,t.prop)("nodeType"));(0,t.propSatisfies)((0,t.allPass)([e=>document.body.contains(e),e]),"el")(this.props)&&(this.updatePropsToMatchEl(),this.postRender())}loadEnhancers(e=[]){let t=new M(this,e);this.props.enhancersMap=t.getEnhancersMap(),t=void 0}loadAllMethods(){const e=(0,t.curry)(this.onChannelMethodCall.bind(this));this.addActionListeners().forEach((r=>{let[s,o,n]=r;(0,t.is)(String,n)&&(n=new J({selector:n})),this.props.extendedSourcesHashMethods[s]=e(o,n)})),this.props.hashSourceMethods=this.setSourceHashMethods(this.props.extendedSourcesHashMethods)}addActionListeners(){return[]}onChannelMethodCall(e,r,s){if(void 0!==s.$dir&&s.$dir.includes("child")&&!0!==this.deleted){let e=O({},s);e.$dir=this.$dirs.C,this.sourceStreams.raw$.next(e)}let o=(0,t.defaultTo)((0,t.always)(!0),r);Math.floor(999999*Math.random()),!0===o(s)&&(t=>{void 0===this[e]?console.warn(`Spyne Warning: The method, ${e} does not appear to exist in ${this.constructor.name}!`):this[e](t)})(s=(0,t.omit)(["$dir"],s))}setSourceHashMethods(e={}){let t={EXTIRPATING:e=>this.checkParentDispose(e),EXTIRPATE:e=>this.disposeViewStream(e),VS_SPAWNED:e=>this.onVSRendered(e),VS_SPAWNED_AND_ATTACHED_TO_DOM:e=>this.onVSRendered(e),VS_SPAWNED_AND_ATTACHED_TO_PARENT:e=>this.onVSRendered(e),READY_FOR_VS_DETRITUS_COLLECT:e=>this.onReadyToGC(e),VS_NULLITY:()=>({})};return O.all([{},t,e])}initViewStream(){this._source$=this._rawSource$.pipe((0,P.map)((e=>this.onMapViewSource(e))),(0,P.takeWhile)(this.notGCSTATE)),this.initAutoMergeSourceStreams(),this.updateSourceSubscription(this._source$,!0)}notGCSTATE(e){return!e.action.includes("READY_FOR_VS_DETRITUS_COLLECT")}eqGCSTATE(e){return!e.action.includes("READY_FOR_VS_DETRITUS_COLLECT")}notCOMPLETED(e){return!e.action.includes("COMPLETED")}notGCCOMPLETE(e){return!e.action.includes("GC_COMPLETE")}testVal(e){console.log("TESTING VALL IS ",e)}addParentStream(e,t){this.parent$=e.pipe((0,P.filter)((e=>void 0!==e&&void 0!==e.action)),(0,P.map)((e=>{let t=O({},e);return"EXTIRPATE_AND_READY_FOR_VS_DETRITUS_COLLECT"===t.action&&(this.disposeViewStream(t),t.action="READY_FOR_VS_DETRITUS_COLLECT"),t}))),this.updateSourceSubscription(this.parent$,!1,"PARENT"),this.renderAndAttachToParent(t)}addChildStream(e){let t=e.pipe((0,P.filter)((e=>void 0!==e&&void 0!==e.action)),(0,P.tap)((e=>this.tracer("addChildStraem do ",e))),(0,P.map)((e=>e)),(0,P.finalize)((e=>this.onChildCompleted(t.source))));this.updateSourceSubscription(t,!0,"CHILD")}onChildDisposed(e){}onChildCompleted(e){let r=(e=>{let r=e=>{for(;void 0!==e.destination;)e=r(e.destination);return e};return(0,t.pick)(["id","vsid"],r(e))})(e);return this.tracer("onChildCompleted ",this.vsnum,e),this.onChildDisposed(r,e),r}static removeDataFromTmpDir(e){void 0!==(0,t.path)(["Spyne","config","tmp"],window)[e]&&delete window.Spyne.config.tmp[e]}initAutoMergeSourceStreams(){let e={next:this.onSubscribeToSourcesNext.bind(this),error:this.onSubscribeToSourcesError.bind(this),complete:this.onSubscribeToSourcesComplete.bind(this)},t=()=>{this.props.el$=void 0,this.uberSource$.complete(),this.autoSubscriber$.complete(),this.sink$.complete(),this.props=void 0,this.deleted=!0,this.tracer("completeAll",this.deleted,this.props)},r=()=>{s-=1,0===s&&t()},s=0;this.uberSource$=new R.Subject,this.autoMergeSubject$=this.uberSource$.pipe((0,P.mergeMap)((e=>{let t=e.observable.pipe((0,P.filter)((e=>void 0!==e&&void 0!==e.action)),(0,P.map)((e=>{let t=O({},e);return t.action=e.action,this.tracer("autoMergeSubject$",t),t})));return!1===e.autoClosesBool?t:(s+=1,t.pipe((0,P.finalize)(r)))}))),this.autoSubscriber$=this.autoMergeSubject$.pipe((0,P.filter)((e=>void 0!==e&&void 0!==e.action))).subscribe(e)}updateSourceSubscription(e,t=!1,r){let s={observable:e,autoClosesBool:t,rel:r};this.tracer("updateSourceSubscription ",this.vsnum,s),this.uberSource$.next(s)}onSubscribeToSourcesNext(e={}){let r=(0,t.defaultTo)((e=>this.sendExtendedStreams(e)));const s=void 0!==(o=this.props.hashSourceMethods)[n=e.action]?n:(0,t.compose)(t.head,(0,t.filter)((0,t.compose)((0,t.test)(t.__,n),(e=>new RegExp(e)))))((0,t.keys)(o));var o,n;r(this.props.hashSourceMethods[s])(e),this.tracer("onSubscribeToSourcesNext",{payload:e})}onSubscribeToSourcesError(e=""){console.log("ALL ERROR  ",this.constructor.name,e)}onSubscribeToSourcesComplete(){this.tracer("onSubscribeToSourcesComplete","VS_DETRITUS_COLLECT"),this.openSpigot("VS_DETRITUS_COLLECT")}get source$(){return this._source$}sendExtendedStreams(e){this.tracer("sendExtendedStreams",e),this.openSpigot(e.action,e)}renderAndAttachToParent(e){this.openSpigot("VS_SPAWN_AND_ATTACH_TO_PARENT",e)}renderView(){this.openSpigot("VS_SPAWN")}renderViewAndAttachToDom(e,t,r){let s={node:e,type:t,attachType:r};this.openSpigot("VS_SPAWN_AND_ATTACH_TO_DOM",{attachData:s})}checkParentDispose(e){"parent"===e.from$&&this.disposeViewStream(e)}onBeforeDispose(){}setTimeout(e,r=0,s=!1){window.setTimeout(((...r)=>{if(void 0!==this&&void 0!==this.props){const o=!0===s?e.bind(this):e;(0,t.apply)(o,r)}}),r)}disposeViewStream(e){this.onBeforeDispose(),this.openSpigot("EXTIRPATE")}onChildDispose(e){}onParentDisposing(e){this.openSpigot("EXTIRPATE")}onReadyToGC(e){const t=void 0!==e.from$&&"internal"===e.from$;this.tracer("onReadyToGC",t,e)}openSpigot(e,r={}){if(void 0!==this.props){this.props.action=e;let s=(0,t.mergeRight)(this.props,r);this.sink$.next(Object.freeze(s))}}static isDevMode(){return!0===(0,t.path)(["Spyne","config","debug"],window)}setAttachData(e,r){return{node:this.props.el,type:"ViewStreamObservable",attachType:e,query:(()=>{let e=this.props.el.querySelector(r);return!0===ie.isDevMode()&&(0,t.is)(String,r)&&(0,t.isNil)(e)&&console.warn(`Spyne Warning: The appendView query in ${this.props.name}, '${r}', appears to not exist!`),e})()}}getParentEls(e,t){let r=e=>e.parentElement,s=0,o=e;for(;s<t;)o=r(o),s++;return o}setAttachParentData(e,t,r){return t=""!==t?t:void 0,{node:this.getParentEls(this.props.el,r),type:"ViewStreamObservable",attachType:e,query:this.props.el.parentElement.querySelector(t)}}onMapViewSource(e={}){return this.props=(0,t.mergeRight)(this.props,e),e}exchangeViewsWithChild(e,t){this.addChildStream(e.sourceStreams.toParent$),e.addParentStream(this.sourceStreams.toChild$,t)}appendToDom(e){void 0!==this.props.el&&console.warn(`Spyne Warning: The ViewStream, ${this.props.name}, has an element, ${this.props.el}, that is already rendered and does not need to be appendedToDom. This may create unsusual side effects!`),this.renderViewAndAttachToDom(e,"dom","appendChild")}prependToDom(e){void 0!==this.props.el&&console.warn(`Spyne Warning: The ViewStream, ${this.props.name}, has an element, ${this.props.el}, that is already rendered and does not need to be prependedToDom. This may create unsusual side effects!`),this.renderViewAndAttachToDom(e,"dom","prependChild")}appendView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("appendChild",t))}appendViewToParentEl(e,t,r=1){this.exchangeViewsWithChild(e,this.setAttachParentData("appendChild",t,r))}prependViewToParentEl(e,t,r=1){this.exchangeViewsWithChild(e,this.setAttachParentData("prependChild",t,r))}prependView(e,t){this.exchangeViewsWithChild(e,this.setAttachData("prependChild",t))}appendToNull(){let e=document.getElementById("spyne-null-views");this.renderViewAndAttachToDom(e,"dom","appendChild")}onVSRendered(e){"internal"===e.from$&&this.postRender()}postRender(){if(this.beforeAfterRender(),this.afterRender(),this.onRendered(),!0===this.isDevMode){const e=this.broadcastEvents();!1===ie.isValidNestedArr(e)&&console.warn(`Spyne Warning: The array returned from broadcastEvents in ${this.props.name}, '${JSON.stringify(e)}', does not appear to be properly formatted!`)}this.viewsStreamBroadcaster=new G(this.props,this.broadcastEvents.bind(this)),this.afterBroadcastEvents()}addTraits(e){"Array"!==e.constructor.name&&(e=[e]),e.forEach((e=>{new e(this)})),!0===this.isDevMode&&this.addActionListeners()}afterBroadcastEvents(){if(!0===this.isDevMode){const e=e=>e[0],r=this.addActionListeners();let s=r.map(e);if(!1===ie.isValidNestedArr(r))console.warn(`Spyne Warning: The array returned from addActionsListeners in ${this.props.name}, '${JSON.stringify(r)}', does not appear to be properly formatted!`);else{const e=e=>{const r=(0,t.defaultTo)("",e[1]);!1===(0,t.is)(Function,this[r])&&console.warn(`Spyne Warning: The method in addActionListeners nested Array, '${JSON.stringify(e)}', in ${this.props.name}, does not appear to exist!`)};(0,t.compose)((0,t.forEach)(e),(0,t.defaultTo)([]))(r)}const o=()=>{void 0!==(0,t.path)(["props","addedChannels"],this)&&ie.checkIfActionsAreRegistered.bind(this)(this.props.addedChannels,s)};this.setTimeout(o,500)}}static checkIfActionsAreRegistered(e=[],r){if(r.length>0){const s=r=>{let s=new RegExp(r);if((0,t.findIndex)((0,t.test)(s),o)<0){let t=1===e.length?"from added channel":"from added dchannels";console.warn(`Spyne Warning: The action, ${r}, in ${this.props.name}, does not match any of the registered actions ${t}, ${e.join(", ")}`)}};let o=(e=>{let r=e.map((e=>window.Spyne.channels.getChannelActions(e)));return(0,t.flatten)(r)})(e);r.forEach(s)}}setDataVSID(){this.props.el.dataset.vsid=this.props.vsid}beforeAfterRender(){this.setDataVSID(),this.props.el$=oe(this.props.el)}downStream(){}onRendered(){}afterRender(){}static isValidNestedArr(e){const r=(0,t.equals)(!0),s=(0,t.all)(r),o=(0,t.is)(String),n=(0,t.compose)(s,ne(o),(0,t.slice)(0,2),(0,t.defaultTo)([]));return(0,t.compose)(s,ne(n),(0,t.defaultTo)([]))(e)}broadcastEvents(){return[]}getChannel(e){return(0,t.ifElse)((e=>c().includes(e)),(e=>window.Spyne.channels.getStream(e).observer.pipe((0,P.takeWhile)((e=>!0!==this.deleted)))),(e=>console.warn(`channel name ${e} is not within ${c}`)))(e)}addChannel(e,r=!1,s=!1,o=!1){const n=!0===s?this.$dirs.CI:this.$dirs.I,i=(0,t.path)(["srcElement","isLocalEvent"]),a=(0,t.path)(["srcElement","vsid"]),c=[(0,P.map)((e=>{let t=e;return t.$dir=n,t})),(0,P.filter)((e=>{let t=a(e);return!0!==i(e)||t===this.props.vsid}))];!0===r&&c.unshift((0,P.skip)(1));let l=this.getChannel(e).pipe(...c);this.updateSourceSubscription(l,!1),this.props.addedChannels.push(e)}checkIfChannelExists(e){let t=void 0!==window.Spyne.channels.map.get(e);return!0!==t&&console.warn(`SPYNE WARNING: The ChannelPayload from ${this.props.name}, has been sent to a channel, ${e}, that has not been registered!`),t}sendInfoToChannel(e,r={},s="VIEWSTREAM_EVENT"){let o={payload:r,action:s};if(o.srcElement=(0,t.compose)((0,t.pick)(["id","vsid","class","tagName"]),(0,t.prop)("props"))(this),!0===this.checkIfChannelExists(e)){if(!1===/CHANNEL_LIFECYCLE/.test(s)){const e=["Spyne","config","tmp"],s=["Spyne","config","tmp",this.props.vsid];(0,t.path)(e,window)[this.props.vsid]=r;const n=this.props.vsid;Object.defineProperties(o,{payload:{get:()=>(0,t.compose)(t.clone,(0,t.path)(s))(window)}});const i=()=>ie.removeDataFromTmpDir(n);window.requestAnimationFrame(i)}let n=(0,R.of)(o);return new j(e,n,o)}}tracer(...e){this.sendLifecycleMethod(...e)}sendLifecycleMethodInactive(){}sendLifecycleMethodActive(e,r){let s="VS_DETRITUS_COLLECT"===r;!0===(0,t.where)({from$:(0,t.equals)("internal"),action:(0,t.equals)("VS_SPAWNED_AND_ATTACHED_TO_PARENT")},r)?this.sendInfoToChannel("CHANNEL_LIFECYCLE",{action:"CHANNEL_LIFECYCLE_RENDERED_EVENT"},"CHANNEL_LIFECYCLE_RENDERED_EVENT"):!0===s&&this.sendInfoToChannel("CHANNEL_LIFECYCLE",{action:"CHANNEL_LIFECYCLE_DISPOSED_EVENT"},"CHANNEL_LIFECYCLE_DISPOSED_EVENT")}createActionFilter(e,t){return new J(e,t)}isLocalEvent(e){return void 0!==(0,t.path)(["srcElement","el"],e)&&this.props.el.contains(e.srcElement.el)}get attributesArray(){return["accept","accept-charset","accesskey","action","align","allow","alt","aria-autocomplete","aria-checked","aria-disabled","aria-expanded","aria-haspopup","aria-hidden","aria-invalid","aria-label","aria-level","aria-multiline","aria-multiselectable","aria-orientation","aria-pressed","aria-readonly","aria-required","aria-selected","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","aria-atomic","aria-busy","aria-live","aria-relevant","aria-dropeffect","aria-grabbed","aria-activedescendant","aria-controls","aria-describedby","aria-flowto","aria-labelledby","aria-owns","aria-posinset","aria-setsize","async","autocapitalize","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","csp","dataset","datetime","decoding","default","defer","dir","dirname","disabled","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","importance","integrity","ismap","itemprop","keytype","kind","label","lang","language","lazyload","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","muted","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","referrerpolicy","rel","required","reversed","role","rows","rowspan","sandbox","scope","scoped","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","value","width","wrap"]}addMixins(){let e=A();this.createId=e.createId}}class ae{constructor(e){let r=String(e.props.name),s=`${r}_ROUTE_UPDATER`;return(0,t.curry)(ae.createTemporaryViewStreamObj)({id:s,name:r})}static createTemporaryViewStreamObj(e,t){let{name:r,id:s}=e,o=t,n=new ie({id:s,name:r,data:t});n.onRendered=()=>{n.sendInfoToChannel("CHANNEL_ROUTE",o)},n.afterBroadcastEvents=()=>{n.disposeViewStream()},n.appendToNull()}}const ce=n(205).map;class le{constructor(e,t={}){this.addRegisteredActions.bind(this),this.createChannelActionsObj(e,t.extendedActionsArr),t.name=e,this.props=t,this.props.isRegistered=!1,this.props.isProxy=void 0!==this.props.isProxy&&this.props.isProxy,this.props.sendCachedPayload=void 0!==this.props.sendCachedPayload&&this.props.sendCachedPayload,this.sendPayloadToRouteChannel=new ae(this),this.createChannelActionMethods(),this.streamsController=window.Spyne.channels;let r=this.getMainObserver();this.observer$=this.props.observer=r,this.streamsController.getStream("DISPATCHER").subscribe((e=>this.onReceivedObservable(e)))}getMainObserver(){return!0===this.streamsController.testStream(this.props.name)?this.streamsController.getProxySubject(this.props.name,this.props.sendCachedPayload):!0===this.props.sendCachedPayload?new R.ReplaySubject(1):new R.Subject}onChannelInitialized(){}onRegistered(){}get isProxy(){return this.props.isProxy}get channelName(){return this.props.name}get observer(){return this.observer$}checkForTraits(){void 0!==this.props.traits&&(e=>{"Array"!==e.constructor.name&&(e=[e]),e.forEach((e=>{new e(this)}))})(this.props.traits)}initializeStream(){this.checkForTraits(),this.onChannelInitialized(),this.onRegistered(),this.props.isRegistered=!0}setTrace(e){}createChannelActionsObj(e,r=[]){const s=(0,t.ifElse)((0,t.is)(String),t.identity,t.head);let o=r.concat(this.addRegisteredActions(e)),n=ce(s,o),i=(0,t.mergeAll)((0,t.chain)((e=>(0,t.objOf)(e,e)),n));this.channelActions=i}createChannelActionMethods(){const e=(0,t.ifElse)((0,t.is)(String),t.identity,t.head),r=(0,t.ifElse)((0,t.is)(String),(0,t.always)("onViewStreamInfo"),(e=>{const r=(0,t.view)((0,t.lensIndex)(1),e);return!0==("function"==typeof this[r])?this[r].bind(this):console.warn(`"${this.props.name}", REQUIRES THE FOLLOWING METHOD ${r} FOR ACTION, ${e[0]}`),r}));this.channelActionMethods=(0,t.fromPairs)(ce((t=>[e(t),r(t)]),this.addRegisteredActions()))}addRegisteredActions(){return[]}onReceivedObservable(e){this.onIncomingObservable(e)}getActionMethodForObservable(e){e.unpacked=!0;const r=this.onViewStreamInfo.bind(this);let s=(0,t.path)(["data","action"],e);const o=(0,t.prop)(s,this.channelActionMethods);let n=r;return void 0!==o&&"onViewStreamInfo"!==o&&!0==("function"==typeof this[o])&&(n=this[o].bind(this)),n}onIncomingObservable(e){let r=(0,t.equals)(e.name,this.props.name),{action:s,payload:o,srcElement:n}=e.data,i=r=>({props:()=>{return r=e.data,(0,t.mergeAll)([r,{action:(0,t.prop)("action",r)},(0,t.prop)("payload",r),(0,t.prop)("srcElement",r)]);var r},action:s,payload:o,srcElement:n,event:r});return!0===r?(e=>e.observable.pipe((0,P.map)(i)).subscribe(this.getActionMethodForObservable(e)))(e):void 0}onViewStreamInfo(e){}sendChannelPayload(e,t,r={},s={},o=this.observer$){let n=new f(this.props.name,e,t,r,s);o.next(n)}getChannel(e,r){return(0,t.ifElse)((e=>c().includes(e)),(e=>{let t=this.streamsController.getStream(e).observer;return void 0!==r?t.pipe((0,P.filter)(r)):t}),(e=>console.warn(`channel name ${e} is not within ${c}`)))(e)}setTimeout(e,r=0,s=!1){window.setTimeout(((...r)=>{if(void 0!==this&&void 0!==this.props){const o=!0===s?e.bind(this):e;(0,t.apply)(o,r)}}),r)}}class pe{constructor(){this.checkIfObjIsNotEmptyOrNil=pe.checkIfObjIsNotEmptyOrNil.bind(this)}static checkIfObjIsNotEmptyOrNil(e){const r=(0,t.compose)((0,t.complement)(t.isEmpty),t.head,t.values),s=(0,t.compose)((0,t.complement)(t.isNil),t.head,t.values);return(0,t.allPass)([r,s])(e)}static checkIfParamValueMatchesRegex(e,r){const s=(0,t.reject)((0,t.equals)("routeName")),o=(0,t.compose)(s,t.keys),n=(0,t.compose)((0,t.find)((r=>(0,t.test)(new RegExp(r),e))),o)(r);return(0,t.is)(String,n)&&(r=(0,t.assoc)(e,(0,t.prop)(n,r),r)),r}static formatStrAsWindowLocation(e){return{hash:e,search:e,pathname:e}}static getLocationStrByType(e,r=!1,s=window.location){const o={slash:"pathname",query:"search",hash:"hash"}[!0===r?"hash":e];return(0,t.prop)(o,s).replace(/^(\/)?(#)?(\/)?(.*)$/,"$4")}static createRouteArrayFromParams(e,r,s="slash",o){let n=[],i=r=>{let s={},a=r.routeName,c=void 0!==e[a]?e[a]:(0,t.prop)(a,o);const l=typeof r[c];"string"===l?c=r[c]:"undefined"===l&&(r=this.checkIfParamValueMatchesRegex(c,r)),s[a]=c,this.checkIfObjIsNotEmptyOrNil(s)&&n.push(s);const p=(0,t.is)(Object,r),d=(0,t.has)(c,r),h=(0,t.has)("routePath",r);if(!0===(d&&p)){let e=r[c];(0,t.has)("routePath",e)&&i(e.routePath)}else!0===h&&void 0!==c&&i(r.routePath)};return i(r),n}static createSlashString(e){const r=(0,t.reject)(t.isNil),s=(0,t.when)((0,t.complement)(t.isNil,t.__),(0,t.join)("/")),o=(0,t.replace)(/^(\^*)(.*|^\$)(\$)$/,"$2");return(0,t.compose)(o,s,r,t.flatten,(0,t.map)(t.values))(e)}static createQueryString(e){const r=(0,t.reject)(t.isNil),s=this.checkIfObjIsNotEmptyOrNil,o=(0,t.compose)((0,t.join)("="),t.flatten,t.toPairs),n=(0,t.ifElse)(s,o,(0,t.always)(void 0)),i=(0,t.map)(n),a=(0,t.when)((0,t.complement)(t.isEmpty),(0,t.concat)("?"));return(0,t.compose)(a,(0,t.join)("&"),r,i)(e)}static checkPayloadForRegexOverrides(e,r,s="Value"){const o=(0,t.compose)((e=>(0,t.prop)(`${e}${s}`,r)),t.head,t.keys);return(0,t.map)((e=>{let r=o(e);return void 0!==r?(0,t.assoc)((0,t.compose)(t.head,t.keys)(e),r,e):e}),e)}static convertParamsToRoute(e,t=window.Spyne.config.channels.ROUTE,r,s){const o=void 0!==r?r:t.type,n=t.isHash;let i=t.routes.routePath,a=void 0!==s?s:this.getLocationStrByType(o,n),c=this.convertRouteToParams(a,t,o).routeData,l=this.createRouteArrayFromParams(e,i,o,c);return l=pe.checkPayloadForRegexOverrides(l,e),"query"===o?this.createQueryString(l):this.createSlashString(l)}static findIndexOfMatchedStringOrRegex(e,r){const s=(0,t.replace)(/^$/,"^$"),o=(0,t.either)((0,t.propEq)("str",e),(0,t.compose)((0,t.test)(t.__,e),(0,t.prop)("re")));return(0,t.compose)((0,t.findLastIndex)((0,t.equals)(!0)),(0,t.map)(o),(0,t.map)((e=>{return{str:e,re:(t=e,new RegExp(t))};var t})),(0,t.map)(s))(r)}static checkIfValueShouldMapToParam(e,r,s){let o=(0,t.compose)((0,t.map)(t.last),(0,t.map)((0,t.filter)((0,t.is)(String))),t.toPairs)(e),n=pe.findIndexOfMatchedStringOrRegex(r,o),i=r;if(n>=0){let r=o[n],s=(0,t.invert)(e),a=(0,t.compose)(t.head,(0,t.defaultTo)([]),(0,t.prop)(r))(s);!0===/^([-\$\w]*)$/.test(a)&&!0===(0,t.is)(String,a)&&(i=a)}return i}static createArrFromSlashStr(e){return e.replace(/^([/])?(.*)$/,"$2").split("/")}static convertSlashRouteStrToParamsObj(e,r,s){const o=r;let n=this.createArrFromSlashStr(r),i=[],a=[],c=e;(0,t.reduce)(((e,r)=>{let o=this.checkIfValueShouldMapToParam(c,r,s);c=this.checkIfParamValueMatchesRegex(r,c);const n=(0,t.either)(t.isEmpty,t.isNil);void 0!==c&&(e=>e!==(0,t.last)(i))(c.routeName)&&!1===n(o)&&(i.push(c.routeName),a.push(o));let l=[r,"routePath"],p=(0,t.path)(l,c),d=(0,t.path)(["routePath"],c);void 0!==p?c=p:void 0!==d&&(c=d)}),0,n);let l=(0,t.zipObj)(i,a);const p=this.getLastArrVal(i);return{paths:i,pathInnermost:p,routeData:l,routeValue:o}}static getLastArrVal(e){return r=e,void 0!==(0,t.last)(r)?(0,t.last)(r):"";var r}static createDefaultParamFromEmptyStr(e,t){let r={};return r[e.routeName]=this.checkIfValueShouldMapToParam(e,t),r}static convertQueryStrToParams(e,r,s){const o=r;let n=r.replace(/^([?])?(.*)$/,"$2"),i=(0,t.compose)((0,t.map)((0,t.split)("=")),(0,t.split)("&"))(n),a=(0,t.fromPairs)(i),c=(0,t.map)(t.head,i);return!0===(0,t.isEmpty)(r)&&(a=this.createDefaultParamFromEmptyStr(e,r,s),c=(0,t.keys)(a)),{paths:c,pathInnermost:this.getLastArrVal(c),routeData:a,routeValue:o}}static convertRouteToParams(e,r,s){if(void 0===r)return{};const o=void 0!==s?s:r.type,n=(0,t.defaultTo)({},(0,t.prop)("regexTokens",r));let i=r.routes.routePath;return"query"===o?this.convertQueryStrToParams(i,e):(e=e.replace(/\/$|$/,"/"),this.convertSlashRouteStrToParamsObj(i,e,n))}}class de{constructor(){this.createPopStateStream=de.createPopStateStream.bind(this)}static createPopStateStream(e){(0,R.fromEventPattern)((function(e){window.onpopstate=e}),(function(){window.onpopstate=function(){}})).subscribe(e)}static getLastArrVal(e){return r=e,void 0!==(0,t.last)(r)?(0,t.last)(r):"";var r}static compareRouteKeywords(e={},r){const s=(e,r)=>void 0!==r?(0,t.pick)(r,e):e;let o=s(e,r);return{pickValues:s,compare:(e={},r)=>{let n=s(e,r);const i=e=>(0,t.compose)(t.keys,(0,t.filter)((0,t.propEq)(e,!0))),a=(0,t.compose)((0,t.map)((e=>{let r=(0,t.prop)(e,o),s=(0,t.prop)(e,n),i=(0,t.equals)(r,s),a=void 0!==r,c=void 0!==s,l=!i,p=!1===a&&!0===c,d=!0===a&&!1===c,h={};return h[e]={same:i,changed:l,added:p,removed:d,previousExists:a,nextExists:c},h})),t.uniq,(0,t.chain)(t.keys))([o,n]);let c=(0,t.chain)(i("changed"),a),l=(0,t.chain)(i("added"),a),p=(0,t.chain)(i("removed"),a);return o=n,{pathsAdded:l,pathsRemoved:p,pathsChanged:c}},getComparer:()=>o}}static getRouteArrData(e,r){let s=(0,t.filter)((0,t.includes)(t.__,e),r);return{paths:s,pathInnermost:de.getLastArrVal(s)}}static flattenConfigObject(e){const r=e=>(0,t.chain)((([e,s])=>"[object Object]"===Object.prototype.toString.call(s)?(0,t.map)((([t,r])=>[`${e}.${t}`,r]),r(s)):[[e,s]]),(0,t.toPairs)(e));return(0,t.values)((0,t.fromPairs)(r(e)))}static addRouteDatasets(e){const{type:r,isHash:s}=e,o=t=>("query"===r?"":!0===s?"#":"/")+pe.convertParamsToRoute(t,e).replace(/^(.*\/)([\w\-]*\/?)(.*)$/gm,"$1$2"),n=/^([A-Za-z0-9_\-])+$/m,i=(e=[],r,s={})=>{let{routeName:a}=r;return(0,t.toPairs)(r).reduce(((r,c)=>{const[l,p]=c,d=(0,t.is)(Object,p),h=e=>(0,t.test)(n,e)?String(e).toUpperCase():l;if("routeName"===l||"404"===l)return r;a=a||(0,t.prop)("routeName",p);let u=(0,t.clone)(s);if(u[a]=String(l).replace(/([^A-Za-z0-9-_])/g,""),!0===d){if(1===(0,t.keys)(u).length){const e=(0,t.path)(["routePath","routeName"],p);if(e){const n=(0,t.clone)(u);n[e]="",n.navLevel=(0,t.keys)(s).length,n.title=h(l),n.href=o(n),r.push(n)}}u=i(e,p,u)}else u.title=h(l),u.href=o(u);return u.navLevel=(0,t.keys)(s).length,r.push(u),r}),[])};let a=i([],e.routes);const c=(0,t.flatten)(a);return{routeDatasetsArr:c,routeNamesArr:(e=>{const r=(0,t.reject)((0,t.includes)(t.__,["title","href","navLevel"]));return(0,t.compose)(t.uniq,r,t.flatten,(0,t.map)(t.keys))(e)})(c)}}static conformRouteObject(e={},r=!1){const s=(0,t.path)(["channels","ROUTE"],e);let{add404s:o}=void 0!==s?s:e;o=o||r;const n=e=>{let r=e[1];const s=(0,t.is)(Array,r);return""===r?e[1]="^$":s&&(e[1]=r.join("|")),e},i=(0,t.compose)(t.fromPairs,(0,t.map)((e=>{let[r,s]=e;const a=o?{404:".+"}:{},c=(0,t.is)(Object,s),l=(0,t.is)(Array,s),p="routePath"===r;return!0===c&&!1===l&&(e[1]=i(e[1]),p&&(e[1]=(0,t.compose)((0,t.mergeDeepRight)(a),t.fromPairs,(0,t.map)(n),t.toPairs)(e[1]))),e})),t.toPairs);if(void 0!==s){e.channels.ROUTE=i(e.channels.ROUTE);const r=de.addRouteDatasets(e.channels.ROUTE);return e.channels.ROUTE=(0,t.mergeRight)(e.channels.ROUTE,r),e}return i(e)}static getLocationData(){return(0,t.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}}const he=n(205).filter,ue=n(205).mergeRight;class Ee extends le{constructor(e="CHANNEL_ROUTE",t={}){t.sendCachedPayload=!0,super("CHANNEL_ROUTE",t),this.createChannelActionsObj(),this.routeConfigJson=this.getRouteConfig(),this.bindStaticMethods(),this.navToStream$=new R.ReplaySubject(1),this.observer$=this.navToStream$.pipe((0,P.map)((e=>this.onMapNext(e)))),this.compareRouteKeywords=de.compareRouteKeywords()}checkConfigForHash(){!0==("hash"===window.Spyne.config.channels.ROUTE.type)&&(window.Spyne.config.channels.ROUTE.type="slash",window.Spyne.config.channels.ROUTE.isHash=!0)}onRegistered(){this.checkConfigForHash(),this.initStream()}createChannelActionsObj(){let e=this.addRegisteredActions(),r=(0,t.mergeAll)((0,t.chain)((e=>(0,t.objOf)(e,e)),e));this.channelActions=r}addRegisteredActions(){return["CHANNEL_ROUTE_DEEPLINK_EVENT","CHANNEL_ROUTE_CHANGE_EVENT","CHANNEL_ROUTE_CONFIG_UPDATED_EVENT",["CHANNEL_ROUTE_UPDATE_CONFIG_EVENT","updateRouteConfig"]]}updateRouteConfig(e){const r=(0,t.pick)(["isHash","isHidden","routes","type"],e.payload);window.Spyne.config.channels.ROUTE=(0,t.mergeRight)(window.Spyne.config.channels.ROUTE,r),(0,t.clone)(window.Spyne.config.channels.ROUTE),window.Spyne.config=de.conformRouteObject(window.Spyne.config);const s=this.getRouteConfig();this.routeConfigJson=s,this.bindStaticMethodsWithConfigData(),this.sendChannelPayload("CHANNEL_ROUTE_CONFIG_UPDATED_EVENT",s,{},{},this.navToStream$)}getRouteConfig(){const e=window.Spyne.config;let r=(0,t.path)(["channels","ROUTE"],e);"query"===r.type&&(r.isHash=!1);let s=de.flattenConfigObject(r.routes);return r.paramsArr=s,r}initStream(){this.firstLoadStream$=new R.ReplaySubject(1),this.onIncomingDomEvent(void 0,this.routeConfigJson,"CHANNEL_ROUTE_DEEPLINK_EVENT"),de.createPopStateStream(this.onIncomingDomEvent.bind(this)),this.observer$=(0,R.merge)(this.firstLoadStream$,this.navToStream$)}onMapNext(e,t=!1){return e.action="CHANNEL_ROUTE_CHANGE_EVENT",e}static removeSSID(e){const r=(0,t.lensProp)(["routeData"]);return(0,t.over)(r,(0,t.omit)(["vsid"]))(e)}static onIncomingDomEvent(e,r=this.routeConfigJson,s){let o=void 0!==s?s:this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT,n=(0,t.path)(["state","routeCount"],e),i=!0===(0,t.is)(Number,n),a=this.getDataFromString(r,i);!0===i&&(a.routeCount=n);let c=this.compareRouteKeywords.compare(a.routeData,a.paths);a=ue(a,c),this.sendChannelPayload(o,a,void 0,void 0,this.navToStream$)}static checkForRouteParamsOverrides(e){return e}static checkForEventMethods(e){const r=(0,t.compose)(he((0,t.test)(/^(event)([A-Z].*)([A-Z].*)$/gm)),t.keys,(0,t.prop)("payload"))(e);if(r.length>=1){const s=(0,t.prop)("event",e);if(void 0!==s){const e=(e,t,r,s,o)=>String(r).toLowerCase()+s+o,o=(0,t.replace)(/^(event)([A-Z])(.*)([A-Z].*)$/gm,e),n=e=>{const t=o(e);void 0!==s[t]&&s[t]()};r.forEach(n)}}return e}static checkForEndRoute(e,r=this.routeConfigJson,s){if(!0!==(0,t.compose)((0,t.equals)("true"),(0,t.path)(["payload","endRoute"]))(e))return e;const o=window||{},n=void 0!==s?s:(0,t.compose)((0,t.equals)(!0),(0,t.path)(["Spyne","config","debug"]))(o),{payload:i}=e;let a=0;const c=(e=[],r)=>{const[s,o]=r,{routePath:l}=o,p=(0,t.prop)("routeName",l),d=(e=>{const r=(0,t.prop)("routeName",e);if(r){const s=(0,t.compose)(t.keys,(0,t.omit)(["routeName"]))(e);let o=i[r];const n=e=>new RegExp(`^${e}$`).test(o);return(0,t.find)(n,s)}})(l),h=(0,t.is)(Object,o),u=(0,t.is)(Array,o);if(a+=1,!0===h&&!1===u){const r=l[d];r?(0,t.compose)(t.reverse,(0,t.reduce)(c,e),t.toPairs)({nextRoutePath:r}):1===a?n&&console.warn(`Spyne Warning: use of end route method should add start route value of "${p}".`):e.push(p)}return e},{routes:l}=r,p=(0,t.compose)(t.reverse,(0,t.reduce)(c,[]),t.toPairs)({routes:l});if(1===p.length){const t=p[0];e.payload[t]=""}return e}onViewStreamInfo(e){let r=this.channelActions.CHANNEL_ROUTE_CHANGE_EVENT;Ee.checkForEventMethods(e),e=this.checkForEndRoute(e);let s=this.getDataFromParams(e);const{routeConfigJson:o}=this;let n=(0,t.prop)("srcElement",e),i=(0,t.prop)("event",e),a=!s.isHidden,c=this.compareRouteKeywords.compare(s.routeData,s.paths);s=ue(s,c),this.sendRouteStream(s,a),s=Ee.removeSSID(s),this.sendChannelPayload(r,s,n,i,this.navToStream$)}static checkAndConvertStrWithRegexTokens(e,r){return(0,t.keys)(r)}sendRouteStream(e,t=!0){!0===t&&this.setWindowLocation(e)}static getRouteState(){return"CHANNEL_ROUTE_CHANGE_EVENT"}static getIsDeepLinkBool(e){return!1===e&&0===this._routeCount}static getRouteCount(e=!1){return void 0===this._routeCount?(this._routeCount=0,this._routeCount):(!1===e&&(this._routeCount+=1),this._routeCount)}static getExtraPayloadParams(e=this.routeConfigJson,t=!1){return{routeCount:this.getRouteCount(t),isDeepLink:this.getIsDeepLinkBool(t),isHash:e.isHash,isHidden:e.isHidden,routeType:e.type}}static getDataFromParams(e,r=this.routeConfigJson){let s=(0,t.prop)("payload",e),o=this.getRouteStrFromParams(s,r);const n=(e,s)=>(0,t.defaultTo)(s,(0,t.prop)(e,r));let i=n("type","slash"),a=n("isHash",!1),c=pe.formatStrAsWindowLocation(o),l=this.getDataFromLocationStr(i,a,c),{pathInnermost:p,paths:d}=l;s=ue(l.routeData,s);let{routeCount:h,isDeepLink:u,isHash:E,isHidden:m,routeType:N}=this.getExtraPayloadParams(r);return{isDeepLink:u,routeCount:h,pathInnermost:p,paths:d,routeData:s,routeValue:o,isHash:E,isHidden:m,routeType:N}}static getDataFromString(e=this.routeConfigJson,t=!1){const r=e.type,s=!0===e.isHash,o=pe.getLocationStrByType(r,s);let{paths:n,pathInnermost:i,routeData:a,routeValue:c}=Ee.getParamsFromRouteStr(o,e,r),{routeCount:l,isDeepLink:p,isHash:d,routeType:h,isHidden:u}=this.getExtraPayloadParams(e,t);return{isDeepLink:p,routeCount:l,pathInnermost:i,paths:n,routeData:a,routeValue:c,isHash:d,isHidden:u,routeType:h}}static getDataFromLocationStr(e="slash",t=this.routeConfigJson.isHash,r=window.location){const s=void 0!==this.routeConfigJson?this.routeConfigJson.type:e,o=pe.getLocationStrByType(s,t,r);let{paths:n,pathInnermost:i,routeData:a,routeValue:c}=this.getParamsFromRouteStr(o,this.routeConfigJson,s);return{paths:n,pathInnermost:i,routeData:a,routeValue:c,action:this.getRouteState()}}static getLocationData(){return(0,t.pickAll)(["href","origin","protocol","host","hostname","port","pathname","search","hash"],window.location)}static getRouteStrFromParams(e,t,r){const s=void 0!==r?r:t.type;return pe.convertParamsToRoute(e,t,s)}static getParamsFromRouteStr(e,t,r){const s=void 0!==r?r:t.type;return pe.convertRouteToParams(e,t,s)}checkEmptyRouteStr(e,r=!1){const s=(0,t.isEmpty)(e);return!0==(!0===s&&!1===r)||!0==(!0===s&&!0===r)?"/":!0==(!1===s&&!0===r)?(0,t.concat)("#",e):e}static removeLastSlash(e){return e.replace(/^(.*)(\/)$/,"$1")}setWindowLocation(e){let{isHash:r,routeValue:s}=e;s=this.checkEmptyRouteStr(s,r);let{routeCount:o}=e;if(!0===r)s=Ee.removeLastSlash(window.location.pathname)+s,window.history.pushState({routeCount:o},"",s);else{const e=(0,t.when)((0,t.compose)((0,t.complement)((0,t.equals)("/")),t.head),(0,t.concat)("/",t.__));window.history.pushState({routeCount:o},"",e(s))}}getWindowLocation(){return window.location.pathname}bindStaticMethods(){this.checkForEndRoute=Ee.checkForEndRoute.bind(this),this.getIsDeepLinkBool=Ee.getIsDeepLinkBool.bind(this),this.getDataFromLocationStr=Ee.getDataFromLocationStr.bind(this),this.onIncomingDomEvent=Ee.onIncomingDomEvent.bind(this),this.getDataFromString=Ee.getDataFromString.bind(this),this.getParamsFromRouteStr=Ee.getParamsFromRouteStr.bind(this),this.getLocationData=Ee.getLocationData.bind(this),this.getRouteState=Ee.getRouteState.bind(this),this.getDataFromParams=Ee.getDataFromParams.bind(this),this.getRouteCount=Ee.getRouteCount.bind(this),this.getExtraPayloadParams=Ee.getExtraPayloadParams.bind(this),this.bindStaticMethodsWithConfigData()}bindStaticMethodsWithConfigData(){const e=(0,t.curryN)(3,Ee.getRouteStrFromParams);this.getRouteStrFromParams=e(t.__,this.routeConfigJson,this.routeConfigJson.type)}}class me extends le{constructor(e="CHANNEL_UI",t={}){t.sendCachedPayload=!1,super(e,t),this.keyEventsLoaded=!1,this.keyCodeArr=[]}addRegisteredActions(){return["CHANNEL_UI_ANIMATIONEND_EVENT","CHANNEL_UI_ANIMATIONITERATION_EVENT","CHANNEL_UI_ANIMATIONSTART_EVENT","CHANNEL_UI_AUDIOEND_EVENT","CHANNEL_UI_AUDIOPROCESS_EVENT","CHANNEL_UI_AUDIOSTART_EVENT","CHANNEL_UI_BLUR_EVENT","CHANNEL_UI_CACHED_EVENT","CHANNEL_UI_CANPLAYTHROUGH_EVENT","CHANNEL_UI_CANPLAY_EVENT","CHANNEL_UI_CHANGE_EVENT","CHANNEL_UI_CHECKBOXSTATECHANGE_EVENT","CHANNEL_UI_CLICK_EVENT","CHANNEL_UI_COMPLETE_EVENT","CHANNEL_UI_COPY_EVENT","CHANNEL_UI_CUT_EVENT","CHANNEL_UI_DBLCLICK_EVENT","CHANNEL_UI_DURATIONCHANGE_EVENT","CHANNEL_UI_EMPTIED_EVENT","CHANNEL_UI_ENDED_EVENT","CHANNEL_UI_EVENT","CHANNEL_UI_FOCUSIN_EVENT","CHANNEL_UI_FOCUSOUT_EVENT","CHANNEL_UI_FOCUS_EVENT","CHANNEL_UI_HASHCHANGE_EVENT","CHANNEL_UI_INPUT_EVENT","CHANNEL_UI_KEYDOWN_EVENT","CHANNEL_UI_KEYPRESS_EVENT","CHANNEL_UI_KEYUP_EVENT","CHANNEL_UI_LOADEDDATA_EVENT","CHANNEL_UI_LOADEDMETADATA_EVENT","CHANNEL_UI_MOUSEDOWN_EVENT","CHANNEL_UI_MOUSEENTER_EVENT","CHANNEL_UI_MOUSELEAVE_EVENT","CHANNEL_UI_MOUSEMOVE_EVENT","CHANNEL_UI_MOUSEOUT_EVENT","CHANNEL_UI_MOUSEOVER_EVENT","CHANNEL_UI_MOUSEUP_EVENT","CHANNEL_UI_MOUSEWHEEL_EVENT","CHANNEL_UI_PAUSE_EVENT","CHANNEL_UI_PLAYING_EVENT","CHANNEL_UI_PLAY_EVENT","CHANNEL_UI_RADIOSTATECHANGE_EVENT","CHANNEL_UI_RATECHANGE_EVENT","CHANNEL_UI_READYSTATECHANGE_EVENT","CHANNEL_UI_SEEKED_EVENT","CHANNEL_UI_SEEKING_EVENT","CHANNEL_UI_SELECT_EVENT","CHANNEL_UI_STALLED_EVENT","CHANNEL_UI_SUBMIT_EVENT","CHANNEL_UI_SUSPEND_EVENT","CHANNEL_UI_SVGABORT_EVENT","CHANNEL_UI_SVGERROR_EVENT","CHANNEL_UI_SVGLOAD_EVENT","CHANNEL_UI_SVGRESIZE_EVENT","CHANNEL_UI_SVGSCROLL_EVENT","CHANNEL_UI_SVGUNLOAD_EVENT","CHANNEL_UI_SVGZOOM_EVENT","CHANNEL_UI_TIMEUPDATE_EVENT","CHANNEL_UI_TOUCHCANCEL_EVENT","CHANNEL_UI_TOUCHEND_EVENT","CHANNEL_UI_TOUCHMOVE_EVENT","CHANNEL_UI_TOUCHSTART_EVENT","CHANNEL_UI_TRANSITIONEND_EVENT","CHANNEL_UI_VALUECHANGE_EVENT","CHANNEL_UI_VOLUMECHANGE_EVENT","CHANNEL_UI_WAITING_EVENT","CHANNEL_UI_WHEEL_EVENT"]}loadKeyStream(){let e=R.Observable.fromEvent(document,"keyup");this.keyPresses$=e.groupBy((e=>e.keyCode)).mergeAll().filter((e=>this.keyCodeArr.indexOf(e.keyCode)>=0)).repeat().subscribe(this.onKeyPressed.bind(this))}addKeyEvent(e){!1===this.keyEventsLoaded&&this.loadKeyStream(),this.keyEventsLoaded=!0,this.registerKey(e)}registerKey(e){this.keyCodeArr.push(e)}onKeyPressed(e){console.log("key is ",e)}static removeSSID(e){const r=(0,t.lensProp)(["payload"]);return(0,t.over)(r,(0,t.omit)(["vsid"]))(e)}onIncomingObservable(e){let r=(0,t.equals)(e.name,this.props.name);e.data=me.removeSSID(e.data);let{payload:s,srcElement:o}=e.data,n=e=>({payload:s,srcElement:o,event:e});return!0===r?(e=>e.observable.pipe((0,P.map)(n)).subscribe(this.onUIEvent.bind(this)))(e):void 0}getActionState(e){let r=(0,t.path)(["event","type"]),s=(0,t.path)(["event","typeOverRide"]),o=(0,t.compose)(t.toUpper,(0,t.either)(s,r))(e);return void 0!==o?`CHANNEL_UI_${o}_EVENT`:"CHANNEL_UI"}static checkForEventMethods(e){const r=(0,t.compose)((0,t.filter)((0,t.test)(/^(event)([A-Z].*)([A-Z].*)$/gm)),t.keys,(0,t.prop)("payload"))(e);if(r.length>=1){const s=(0,t.prop)("event",e);if(void 0!==s){const e=(e,t,r,s,o)=>String(r).toLowerCase()+s+o,o=(0,t.replace)(/^(event)([A-Z])(.*)([A-Z].*)$/gm,e),n=e=>{const t=o(e);void 0!==s[t]&&"function"==typeof s[t]&&s[t]()};r.forEach(n)}}return e}onUIEvent(e){me.checkForEventMethods(e),e.action=this.getActionState(e);const t=e.action,{payload:r,srcElement:s}=e,o=e.event;this.sendChannelPayload(t,r,s,o)}}class Ne{constructor(){this.createDomObservableFromEvent=Ne.createDomObservableFromEvent.bind(this)}static createDomObservableFromEvent(e,t,r=!0,s=window){return t=void 0===t?e=>e:t,(0,R.fromEventPattern)((t=>s.addEventListener(e,t,{passive:r})),(()=>{s[e]=e=>e})).pipe((0,P.map)(t))}static createMediaQuery(e){const t=window.matchMedia(e);return this.checkIfValidMediaQuery(t,e),!1!==t&&t}static checkIfValidMediaQuery(e,t){const r=e=>e.replace(/\s+/gm,""),s=void 0!==e.matches&&r(e.media).indexOf(r(t))>=0;return!1===s&&(t=>{console.warn(`Spyne Info: the following query string, "${t}", has been optimized to "${e.media}" by the browser and may not be a valid Media Query item!`)})(t),s}static createMediaQueryHandler(e,t){let r=(e=>t=>(t.mediaQueryName=e,t))(t),s=(o=e,{addHandler:e=>{o.addListener(e)},removeHandler:e=>{o.onchange=()=>{}}});var o;return new R.fromEventPattern(s.addHandler,s.removeHandler).pipe((0,P.map)(r))}static createMergedObsFromObj(e){let r=e.mediqQueries,s=[];return(0,t.mapObjIndexed)(((e,t,r)=>{let o=Ne.createMediaQuery(e);return!1!==o&&s.push(Ne.createMediaQueryHandler(o,t)),s}),r),s}}const ge=n(205).map;class _e extends le{constructor(e="CHANNEL_WINDOW"){super(e),this.bindStaticMethods(),this.currentScrollY=0}initializeStream(){this.domChannelConfig=window.Spyne.config.channels.WINDOW;let e=this.getActiveObservables(),t=(0,R.merge)(...e);this.dom$=t,t.subscribe((e=>{let{action:t,payload:r,srcElement:s,event:o}=e;this.sendChannelPayload(t,r,s,o)}))}static getMouseWheelMapFn(e){let t=this.channelActions.CHANNEL_WINDOW_MOUSEWHEEL_EVENT,r=e.deltaY<=0?"up":"down",{deltaX:s,deltaY:o,deltaZ:n}=e;return{action:t,payload:{scrollDir:r,deltaX:s,deltaY:o,deltaZ:n},srcElement:e.srcElement,event:e}}static createCurriedGenericEvent(e){let r=`CHANNEL_WINDOW_${e.toUpperCase()}_EVENT`;return(0,t.curry)(_e.mapGenericEvent)(r)}static mapGenericEvent(e,t){return{action:e,payload:t,srcElement:t.srcElement,event:t}}static getResizeMapFn(e){return{action:this.channelActions.CHANNEL_WINDOW_RESIZE_EVENT,payload:(0,t.pick)(["innerWidth","innerHeight","outerWidth","outerHeight"],window),srcElement:e.srcElement,event:e}}static getOrientationMapFn(e){let r=this.channelActions.CHANNEL_WINDOW_ORIENTATION_EVENT,s=window.matchMedia("(orientation: portrait)").matches,o=(0,t.pick)(["innerWidth","innerHeight","outerWidth","outerHeight"],window);return o.orientation=!0===s?"portrait":"landscape",{action:r,payload:o,srcElement:e.srcElement,event:e}}getMediaQueryMapFn(e){return{action:this.channelActions.CHANNEL_WINDOW_MEDIA_QUERY_EVENT,payload:(0,t.pick)(["matches","media","mediaQueryName"],e),srcElement:e.srcElement,event:e}}createMouseWheelObservable(e){const t=e.debounceMSTimeForScroll;return Ne.createDomObservableFromEvent("mousewheel",_e.getMouseWheelMapFn.bind(this)).pipe((0,P.debounceTime)(t))}static getScrollData(){let e=0;return t=>{let r=e-t;return e=t,{scrollY:t,scrollDistance:r,scrollDir:r>=0?"up":"down"}}}static getScrollY(e){return void 0!==e.pageYOffset?e.pageYOffset:e.scrollTop}static getScrollMapFn(e,t,r,s,o){let n=s(_e.getScrollY(o)),{scrollDistance:i}=n;return{action:r,payload:n,srcElement:e.srcElement,scrollDistance:i,event:e}}createScrollObservable(e,r=window){const s=e.debounceMSTimeForScroll,o=r===window,n=void 0!==e.scrollElForVals?e.scrollElForVals:r,i=o?"CHANNEL_WINDOW_SCROLL_EVENT":"CHANNEL_WINDOW_ELEMENT_SCROLL_EVENT",a=_e.getScrollData(),c=(0,t.partialRight)(_e.getScrollMapFn,[i,a,n]).bind(this);return Ne.createDomObservableFromEvent("scroll",c).pipe((0,P.debounceTime)(s),(0,P.skipWhile)((e=>0===e.scrollDistance)),(0,P.map)((e=>{const t=_e.getScrollY(window);return e.payload.scrollDistanceAbs=Math.abs(this.currentScrollY-t),this.currentScrollY=t,e})))}createOrientationObservable(e){return Ne.createDomObservableFromEvent("orientationchange",_e.getOrientationMapFn.bind(this))}createResizeObservable(e){const t=e.debounceMSTimeForResize;return Ne.createDomObservableFromEvent("resize",_e.getResizeMapFn.bind(this)).pipe((0,P.debounceTime)(t))}getEventsFromConfig(e=this.domChannelConfig){let t=e.events;return ge((e=>{let t=_e.createCurriedGenericEvent(e);return Ne.createDomObservableFromEvent(e,t)}),t)}getActiveObservables(e=this.domChannelConfig){let r=[];e.listenForMediaQueries=(e=>{const r=(0,t.compose)((0,t.complement)(t.isEmpty),t.head,t.values),s=(0,t.compose)((0,t.complement)(t.isNil),t.head,t.values);return(0,t.allPass)([r,s])(e)})(e.mediqQueries);let s={listenForResize:this.createResizeObservable.bind(this),listenForOrientation:this.createOrientationObservable.bind(this),listenForScroll:this.createScrollObservable.bind(this),listenForMouseWheel:this.createMouseWheelObservable.bind(this)};(0,t.mapObjIndexed)(((t,s,o)=>{e[s]&&r.push(t(e))}),s),this.checkForMediaQueries(e.listenForMediaQueries);let o=this.getEventsFromConfig(e);return r=r.concat(o),r}checkForMediaQueries(e){!0===e&&this.getMediaQueryObservable(this.domChannelConfig).subscribe((e=>{let{action:t,payload:r,srcElement:s,event:o}=e;this.sendChannelPayload(t,r,s,o,this.observer$)}))}getMediaQueryObservable(e){let r=this.createMergedObsFromObj(e);return(0,t.apply)(R.merge,r).pipe((0,P.map)(this.getMediaQueryMapFn.bind(this)))}addRegisteredActions(){return["CHANNEL_WINDOW_ABORT_EVENT","CHANNEL_WINDOW_AFTERPRINT_EVENT","CHANNEL_WINDOW_ANIMATIONEND_EVENT","CHANNEL_WINDOW_ANIMATIONITERATION_EVENT","CHANNEL_WINDOW_ANIMATIONSTART_EVENT","CHANNEL_WINDOW_APPINSTALLED_EVENT","CHANNEL_WINDOW_BEFOREPRINT_EVENT","CHANNEL_WINDOW_BEFOREUNLOAD_EVENT","CHANNEL_WINDOW_BEGINEVENT_EVENT","CHANNEL_WINDOW_BLUR_EVENT","CHANNEL_WINDOW_CACHED_EVENT","CHANNEL_WINDOW_CHANGE_EVENT","CHANNEL_WINDOW_CLICK_EVENT","CHANNEL_WINDOW_CLOSE_EVENT","CHANNEL_WINDOW_COMPOSITIONEND_EVENT","CHANNEL_WINDOW_COMPOSITIONSTART_EVENT","CHANNEL_WINDOW_COMPOSITIONUPDATE_EVENT","CHANNEL_WINDOW_COPY_EVENT","CHANNEL_WINDOW_CUT_EVENT","CHANNEL_WINDOW_DEVICECHANGE_EVENT","CHANNEL_WINDOW_DEVICELIGHT_EVENT","CHANNEL_WINDOW_DEVICEMOTION_EVENT","CHANNEL_WINDOW_DEVICEORIENTATION_EVENT","CHANNEL_WINDOW_DEVICEPROXIMITY_EVENT","CHANNEL_WINDOW_DOMATTRIBUTENAMECHANGED_EVENT","CHANNEL_WINDOW_DOMATTRMODIFIED_EVENT","CHANNEL_WINDOW_DOMCHARACTERDATAMODIFIED_EVENT","CHANNEL_WINDOW_DOMCONTENTLOADED_EVENT","CHANNEL_WINDOW_DOMELEMENTNAMECHANGED_EVENT","CHANNEL_WINDOW_ERROR_EVENT","CHANNEL_WINDOW_FOCUSIN_EVENT","CHANNEL_WINDOW_FOCUS_EVENT","CHANNEL_WINDOW_FULLSCREENCHANGE_EVENT","CHANNEL_WINDOW_FULLSCREENERROR_EVENT","CHANNEL_WINDOW_LOAD_EVENT","CHANNEL_WINDOW_MEDIA_QUERY_EVENT","CHANNEL_WINDOW_MESSAGE_EVENT","CHANNEL_WINDOW_MOUSEWHEEL_EVENT","CHANNEL_WINDOW_OFFLINE_EVENT","CHANNEL_WINDOW_ONLINE_EVENT","CHANNEL_WINDOW_OPEN_EVENT","CHANNEL_WINDOW_ORIENTATION_EVENT","CHANNEL_WINDOW_PAGEHIDE_EVENT","CHANNEL_WINDOW_PAGESHOW_EVENT","CHANNEL_WINDOW_POPSTATE_EVENT","CHANNEL_WINDOW_RESET_EVENT","CHANNEL_WINDOW_RESIZE_EVENT","CHANNEL_WINDOW_ELEMENT_SCROLL_EVENT",["CHANNEL_WINDOW_SET_ELEMENT_TO_SCROLL_EVENT","onSetElementToScroll"],"CHANNEL_WINDOW_SCROLL_EVENT","CHANNEL_WINDOW_SCROLL_LOCK_EVENT",["CHANNEL_WINDOW_SCROLL_LOCK_EVENT","onScrollLockEvent"],"CHANNEL_WINDOW_SUBMIT_EVENT","CHANNEL_WINDOW_TRANSITIONCANCEL_EVENT","CHANNEL_WINDOW_TRANSITIONEND_EVENT","CHANNEL_WINDOW_TRANSITIONRUN_EVENT","CHANNEL_WINDOW_TRANSITIONSTART_EVENT","CHANNEL_WINDOW_UNLOAD_EVENT","CHANNEL_WINDOW_WHEEL_EVENT"]}onScrollLockEvent(e){let{action:t,scrollLock:r}=e.payload;window.Spyne.config.scrollLock=r,!0===r&&(window.Spyne.config.scrollLockX=window.scrollX,window.Spyne.config.scrollLockY=window.scrollY),this.sendChannelPayload(t,{scrollLock:r})}onSetElementToScroll(e){let{config:t,scrollElement:r}=e.payload;t=O(this.domChannelConfig,t),this.createScrollObservable(t,r).subscribe((e=>{let{action:t,payload:r,srcElement:s,event:o}=e;this.sendChannelPayload(t,r,s,o)}))}bindStaticMethods(){this.createMediaQueryHandler=Ne.createMediaQueryHandler.bind(this),this.createMergedObsFromObj=Ne.createMergedObsFromObj.bind(this)}}class ye extends le{constructor(e={}){super("CHANNEL_LIFECYCLE",e)}addRegisteredActions(){return["CHANNEL_LIFECYCLE_RENDERED_EVENT","CHANNEL_LIFECYCLE_DISPOSED_EVENT"]}onViewStreamInfo(e){let{data:t,action:r,srcElement:s}=e.props(),o=s;o.action=r,this.onSendEvent(r,o)}onSendEvent(e,t={}){const r=this.channelActions[e],s={};window.setTimeout((()=>this.sendChannelPayload(r,t,s,void 0)),0)}}class Se extends le{constructor(e,r={}){r.isProxy=!0,super(e,r),this.props=r,this.subject$=new R.Subject,this.replaySub$=new R.ReplaySubject(1),this.observer$=(0,R.merge)(this.subject$,this.replaySub$),!0==(!0===(0,t.path)(["Spyne","config","debug"],window))&&this.checkIfChannelIsStillProxy(e)}getMergedSubject(e=!1){return!0===e?this.replaySub$:this.subject$}checkIfChannelIsStillProxy(e){let r=e;window.setTimeout((()=>{!0!==(0,t.includes)(r,window.Spyne.channels.listRegisteredChannels())&&console.warn(`Spyne Warning: The channel, ${r} does not appear to be registered!`)}),1e3)}get replaySubject(){return this.replaySub$}get subject(){return this.subject$}}const Te=n(205).map;class fe{constructor(){this.addMixins(),this.map=new Map,this.map.set("DISPATCHER",new R.Subject),this.listRegisteredChannels=fe.listRegisteredChannels.bind(this),this.getChannelsList=fe.getChannelsList.bind(this)}static getChannelsList(){return Array.from(window.Spyne.channels.map,((e,t)=>({key:e[0],val:e[1].constructor.name})))}static listRegisteredChannels(e=!1){let r=this.getChannelsList(),s=(0,t.reject)((0,t.propEq)("val","ChannelProxy")),o=(0,t.filter)((0,t.propEq)("val","ChannelProxy")),n=(!0===e?o:s)(r);return(0,t.pluck)(["key"],n)}listProxyChannels(){return this.listRegisteredChannels(!0)}checkForMissingChannels(){let e=this.getChannelsList(),r=(0,t.filter)((0,t.propEq)("val","ChannelProxy"))(e);if(r.length>=1){let e=`Spyne Warning: The following ${1===r.length?"Channel has":"Channels have"} not been initialized: ${(0,t.compose)((0,t.join)(", "),Te((0,t.prop)("key")))(r)}`;console.warn(e)}}init(){this.createMainStreams()}createObserver(e){k(e.validations,e.init),this.map.set(e.init.name,e.init.observable())}createMainStreams(){this.routeStream=new Ee,this.map.set("CHANNEL_ROUTE",this.routeStream),window.Spyne.config.channels.CHANNEL_ROUTE={},this.uiStream=new me,this.map.set("CHANNEL_UI",this.uiStream),window.Spyne.config.channels.CHANNEL_UI={},this.domStream=new _e,this.map.set("CHANNEL_WINDOW",this.domStream),window.Spyne.config.channels.CHANNEL_WINDOW={},this.viewStreamLifecycle=new ye,this.map.set("CHANNEL_LIFECYCLE",this.viewStreamLifecycle),window.Spyne.config.channels.CHANNEL_LIFECYCLE={},this.routeStream.initializeStream(),this.domStream.initializeStream()}addKeyEvent(e){this.map.get("UI").addKeyEvent(e)}registerStream(e){let r=e.channelName;this.map.has(r)&&(0,t.compose)((0,t.pathEq)(["props","isRegistered"],!0))(this.map.get(r))?console.warn(`Spyne Warning: The Channel, ${r}, has already been registered!`):(window.Spyne.config.channels[r]={},this.map.set(r,e),e.initializeStream())}getChannelActions(e){return this.map.get(e).addRegisteredActions()}getProxySubject(e,t=!1){let r=!0===t?"replaySubject":"subject";return this.map.get(e)[r]}testStream(e){return void 0!==this.map.get(e)}getStream(e){return!1===this.testStream(e)&&this.map.set(e,new Se(e)),this.map.get(e)}addMixins(){}}class Ae{constructor(){this._packetMap=new Map,this._iter=0,this.createFilterGateway=Ae.createFilterGateway.bind(this),this.createDataPacket=Ae.createDataPacket.bind(this),this.createLabel=Ae.createLabel.bind(this)}static deepFreeze(e){try{Object.freeze(e),Object.getOwnPropertyNames(e).forEach((function(t){!e.hasOwnProperty(t)||null===e[t]||"object"!=typeof e[t]&&"function"!=typeof e[t]||Object.isFrozen(e[t])||Ae.deepFreeze(e[t])}))}catch(t){return e}return e}static createDataPacket(e={},r=[]){e=Ae.deepFreeze(e);const s=this.createLabel();this._packetMap.set(s,e);const o=(0,t.compose)(t.keys,(0,t.omit)(["props"]))(e),n=Ae.createTimeStamp(),i=this.createFilterGateway(e),a=r.reduce(((t={},r)=>("props"===r||(t[r]=e[r]),t)),{}),c=(0,t.ifElse)((0,t.prop)("props"),(0,t.invoker)(0,"props"),t.identity),l=()=>{const e=this._packetMap.get(s);o.forEach((t=>{d[t]=e[t]}))};let p=Object.create(null),d=(0,t.mergeAll)([{timestamp:n,label:s,props:()=>c(this._packetMap.get(s)),users:()=>this._packetMap.get(s).payload.users,isPacket:!0,packedData:()=>this._packetMap.get(s),unpack:l,filterGateway:i},a]);return d=O(d,p),d}static createAllPassFilterGateway(){}static createFilterGateway(e,t=this._packetMap){return r=>{if("function"==typeof r)try{return r(t.get(e))}catch(e){console.log("predicate not working -> ",e)}return!1}}static createUnpackedDataArr(e){return(0,t.keys)(e)}static createLabel(e=this._iter++){return`packet_num_${this._iter}`}static createTimeStamp(){return Date.now()}static createPacketUnpacker(){}}class Ce{constructor(e,t="",r=!0){return this.parentContext=e,this.omittedMethods=["autoBinder","initAutoBinder","getEnhancerMethods","checkForMalformedMethods","caller","arguments","bindParentViewStream"],this.prefix=t,!0===r&&this.autoBinder(),this.allMethodsList}initAutoBinder(){this.autoBinder()}getEnhancerMethods(){return s(this,this.omittedMethods)}checkForMalformedMethods(e){if(""===this.prefix)return void console.warn(`SPYNE WARNING: The following SpyneTrait ${this.constructor.name} needs a prefix`);let r=(0,t.reject)((e=>0===e.indexOf(this.prefix)),e);if(r.length>=1){let e=`Spyne Warning: The following method(s) in ${this.constructor.name} require the prefix, "${this.prefix}": [${r.join(", ")}];`;console.warn(e)}}bindParentViewStream(e,r){this.checkForMalformedMethods(e.allMethods);let s={};const o=(e,t=!1)=>{let o=!0===t?this.constructor:this;var n;"function"==typeof o[e]&&(s[e]=r[n=e]=o[n].bind(r))},n=(0,t.curryN)(2,o)(t.__,!0);return(0,t.map)(n,e.staticMethods),(0,t.map)(o,e.methods),s}autoBinder(){let e=this.getEnhancerMethods();return this.allMethodsList=this.bindParentViewStream(e,this.parentContext),this.allMethodsList}}class be{constructor(e,t,r){this._mapFn=be.setMapFn(e),this._url=be.setUrl(e),this._responseType=be.setResponseType(e),this._serverOptions=be.setServerOptions(e),this._subscriber=void 0!==t?t:e=>console.log("FETCH RETURNED ",e),this.debug=void 0!==e.debug&&e.debug;let s={mapFn:this.mapFn,url:this.url,serverOptions:this.serverOptions,responseType:this.responseType,debug:this.debug};!0!==r&&be.startWindowFetch(s,this._subscriber)}static startWindowFetch(e,t){let{mapFn:r,url:s,serverOptions:o,responseType:n,debug:i}=e;const a=!0===i?e=>console.log("DEBUG FETCH :",e):()=>{};let c=(0,R.from)(window.fetch(s,o)).pipe((0,P.tap)(a),(0,P.flatMap)((e=>(0,R.from)(e[n]()))),(0,P.map)(r),(0,P.publish)());c.connect(),c.subscribe(t)}static setMapFn(e){return(0,t.compose)((0,t.defaultTo)((e=>e)),(0,t.prop)("mapFn"))(e)}static setUrl(e){let r=(0,t.prop)("url",e);return void 0===r&&console.warn("SPYNE WARNING: URL is undefined for data channel"),r}static setResponseType(e){return(0,t.defaultTo)("json",(0,t.prop)("responseType",e))}get mapFn(){return this._mapFn}get url(){return this._url}get serverOptions(){return this._serverOptions}get responseType(){return this._responseType}static stringifyBodyIfItExists(e){return(0,t.when)((0,t.propIs)(Object,"body"),(0,t.compose)((0,t.over)((0,t.lensProp)("body"),JSON.stringify)))(e)}static updateMethodWhenBodyExists(e){const r=(0,t.has)("body"),s=(0,t.propEq)("method","GET"),o=(0,t.allPass)([r,s]);return(0,t.when)(o,(0,t.assoc)("method","POST"))(e)}static setServerOptions(e){let r=(0,t.pick)(["header","body","mode","method"],e),s=(0,t.mergeDeepRight)(be.baseOptions(),r);return s=be.updateMethodWhenBodyExists(s),s=be.stringifyBodyIfItExists(s),s}static baseOptions(){return{method:"GET",headers:{Accept:"application/json, text/plain, */*"}}}}class ve extends le{constructor(e,t={}){void 0!==t.map&&(t.mapFn=t.map),t.extendedActionsArr=[`${e}_DATA_EVENT`,[`${e}_UPDATE_DATA_EVENT`,"onFetchUpdate"]],t.sendCachedPayload=!0,super(e,t)}onRegistered(){this.startFetch()}addRegisteredActions(e){let r=(0,t.compose)((0,t.defaultTo)([]),(0,t.path)(["props","extendedActionsArr"]));return["CHANNEL_DATA_EVENT",["CHANNEL_UPDATE_DATA_EVENT","onFetchUpdate"]].concat(r(this))}startFetch(e={},t=this.onFetchReturned.bind(this)){let r=this.consolidateAllFetchProps(e);return new be(r,t)}onFetchUpdate(e){let t=this.getPropsForFetch(e);this.startFetch(t)}onFetchReturned(e){this.createChannelPayloadItem(e)}createChannelPayloadItem(e,t=`${this.props.name}_DATA_EVENT`){this.sendChannelPayload(t,e)}getPropsForFetch(e){let r=(0,t.path)(["viewStreamInfo","payload"],e);return(0,t.pick)(["mapFn","url","header","body","mode","method","responseType","debug"],r)}consolidateAllFetchProps(e,r=this.props){let s=(0,t.pick)(["mapFn","url","header","body","mode","method","responseType","debug"],r);const o=(0,t.reject)(t.isNil);return(0,t.compose)(o,((e,r)=>(0,t.mergeDeepRight)(e,r)))(s,e)}get observer(){return this.observer$}}class Oe{constructor(e={}){let{name:t,config:r,parentEl:s}=e;if(this.props=e,this.name=t||"empty",this.props.name=t,r=Oe.mergeDefaultConfig(r,this.defaultConfig()),this.props.parentEl=s||Oe.createParentEl(),this.props.spyneApp=Oe.getSpyneApp(t,r),console.log("SPYNE APP ",{name:t},this.name,this.props.spyneApp),!1===this.props.spyneApp)return!1;this.onBeforeRegistered(),this.onRegistered(),this.onRender()}onBeforeRegistered(){this.props.pluginName=this.props.name,this.props.config=(0,t.path)(["Spyne","config","plugins",this.props.name],window)}static mergeDefaultConfig(e={},t=this.defaultConfig()){return Object.assign(t,e)}defaultConfig(){return{}}static getSpyneApp(e,r){const s=window||{};let o=(0,t.prop)("Spyne",s);return o=!0==("object"==typeof o)?o:new o,!1!==Oe.updateSpyneConfig(o,e,r)&&o}static updateSpyneConfig(e,r,s){return!0===(0,t.pathSatisfies)((0,t.is)(Object),["config","plugins",r])(e)?(!0===e.config.debug&&console.warn(`Spyne Warning: The plugin, ${r}, already exists`),!1):(e.config.plugins[r]=s,e.config.plugins[r])}static createParentEl(e){return e||document.getElementById("spyne-plugins")||(()=>{const e=new L({id:"spyne-plugins"});document.body.appendChild(e.render());const t=document.getElementById("spyne-plugins");return t.style.cssText="position:absolute; top:0;left:0;width:100%;height:100%;min-height:100vh; pointer-events:none",t})()}onRegistered(){}onRender(){}}class Ie{constructor(e={}){this.channels=new fe,this.VERSION="0.15.2",this.ViewStream=ie,this.BasicView=H,this.DomEl=L,this.ViewStreamBroadcaster=G,this.ChannelsPayload=j,this.ChannelsController=fe,this.ChannelsBase=le,this.ChannelPayloadItem=f,this._channelDataPacketGenerator=new Ae,window.Spyne=this;void 0!==e&&(e=de.conformRouteObject(e),window.Spyne.config=O({scrollLock:!1,scrollLockX:31,scrollLockY:0,debug:!1,utils:{tableRE:/^([^>]*?)(<){1}(\b)(thead|col|colgroup|tbody|td|tfoot|tr|th)(\b)([^\0]*)$/},tmp:{},plugins:{},channels:{WINDOW:{mediqQueries:{},events:[],listenForResize:!0,listenForOrientation:!0,listenForScroll:!1,listenForMouseWheel:!1,debounceMSTimeForResize:200,debounceMSTimeForScroll:150},ROUTE:{type:"slash",isHash:!1,isHidden:!1,add404s:!1,routes:{routePath:{routeName:"change"}}},CHANNEL_ROUTE:{},CHANNEL_UI:{}}},e)),this.getChannelActions=e=>window.Spyne.channels.getChannelActions(e),this.registerChannel=e=>this.channels.registerStream(e),this.registerDataChannel=e=>this.channels.registerStream(e),this.listChannels=()=>Array.from(window.Spyne.channels.map.keys());let t=new ie({id:"spyne-null-views"});t.appendToDom(document.body),t.props.el.style.cssText="display:none; opacity:0; pointer-events:none;",this.channels.init()}get createDataPacket(){return this._channelDataPacketGenerator.createDataPacket}static listChannels(){return Array.from(window.Spyne.channels.map.keys())}static getChannelActions(e){return window.Spyne.channels.getChannelActions(e)}static registerChannel(e){if(void 0!==window.Spyne)return window.Spyne.channels.registerStream(e);console.warn("Spyne has not been initialized")}}window.Spyne=Ie})(),i})()}));